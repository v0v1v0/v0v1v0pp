<div class="container">

<table style="width: 100%;"><tr>
<td>PeakSegJointHeuristicStep1</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>PeakSegJointHeuristicStep1</h2>

<h3>Description</h3>

<p>Run the first step of the PeakSegJoint fast heuristic optimization
algorithm. This is the GridSearch subroutine of the JointZoom algorithm
in arXiv:1506.01286. NB: this function is only for testing the C code
against the R implementation (search tests/testthat/*.R for Step1).
For real data see
<code>PeakSegJointSeveral</code>.</p>


<h3>Usage</h3>

<pre><code class="language-R">PeakSegJointHeuristicStep1(profiles, 
    bin.factor = 2L)</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>profiles</code></td>
<td>
<p>List of data.frames with columns chromStart, chromEnd, count, or
single data.frame with additional column sample.id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin.factor</code></td>
<td>
<p>Size of bin pyramid. Bigger values result in slower computation.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>List of model fit results, which can be passed to <code>ConvertModelList</code>
for easier interpretation.</p>


<h3>Author(s)</h3>

<p>Toby Dylan Hocking &lt;toby.hocking@r-project.org&gt; [aut, cre]</p>


<h3>Examples</h3>

<pre><code class="language-R">library(PeakSegJoint)
library(ggplot2)
data(H3K36me3.TDH.other.chunk1, envir=environment())
lims &lt;- c(43000000, 43200000) # left
some.counts &lt;-
  subset(H3K36me3.TDH.other.chunk1$counts,
         lims[1] &lt; chromEnd &amp; chromStart &lt; lims[2])
fit &lt;- PeakSegJointHeuristicStep1(some.counts)
## Compute bins to show on plot as well.
profile.list &lt;- split(some.counts, some.counts$sample.id)
bin.list &lt;- list()
norm.list &lt;- list()
for(sample.id in names(profile.list)){
  one &lt;- profile.list[[sample.id]]
  max.count &lt;- max(one$count)
  bins &lt;- binSum(one, fit$bin_start_end[1], fit$bases_per_bin, fit$n_bins)
  stopifnot(fit$n_bins == nrow(bins))
  bins$mean &lt;- with(bins, count/(chromEnd-chromStart))
  bins$mean.norm &lt;- bins$mean/max.count
  stopifnot(bins$count &gt;= 0)
  one$count.norm &lt;- one$count/max.count
  norm.list[[sample.id]] &lt;- one
  bin.list[[sample.id]] &lt;- data.frame(sample.id, bins)
}
bin.df &lt;- do.call(rbind, bin.list)
norm.df &lt;- do.call(rbind, norm.list)
converted &lt;- ConvertModelList(fit)
best.peaks &lt;- transform(converted$peaks, y=peaks*-0.1, what="peaks")

if(require(ggplot2) &amp;&amp; interactive()){

  ggplot()+
    scale_color_manual(values=c(data="grey50",
                                peaks="deepskyblue",
                                bins="black", segments="green"))+
    geom_step(aes(chromStart/1e3, count.norm, color=what),
              data=data.frame(norm.df, what="data"))+
    geom_segment(aes(chromStart/1e3, mean.norm,
                     xend=chromEnd/1e3, yend=mean.norm,
                     color=what),
                 data=data.frame(bin.df, what="bins"))+
    geom_segment(aes(chromStart/1e3, y,
                     xend=chromEnd/1e3, yend=y,
                     color=what),
                 size=1,
                 data=best.peaks)+
    geom_text(aes(chromStart/1e3, y,
                  label=paste0(peaks, " peak",
                               ifelse(peaks==1, "", "s"), " "),
                  color=what),
              hjust=1,
              size=3,
              vjust=0.5,
              data=best.peaks)+
    theme_bw()+
    theme(panel.margin=grid::unit(0, "cm"))+
    facet_grid(sample.id ~ ., scales="free")

}

</code></pre>


</div>