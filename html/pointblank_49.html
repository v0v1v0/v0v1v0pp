<div class="container">

<table style="width: 100%;"><tr>
<td>draft_validation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Draft a starter <strong>pointblank</strong> validation .R/.Rmd file with a data table</h2>

<h3>Description</h3>

<p>Generate a draft validation plan in a new .R or .Rmd file using an input data
table. Using this workflow, the data table will be scanned to learn about its
column data and a set of starter validation steps (constituting a validation
plan) will be written. It's best to use a data extract that contains at least
1000 rows and is relatively free of spurious data.
</p>
<p>Once in the file, it's possible to tweak the validation steps to better fit
the expectations to the particular domain. While column inference is used to
generate reasonable validation plans, it is difficult to infer the acceptable
values without domain expertise. However, using <code>draft_validation()</code> could
get you started on floor 10 of tackling data quality issues and is in any
case better than starting with an empty code editor view.
</p>


<h3>Usage</h3>

<pre><code class="language-R">draft_validation(
  tbl,
  tbl_name = NULL,
  filename = tbl_name,
  path = NULL,
  lang = NULL,
  output_type = c("R", "Rmd"),
  add_comments = TRUE,
  overwrite = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tbl</code></td>
<td>
<p><em>A data table</em>
</p>
<p><code style="white-space: pre;">⁠obj:&lt;tbl_*&gt;⁠</code> // <strong>required</strong>
</p>
<p>The input table. This can be a data frame, tibble, a <code>tbl_dbi</code> object, or a
<code>tbl_spark</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tbl_name</code></td>
<td>
<p><em>A table name</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>A optional name to assign to the input table object. If no value is
provided, a name will be generated based on whatever information is
available. This table name will be displayed in the header area of the
agent report generated by printing the <em>agent</em> or calling
<code>get_agent_report()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p><em>File name</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>tbl_name</code>
</p>
<p>An optional name for the .R or .Rmd file. This should be a name without an
extension. By default, this is taken from the <code>tbl_name</code> but if nothing is
supplied for that, the name will contain the text <code>"draft_validation_"</code>
followed by the current date and time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p><em>File path</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>A path can be specified here if there shouldn't be an attempt to place the
generated file in the working directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lang</code></td>
<td>
<p><em>Commenting language</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>The language to use when creating comments for the automatically- generated
validation steps. By default, <code>NULL</code> will create English (<code>"en"</code>) text.
Other options include French (<code>"fr"</code>), German (<code>"de"</code>), Italian (<code>"it"</code>),
Spanish (<code>"es"</code>), Portuguese (<code>"pt"</code>), Turkish (<code>"tr"</code>), Chinese (<code>"zh"</code>),
Russian (<code>"ru"</code>), Polish (<code>"pl"</code>), Danish (<code>"da"</code>), Swedish (<code>"sv"</code>), and
Dutch (<code>"nl"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_type</code></td>
<td>
<p><em>The output file type</em>
</p>
<p><code style="white-space: pre;">⁠singl-kw:[R|Rmd]⁠</code> // <em>default:</em> <code>"R"</code>
</p>
<p>An option for choosing what type of output should be generated. By default,
this is an .R script (<code>"R"</code>) but this could alternatively be an R Markdown
document (<code>"Rmd"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_comments</code></td>
<td>
<p><em>Add comments to the generated validation plan</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;logical&gt;⁠</code> // <em>default:</em> <code>TRUE</code>
</p>
<p>Should there be comments that explain the features of the validation plan
in the generated document?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p><em>Overwrite a previous file of the same name</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;logical&gt;⁠</code> // <em>default:</em> <code>FALSE</code>
</p>
<p>Should a file of the same name be overwritten?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p><em>Inform (or not) upon file writing</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;logical&gt;⁠</code> // <em>default:</em> <code>FALSE</code>
</p>
<p>Should the function <em>not</em> inform when the file is written?</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Invisibly returns <code>TRUE</code> if the file has been written.
</p>


<h3>Supported Input Tables</h3>

<p>The types of data tables that are officially supported are:
</p>

<ul>
<li>
<p> data frames (<code>data.frame</code>) and tibbles (<code>tbl_df</code>)
</p>
</li>
<li>
<p> Spark DataFrames (<code>tbl_spark</code>)
</p>
</li>
<li>
<p> the following database tables (<code>tbl_dbi</code>):
</p>

<ul>
<li> <p><em>PostgreSQL</em> tables (using the <code>RPostgres::Postgres()</code> as driver)
</p>
</li>
<li> <p><em>MySQL</em> tables (with <code>RMySQL::MySQL()</code>)
</p>
</li>
<li> <p><em>Microsoft SQL Server</em> tables (via <strong>odbc</strong>)
</p>
</li>
<li> <p><em>BigQuery</em> tables (using <code>bigrquery::bigquery()</code>)
</p>
</li>
<li> <p><em>DuckDB</em> tables (through <code>duckdb::duckdb()</code>)
</p>
</li>
<li> <p><em>SQLite</em> (with <code>RSQLite::SQLite()</code>)
</p>
</li>
</ul>
</li>
</ul>
<p>Other database tables may work to varying degrees but they haven't been
formally tested (so be mindful of this when using unsupported backends with
<strong>pointblank</strong>).
</p>


<h3>Examples</h3>

<p>Let's draft a validation plan for the <code>dplyr::storms</code> dataset.
</p>
<div class="sourceCode r"><pre>dplyr::storms
#&gt; # A tibble: 19,537 x 13
#&gt;    name   year month   day  hour   lat  long status      category  wind pressure
#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt; &lt;int&gt;    &lt;int&gt;
#&gt;  1 Amy    1975     6    27     0  27.5 -79   tropical d~       NA    25     1013
#&gt;  2 Amy    1975     6    27     6  28.5 -79   tropical d~       NA    25     1013
#&gt;  3 Amy    1975     6    27    12  29.5 -79   tropical d~       NA    25     1013
#&gt;  4 Amy    1975     6    27    18  30.5 -79   tropical d~       NA    25     1013
#&gt;  5 Amy    1975     6    28     0  31.5 -78.8 tropical d~       NA    25     1012
#&gt;  6 Amy    1975     6    28     6  32.4 -78.7 tropical d~       NA    25     1012
#&gt;  7 Amy    1975     6    28    12  33.3 -78   tropical d~       NA    25     1011
#&gt;  8 Amy    1975     6    28    18  34   -77   tropical d~       NA    30     1006
#&gt;  9 Amy    1975     6    29     0  34.4 -75.8 tropical s~       NA    35     1004
#&gt; 10 Amy    1975     6    29     6  34   -74.8 tropical s~       NA    40     1002
#&gt; # i 19,527 more rows
#&gt; # i 2 more variables: tropicalstorm_force_diameter &lt;int&gt;,
#&gt; #   hurricane_force_diameter &lt;int&gt;
</pre></div>
<p>The <code>draft_validation()</code> function creates an .R file by default. Using just
the defaults with <code>dplyr::storms</code> will yield the <code>"dplyr__storms.R"</code> file
in the working directory. Here are the contents of the file:
</p>
<div class="sourceCode r"><pre>library(pointblank)

agent &lt;-
  create_agent(
    tbl = ~ dplyr::storms,
    actions = action_levels(
      warn_at = 0.05,
      stop_at = 0.10
    ),
    tbl_name = "dplyr::storms",
    label = "Validation plan generated by `draft_validation()`."
  ) %&gt;%
  # Expect that column `name` is of type: character
  col_is_character(
    columns = name
  ) %&gt;%
  # Expect that column `year` is of type: numeric
  col_is_numeric(
    columns = year
  ) %&gt;%
  # Expect that values in `year` should be between `1975` and `2020`
  col_vals_between(
    columns = year,
    left = 1975,
    right = 2020
  ) %&gt;%
  # Expect that column `month` is of type: numeric
  col_is_numeric(
    columns = month
  ) %&gt;%
  # Expect that values in `month` should be between `1` and `12`
  col_vals_between(
    columns = month,
    left = 1,
    right = 12
  ) %&gt;%
  # Expect that column `day` is of type: integer
  col_is_integer(
    columns = day
  ) %&gt;%
  # Expect that values in `day` should be between `1` and `31`
  col_vals_between(
    columns = day,
    left = 1,
    right = 31
  ) %&gt;%
  # Expect that column `hour` is of type: numeric
  col_is_numeric(
    columns = hour
  ) %&gt;%
  # Expect that values in `hour` should be between `0` and `23`
  col_vals_between(
    columns = hour,
    left = 0,
    right = 23
  ) %&gt;%
  # Expect that column `lat` is of type: numeric
  col_is_numeric(
    columns = lat
  ) %&gt;%
  # Expect that values in `lat` should be between `-90` and `90`
  col_vals_between(
    columns = lat,
    left = -90,
    right = 90
  ) %&gt;%
  # Expect that column `long` is of type: numeric
  col_is_numeric(
    columns = long
  ) %&gt;%
  # Expect that values in `long` should be between `-180` and `180`
  col_vals_between(
    columns = long,
    left = -180,
    right = 180
  ) %&gt;%
  # Expect that column `status` is of type: character
  col_is_character(
    columns = status
  ) %&gt;%
  # Expect that column `category` is of type: factor
  col_is_factor(
    columns = category
  ) %&gt;%
  # Expect that column `wind` is of type: integer
  col_is_integer(
    columns = wind
  ) %&gt;%
  # Expect that values in `wind` should be between `10` and `160`
  col_vals_between(
    columns = wind,
    left = 10,
    right = 160
  ) %&gt;%
  # Expect that column `pressure` is of type: integer
  col_is_integer(
    columns = pressure
  ) %&gt;%
  # Expect that values in `pressure` should be between `882` and `1022`
  col_vals_between(
    columns = pressure,
    left = 882,
    right = 1022
  ) %&gt;%
  # Expect that column `tropicalstorm_force_diameter` is of type: integer
  col_is_integer(
    columns = tropicalstorm_force_diameter
  ) %&gt;%
  # Expect that values in `tropicalstorm_force_diameter` should be between
  # `0` and `870`
  col_vals_between(
    columns = tropicalstorm_force_diameter,
    left = 0,
    right = 870,
    na_pass = TRUE
  ) %&gt;%
  # Expect that column `hurricane_force_diameter` is of type: integer
  col_is_integer(
    columns = hurricane_force_diameter
  ) %&gt;%
  # Expect that values in `hurricane_force_diameter` should be between
  # `0` and `300`
  col_vals_between(
    columns = hurricane_force_diameter,
    left = 0,
    right = 300,
    na_pass = TRUE
  ) %&gt;%
  # Expect entirely distinct rows across all columns
  rows_distinct() %&gt;%
  # Expect that column schemas match
  col_schema_match(
    schema = col_schema(
      name = "character",
      year = "numeric",
      month = "numeric",
      day = "integer",
      hour = "numeric",
      lat = "numeric",
      long = "numeric",
      status = "character",
      category = c("ordered", "factor"),
      wind = "integer",
      pressure = "integer",
      tropicalstorm_force_diameter = "integer",
      hurricane_force_diameter = "integer"
    )
  ) %&gt;%
  interrogate()

agent
</pre></div>
<p>This is runnable as is, and the promise is that the interrogation should
produce no failing test units. After execution, we get the following
validation report:
</p>


<img src="https://raw.githubusercontent.com/rstudio/pointblank/main/images/man_draft_validation_1.png" alt="This image was generated from the first code example in the `draft_validation()` help file." style="width:100%;"><p>All of the expressions in the resulting file constitute just a rough
approximation of what a validation plan should be for a dataset. Certainly,
the value ranges in the emitted <code>col_vals_between()</code> may not be realistic for
the <code>wind</code> column and may require some modification (the provided <code>left</code> and
<code>right</code> values are just the limits of the provided data). However, note that
the <code>lat</code> and <code>long</code> (latitude and longitude) columns have acceptable ranges
(providing the limits of valid lat/lon values). This is thanks to
<strong>pointblank</strong>'s column inference routines, which is able to understand what
certain columns contain.
</p>
<p>For an evolving dataset that will experience changes (either in the form of
revised data and addition/deletion of rows or columns), the emitted
validation will serve as a good first step and changes can more easily be
made since there is a foundation to build from.
</p>


<h3>Function ID</h3>

<p>1-11
</p>


<h3>See Also</h3>

<p>Other Planning and Prep: 
<code>action_levels()</code>,
<code>create_agent()</code>,
<code>create_informant()</code>,
<code>db_tbl()</code>,
<code>file_tbl()</code>,
<code>scan_data()</code>,
<code>tbl_get()</code>,
<code>tbl_source()</code>,
<code>tbl_store()</code>,
<code>validate_rmd()</code>
</p>


</div>