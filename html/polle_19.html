<div class="container">

<table style="width: 100%;"><tr>
<td>history</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get History Object</h2>

<h3>Description</h3>

<p><code>get_history</code> summarizes the history and action at a given stage from a
policy_data object.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_history(object, stage = NULL, full_history = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Object of class policy_data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage</code></td>
<td>
<p>Stage number. If NULL, the state/Markov-type history across
all stages is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>full_history</code></td>
<td>
<p>Logical. If TRUE, the full history is returned
If FALSE, only the state/Markov-type history is returned.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Each observation has the sequential form
</p>
<p style="text-align: center;"><code class="reqn">O= {B, U_1, X_1, A_1, ..., U_K, X_K, A_K, U_{K+1}},</code>
</p>

<p>for a possibly stochastic number of stages K.
</p>

<ul>
<li> <p><code class="reqn">B</code> is a vector of baseline covariates.
</p>
</li>
<li> <p><code class="reqn">U_k</code> is the reward at stage k (not influenced by the action <code class="reqn">A_k</code>).
</p>
</li>
<li> <p><code class="reqn">X_k</code> is a vector of state covariates summarizing the state at stage k.
</p>
</li>
<li> <p><code class="reqn">A_k</code> is the categorical action at stage k.
</p>
</li>
</ul>
<h3>Value</h3>

<p>Object of class history. The object is a list
containing the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>H</code></td>
<td>
<p>data.table::data.table with keys id and stage and with variables
{<code class="reqn">B</code>, <code class="reqn">X_k</code>} (state history) or
{<code class="reqn">B</code>, <code class="reqn">X_1</code>, <code class="reqn">A_1</code>, ..., <code class="reqn">X_k</code>}
(full history), see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>data.table::data.table with keys id and stage and variable <code class="reqn">A_k</code>, see
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>action_name</code></td>
<td>
<p>Name of the action variable in <code>A</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>action_set</code></td>
<td>
<p>Sorted character vector defining the action set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>U</code></td>
<td>
<p>(If <code>stage</code> is not NULL) data.table::data.table with keys id and stage
and with variables U_bar and U_Aa for every a in the actions set.
U_bar is the accumulated rewards up till and including the given
stage, i.e., <code class="reqn">\sum_{j=1}^k U_j</code>. U_Aa is the deterministic
reward of action a.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">library("polle")
### Single stage:
d1 &lt;- sim_single_stage(5e2, seed=1)
# constructing policy_data object:
pd1 &lt;- policy_data(d1, action="A", covariates=list("Z", "B", "L"), utility="U")
pd1

# In the single stage case, set stage = NULL
h1 &lt;- get_history(pd1)
head(h1$H)
head(h1$A)

### Two stages:
d2 &lt;- sim_two_stage(5e2, seed=1)
# constructing policy_data object:
pd2 &lt;- policy_data(d2,
                  action = c("A_1", "A_2"),
                  baseline = c("B"),
                  covariates = list(L = c("L_1", "L_2"),
                                    C = c("C_1", "C_2")),
                  utility = c("U_1", "U_2", "U_3"))
pd2
# getting the state/Markov-type history across all stages:
h2 &lt;- get_history(pd2)
head(h2$H)
head(h2$A)

# getting the full history at stage 2:
h2 &lt;- get_history(pd2, stage = 2, full_history = TRUE)
head(h2$H)
head(h2$A)
head(h2$U)

# getting the state/Markov-type history at stage 2:
h2 &lt;- get_history(pd2, stage = 2, full_history = FALSE)
head(h2$H)
head(h2$A)

### Multiple stages
d3 &lt;- sim_multi_stage(5e2, seed = 1)
# constructing policy_data object:
pd3 &lt;- policy_data(data = d3$stage_data,
                   baseline_data = d3$baseline_data,
                   type = "long",
                   id = "id",
                   stage = "stage",
                   event = "event",
                   action = "A",
                   utility = "U")
pd3

# getting the full history at stage 2:
h3 &lt;- get_history(pd3, stage = 2, full_history = TRUE)
head(h3$H)
# note that not all observations have two stages:
nrow(h3$H) # number of observations with two stages.
get_n(pd3) # number of observations in total.
</code></pre>


</div>