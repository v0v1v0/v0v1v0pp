<div class="container">

<table style="width: 100%;"><tr>
<td>pspatreg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>pspatreg: A package to estimate and make inference for spatial
and spatio-temporal econometric regression models</h2>

<h3>Description</h3>

<p><span class="pkg">pspatreg</span> offers the user a collection of functions to
estimate and make inference of geoadditive spatial or spatio-temporal
semiparametric regression models of type <em>ps-sim</em>, <em>ps-sar</em>,
<em>ps-sem</em>, <em>ps-sarar</em>, <em>ps-sdm</em>, <em>ps-sdem</em> or
<em>ps-slx</em>. These type of specifications are very general and they can
include parametric and non-parametric covariates, spatial or
spatio-temporal non-parametric trends and spatial lags of the dependent and
independent variables and/or the noise of the model. The non-parametric
terms (either trends or covariates) are modeled using P-Splines. The
non-parametric trend can be decomposed in an ANOVA way including main and
interactions effects of 2nd and 3rd order. The estimation method can be
restricted maximum likelihood (REML) or maximum likelihood (ML).
</p>


<h3>Details</h3>

<p>Some functionalities that have been included in <span class="pkg">pspatreg</span>
package are:
</p>


<h3>1. Estimation of the semiparametric regression model</h3>

<p><span class="pkg">pspatreg</span>
allows the estimation of geoadditive spatial or spatio-temporal
semiparametric regression models which could include: </p>
 <ul>
<li>
<p> An
spatial or spatio-temporal trend, that is, a geoadditive model either for
cross-section data or for panel data. This trend can be decomposed in main
and interaction functions in an ANOVA way. The spatial (or spatio-temporal)
trend gather the potential spatial heterogeneity of the data. </p>
</li>
<li>
<p>Parametric covariates as usual in regression models. </p>
</li>
<li>
<p> Non-parametric
covariates in which the functional relationship is estimated from the data.
Both the trends and non-parametric covariates are modelled using P-splines.
</p>
</li>
<li>
<p> Spatial dependence adding spatial lags of the dependent and
independent variables as usual in spatial econometric models. These models
gather the potential spatial spillovers. </p>
</li>
</ul>
<p> Once specified, the whole model
can be estimated using either restricted maximum-likelihood (REML) or
maximum likelihood (ML). The spatial econometric specifications allowed in
<span class="pkg">pspatreg</span> are the following ones: </p>
 <ul>
<li> <p><em>ps-sim</em>:
geoadditive semiparametric model without spatial effects (in addition to
the spatial or spatio-temporal trend, if it is included). </p>
<p style="text-align: center;"><code class="reqn"> y =
  f(s_1,s_2,\tau_{t}) y + X \beta + + \sum_{i=1}^k g(z_i) + \epsilon </code>
</p>
<p> where:
</p>
 <ul>
<li> <p><code class="reqn">f(s_1,s_2,\tau_t)</code> is a smooth spatio-temporal trend
of the spatial coordinates <code class="reqn">s1,s_2</code> and of the temporal coordinates
<code class="reqn">\tau_t</code>. </p>
</li>
<li> <p><code class="reqn">X</code> is a matrix including values of parametric
covariates. </p>
</li>
<li> <p><code class="reqn">g(z_i)</code> are non-parametric smooth functions of the
covariates <code class="reqn">z_i</code>. </p>
</li>
<li> <p><code class="reqn">\epsilon ~ N(0,R)</code> where <code class="reqn"> R =
  \sigma^2 I_T</code> if errors are uncorrelated or it follows an AR(1) temporal
autoregressive structure for serially correlated errors. </p>
</li>
</ul>
</li>
<li>
<p><em>ps-slx</em>: geoadditive semiparametric model with spatial lags of the
regresors (either parametric or non-parametric): </p>
<p style="text-align: center;"><code class="reqn"> y =
  f(s_1,s_2,\tau_{t}) + X \beta + (W_{N} \otimes I_T) X \theta + \sum_{i
  =1}^k g(z_i) + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i) +
  \epsilon </code>
</p>
<p> where: </p>
 <ul>
<li> <p><code class="reqn">W_N</code> is the spatial weights matrix.
</p>
</li>
<li> <p><code class="reqn">I_T</code> is an identity matrix of order <code class="reqn">T</code> (<em>T = 1</em> for
pure spatial data). </p>
</li>
</ul>
</li>
<li> <p><em>ps-sar</em>: geoadditive semiparametric model
with spatial lag of the dependent variable </p>
<p style="text-align: center;"><code class="reqn"> y = (\rho*W_{N} \otimes
  I_T) y + f(s_1,s_2,\tau_{t}) + X \beta + \sum_{i =1}^k g(z_i) + \epsilon </code>
</p>

</li>
<li> <p><em>ps-sem</em>: geoadditive semiparametric model with a spatial lag of
the noise of the model </p>
<p style="text-align: center;"><code class="reqn"> y = f(s_1,s_2,\tau_{t}) + X \beta + \sum_{i
  =1}^k g(z_i) + u </code>
</p>
 <p style="text-align: center;"><code class="reqn"> u = (\delta*W_{N} \otimes I_T) u + \epsilon </code>
</p>

</li>
<li> <p><em>ps-sdm</em>: geoadditive semiparametric model with spatial lags of
the endogenous variable and of the regressors (spatial durbin model) </p>
<p style="text-align: center;"><code class="reqn">
  y = (\rho*W_{N} \otimes I_T) y + f(s_1,s_2,\tau_{t}) + X \beta + (W_{N}
  \otimes I_T) X \theta + \sum_{i = 1}^k g(z_i) + \sum_{i = 1}^k
  g((\gamma_i*W_{N} \otimes I_T) z_i) + \epsilon </code>
</p>
 </li>
<li> <p><em>ps-sdem</em>:
geoadditive semiparametric model with spatial errors and spatial lags of
the endogenous variable and of the regressors </p>
<p style="text-align: center;"><code class="reqn"> y =
  f(s_1,s_2,\tau_{t}) + X \beta + (W_{N} \otimes I_T) X \theta + \sum_{i =
  1}^k g(z_i) + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i) + u </code>
</p>

<p style="text-align: center;"><code class="reqn"> u = (\delta*W_{N} \otimes I_T) u + \epsilon </code>
</p>
 </li>
<li> <p><em>ps-sarar</em>:
geoadditive semiparametric model with a spatial lag for: both dependent
variable and errors </p>
<p style="text-align: center;"><code class="reqn"> y = (\rho*W_{N} \otimes I_T) y +
  f(s_1,s_2,\tau_{t}) + X \beta + (W_{N} \otimes I_T) X \theta + \sum_{i =
  1}^k g(z_i) + \sum_{i = 1}^k g((\gamma_i*W_{N} \otimes I_T) z_i) + u </code>
</p>

<p style="text-align: center;"><code class="reqn"> u = (\delta*W_{N} \otimes I_T) u + \epsilon </code>
</p>
 </li>
</ul>
<h3>2. Plot of the spatial and spatio-temporal trends</h3>

<p>Once estimated
the geoadditive semiparametric model, some functions of <span class="pkg">pspatreg</span> are
suited to make plots of the spatial or spatio-temporal trends. These
functions, named <code>plot_sp2d</code> and <code>plot_sp3d</code>, can deal
either with 'sf' objects or 'dataframe' objects including spatial coordinates
(see the examples of the functions). 
The function <code>plot_sptime</code> allows
to examine temporal trends for each spatial unit. Eventually, it is also
possible to get the plots on nonparametric covariates using
<code>plot_terms</code>.
</p>


<h3>3. Impacts and spatial spillovers</h3>

<p>It is very common in spatial econometrics to
evaluate the multiplier impacts that a change in the value of a regressor,
in a point in the space, has on the explained variable. The <span class="pkg">pspatreg</span>
package allows the computation and inference of spatial impacts (direct,
indirect and total) either for parametric covariates or nonparametric
covariates (in the last case, the output are impact functions). The function
named <code>impactspar</code> compute the impacts for parametric
covariates in the usual way using simulation. On the other hand, the
function <code>impactsnopar</code> allows the computation of impact
functions for nonparametric covariates. For parametric covariates, 
the method to compute the impacts is the same than the
exposed in LeSage and Page (2009). For nonparametric covariates the 
method is described in the help of the function <code>impactsnopar</code>.
Both impact functions have dedicated methods to
get a summary, for the parametric covariates, and 
plots, for the nonparametric covariates, of the 
direct, indirect and total impacts.
</p>


<h3>4. Additional methods</h3>

<p>The package <span class="pkg">pspatreg</span> provides the usual
methods to extract information of the fitted models. The methods included
are: 
</p>
 
<ul>
<li> <p><code>anova</code>: provides tables of fitted
'pspatreg' models including information criteria (AIC and BIC),
log-likelihood and degrees of freedom of each fitted model.
Also allows to perform LR tests between nested  models.
</p>
</li>
<li> <p><code>print</code> method is used to print short tables 
including the values of beta and spatial coefficients 
as well as p-values of significance test for each 
coefficient.
</p>
</li>
<li> <p><code>summary</code> method displays the results of
the estimation for spatial and spatio-temporal trends, 
parametric and nonparametric covariates and spatial parameters.
</p>
</li>
<li> <p><code>coef</code> extractor function of the parametric and 
spatial coefficientes.
</p>
</li>
<li> <p><code>fitted</code> extractor function of the  fitted values.
</p>
</li>
<li> <p><code>logLik</code> extractor function of the log-likelihood.
</p>
</li>
<li> <p><code>residuals</code> extractor function of the residuals.
</p>
</li>
<li> <p><code>vcov</code> extractor function of the covariance matrix
of the estimated parameters. The argument <code>bayesian</code> 
(default = 'TRUE') allows to choose between sandwich 
(frequentist) or bayesian method to compute the variances and 
covariances. See Fahrmeir et al. (2021) for details.
</p>
</li>
</ul>
<h3>Datasets</h3>

<p><span class="pkg">pspatreg</span> includes a spatio-temporal panel database
including observations of unemployment,  economic variables 
and spatial coordinates (centroids) for 103 Italian provinces
in the period 1996-2019. 
This database is provided in RData  format and can be loaded 
using the command <code>data(unemp_it, package = "pspatreg")</code>. 
The database also includes a <em>W</em> spatial neighborhood matrix 
of the Italian provinces (computed using queen criterium). 
Furthermore, a map of Italian provinces is also included as an sf object. 
This map can be used to plot spatial and spatio-temporal trends estimated 
for each province. Some examples of spatial and spatio-temporal 
fitted trends are included in the help of the main function of 
<span class="pkg">pspatreg</span> package (see especially <code>?pspatfit</code>). 
See Minguez, Basile and Durban (2020) for additional details about 
this database. 
<br>
source: Italian National Institute of Statistics (ISTAT)
<em>https://www.istat.it</em>
<br><br></p>
<p>For the spatial pure case, the examples included use the 
household database <code>ames</code> included in <span class="pkg">AmesHousing</span> package. 
See the help of <code>?AmesHousing::make_ames</code> for an explanation of the 
variables included in this database.
Examples of hedonic models including geoadditive spatial econometric
regressions are included in the examples of <span class="pkg">pspatreg</span> package.
</p>


<h3>Author(s)</h3>


<table>
<tr>
<td style="text-align: left;"> 
  Roman Minguez  </td>
<td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
<td style="text-align: left;">
  Roberto Basile </td>
<td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
<td style="text-align: left;"> Maria Durban </td>
<td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
<td style="text-align: left;"> Gonzalo Espana-Heredia </td>
<td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
<td style="text-align: left;"> 
 </td>
</tr>
</table>
<h3>References</h3>

 
<ul>
<li>
<p> Basile, R.; Durban, M.; Minguez, R.; Montero, J. M.; and 
Mur, J. (2014). Modeling regional economic dynamics: Spatial
dependence, spatial heterogeneity and nonlinearities. 
<em>Journal of Economic Dynamics and Control</em>, (48), 229-245.
&lt;doi:10.1016/j.jedc.2014.06.011&gt;
</p>
</li>
<li>
<p> Eilers, P. and Marx, B. (1996). Flexible Smoothing with 
B-Splines and Penalties. <em>Statistical Science</em>, (11), 89-121.
</p>
</li>
<li>
<p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li>
<p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li>
<p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li>
<p> Lee, D. J., Durban, M., and Eilers, P. (2013). Efficient
two-dimensional smoothing with P-spline ANOVA mixed models 
and nested bases. <em>Computational Statistics &amp; Data Analysis</em>, 
(61), 22-37. &lt;doi:10.1016/j.csda.2012.11.013&gt;
</p>
</li>
<li>
<p> LeSage, J. and Pace, K. (2009). <em>Introduction to 
Spatial Econometrics</em>. CRC Press, Boca Raton.
</p>
</li>
<li>
<p> Minguez, R.; Basile, R. and Durban, M. (2020). An Alternative 
Semiparametric Model for Spatial Panel Data. <em>Statistical Methods and Applications</em>,
(29), 669-708. &lt;doi:	10.1007/s10260-019-00492-8&gt;
</p>
</li>
<li>
<p> Montero, J., Minguez, R., and Durban, M. (2012). SAR models 
with nonparametric spatial trends: A P-Spline approach. 
<em>Estadistica Espanola</em>, (54:177), 89-111.
</p>
</li>
<li>
<p> Rodriguez-Alvarez, M. X.; Kneib, T.; Durban, M.; Lee, D.J.
and Eilers, P. (2015). Fast smoothing parameter separation 
in multidimensional generalized P-splines: the SAP algorithm.
<em>Statistics and Computing</em> 25 (5), 941-957. 
&lt;doi:10.1007/s11222-014-9464-2&gt;
</p>
</li>
<li>
<p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li>
</ul>
</div>