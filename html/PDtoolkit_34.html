<div class="container">

<table style="width: 100%;"><tr>
<td>rf.clustering</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Risk factor clustering</h2>

<h3>Description</h3>

<p><code>rf.clustering</code> implements correlation based clustering of risk factors.
Clustering procedure is base on hclust from <code>stats</code> package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rf.clustering(db, metric, k = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>db</code></td>
<td>
<p>Data frame of risk factors supplied for clustering analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>Correlation metric used for distance calculation. Available options are:
</p>

<ul>
<li> <p><code>"raw pearson"</code> - calculated distance <code>as.dist(1 - cor(db, method = "pearson"))</code>;
</p>
</li>
<li> <p><code>"raw spearman"</code> - calculated distance <code>as.dist(1 - cor(db, method = "spearman"))</code>;
</p>
</li>
<li> <p><code>"common pearson"</code> - calculated distance <code>as.dist((1 - cor(db, method = "pearson")) / 2)</code>;
</p>
</li>
<li> <p><code>"common spearman"</code> - calculated distance <code>as.dist((1 - cor(db, method = "spearman")) / 2)</code>;
</p>
</li>
<li> <p><code>"absolute pearson"</code> - calculated distance <code>as.dist(1 - abs(cor(db, method = "pearson")))</code>;
</p>
</li>
<li> <p><code>"absolute spearman"</code> - calculated distance <code>as.dist(1 - abs(cor(db, method = "spearman")))</code>;
</p>
</li>
<li> <p><code>"sqrt pearson"</code> - calculated distance <code>as.dist(sqrt(1 - cor(db, method = "pearson")))</code>;
</p>
</li>
<li> <p><code>"sqrt spearman"</code> - calculated distance <code>as.dist(sqrt(1 - cor(db, method = "spearman")))</code>;
</p>
</li>
<li> <p><code>"x2y"</code> - calculated distance <code>as.dist(1 - dx2y(d = db)[[2]]))</code>.
</p>
</li>
</ul>
<p><code>x2y</code> metric is proposed by Professor Rama Ramakrishnan and details can be found on this
<a href="https://rviews.rstudio.com/2021/04/15/an-alternative-to-the-correlation-coefficient-that-works-for-numeric-and-categorical-variables/">link</a>.
This metric is especially handy if analyst wants to perform clustering before any binning procedures and to decrease number of risk factors. Additionally,
<code>x2y</code> algorithm process numerical and categorical risk factors at once and it is able to identify
non-linear relationship between the pairs. Metric <code>x2y</code> is not symmetric with respect to inputs - <code>x, y</code>,
therefore arithmetic average of values between <code>xy</code> and <code>yx</code> is used to produce the final value for each pair.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Number of clusters. If default value (<code>NA</code>) is passed, then automatic elbow method
will be used to determine the optimal number of clusters, otherwise selected number of clusters will be used.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The function <code>rf.clustering</code> returns a data frame with: risk factors, clusters assigned and
distance to centroid (ordered from smallest to largest).
The last column (distance to centroid) can be used for selection of one or more risk factors per
cluster.
</p>


<h3>Examples</h3>

<pre><code class="language-R">suppressMessages(library(PDtoolkit))
library(rpart)
data(loans)
#clustering using common spearman metric
#first we need to categorize numeric risk factors
num.rf &lt;- sapply(loans, is.numeric)
num.rf &lt;- names(num.rf)[!names(num.rf)%in%"Creditability" &amp; num.rf]
loans[, num.rf] &lt;- sapply(num.rf, function(x) 
			  sts.bin(x = loans[, x], y = loans[, "Creditability"])[[2]])
#replace woe in order to convert to all numeric factors 
loans.woe &lt;- replace.woe(db = loans, target = "Creditability")[[1]]
cr &lt;- rf.clustering(db = loans.woe[, -which(names(loans.woe)%in%"Creditability")], 
		  metric = "common spearman", 
		  k = NA)
cr
#select one risk factor per cluster with min distance to centorid
cr %&gt;% group_by(clusters) %&gt;% 
 slice(which.min(dist.to.centroid))
</code></pre>


</div>