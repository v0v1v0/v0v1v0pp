<div class="container">

<table style="width: 100%;"><tr>
<td>var.rate.div</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Expected diversity for general exponential rates</h2>

<h3>Description</h3>

<p>Calculates the expected species diversity on an interval given a (possibly 
time-dependent) exponential rate. Takes as the base rate (1) a constant, (2)
a function of time, (3) a function of time interacting with an environmental 
variable, or (4) a vector of numbers describing rates as a step function. 
Requires information regarding the maximum simulation time, and allows for 
optional extra parameters to tweak the baseline rate. For more information 
on the creation of the final rate, see <code>make.rate</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">var.rate.div(rate, t, n0 = 1, tMax = NULL, envRate = NULL, rateShifts = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rate</code></td>
<td>
<p>The baseline function with which to make the rate.
It can be a
</p>

<dl>
<dt>A number</dt>
<dd>
<p>For constant birth-death rates.</p>
</dd>
<dt>A function of time</dt>
<dd>
<p>For rates that vary with time. Note that this can 
be any function of time.</p>
</dd> 
<dt>A function of time and an environmental variable</dt>
<dd>
<p>For rates varying 
with time and an environmental variable, such as temperature. Note that 
supplying a function on more than one variable without an accompanying 
<code>envRate</code> will result in an error.</p>
</dd>
<dt>A numeric vector</dt>
<dd>
<p>To create step function rates. Note this must be
accompanied by a corresponding vector of rate shift times, 
<code>rateShifts</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>A time vector over which to consider the distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n0</code></td>
<td>
<p>The initial number of species is by default 1, but one can change to
any nonnegative number.
</p>
<p>Note: <code>var.rate.div</code> will find the expected number of species given a
rate <code>rate</code> and an initial number of parents <code>n0</code>, so in a
biological context <code>rate</code> is diversification rate, not speciation 
(unless extinction is <code>0</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tMax</code></td>
<td>
<p>Ending time of simulation, in million years after the clade's 
origin. Needed to ensure <code>rateShifts</code> runs the correct way.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envRate</code></td>
<td>
<p>A <code>data.frame</code> representing a time-series, usually an 
environmental variable (e.g. CO2, temperature, etc) varying with time. The 
first column of this <code>data.frame</code> must be time, and the second column 
must be the values of the variable. The function will return an error if 
the user supplies <code>envRate</code> without <code>rate</code> being a function of two
variables. <code>paleobuddy</code> has two environmental data frames, <code>temp</code>
and <code>co2</code>. One can check <code>RPANDA</code> for more examples.
</p>
<p>Note that, since simulation functions are run in forward-time (i.e. with 
<code>0</code> being the origin time of the simulation), the time column of
<code>envRate</code> is assumed to do so as well, so that the row corresponding to
<code>t = 0</code> is assumed to be the value of the time-series when the 
simulation starts, and <code>t = tMax</code> is assumed to be its value when the
simulation ends (the present).
</p>
<p>Acknowledgements: The strategy to transform a function of <code>t</code> and 
<code>envRate</code> into a function of <code>t</code> only using <code>envRate</code> was 
adapted from <code>RPANDA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rateShifts</code></td>
<td>
<p>A vector indicating the time of rate shifts in a step 
function. The first element must be the first or last time point for the 
simulation, i.e. <code>0</code> or <code>tMax</code>. Since functions in paleobuddy run
from <code>0</code> to <code>tMax</code>, if <code>rateShifts</code> runs from past to present
(meaning <code>rateShifts[2] &lt; rateShifts[1]</code>), we take 
<code>tMax - rateShifts</code> as the shifts vector. Note that supplying 
<code>rateShifts</code> when <code>rate</code> is not a numeric vector of the same 
length will result in an error.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A vector of the expected number of species per time point supplied
in <code>t</code>, which can then be used to plot vs. <code>t</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# let us first create a vector of times to use in these examples
time &lt;- seq(0, 50, 0.1)

###
# we can start simple: create a constant rate
rate &lt;- 0.1

# make the rate
r &lt;- make.rate(0.5)

# plot it
plot(time, rep(r, length(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(50, 0), type = 'l')

# get expected diversity
div &lt;- var.rate.div(rate, time)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(50, 0), type = 'l')

###
# something a bit more complex: a linear rate
rate &lt;- function(t) {
  return(1 - 0.05*t)
}

# make the rate
r &lt;- make.rate(rate)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(50, 0), type = 'l')
# negative values are ok since this represents a diversification rate

# get expected diversity
div &lt;- var.rate.div(rate, time)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(50, 0), type = 'l')

###
# remember: rate is the diversification rate!

# we can create speciation...
lambda &lt;- function(t) {
  return(0.5 - 0.01*t)
}

# ...and extinction...
mu &lt;- function(t) {
  return(0.01*t)
}

# ...and get rate as diversification
rate &lt;- function(t) {
  return(lambda(t) - mu(t))
}

# make the rate
r &lt;- make.rate(rate)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(50, 0), type = 'l')

# get expected diversity
div &lt;- var.rate.div(rate, time)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(50, 0), type = 'l')

###
# we can use ifelse() to make a step function like this
rate &lt;- function(t) {
  return(ifelse(t &lt; 2, 0.2,
          ifelse(t &lt; 3, 0.4,
           ifelse(t &lt; 5, -0.2, 0.5))))
}

# change time so things are faster
time &lt;- seq(0, 10, 0.1)

# make the rate
r &lt;- make.rate(rate)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')
# negative rates is ok since this represents a diversification rate

# get expected diversity
div &lt;- var.rate.div(rate, time)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')

# this method of creating a step function might be annoying, but when
# running thousands of simulations it will provide a much faster
# integration than when using our method of transforming
# a rates and a shifts vector into a function of time

###
# ...which we can do as follows

# rates vector
rateList &lt;- c(0.2, 0.4, -0.2, 0.5)

# rate shifts vector
rateShifts &lt;- c(0, 2, 3, 5)

# make the rate
r &lt;- make.rate(rateList, tMax = 10, rateShifts = rateShifts)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')
# negative rates is ok since this represents a diversification rate

# get expected diversity
div &lt;- var.rate.div(rateList, time, tMax = 10, rateShifts = rateShifts)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')
 
###
# finally let us see what we can do with environmental variables

# get the temperature data
data(temp)

# diversification
rate &lt;- function(t, env) {
  return(0.2 + 2*exp(-0.25*env))
}

# make the rate
r &lt;- make.rate(rate, tMax = tMax, envRate = temp)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')

# get expected diversity
div &lt;- var.rate.div(rate, time, tMax = tMax, envRate = temp)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')

###
# we can also have a function that depends on both time AND temperature

# diversification
rate &lt;- function(t, env) {
  return(0.02 * env - 0.01 * t)
}

# make the rate
r &lt;- make.rate(rate, tMax = tMax, envRate = temp)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')

# get expected diversity
div &lt;- var.rate.div(rate, time, tMax = tMax, envRate = temp)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')
  
###
# as mentioned above, we could also use ifelse() to construct a step 
# function that is modulated by temperature

# diversification
rate &lt;- function(t, env) {
  return(ifelse(t &lt; 2, 0.1 + 0.01*env,
          ifelse(t &lt; 5, 0.2 - 0.05*env,
           ifelse(t &lt; 8, 0.1 + 0.1*env, 0.2))))
}

# make the rate
r &lt;- make.rate(rate, tMax = tMax, envRate = temp)

# plot it
plot(time, rev(r(time)), ylab = "Diversification rate",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')


# get expected diversity
div &lt;- var.rate.div(rate, time, tMax = tMax, envRate = temp)

# plot it
plot(time, rev(div), ylab = "Expected number of species",
     xlab = "Time (Mya)", xlim = c(10, 0), type = 'l')


# takes a bit long so we set it to not run, but the user
# should feel free to explore this and other scenarios

</code></pre>


</div>