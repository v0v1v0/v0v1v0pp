<div class="container">

<table style="width: 100%;"><tr>
<td>randomTF</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Proportion of variance in the fossil data explained by an
environmental reconstruction</h2>

<h3>Description</h3>

<p>Calculate the proportion of variance in the fossil data
explained by an environmental reconstruction with a constrained ordination.
This value is compared with a null distribution calculated as the proportion
of variance in the fossil data explained by reconstructions from transfer
functions trained on random data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">randomTF(
  spp,
  env,
  fos,
  n = 99,
  fun,
  col,
  condition = NULL,
  autosim,
  ord = rda,
  permute = FALSE,
  models,
  make_models = FALSE,
  ...
)

## S3 method for class 'palaeoSig'
plot(x, variable_names, top = 0.7, adj = c(0, 0.5), p_val = 0.05, ...)

## S3 method for class 'palaeoSig'
autoplot(object, variable_names, nbins = 20, top = 0.7, p_val = 0.05, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>spp</code></td>
<td>
<p>Data frame of modern training set species data, transformed as
required for example with <code>sqrt</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>Data frame of training set environmental variables or vector with
single environmental variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fos</code></td>
<td>
<p>Data frame of fossil species data, with same species codes and
transformations as <code>spp</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of random training sets. More is better.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>Transfer function method.
Additional arguments to <code>fun</code> can be passed with <code>...</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>Some transfer functions return more than one column of results,
for example with different <code>WAPLS</code> components.
<code>col</code> selects which column of the reconstructions to use.
See the relevant transfer function method help file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condition</code></td>
<td>
<p>Optional data frame of reconstructions to partial out when
testing if multiple independent reconstructions are possible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autosim</code></td>
<td>
<p>Optional data frame of random values.
This is useful if the training set is spatially autocorrelated and the
supplied data frame contains autocorrelated random variables.
If <code>autosim</code> is missing, and <code>permute</code> is <code>FALSE</code>, the
transfer functions are trained on random variables drawn from a uniform
distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ord</code></td>
<td>
<p>Constrained ordination method to use. <code>rda</code> is
the default, <code>cca</code> should also work.
<code>capscale</code> won't work without modifications to the code
(or a wrapper).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permute</code></td>
<td>
<p>logical value. Generate random environmental variables by
permuting existing variable. Only possible if there is only one environmental
variable and <code>autosim</code> is missing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models</code></td>
<td>
<p>list of models made by <code>randomTF</code> with argument
<code>make_models = TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>make_models</code></td>
<td>
<p>logical, should a list of transfer functions trained on
random data be returned</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments to the transfer function. For example to change
the distance metric in <code>MAT</code>.
Also extra arguments to plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Output from randomTF</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable_names</code></td>
<td>
<p>Names of environmental variables. If missing, taken
from <code>env</code> data.frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>top</code></td>
<td>
<p>Proportion of the figure below the environmental name labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adj</code></td>
<td>
<p>Adjust the position that the environmental names are plotted at.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_val</code></td>
<td>
<p>P value to draw a line vertical line at (with which=2)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Output from randomTF</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbins</code></td>
<td>
<p>integer giving number of bins for the histogram</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function calculates the proportion of variance in the fossil
data explained by the transfer function reconstruction.
This is compared with a null distribution of the proportion of variance
explained by reconstructions based on random environmental variables.
Reconstructions can be partialled out to test if multiple reconstructions are
statistically significant. If the environment is spatially autocorrelated, a
red-noise null should be used instead of the default white noise null.
Red noise environmental variables can be generated with the <span class="pkg">gstat</span>
package.
</p>
<p>Any transfer function in the <span class="pkg">rioja</span> package can be used. Other methods
(e.g. random forests) can be used by making a wrapper function.
</p>
<p>If reconstructions from several sites are to be tested using the same
training set it can be much faster to train the models on random
environmental data once and then use them repeatedly.
This can be done with <code>make_models = TRUE</code> and then running
<code>randomTF</code> again giving the resultant models to the <code>models</code>
argument.
<code>make_models</code> does not work with MAT.
</p>
<p>For some transfer function methods, including <code>WA</code>, the code can be made
somewhat faster by coercing the modern and fossil species data to matrices
(<code>spp &lt;- as.matrix(spp)</code>), otherwise <code>WA</code> has to do this repeatedly.
With <code>MAT</code>, this should not be done as it might cause an error.
</p>


<h3>Value</h3>

<p>A list with components
</p>

<ul>
<li>
<p>PCA The unconstrained ordination of the fossil data.
</p>
</li>
<li>
<p>preds A list of the containing the reconstructions for each
environmental variable.
</p>
</li>
<li>
<p>MAX Proportion of the variance explained by the first axis of the
unconstrained ordination.
This is the maximum amount that a reconstruction of a single variable can
explain.
</p>
</li>
<li>
<p>EX The proportion of the variance in the fossil data explained by
each reconstruction.
</p>
</li>
<li>
<p>sim.ex The proportion of variance explained by each of the random
environmental variables.
</p>
</li>
<li>
<p>sig The p-value of each reconstruction.
</p>
</li>
</ul>
<p>If <code>make_models = TRUE</code>, a list of transfer function models is returned.
</p>
<p><code>autoplot.palaeoSig</code> returns a <code>ggplot2</code> object
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>plot(palaeoSig)</code>: Plot palaeoSig object
</p>
</li>
<li> <p><code>autoplot(palaeoSig)</code>: autoplot function for palaeoSig object
</p>
</li>
</ul>
<h3>Note</h3>

<p>If there are only a few fossil levels, <code>obs.cor</code> might have
more power.
If there are few taxa, tests on <code>MAT</code> reconstructions have
more statistical power than those based on <code>WA</code>.
</p>


<h3>Author(s)</h3>

<p>Richard Telford <a href="mailto:richard.telford@uib.no">richard.telford@uib.no</a>
</p>


<h3>References</h3>

<p>Telford, R. J. and Birks, H. J. B. (2011) A novel method for
assessing the statistical significance of quantitative reconstructions
inferred from biotic assemblages. <em>Quaternary Science Reviews</em>
<b>30</b>: 1272â€“1278.
<a href="https://doi.org/10.1016/j.quascirev.2011.03.002">doi:10.1016/j.quascirev.2011.03.002</a>
</p>


<h3>See Also</h3>

<p><code>obs.cor</code>, <code>WA</code>,
<code>MAT</code>, <code>WAPLS</code>,
<code>rda</code>, <code>cca</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(rioja)
data(SWAP)
data(RLGH)
rlghr &lt;- randomTF(
  spp = sqrt(SWAP$spec), env = data.frame(pH = SWAP$pH),
  fos = sqrt(RLGH$spec), n = 49, fun = WA, col = "WA.inv"
)
rlghr$sig
plot(rlghr, "pH")

require("ggplot2")
autoplot(rlghr, "pH")
</code></pre>


</div>