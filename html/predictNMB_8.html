<div class="container">

<table style="width: 100%;"><tr>
<td>do_nmb_sim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Do the predictNMB simulation, evaluating the net monetary benefit (NMB) of the
simulated model.</h2>

<h3>Description</h3>

<p>Do the predictNMB simulation, evaluating the net monetary benefit (NMB) of the
simulated model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">do_nmb_sim(
  sample_size,
  n_sims,
  n_valid,
  sim_auc,
  event_rate,
  cutpoint_methods = get_inbuilt_cutpoint_methods(),
  fx_nmb_training,
  fx_nmb_evaluation,
  meet_min_events = TRUE,
  min_events = NA,
  show_progress = FALSE,
  cl = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sample_size</code></td>
<td>
<p>Sample size of training set. If missing, a sample size
calculation will be performed and the calculated size will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_sims</code></td>
<td>
<p>Number of simulations to run.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_valid</code></td>
<td>
<p>Sample size for evaluation set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim_auc</code></td>
<td>
<p>Simulated model discrimination (AUC).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event_rate</code></td>
<td>
<p>Simulated event rate of the binary outcome being predicted.
Also known as prevalence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutpoint_methods</code></td>
<td>
<p>A value or vector of cutpoint methods to include.
Defaults to use the inbuilt methods:
</p>

<ul>
<li>
<p>"all" = treat all patients (cutpoint = 0)
</p>
</li>
<li>
<p>"none" = treat no patients (cutpoint = 1)
</p>
</li>
<li>
<p>"value_optimising" = select the cutpoint that maximises NMB
</p>
</li>
<li>
<p>"youden" = select cutpoint based on the Youden index, also known as
the J-index (sensitivity + specificity - 1)
</p>
</li>
<li>
<p>"cost_minimising" = select the cutpoint that minimises expected value
of costs
</p>
</li>
<li>
<p>"prod_sens_spec" = product of sensitivity and specificity
(sensitivity * specificity)
</p>
</li>
<li>
<p>"roc01" = selects the closest threshold to the (0,1) point on the ROC
curve
</p>
</li>
</ul>
<p>User-defined cutpoint methods can be used by passing the name of a function
that takes the following arguments:
</p>

<ul>
<li>
<p><code>predicted</code> (predicted probabilities)
</p>
</li>
<li>
<p><code>actual</code> (the actual, binary outcome)
</p>
</li>
<li>
<p><code>nmb</code> (a named vector containing NMB values assigned to each
predicted class (i.e. c("TP" = -3, "TN" = 0, "FP" = -1, "FN" = -4)))
</p>
</li>
</ul>
<p>See <code>?get_thresholds</code> for an example of a user-defined cutpoint
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fx_nmb_training</code></td>
<td>
<p>Function or <code>NMBsampler</code> that returns a named vector of NMB assigned
to classifications used for obtaining cutpoint on training set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fx_nmb_evaluation</code></td>
<td>
<p>Function or <code>NMBsampler</code> that returns a named vector of NMB
assigned to classifications used for obtaining cutpoint on evaluation set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meet_min_events</code></td>
<td>
<p>Whether or not to incrementally add samples until the
expected number of events (<code>sample_size * event_rate</code>) is met.
(Applies to sampling of training data only.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_events</code></td>
<td>
<p>The minimum number of events to include in the training
sample. If less than this number are included in sample of size
<code>sample_size</code>, additional samples are added until the <code>min_events</code> is met.
The default (<code>NA</code>) will use the expected value given the
<code>event_rate</code> and the <code>sample_size</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_progress</code></td>
<td>
<p>Logical. Whether to display a progress bar. Requires the
<code>pbapply</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>A cluster made using <code>parallel::makeCluster()</code>.
If a cluster is provided, the simulation will be done in parallel.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function runs a simulation for a given set of inputs that represent a
healthcare setting using model-guided interventions. <br><br>
The arguments <code>fx_nmb_training</code> and <code>fx_nmb_evaluation</code>
should be functions that capture the treatment being used, its costs and
effectiveness, and the costs of the outcome being treated/prevented. <br><br>
Both of these are functions that return a named vector of NMB values when
called and are used for obtaining and evaluating cutpoints, respectively.
For example, the following function returns the appropriately named vector.
<br><br><code>get_nmb &lt;- function() c("TP" = -3, "TN" = 0, "FP" = -1, "FN" = -4)</code>
</p>
<p>There is a helper function, <code>get_nmb_sampler()</code>, to help you
create these.
</p>


<h3>Value</h3>

<p>Returns a <code>predictNMBsim</code> object.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
get_nmb &lt;- function() c("TP" = -3, "TN" = 0, "FP" = -1, "FN" = -4)
do_nmb_sim(
  sample_size = 200, n_sims = 50, n_valid = 10000, sim_auc = 0.7,
  event_rate = 0.1, fx_nmb_training = get_nmb, fx_nmb_evaluation = get_nmb
)

</code></pre>


</div>