<div class="container">

<table style="width: 100%;"><tr>
<td>riskCurve</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of Conditional Clinical Endpoint Risk under Placebo and Treatment Given Biomarker Response to Treatment in a Baseline Surrogate Measure Three-Phase Sampling Design</h2>

<h3>Description</h3>

<p>Estimates <code class="reqn">P\{Y(z)=1|S(1)=s_1\}</code>, <code class="reqn">z=0,1</code>, on a grid of <code class="reqn">s_1</code> values following the estimation method of Juraska, Huang, and Gilbert (2018), where <code class="reqn">Z</code> is the
treatment group indicator (<code class="reqn">Z=1</code>, treatment; <code class="reqn">Z=0</code>, placebo), <code class="reqn">S(z)</code> is a continuous or ordered categorical univariate biomarker under assignment to <code class="reqn">Z=z</code>
measured at fixed time <code class="reqn">t_0</code> after randomization, and <code class="reqn">Y</code> is a binary clinical endpoint (<code class="reqn">Y=1</code>, disease; <code class="reqn">Y=0</code>, no disease) measured after <code class="reqn">t_0</code>. The
estimator employs the generalized product kernel density/probability estimation method of Hall, Racine, and Li (2004) implemented in the <code>np</code> package. The risks
<code class="reqn">P\{Y(z)=1|S(z)=s_1,X=x\}</code>, <code class="reqn">z=0,1</code>, where <code class="reqn">X</code> is a vector of discrete baseline covariates, are estimated by fitting inverse probability-weighted logistic regression
models using the <code>osDesign</code> package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">riskCurve(
  formula,
  bsm,
  tx,
  data,
  pstype = c("continuous", "ordered"),
  bsmtype = c("continuous", "ordered"),
  bwtype = c("fixed", "generalized_nn", "adaptive_nn"),
  hinge = FALSE,
  weights = NULL,
  psGrid = NULL,
  saveFile = NULL,
  saveDir = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula object with the binary clinical endpoint on the left of the <code>~</code> operator. The first listed variable on the right must be the biomarker response
at <code class="reqn">t0</code> and all variables that follow, if any, are discrete baseline covariates specified in all fitted models that condition on them. Interactions and transformations
of the baseline covariates are allowed. All terms in the formula must be evaluable in the data frame <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bsm</code></td>
<td>
<p>a character string specifying the variable name in <code>data</code> representing the baseline surrogate measure</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tx</code></td>
<td>
<p>a character string specifying the variable name in <code>data</code> representing the treatment group indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame with one row per randomized participant endpoint-free at <code class="reqn">t_0</code> that contains at least the variables specified in <code>formula</code>, <code>bsm</code> and
<code>tx</code>. Values of <code>bsm</code> and the biomarker at <code class="reqn">t_0</code> that are unavailable are represented as <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pstype</code></td>
<td>
<p>a character string specifying whether the biomarker response shall be treated as a <code>continuous</code> (default) or <code>ordered</code> categorical variable in the
kernel density/probability estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bsmtype</code></td>
<td>
<p>a character string specifying whether the baseline surrogate measure shall be treated as a <code>continuous</code> (default) or <code>ordered</code> categorical variable in the
kernel density/probability estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bwtype</code></td>
<td>
<p>a character string specifying the bandwidth type for continuous variables in the kernel density estimation. The options are <code>fixed</code> (default) for fixed
bandwidths, <code>generalized_nn</code> for generalized nearest neighbors, and <code>adaptive_nn</code> for adaptive nearest neighbors. As noted in the documentation of the function
<code>npcdensbw</code> in the <code>np</code> package: "Adaptive nearest-neighbor bandwidths change with each sample realization in the set when estimating the density at the point <code class="reqn">x</code>.
Generalized nearest-neighbor bandwidths change with the point at which the density is estimated, <code class="reqn">x</code>. Fixed bandwidths are constant over the support of <code class="reqn">x</code>."</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hinge</code></td>
<td>
<p>a logical value (<code>FALSE</code> by default) indicating whether a hinge model (Fong et al., 2017) shall be used for modeling the effect of <code class="reqn">S(z)</code> on the
clinical endpoint risk. A hinge model specifies that variability in <code class="reqn">S(z)</code> below the hinge point does not associate with the clinical endpoint risk.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>either a numeric vector of weights or a character string specifying the variable name in <code>data</code> representing weights applied to observations
in the phase 2 subset in order to make inference about the target population of all randomized participants endpoint-free at <code class="reqn">t_0</code>. The weights reflect that
the case:control ratio in the phase 2 subset is different from that in the target population and are passed on to GLMs in the estimation of the hinge point.
If <code>NULL</code> (default), weights for cases and controls are calculated separately in each study group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psGrid</code></td>
<td>
<p>a numeric vector of <code class="reqn">S(1)</code> values at which the conditional clinical endpoint risk in each study group is estimated. If <code>NULL</code> (default),
a grid of values spanning the range of observed values of the biomarker will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveFile</code></td>
<td>
<p>a character string specifying the name of an <code>.RData</code> file storing the output list. If <code>NULL</code> (default), the output list will only be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveDir</code></td>
<td>
<p>a character string specifying a path for the output directory. If <code>NULL</code> (default), the output list will only be returned; otherwise, if
<code>saveFile</code> is specified, the output list will also be saved as an <code>.RData</code> file in the specified directory.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>If <code>saveFile</code> and <code>saveDir</code> are both specified, the output list (named <code>oList</code>) is saved as an <code>.RData</code> file; otherwise it is returned only.
The output object (of class <code>riskCurve</code>) is a list with the following components:
</p>

<ul>
<li> <p><code>psGrid</code>: a numeric vector of <code class="reqn">S(1)</code> values at which the conditional clinical endpoint risk is estimated in the components <code>plaRiskCurve</code> and
<code>txRiskCurve</code>
</p>
</li>
<li> <p><code>plaRiskCurve</code>: a numeric vector of estimates of <code class="reqn">P\{Y(0)=1|S(1)=s_1\}</code> for <code class="reqn">s_1</code> in <code>psGrid</code>
</p>
</li>
<li> <p><code>txRiskCurve</code>: a numeric vector of estimates of <code class="reqn">P\{Y(1)=1|S(1)=s_1\}</code> for <code class="reqn">s_1</code> in <code>psGrid</code>
</p>
</li>
<li> <p><code>fOptBandwidths</code>: a <code>conbandwidth</code> object returned by the call of the function <code>npcdensbw</code> containing the optimal bandwidths, selected by likelihood
cross-validation, in the kernel estimation of the conditional density of <code class="reqn">S(1)</code> given the baseline surrogate measure and any other specified baseline covariates
</p>
</li>
<li> <p><code>gOptBandwidths</code>: a <code>conbandwidth</code> object returned by the call of the function <code>npcdensbw</code> or <code>npudensbw</code> containing the optimal bandwidths,
selected by likelihood cross-validation, in the kernel estimation of the conditional density of <code class="reqn">S(0)</code> given any specified baseline covariates or the marginal density
of <code class="reqn">S(0)</code> if no baseline covariates are specified in <code>formula</code>
</p>
</li>
<li> <p><code>cpointP</code>: if <code>hinge=TRUE</code>, the estimate of the hinge point in the placebo group
</p>
</li>
<li> <p><code>cpointT</code>: if <code>hinge=TRUE</code>, the estimate of the hinge point in the treatment group
</p>
</li>
</ul>
<h3>References</h3>

<p>Fong, Y., Huang, Y., Gilbert, P. B., and Permar, S. R. (2017), chngpt: threshold regression model estimation and inference, <em>BMC Bioinformatics</em>, 18.
</p>
<p>Hall, P., Racine, J., and Li, Q. (2004), Cross-validation and the estimation of conditional probability densities, <em>JASA</em> 99(468), 1015-1026.
</p>
<p>Juraska, M., Huang, Y., and Gilbert, P. B. (2020), Inference on treatment effect modification by biomarker response in a three-phase sampling design, Biostatistics, 21(3): 545-560, <a href="https://doi.org/10.1093/biostatistics/kxy074">https://doi.org/10.1093/biostatistics/kxy074</a>.
</p>


<h3>See Also</h3>

<p><code>bootRiskCurve</code>, <code>summary.riskCurve</code> and <code>plotMCEPcurve</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">n &lt;- 500
Z &lt;- rep(0:1, each=n/2)
S &lt;- MASS::mvrnorm(n, mu=c(2,2,3), Sigma=matrix(c(1,0.9,0.7,0.9,1,0.7,0.7,0.7,1), nrow=3))
p &lt;- pnorm(drop(cbind(1,Z,(1-Z)*S[,2],Z*S[,3]) %*% c(-1.2,0.2,-0.02,-0.2)))
Y &lt;- sapply(p, function(risk){ rbinom(1,1,risk) })
X &lt;- rbinom(n,1,0.5)
# delete S(1) in placebo recipients
S[Z==0,3] &lt;- NA
# delete S(0) in treatment recipients
S[Z==1,2] &lt;- NA
# generate the indicator of being sampled into the phase 2 subset
phase2 &lt;- rbinom(n,1,0.4)
# delete Sb, S(0) and S(1) in controls not included in the phase 2 subset
S[Y==0 &amp; phase2==0,] &lt;- c(NA,NA,NA)
# delete Sb in cases not included in the phase 2 subset
S[Y==1 &amp; phase2==0,1] &lt;- NA
data &lt;- data.frame(X,Z,S[,1],ifelse(Z==0,S[,2],S[,3]),Y)
colnames(data) &lt;- c("X","Z","Sb","S","Y")
qS &lt;- quantile(data$S, probs=c(0.05,0.95), na.rm=TRUE)
grid &lt;- seq(qS[1], qS[2], length.out=3)

out &lt;- riskCurve(formula=Y ~ S + factor(X), bsm="Sb", tx="Z", data=data, psGrid=grid)

# alternatively, to save the .RData output file (no '&lt;-' needed):
riskCurve(formula=Y ~ S + factor(X), bsm="Sb", tx="Z", data=data, saveFile="out.RData",
          saveDir="./")


</code></pre>


</div>