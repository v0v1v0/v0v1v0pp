<div class="container">

<table style="width: 100%;"><tr>
<td>write_po_file</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Write a .po or .pot file corresponding to a message database</h2>

<h3>Description</h3>

<p>Serialize a message database in the ‘<span class="file">.po</span>’ and ‘<span class="file">.pot</span>’ formats
recognized by the gettext ecosystem.
</p>


<h3>Usage</h3>

<pre><code class="language-R">write_po_file(
  message_data,
  po_file,
  metadata,
  width = 79L,
  wrap_at_newline = TRUE,
  use_base_rules = metadata$package %chin% .potools$base_package_names
)

po_metadata(
  package = "",
  version = "",
  language = "",
  author = "",
  email = "",
  bugs = "",
  copyright = NULL,
  ...
)

## S3 method for class 'po_metadata'
format(x, template = FALSE, use_plurals = FALSE, ...)

## S3 method for class 'po_metadata'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>message_data</code></td>
<td>
<p><code>data.table</code>, as returned from
<code>get_message_data()</code>. NB: R creates separate domains for R and
C/C++ code; it is recommended you do the same by filtering the
<code>get_message_data</code> output for <code>message_source == "R"</code> or
<code>message_source == "src"</code>. Other approaches are untested.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>po_file</code></td>
<td>
<p>Character vector giving a destination path. Paths ending in
‘<span class="file">.pot</span>’ will be written with template files (e.g., <code>msgstr</code> entries
will be blanked).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadata</code></td>
<td>
<p>A <code>po_metadata</code> object as returned by
<code>po_metadata()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>Numeric governing the wrapping width of the output file.
Default is <code>79L</code> to match the behavior of the <code>xgettext</code> utility.
<code>Inf</code> turns off wrapping (except for file source markers comments).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wrap_at_newline</code></td>
<td>
<p>Logical, default <code>TRUE</code> to match the
<code>xgettext</code> utility's behavior. If <code>TRUE</code>, any <code>msgid</code> or
<code>msgstr</code> will always be wrapped at an internal newline (i.e., literally
matching <code style="white-space: pre;">⁠\n⁠</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_base_rules</code></td>
<td>
<p>Logical; Should internal behavior match base behavior
as strictly as possible? <code>TRUE</code> if being run on a base package (i.e.,
<code>base</code> or one of the default packages like <code>utils</code>,
<code>graphics</code>, etc.). See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package</code></td>
<td>
<p>Character; the name of the package being translated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>version</code></td>
<td>
<p>Character; the version of the package being translated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>language</code></td>
<td>
<p>Character; the language of the <code>msgstr</code>. See
<code>translate_package()</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>author</code></td>
<td>
<p>Character; an author (combined with <code>email</code>) to whom to
attribute the translations (as <code>Last-Translator</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>email</code></td>
<td>
<p>Character; an e-mail address associated with <code>author</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bugs</code></td>
<td>
<p>Character; a URL where issues with the translations can be
reported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>copyright</code></td>
<td>
<p>An object used to construct the initial Copyright reference
in the output. If <code>NULL</code>, no such comment is written. If a <code>list</code>,
it should the following structure:
</p>

<ul>
<li> <p><code>year</code>: Required, A year or hyphen-separated range of years
</p>
</li>
<li> <p><code>holder</code>: Required, The name of the copyright holder
</p>
</li>
<li> <p><code>title</code>: Optional, A title for the ‘<span class="file">.po</span>’
</p>
</li>
<li> <p><code>additional</code>: Optional, A character vector of additional lines for the
copyright comment section
</p>
</li>
</ul>
<p>If a <code>character</code> scalar, it is interpreted as the <code>holder</code> and the <code>year</code>
is set as the <code>POT-Creation-Date</code>'s year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional (named) components to add to the metadata. For
<code>print.po_metadata</code>, passed on to <code>format.po_metadata</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>po_metadata</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>template</code></td>
<td>
<p>Logical; format the metadata as in a ‘<span class="file">.pot</span>’ template?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_plurals</code></td>
<td>
<p>Logical; should the <code>Plural-Forms</code> entry be
included?</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Three components are set automatically if not provided:
</p>

<ul>
<li> <p><code>pot_timestamp</code> - A <code>POSIXct</code> used to write the
<code>POT-Creation-Date</code> entry. Defaults to the <code>Sys.time()</code> at
run time.
</p>
</li>
<li> <p><code>po_timestamp</code> - A <code>POSIXct</code> used to write the
<code>PO-Revision-Date</code> entry. Defaults to be the same as
<code>pot_timestamp</code>.
</p>
</li>
<li> <p><code>language_team</code> - A string used to write
the <code>Language-Team</code> entry. Defaults to be the same as <code>language</code>;
if provided manually, the format <code style="white-space: pre;">⁠LANGUAGE &lt;LL@li.org&gt;⁠</code> is recommended.
</p>
</li>
</ul>
<p>The <code>charset</code> for output is always set to <code>"UTF-8"</code>; this is
intentional to make it more cumbersome to create non-UTF-8 files.
</p>


<h3>Value</h3>

<p>For <code>po_metadata</code>, an object of class <code>po_metadata</code> that
has a <code>format</code> method used to serialize the metadata.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>References</h3>

<p><a href="https://www.gnu.org/software/gettext/manual/html_node/Header-Entry.html">https://www.gnu.org/software/gettext/manual/html_node/Header-Entry.html</a>
<br></p>


<h3>See Also</h3>

<p><code>translate_package()</code>, <code>get_message_data()</code>,
<code>tools::xgettext2pot()</code>, <code>tools::update_pkg_po()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
message_data &lt;- get_message_data(system.file('pkg', package='potools'))
desc_data &lt;- read.dcf(system.file('pkg', 'DESCRIPTION', package='potools'), c('Package', 'Version'))
metadata &lt;- po_metadata(
  package = desc_data[, "Package"], version = desc_data[, "Version"],
  language = 'ar_SY', author = 'R User', email = 'ruser@gmail.com',
  bugs = 'https://github.com/ruser/potoolsExample/issues'
)

# add fake translations
message_data[type == "singular", msgstr := "&lt;arabic translation&gt;"]
# Arabic has 6 plural forms
message_data[type == "plural", msgstr_plural := .(as.list(sprintf("&lt;%d translation&gt;", 0:5)))]

# Preview metadata
print(metadata)
# write .po file
write_po_file(
  message_data[message_source == "R"],
  tmp_po &lt;- tempfile(fileext = '.po'),
  metadata
)
writeLines(readLines(tmp_po))

# write .pot template
write_po_file(
  message_data[message_source == "R"],
  tmp_pot &lt;- tempfile(fileext = '.pot'),
  metadata
)
writeLines(readLines(tmp_pot))

# cleanup
file.remove(tmp_po, tmp_pot)
rm(message_data, desc_data, metadata, tmp_po, tmp_pot)
</code></pre>


</div>