<div class="container">

<table style="width: 100%;"><tr>
<td>heterogeneity</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Testing heterogeneity of the PD rating model</h2>

<h3>Description</h3>

<p><code>heterogeneity</code> performs heterogeneity testing of PD model based on the rating grades.
This test is usually applied on application portfolio, but it can be applied also on model development sample.
</p>


<h3>Usage</h3>

<pre><code class="language-R">heterogeneity(app.port, def.ind, rating, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>app.port</code></td>
<td>
<p>Application portfolio (data frame) which contains default indicator (0/1) and
ratings in use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>def.ind</code></td>
<td>
<p>Name of the column that represents observed default indicator (0/1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rating</code></td>
<td>
<p>Name of the column that represent rating grades in use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Significance level of p-value for two proportion test. Default is 0.05.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Testing procedure starts with summarizing the number of observations and defaults per rating grade.
After that, two proportion test is applied on adjacent rating grades. Testing hypothesis is that
default rate of grade <code>i</code> is less or greater than default rate of grade <code>i - 1</code>, where <code>i</code>
takes the values from 2 to the number of unique grades.
Direction of alternative hypothesis (less or greater) is determined automatically based on correlation direction
of observed default on rating grades.
Incomplete cases, identified based on default indicator (<code>def.ind</code>) and rating grade (<code>rating </code>)
columns are excluded from the summary table and testing procedure. If identified, warning will be returned.
</p>


<h3>Value</h3>

<p>The command <code>heterogeneity</code> returns a data frame with the following columns:
</p>

<ul>
<li>
<p> rating: Unique values of rating grades from application portfolio.
</p>
</li>
<li>
<p> no: Number of complete observations.
</p>
</li>
<li>
<p> nb: Number of defaults (bad cases) in complete observations.
</p>
</li>
<li>
<p> p.val: Test p-value (two proportion test of adjacent rating grades).
</p>
</li>
<li>
<p> alpha: Selected significance level.
</p>
</li>
<li>
<p> res: Accepted hypothesis.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">suppressMessages(library(PDtoolkit))
data(loans)
#estimate some dummy model
mod.frm &lt;- `Creditability` ~ `Account Balance` + `Duration of Credit (month)` +
				`Age (years)` + `Value Savings/Stocks`
lr.mod &lt;- glm(mod.frm, family = "binomial", data = loans)
summary(lr.mod)$coefficients
#model predictions
loans$pred &lt;-  unname(predict(lr.mod, type = "response", newdata = loans))
#scale probabilities
loans$score &lt;- scaled.score(probs = loans$pred, score = 600, odd = 50/1, pdo = 20)
#group scores into ratings
loans$rating.1 &lt;- sts.bin(x = round(loans$score), y = loans$Creditability, y.type = "bina")[[2]]
#group probabilities into ratings
loans$rating.2 &lt;- sts.bin(x = round(loans$pred, 4), y = loans$Creditability, y.type = "bina")[[2]]
#simulate dummy application portfolio 
set.seed(1984)
app.port &lt;- loans[sample(1:nrow(loans), 400, rep = TRUE), ]
#run heterogeneity test on ratings based on the scaled score
#higher score lower default rate
heterogeneity(app.port = app.port, 
	   def.ind = "Creditability", 
	   rating = "rating.1", 
	   alpha = 0.05)
#run test on predicted default rate - direction of the test is changed
heterogeneity(app.port = app.port, 
	   def.ind = "Creditability", 
	   rating = "rating.2", 
	   alpha = 0.05)
</code></pre>


</div>