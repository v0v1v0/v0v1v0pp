<div class="container">

<table style="width: 100%;"><tr>
<td>cal_estimate_multinomial</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Uses a Multinomial calibration model to calculate new probabilities</h2>

<h3>Description</h3>

<p>Uses a Multinomial calibration model to calculate new probabilities
</p>


<h3>Usage</h3>

<pre><code class="language-R">cal_estimate_multinomial(
  .data,
  truth = NULL,
  estimate = dplyr::starts_with(".pred_"),
  smooth = TRUE,
  parameters = NULL,
  ...
)

## S3 method for class 'data.frame'
cal_estimate_multinomial(
  .data,
  truth = NULL,
  estimate = dplyr::starts_with(".pred_"),
  smooth = TRUE,
  parameters = NULL,
  ...,
  .by = NULL
)

## S3 method for class 'tune_results'
cal_estimate_multinomial(
  .data,
  truth = NULL,
  estimate = dplyr::starts_with(".pred_"),
  smooth = TRUE,
  parameters = NULL,
  ...
)

## S3 method for class 'grouped_df'
cal_estimate_multinomial(
  .data,
  truth = NULL,
  estimate = NULL,
  smooth = TRUE,
  parameters = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.data</code></td>
<td>
<p>An ungrouped <code>data.frame</code> object, or <code>tune_results</code> object,
that contains predictions and probability columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>truth</code></td>
<td>
<p>The column identifier for the true class results
(that is a factor). This should be an unquoted column name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate</code></td>
<td>
<p>A vector of column identifiers, or one of <code>dplyr</code> selector
functions to choose which variables contains the class probabilities. It
defaults to the prefix used by tidymodels (<code>.pred_</code>). The order of the
identifiers will be considered the same as the order of the levels of the
<code>truth</code> variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>Applies to the logistic models. It switches between logistic
spline when <code>TRUE</code>, and simple logistic regression when <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameters</code></td>
<td>
<p>(Optional)  An optional tibble of tuning parameter values
that can be used to filter the predicted values before processing. Applies
only to <code>tune_results</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to the models or routines used to
calculate the new probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.by</code></td>
<td>
<p>The column identifier for the grouping variable. This should be
a single unquoted column name that selects a qualitative variable for
grouping. Default to <code>NULL</code>. When <code>.by = NULL</code> no grouping will take place.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When <code>smooth = FALSE</code>, <code>nnet::multinom()</code> function is used to estimate the
model, otherwise <code>mgcv::gam()</code> is used.
</p>


<h3>See Also</h3>

<p><a href="https://www.tidymodels.org/learn/models/calibration/">https://www.tidymodels.org/learn/models/calibration/</a>,
<code>cal_validate_multinomial()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(modeldata)
library(parsnip)
library(dplyr)

f &lt;-
  list(
    ~ -0.5 + 0.6 * abs(A),
    ~ ifelse(A &gt; 0 &amp; B &gt; 0, 1.0 + 0.2 * A / B, -2),
    ~ -0.6 * A + 0.50 * B - A * B
  )

set.seed(1)
tr_dat &lt;- sim_multinomial(500, eqn_1 = f[[1]], eqn_2 = f[[2]], eqn_3 = f[[3]])
cal_dat &lt;- sim_multinomial(500, eqn_1 = f[[1]], eqn_2 = f[[2]], eqn_3 = f[[3]])
te_dat &lt;- sim_multinomial(500, eqn_1 = f[[1]], eqn_2 = f[[2]], eqn_3 = f[[3]])

set.seed(2)
rf_fit &lt;-
  rand_forest() %&gt;%
  set_mode("classification") %&gt;%
  set_engine("randomForest") %&gt;%
  fit(class ~ ., data = tr_dat)

cal_pred &lt;-
  predict(rf_fit, cal_dat, type = "prob") %&gt;%
  bind_cols(cal_dat)
te_pred &lt;-
  predict(rf_fit, te_dat, type = "prob") %&gt;%
  bind_cols(te_dat)

cal_plot_windowed(cal_pred, truth = class, window_size = 0.1, step_size = 0.03)

smoothed_mn &lt;- cal_estimate_multinomial(cal_pred, truth = class)

new_test_pred &lt;- cal_apply(te_pred, smoothed_mn)

cal_plot_windowed(new_test_pred, truth = class, window_size = 0.1, step_size = 0.03)

</code></pre>


</div>