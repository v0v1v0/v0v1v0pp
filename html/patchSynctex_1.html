<div class="container">

<table style="width: 100%;"><tr>
<td>patchSynctex-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Allows for communication between .Rnw editor and .pdf viewer.
</h2>

<h3>Description</h3>

<p>Utility patching the .synctec(.gz) file resulting from then
<code>LaTeX</code>ing of a .tex file with the concordance information from the
.concordance.tex file resulting from knitting (possibly Sweaving) of the
.Rnw source, allowing(for|back)ward searching from the editor to the viewer and back.
</p>


<h3>Details</h3>

<p>Synchronising TeX source and DVI/PDF output considerably eases
the editing (and, sometimes, debugging) of such documents, by allowing
interaction between source and end-result. Modern DVI/PDF viewers and
editors support this synchronization, either directly, by using
information embedded in the <code>.dvi</code> or <code>.pdf</code> file, or by
using an auxilliary file generated by a LaTeX run with option
<code>\synctex=1</code>, teh <code>.synctex(.gz)</code> file.
</p>
<p>However, when one uses a tool such as <code>Sweave</code> or <code>knitr</code> to
generate a dynamic document (compounding analysis, computations and
report), the resulting <code>.tex</code> file is no longer the original
source, and the references to the <code>.tex</code> file are of little help in
the revision of such a document.
</p>
<p>Duncan Murdoch's <strong>patchDVI</strong> package aims at solving this problem
by using a <em>concordance</em> file that can be generated by passing a
<code>concordance=TRUE</code> option so <code>Sweave</code> or <code>knit*</code>. This
<code>-concordance.tex</code> file contains an RLE encoding of the
correspondence between the <code>.Rnw</code> source and the <code>.tex</code>
intermediary file.
</p>
<p><strong>patchDVI</strong> uses this concordance information to patch the DVI
pointers to source with the relevant pointers to the <code>.Rnw</code> file.
</p>
<p>This package also has a <code>patchSynctex</code> function, attempting t find
the relevant information in the <code>.pdf</code> file. However, some (most ?)
PDFs happens to be impenetrable to <strong>patchDVI</strong>'s
<code>patchSynctex</code> function.
</p>
<p>The present package aims at patching the <code>.synctex(.gz)</code> file with
pointers to the original <code>.Rnw</code> source(s), using exclusively the
<code>.synctex(.gz)</code> file as a source of information. Therefore, the
tools (editors and viewers) must support Synctex in such a way that,
when a <code>.synctex(.gz)</code> file is present, this information is
preffered to the information present in the DVI or PDF document.
</p>
<p>This turns out, according to some serious googling and limited testing,
to be the case with :
</p>

<ul>
<li>
<p> under Linux: <code>emacs</code>, <code>gedit</code> (editors),
<code>evince</code>, <code>okular</code> (viewers), <code>RStudio</code> (IDE);
</p>
</li>
<li>
<p> under MS-Windows: <code>emacs</code> (editor), <code>Sumatra</code>
(viewer), <code>RStudio</code> (IDE).

</p>
</li>
</ul>
<p>Furthermore, the <code>.synctex(.gz)</code> file file remains necessary for
any synchronization, whereas a patched <code>.dvi</code> file can in principle
be used without the <code>.synctex(.gz)</code> file.
</p>
<p>This package is mostly aimed at <strong>programs</strong> (integrated
development environments (IDEs), such as <code>RStudio</code>, or programmable
editors, such as <code>emacs</code> and <code>gedit</code>) able to get R to execute
code: it gives them an easy-to-use interface to a simple function does
the ncessary patches for a given document (characterized by its name
sans extension).
</p>
<p>Its unique function can still be used from an interactive R session for
debugging purposes.
</p>


<h3>Integration in editors and IDEs</h3>

<p><em>This section will be enriched by <strong>your</strong> contributions.</em>
</p>


<h4>
<code>ESS</code> under <code>emacs</code>
</h4>

<p>The logical point of insertion of <code>.synctex(.gz)</code> patching is
after each PDF compilation. It may be a bit wasteful (when two or
more compilations are necessary, in order, for example, to fix
references), but there is no standard way to determine if a LaTeX run
is final.
</p>
<p>This can be achieved by placing an advice on the function used to
compile to PDF|DVI. The example shows how to advice PDF compilation.
</p>


<h5>Up to <code>emacs</code> 24.3</h5>

<p>The following <code>elisp</code> snippet can be placed in your
<code>emacs</code> initialization file (e. g. <code>~/.emacs</code> in
Unix(-like) systems): 
</p>
<pre>
(defadvice ess-swv-PDF (after ess-run-patchKnitr (&amp;optional
						  PDFLATEX-CMD)
			      activate)
  "Patches the .synctex.gz file after PDF compilation"
  (interactive)
  (let* ((fn (buffer-file-name))
	 (fe (file-name-extension fn)))
    (if (string= fe "Rnw")
	(progn
	  (setq RPScmd (concat "patchSynctex('"
			       (file-name-sans-extension fn)
			       "')"))
	  (ess-create-temp-buffer "tampon-ess-execute")
	  (ess-execute "require(patchSynctex)" 'buffer "tampon-ess-execute")
	  (ess-execute RPScmd 'buffer "tampon-ess-execute")
	  (kill-buffer "tampon-ess-execute")))))
(ad-activate 'ess-swv-PDF)
      </pre>



<h5>From <code>emacs</code> 24.4 onwards</h5>

<p>The previous <code>elisp</code> snippet has to be adapted to the newer
<code>advice</code> system of <code>elisp</code>:
</p>
<pre>

(defun ess-swv-patch-after-PDF (&amp;optional PDFLATEX-CMD)
  "Patch the synctex file after PDF compilation"
  (let* ((fn (buffer-file-name))
	 (fe (file-name-extension fn)))
    (if (string= fe "Rnw")
	(progn
	  (setq RPScmd (concat "patchSynctex('"
			       (file-name-sans-extension fn)
			       "')"))
	  (ess-create-temp-buffer "tampon-ess-execute")
	  (ess-execute "require(patchSynctex)" 'buffer "tampon-ess-execute")
	  (ess-execute RPScmd 'buffer "tampon-ess-execute")
	  (kill-buffer "tampon-ess-execute")))))
(advice-add 'ess-swv-PDF :after #'ess-swv-patch-after-PDF)
      </pre>




<h4>
<code>AUCTeX</code> under <code>emacs</code>
</h4>

<p>This is a work in progress : <code>AUCTeX</code> is more sophisticated
than <code>ESS</code> about PDF production. There is no single function to
advice (and <code>knit</code>ting is not yet well integrated, by the
way...). In the meantime, <code>ESS</code> functions remain
available. <em>Stay tuned...</em>
</p>



<h4>Eclipse + StatET</h4>

<p>Create an external build configuration (Sweave document processing)
and place :
</p>
<pre>
require(knitr); 
opts_knit$set(concordance = TRUE); 
texfile &lt;- knit("${resource_loc:${source_file_path}}", encoding="UTF-8")
    </pre>
<p>in the <code>sweave</code> tab, and :
</p>
<pre>
syntex &lt;- if (opts_knit$get('concordance'))"-synctex=1" else "-synctex=0";
command=paste("latexmk -pdf", syntex, "-interaction=nonstopmode", shQuote(texfile));
print(paste("Command ",command,"...\n"));
print(shell(command),intern = TRUE);
if (opts_knit$get('concordance')){
    require(patchSynctex);
    patchSynctex(texfile); 
}
print(paste0(substr(texfile,1, nchar(texfile)-3), "pdf"))
      </pre>
<p>in the <code>LaTeX</code> tab.
</p>



<h3>Note</h3>

<p> The current (1.8) version of <code>knitr</code> does not yet implement
concordance for multifile projects (i. e. children chunks). </p>


<h3>Author(s)</h3>

<p>Jan Gleixner, Emmanuel Charpentier
</p>
<p>Maintainer: Emmanuel Charpentier <a href="emm.charpentier@free.fr">emm.charpentier@free.fr</a> </p>


<h3>References</h3>

<p>Duncan Murdoch's excellent
<a href="https://CRAN.R-project.org/package=patchDVI">patchDVI</a> has a
great vignette explaining the basics of the problem.
</p>


</div>