<div class="container">

<table style="width: 100%;"><tr>
<td>detrend</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Detrending spectral data</h2>

<h3>Description</h3>

<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script><p>Normalizes each row of an input matrix by applying a SNV transformation
followed by fitting a second order linear model and returning the fitted
residuals.
</p>


<h3>Usage</h3>

<pre><code class="language-R">detrend(X, wav, p = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a numeric matrix or vector to process  (optionally a data frame that
can be coerced to a numerical matrix)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wav</code></td>
<td>
<p>the wavelengths/ band centers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>an integer larger than 1 indicating the polynomial order (default is
2, as in the original paper of Barnes et al., 1989).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The detrend is a row-wise transformation that allows to correct for
wavelength-dependent scattering effects (variations in curvilinearity). A
\(p\) order polynomial is fit for each spectrum (\(x_i\))
using the vector of bands (\(\lambda\), e.g. wavelengths) as
explanatory variable as follows:
</p>
\[x_i = a\lambda^p + ... + b\lambda + c + e_i\]
<p>were a, b, c are estimated by least squares, and \(e_i\) are the
spectral residuals of the least square fit. The residuals of the \(i\)th
correspond to the \(i\)th detrended spectrum.
</p>


<h3>Value</h3>

<p>a matrix or vector with the detrended data.
</p>


<h3>Author(s)</h3>

<p>Antoine Stevens and <a href="https://orcid.org/0000-0002-5369-5120">Leonardo Ramirez-Lopez</a>
</p>


<h3>References</h3>

<p>Barnes RJ, Dhanoa MS, Lister SJ. 1989. Standard normal variate
transformation and de-trending of near-infrared diffuse reflectance spectra.
Applied spectroscopy, 43(5): 772-777.
</p>


<h3>See Also</h3>

<p><code>standardNormalVariate</code>, <code>blockScale</code>,
<code>blockNorm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(NIRsoil)
wav &lt;- as.numeric(colnames(NIRsoil$spc))
# conversion to reflectance
opar &lt;- par(no.readonly = TRUE)
par(mfrow = c(2, 1), mar = c(4, 4, 2, 2))
# plot of the 10 first spectra
matplot(wav, t(NIRsoil$spc[1:10, ]),
  type = "l",
  xlab = "",
  ylab = "Absorbance"
)
mtext("Raw spectra")
det &lt;- detrend(NIRsoil$spc, wav)
matplot(wav, t(det[1:10, ]),
  type = "l",
  xlab = "Wavelength /nm",
  ylab = "Absorbance"
)
mtext("Detrend spectra")
par(opar)
</code></pre>


</div>