<div class="container">

<table style="width: 100%;"><tr>
<td>Trade-Analysis</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Analysing Trades: Compute Profit/Loss, Resize and more
</h2>

<h3>Description</h3>

<p>Functions to help analyse trades (as opposed to profit-and-loss series)
</p>


<h3>Usage</h3>

<pre><code class="language-R">scale_trades(amount, price, timestamp, aggregate = FALSE,
            fun = NULL, ...)
split_trades(amount, price, timestamp, aggregate = FALSE,
             drop.zero = FALSE)

limit(amount, price, timestamp, lim, tol = 1e-8)
scale_to_unity(amount)
close_on_first(amount)

tw_exposure(amount, timestamp, start, end, abs.value = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>amount</code></td>
<td>

<p>notionals
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>price</code></td>
<td>

<p>a vector of prices
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timestamp</code></td>
<td>

<p>a vector.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate</code></td>
<td>

<p><code>TRUE</code> or <code>FALSE</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>

<p>a function
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lim</code></td>
<td>

<p>a maximum absolute position size
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>

<p>optional time
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end</code></td>
<td>

<p>optional time
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop.zero</code></td>
<td>

<p>logical. If <code>TRUE</code>, trades with zero amounts are removed.
See Examples.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abs.value</code></td>
<td>

<p>logical. If <code>TRUE</code>, the absolute exposure is computed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed on to fun</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>numeric</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>scale_trades</code> takes a vector of notionals, prices and
scales all trades along the paths so that the maximum
exposure is 1.
</p>
<p>The default <code>fun</code> divides every element of a vector
<code>n</code> by <code>max(abs(cumsum(n)))</code>. If user-specified,
the function <code>fun</code> needs to take a vector of notionals
(changes in position.)
</p>
<p><code>split_trades</code> decomposes a trade list into single
trades, where a single trade comprises those trades from a
zero position to the next zero position.  Note that the
trades must be sorted chronologically.
</p>


<h3>Value</h3>

<p>Either a list or a list-of-lists.
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>See Also</h3>

<p><code>btest</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">n &lt;- c(1,1,-3,-1,2)
p &lt;- 100 + 1:length(n)
timestamp &lt;- 1:length(n)

scale_trades(n, p, timestamp)
scale_trades(n, p, timestamp, TRUE)  ## each _trade_ gets scaled

split_trades(n, p, timestamp)
split_trades(n, p, timestamp, TRUE)  ## almost like the original series



## effect of 'drop.zero'
P &lt;- c(100, 99, 104, 103, 102, 105, 104)  ## price series
S &lt;- c(  0,  1,   1,   0,   0,   1,   0)  ## position to be held
dS &lt;- c(0, diff(S)) ## change in position ==&gt; trades
t &lt;- seq_along(P)

#### ==&gt; 1) with all zero amounts
split_trades(amount = dS, price = P, timestamp = t)

#### ==&gt; 2) without zero-amount trades
split_trades(amount = dS, price = P, timestamp = t, drop.zero = TRUE)

#### ==&gt; 3) without all zero-amounts
zero &lt;- dS == 0
split_trades(amount = dS[!zero], price = P[!zero], timestamp = t[!zero])

</code></pre>


</div>