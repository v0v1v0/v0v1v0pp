<div class="container">

<table style="width: 100%;"><tr>
<td>aovperm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>P-values based on permutation tests for ANOVA and repeated measures ANOVA designs.</h2>

<h3>Description</h3>

<p>Provides p-values for omnibus tests based on permutations for factorial and repeated measures ANOVA. This function produces the F statistics, parametric p-values (based, on Gaussian and sphericity assumptions) and p-values based on the permutation methods that handle nuisance variables.
</p>


<h3>Usage</h3>

<pre><code class="language-R">aovperm(
  formula,
  data = NULL,
  np = 5000,
  method = NULL,
  type = "permutation",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula object. The formula for repeated measures ANOVA should be written using the same notation as aov by adding
<code>+Error(id/within)</code>, where <code>id</code> is the factor that identify the subjects and <code>within</code> is the within factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame or matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>np</code></td>
<td>
<p>The number of permutations. Default value is <code>5000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string indicating the method used to handle nuisance variables. Default is <code>NULL</code> and will change if to <code>"freedman_lane"</code> for the fixed effects model and <code>"Rd_kheradPajouh_renaud"</code> for the random effect models. See Details for other methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A character string to specify the type of transformations: "permutation" and "signflip" are available. Is overridden if P is given. See help from Pmat.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Futher arguments, see details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The following methods are available for the fixed effects model defined as <code class="reqn">y = D\eta + X\beta + \epsilon</code>. If we want to test <code class="reqn">\beta = 0</code> and take into account the effects of the nuisance variables <code class="reqn">D</code>, we transform the data :
</p>

<table>
<tr>
<td style="text-align: left;">
<code>method</code> argument </td>
<td style="text-align: center;"> <code class="reqn">y*</code> </td>
<td style="text-align: center;"> <code class="reqn">D*</code> </td>
<td style="text-align: center;"> <code class="reqn">X*</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"draper_stoneman"</code> </td>
<td style="text-align: center;"> <code class="reqn">y</code> </td>
<td style="text-align: center;"> <code class="reqn">D</code> </td>
<td style="text-align: center;"> <code class="reqn">PX</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"freedman_lane"</code> </td>
<td style="text-align: center;"> <code class="reqn">(H_D+PR_D)y</code> </td>
<td style="text-align: center;"> <code class="reqn">D</code> </td>
<td style="text-align: center;"> <code class="reqn">X</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"manly"</code> </td>
<td style="text-align: center;"> <code class="reqn">Py</code> </td>
<td style="text-align: center;"> <code class="reqn">D</code> </td>
<td style="text-align: center;"> <code class="reqn">X</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"terBraak"</code> </td>
<td style="text-align: center;"> <code class="reqn">(H_{X,D}+PR_{X,D})y</code> </td>
<td style="text-align: center;"> <code class="reqn">D</code> </td>
<td style="text-align: center;"> <code class="reqn">X</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"kennedy"</code> </td>
<td style="text-align: center;"> <code class="reqn">PR_D y</code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: center;"> <code class="reqn">R_D X</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"huh_jhun"</code> </td>
<td style="text-align: center;"> <code class="reqn">PV'R_Dy</code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: center;"> <code class="reqn">V'R_D X</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"dekker"</code> </td>
<td style="text-align: center;"> <code class="reqn">y</code> </td>
<td style="text-align: center;"> <code class="reqn">D</code> </td>
<td style="text-align: center;"> <code class="reqn">PR_D X</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>The following methods are available for the random effects model <code class="reqn">y = D\eta + X\beta + E\kappa + Z\gamma+ \epsilon</code>. If we want to test <code class="reqn">\beta = 0</code> and take into account the effect of the nuisance variable <code class="reqn">D</code> we can transform the data by permutation:
</p>

<table>
<tr>
<td style="text-align: left;">
<code>method</code> argument </td>
<td style="text-align: center;"> <code class="reqn">y*</code> </td>
<td style="text-align: center;"> <code class="reqn">D*</code> </td>
<td style="text-align: center;"> <code class="reqn">X*</code> </td>
<td style="text-align: center;"> <code class="reqn">E*</code> </td>
<td style="text-align: center;"> <code class="reqn">Z*</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"Rd_kheradPajouh_renaud"</code> </td>
<td style="text-align: center;"> <code class="reqn">PR_D y</code> </td>
<td style="text-align: center;">  </td>
<td style="text-align: center;"> <code class="reqn">R_D X</code> </td>
<td style="text-align: center;"> <code class="reqn">R_D E</code> </td>
<td style="text-align: center;"> <code class="reqn">R_D Z</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>"Rde_kheradPajouh_renaud"</code> </td>
<td style="text-align: center;"> <code class="reqn">PR_{D,E}y</code>  </td>
<td style="text-align: center;">  </td>
<td style="text-align: center;"> <code class="reqn">R_{D,E} X</code> </td>
<td style="text-align: center;">   </td>
<td style="text-align: center;"> <code class="reqn">R_{D,E}Z</code>
</td>
</tr>
</table>
<p>Other arguments could be pass in <code>...</code> :<br><br><code>P</code> : a matrix,  of class <code>matrix</code> or <code>Pmat</code>, containing the permutations (for the reproductibility of the results). The first column must be the identity permutation (not checked). <code>P</code> overwrites <code>np</code> argument. <br><code>rnd_rotation</code> : a random matrix of size <code class="reqn">n \times n</code> to compute the rotation used for the <code>"huh_jhun"</code> method.
<code>coding_sum</code> : a logical set to <code>TRUE</code> defining the coding of the design matrix to <code>contr.sum</code> to test the main effects. If it is set to <code>FALSE</code> the design matrix is computed with the coding defined in the dataframe. The tests of simple effets are possible with a coding of the factors of the dataframe set to <code>contr.treatment</code>.<br></p>


<h3>Value</h3>

<p>A <code>lmperm</code> object containing most of the objects given in an lm object, an ANOVA table with parametric and permutation p-values, the test statistics and the permutation distributions.
</p>


<h3>Author(s)</h3>

<p>jaromil.frossard@unige.ch
</p>


<h3>See Also</h3>

<p><code>lmperm</code> <code>plot.lmperm</code>
</p>
<p>Other main function: 
<code>clusterlm()</code>,
<code>lmperm()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## data
data("emergencycost")

## centrering the covariate to the mean
emergencycost$LOSc &lt;- scale(emergencycost$LOS, scale = FALSE)

## ANCOVA
## Warning : np argument must be greater (recommendation: np&gt;=5000)
mod_cost_0 &lt;- aovperm(cost ~ LOSc*sex*insurance, data = emergencycost, np = 2000)
mod_cost_0

## same analysis but with signflip
## Warning : np argument must be greater (recommendation: np&gt;=5000)
mod_cost_0s &lt;- aovperm(cost ~ LOSc*sex*insurance, data = emergencycost, type="signflip", np = 2000)
mod_cost_0s

## Testing at 14 days
emergencycost$LOS14 &lt;- emergencycost$LOS - 14

mod_cost_14 &lt;- aovperm(cost ~ LOS14*sex*insurance, data = emergencycost, np = 2000)
mod_cost_14

## Effect of sex within the public insured
contrasts(emergencycost$insurance) &lt;- contr.treatment
contrasts(emergencycost$sex) &lt;- contr.sum
emergencycost$insurance &lt;- relevel(emergencycost$insurance, ref = "public")

mod_cost_se &lt;- aovperm(cost ~ LOSc*sex*insurance, data = emergencycost,
                        np = 2000, coding_sum = FALSE)
mod_cost_se


## Repeated measures ANCOVA
## data
data(jpah2016)

## centrering the covariate
jpah2016$bmic &lt;- scale(jpah2016$bmi, scale = FALSE)

## Warning : np argument must be greater (recommendation: np&gt;=5000)
mod_jpah2016 &lt;- aovperm(iapa ~ bmic*condition*time+ Error(id/(time)),
                    data = jpah2016, method = "Rd_kheradPajouh_renaud")
mod_jpah2016


</code></pre>


</div>