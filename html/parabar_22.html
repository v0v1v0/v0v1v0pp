<div class="container">

<table style="width: 100%;"><tr>
<td>par_apply</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run a Task in Parallel</h2>

<h3>Description</h3>

<p>This function can be used to run a task in parallel. The task is executed in
parallel on the specified backend, similar to <code>parallel::parApply()</code>. If
<code>backend = NULL</code>, the task is executed sequentially using <code>base::apply()</code>.
See the <strong>Details</strong> section for more information on how this function works.
</p>


<h3>Usage</h3>

<pre><code class="language-R">par_apply(backend = NULL, x, margin, fun, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>backend</code></td>
<td>
<p>An object of class <code>Backend</code> as returned by the
<code>start_backend()</code> function. It can also be <code>NULL</code> to run the task
sequentially via <code>base::apply()</code>. The default value is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An array to pass to the <code>fun</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margin</code></td>
<td>
<p>A numeric vector indicating the dimensions of <code>x</code> the
<code>fun</code> function should be applied over. For example, for a matrix,
<code>margin = 1</code> indicates applying <code>fun</code> rows-wise, <code>margin = 2</code>
indicates applying <code>fun</code> columns-wise, and <code>margin = c(1, 2)</code>
indicates applying <code>fun</code> element-wise. Named dimensions are also
possible depending on <code>x</code>. See <code>parallel::parApply()</code> and
<code>base::apply()</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>A function to apply to <code>x</code> according to the <code>margin</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to pass to the <code>fun</code> function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function uses the <code>UserApiConsumer</code> class that acts like an
interface for the developer API of the <code>parabar</code> package.
</p>


<h3>Value</h3>

<p>The dimensions of the output vary according to the <code>margin</code> argument. Consult
the documentation of <code>base::apply()</code> for a detailed explanation on how the
output is structured.
</p>


<h3>See Also</h3>

<p><code>start_backend()</code>, <code>peek()</code>, <code>export()</code>,
<code>evaluate()</code>, <code>clear()</code>, <code>configure_bar()</code>,
<code>par_sapply()</code>, <code>par_lapply()</code>, <code>stop_backend()</code>,
<code>set_option()</code>, <code>get_option()</code>, <code>Options</code>,
<code>UserApiConsumer</code>, and <code>Service</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# Define a simple task.
task &lt;- function(x) {
    # Perform computations.
    Sys.sleep(0.01)

    # Return the result.
    mean(x)
}

# Define a matrix for the task.
x &lt;- matrix(rnorm(100^2, mean = 10, sd = 0.5), nrow = 100, ncol = 100)

# Start an asynchronous backend.
backend &lt;- start_backend(cores = 2, cluster_type = "psock", backend_type = "async")

# Run a task in parallel over the rows of `x`.
results &lt;- par_apply(backend, x = x, margin = 1, fun = task)

# Run a task in parallel over the columns of `x`.
results &lt;- par_apply(backend, x = x, margin = 2, fun = task)

# The task can also be run over all elements of `x` using `margin = c(1, 2)`.
# Improper dimensions will throw an error.
try(par_apply(backend, x = x, margin = c(1, 2, 3), fun = task))

# Disable progress tracking.
set_option("progress_track", FALSE)

# Run a task in parallel.
results &lt;- par_apply(backend, x = x, margin = 1, fun = task)

# Enable progress tracking.
set_option("progress_track", TRUE)

# Change the progress bar options.
configure_bar(type = "modern", format = "[:bar] :percent")

# Run a task in parallel.
results &lt;- par_apply(backend, x = x, margin = 1, fun = task)

# Stop the backend.
stop_backend(backend)

# Start a synchronous backend.
backend &lt;- start_backend(cores = 2, cluster_type = "psock", backend_type = "sync")

# Run a task in parallel.
results &lt;- par_apply(backend, x = x, margin = 1, fun = task)

# Disable progress tracking to remove the warning that progress is not supported.
set_option("progress_track", FALSE)

# Run a task in parallel.
results &lt;- par_apply(backend, x = x, margin = 1, fun = task)

# Stop the backend.
stop_backend(backend)

# Run the task using the `base::lapply` (i.e., non-parallel).
results &lt;- par_apply(NULL, x = x, margin = 1, fun = task)



</code></pre>


</div>