<div class="container">

<table style="width: 100%;"><tr>
<td>r2_nakagawa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nakagawa's R2 for mixed models</h2>

<h3>Description</h3>

<p>Compute the <em>marginal</em> and <em>conditional</em> r-squared value for
mixed effects models with complex random effects structures.
</p>


<h3>Usage</h3>

<pre><code class="language-R">r2_nakagawa(
  model,
  by_group = FALSE,
  tolerance = 1e-08,
  ci = NULL,
  iterations = 100,
  ci_method = NULL,
  null_model = NULL,
  approximation = "lognormal",
  model_component = NULL,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A mixed effects model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_group</code></td>
<td>
<p>Logical, if <code>TRUE</code>, returns the explained variance
at different levels (if there are multiple levels). This is essentially
similar to the variance reduction approach by <em>Hox (2010), pp. 69-78</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p>Tolerance for singularity check of random effects, to decide
whether to compute random effect variances for the conditional r-squared
or not. Indicates up to which value the convergence result is accepted. When
<code>r2_nakagawa()</code> returns a warning, stating that random effect variances
can't be computed (and thus, the conditional r-squared is <code>NA</code>),
decrease the tolerance-level. See also <code>check_singularity()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>Confidence resp. credible interval level. For <code>icc()</code>, <code>r2()</code>, and
<code>rmse()</code>, confidence intervals are based on bootstrapped samples from the
ICC, R2 or RMSE value. See <code>iterations</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>Number of bootstrap-replicates when computing confidence
intervals for the ICC, R2, RMSE etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_method</code></td>
<td>
<p>Character string, indicating the bootstrap-method. Should
be <code>NULL</code> (default), in which case <code>lme4::bootMer()</code> is used for bootstrapped
confidence intervals. However, if bootstrapped intervals cannot be calculated
this way, try <code>ci_method = "boot"</code>, which falls back to <code>boot::boot()</code>. This
may successfully return bootstrapped confidence intervals, but bootstrapped
samples may not be appropriate for the multilevel structure of the model.
There is also an option <code>ci_method = "analytical"</code>, which tries to calculate
analytical confidence assuming a chi-squared distribution. However, these
intervals are rather inaccurate and often too narrow. It is recommended to
calculate bootstrapped confidence intervals for mixed models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null_model</code></td>
<td>
<p>Optional, a null model to compute the random effect variances,
which is passed to <code>insight::get_variance()</code>. Usually only required if
calculation of r-squared or ICC fails when <code>null_model</code> is not specified. If
calculating the null model takes longer and you already have fit the null
model, you can pass it here, too, to speed up the process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>approximation</code></td>
<td>
<p>Character string, indicating the approximation method
for the distribution-specific (observation level, or residual) variance. Only
applies to non-Gaussian models. Can be <code>"lognormal"</code> (default), <code>"delta"</code> or
<code>"trigamma"</code>. For binomial models, the default is the <em>theoretical</em>
distribution specific variance, however, it can also be
<code>"observation_level"</code>. See <em>Nakagawa et al. 2017</em>, in particular supplement
2, for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_component</code></td>
<td>
<p>For models that can have a zero-inflation component,
specify for which component variances should be returned. If <code>NULL</code> or
<code>"full"</code> (the default), both the conditional and the zero-inflation component
are taken into account. If <code>"conditional"</code>, only the conditional component is
considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Toggle warnings and messages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed down to <code>lme4::bootMer()</code> or <code>boot::boot()</code>
for bootstrapped ICC, R2, RMSE etc.; for <code>variance_decomposition()</code>,
arguments are passed down to <code>brms::posterior_predict()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Marginal and conditional r-squared values for mixed models are calculated
based on <em>Nakagawa et al. (2017)</em>. For more details on the computation of
the variances, see <code>insight::get_variance()</code>. The random effect variances are
actually the mean random effect variances, thus the r-squared value is also
appropriate for mixed models with random slopes or nested random effects
(see <em>Johnson, 2014</em>).
</p>

<ul>
<li> <p><strong>Conditional R2</strong>: takes both the fixed and random effects into account.
</p>
</li>
<li> <p><strong>Marginal R2</strong>: considers only the variance of the fixed effects.
</p>
</li>
</ul>
<p>The contribution of random effects can be deduced by subtracting the
marginal R2 from the conditional R2 or by computing the <code>icc()</code>.
</p>


<h3>Value</h3>

<p>A list with the conditional and marginal R2 values.
</p>


<h3>Supported models and model families</h3>

<p>The single variance components that are required to calculate the marginal
and conditional r-squared values are calculated using the <code>insight::get_variance()</code>
function. The results are validated against the solutions provided by
<em>Nakagawa et al. (2017)</em>, in particular examples shown in the Supplement 2
of the paper. Other model families are validated against results from the
<strong>MuMIn</strong> package. This means that the r-squared values returned by <code>r2_nakagawa()</code>
should be accurate and reliable for following mixed models or model families:
</p>

<ul>
<li>
<p> Bernoulli (logistic) regression
</p>
</li>
<li>
<p> Binomial regression (with other than binary outcomes)
</p>
</li>
<li>
<p> Poisson and Quasi-Poisson regression
</p>
</li>
<li>
<p> Negative binomial regression (including nbinom1 and nbinom2 families)
</p>
</li>
<li>
<p> Gaussian regression (linear models)
</p>
</li>
<li>
<p> Gamma regression
</p>
</li>
<li>
<p> Tweedie regression
</p>
</li>
<li>
<p> Beta regression
</p>
</li>
<li>
<p> Ordered beta regression
</p>
</li>
</ul>
<p>Following model families are not yet validated, but should work:
</p>

<ul>
<li>
<p> Zero-inflated and hurdle models
</p>
</li>
<li>
<p> Beta-binomial regression
</p>
</li>
<li>
<p> Compound Poisson regression
</p>
</li>
<li>
<p> Generalized Poisson regression
</p>
</li>
<li>
<p> Log-normal regression
</p>
</li>
</ul>
<p>Extracting variance components for models with zero-inflation part is not
straightforward, because it is not definitely clear how the distribution-specific
variance should be calculated. Therefore, it is recommended to carefully
inspect the results, and probably validate against other models, e.g. Bayesian
models (although results may be only roughly comparable).
</p>
<p>Log-normal regressions (e.g. <code>lognormal()</code> family in <strong>glmmTMB</strong> or <code>gaussian("log")</code>)
often have a very low fixed effects variance (if they were calculated as
suggested by <em>Nakagawa et al. 2017</em>). This results in very low ICC or
r-squared values, which may not be meaningful.
</p>


<h3>References</h3>


<ul>
<li>
<p> Hox, J. J. (2010). Multilevel analysis: techniques and applications
(2nd ed). New York: Routledge.
</p>
</li>
<li>
<p> Johnson, P. C. D. (2014). Extension of Nakagawa and Schielzeth’s R2 GLMM
to random slopes models. Methods in Ecology and Evolution, 5(9), 944–946.
<a href="https://doi.org/10.1111/2041-210X.12225">doi:10.1111/2041-210X.12225</a>
</p>
</li>
<li>
<p> Nakagawa, S., and Schielzeth, H. (2013). A general and simple method for
obtaining R2 from generalized linear mixed-effects models. Methods in
Ecology and Evolution, 4(2), 133–142. <a href="https://doi.org/10.1111/j.2041-210x.2012.00261.x">doi:10.1111/j.2041-210x.2012.00261.x</a>
</p>
</li>
<li>
<p> Nakagawa, S., Johnson, P. C. D., and Schielzeth, H. (2017). The
coefficient of determination R2 and intra-class correlation coefficient from
generalized linear mixed-effects models revisited and expanded. Journal of
The Royal Society Interface, 14(134), 20170213.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
model &lt;- lme4::lmer(Sepal.Length ~ Petal.Length + (1 | Species), data = iris)
r2_nakagawa(model)
r2_nakagawa(model, by_group = TRUE)

</code></pre>


</div>