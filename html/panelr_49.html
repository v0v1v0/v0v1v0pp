<div class="container">

<table style="width: 100%;"><tr>
<td>wbm_stan</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian estimation of within-between models</h2>

<h3>Description</h3>

<p>A near-equivalent of <code>wbm()</code> that instead uses Stan,
via <span class="pkg">rstan</span> and <span class="pkg">brms</span>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">wbm_stan(
  formula,
  data,
  id = NULL,
  wave = NULL,
  model = "w-b",
  detrend = FALSE,
  use.wave = FALSE,
  wave.factor = FALSE,
  min.waves = 2,
  model.cor = FALSE,
  family = gaussian,
  fit_model = TRUE,
  balance.correction = FALSE,
  dt.random = TRUE,
  dt.order = 1,
  chains = 3,
  iter = 2000,
  scale = FALSE,
  save_ranef = FALSE,
  interaction.style = c("double-demean", "demean", "raw"),
  weights = NULL,
  offset = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Model formula. See details for crucial
info on <code>panelr</code>'s formula syntax.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The data, either a <code>panel_data</code> object or <code>data.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>If <code>data</code> is not a <code>panel_data</code> object, then the name of the
individual id column as a string. Otherwise, leave as NULL, the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wave</code></td>
<td>
<p>If <code>data</code> is not a <code>panel_data</code> object, then the name of the
panel wave column as a string. Otherwise, leave as NULL, the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>One of <code>"w-b"</code>, <code>"within"</code>, <code>"between"</code>,
<code>"contextual"</code>. See details for more on these options.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detrend</code></td>
<td>
<p>Adjust within-subject effects for trends in the predictors?
Default is FALSE, but some research suggests this is a better idea
(see Curran and Bauer (2011) reference).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.wave</code></td>
<td>
<p>Should the wave be included as a predictor? Default is
FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wave.factor</code></td>
<td>
<p>Should the wave variable be treated as an unordered
factor instead of continuous? Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.waves</code></td>
<td>
<p>What is the minimum number of waves an individual must
have participated in to be included in the analysis? Default is <code>2</code> and
any valid number is accepted. <code>"all"</code> is also acceptable if you want to
include only complete panelists.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.cor</code></td>
<td>
<p>Do you want to model residual autocorrelation?
This is often appropriate for linear models (<code>family = gaussian</code>).
Default is FALSE to be consistent with <code>wbm()</code>, reduce
runtime, and avoid warnings for non-linear models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Use this to specify GLM link families. Default is <code>gaussian</code>,
the linear model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit_model</code></td>
<td>
<p>Fit the model? Default is TRUE. If FALSE, only the model
code is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balance.correction</code></td>
<td>
<p>Correct between-subject effects for unbalanced
panels following the procedure in Curran and Bauer (2011)? Default is
FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dt.random</code></td>
<td>
<p>Should the detrending procedure be performed with a
random slope for each entity? Default is TRUE but for short panels
FALSE may be better, fitting a trend for all entities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dt.order</code></td>
<td>
<p>If detrending using <code>detrend</code>, what order polynomial
would you like to specify for the relationship between time and the
predictors? Default is 1, a linear model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p>How many Markov chains should be used? Default is 3, to leave
you with one unused thread if you're on a typical dual-core machine.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>How many iterations, including warmup? Default is 2000, leaving
1000 per chain after warmup. For some models and data, you may need quite
a few more.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>Standardize predictors? This can speed up model fit. Default
is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_ranef</code></td>
<td>
<p>Save random effect estimates? This can be crucial for
predicting from the model and for certain post-estimation procedures.
On the other hand, it drastically increases the size of the resulting
model. Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interaction.style</code></td>
<td>
<p>The best way to calculate interactions in within
models is in some dispute. The conventional way (<code>"demean"</code>) is to first
calculate the product of the variables involved in the interaction before
those variables have their means subtracted and then subtract the mean of
the product from the product term (see Schunk and Perales (2017)).
Giesselmann and Schmidt-Catran (2020) show this method carries
between-entity differences that within models are designed to model out.
They suggest an alternate method (<code>"double-demean"</code>) in which the product
term is first calculated using the de-meaned lower-order variables and
then the subject means are subtracted from this product term. Another
option is to simply use the product term of the de-meaned variables
(<code>"raw"</code>), but Giesselmann and Schmidt-Catran (2020) show this method
biases the results towards zero effect. The default is <code>"double-demean"</code>
but if emulating other software is the goal, <code>"demean"</code> might be
preferred.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>If using weights, either the name of the column in the data
that contains the weights or a vector of the weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>this can be used to specify an <em>a priori</em> known
component to be included in the linear predictor during
fitting. This should be <code>NULL</code> or a numeric vector of length
equal to the number of cases.  One or more <code>offset</code>
terms can be included in the formula instead or as well, and if more
than one is specified their sum is used.  See <code>model.offset</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed on to <code>brms::brm()</code>. This can include
specification of priors.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <code>wbm()</code> for details on the formula syntax, model types,
and some other stuff.
</p>


<h3>Value</h3>

<p>A <code>wbm_stan</code> object, which is a list containing a <code>model</code> object
with the <code>brm</code> model and a <code>stan_code</code> object with the model code.
</p>
<p>If <code>fit_model = FALSE</code>, instead a list is returned containing a <code>stan_code</code>
object and a <code>stan_data</code> object, leaving you with the tools you need to
run the model yourself using <code>rstan</code>.
</p>


<h3>Author(s)</h3>

<p>Jacob A. Long
</p>


<h3>See Also</h3>

<p><code>wbm()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
 data("WageData")
 wages &lt;- panel_data(WageData, id = id, wave = t)
 model &lt;- wbm_stan(lwage ~ lag(union) + wks | blk + fem | blk * lag(union),
           data = wages, chains = 1, iter = 2000)
 summary(model)

## End(Not run)
</code></pre>


</div>