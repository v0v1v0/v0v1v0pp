<div class="container">

<table style="width: 100%;"><tr>
<td>smZ</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Generate Sparse Matrix Z for penalized spline smoothing
</h2>

<h3>Description</h3>

<p>Constructs a sparse matrix (Z) of a spline function with for a covariate with(out) group. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">smZ(x, k=6, intKnots=NULL, range.x=NULL, degree=3, 
    type=c("ZOSull", "Ztps", "ns", "bs", "bernstein", "bSpline",
         "nSpline", "cSpline", "iSpline", "mSpline", "smspline"), 
    by=NULL, group=FALSE, intercept=FALSE, pred=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

	
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>x covariate for the smooth function. Missing values are allowed and will be returned as they are.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Degree of freedom that equals to the column number of the returned matrix. One can specify df rather than knots, then the function chooses df - degree - as.integer(intercept) internal knots at suitable quantiles of x ignoring missing values and those x outside of the boundary. If internal knots are specified via knots, the specified df will be ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intKnots</code></td>
<td>
<p>Ordered array of length smaller than that of x and consisting of unique numbers between min(x) and max(x) that specifies the positions of internal knots, that define the spline basis (see the Wand and Ormerod (2008) reference below for full mathematical details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range.x</code></td>
<td>
<p>Array of length 2 such that range.x[1] &gt;= min(x) and range.x[2] &lt;= max(x).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>Integer: degree of (truncated) polynomial.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of splines including "ZOSull", "Ztps", "ns", "bs", "bernstein", "bSpline", "nSpline", "cSpline", "iSpline", "mSpline" and "smspline", the default is "ZOSull".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>Factor for group wise splines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>When <code>by != NULL</code>, producing group wise splines with radom effects separately.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>If TRUE, all of the spline basis functions are returned. Notice that when using I-Spline for monotonic regression, intercept = TRUE should be set even when an intercept term is considered additional to the spline basis functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>If TRUE, the function <code>smZ</code> will be applied for prediction purpose, this option mainly used by function <code>semipred</code> internally.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments for passing on to model setup routines, such as
drv: either 0,1 or 2 with a default value of 0. If drv = 1 then the first derivatives of the O'Sullivan spline basis functions are computed instead. Similarly, if drv = 2 then the second derivatives are computed.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table><tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>A (or a list of) spline design matrix used in the list <code>smoothZ</code>.</p>
</td>
</tr></table>
<h3>Author(s)</h3>

<p>Dongwen Luo, Siva Ganesh and John Koolaard
</p>


<h3>References</h3>

<p>O'Sullivan, F. (1986). A statistical perspective on ill-posed inverse problems (with discussion). <em>Statistical Science</em>, <b>1</b>, 505-527.
</p>


<h3>Examples</h3>

<pre><code class="language-R">x &lt;- seq.int(0, 1, by = 0.01)
knots &lt;- c(0.3, 0.5, 0.6)

zosuMat &lt;- smZ(x, intKnots = knots)
bsMat &lt;- smZ(x, intKnots = knots, degree = 2, type="bs")
isMat &lt;- smZ(x, intKnots = knots, degree = 2, type="iSpline")

splst &lt;- list(zosuMat, bsMat, isMat)
for (i in splst) {
op &lt;- par(mar = c(2.5, 2.5, 0.2, 0.1), mgp = c(1.5, 0.5, 0))
matplot(x, i, type = "l", ylab = "I-spline basis")
abline(v = knots, lty = 2, col = "gray")
## reset to previous plotting settings
par(op)
}

f &lt;- gl(4, 25, length=length(x))
zosuMat_by &lt;- smZ(x, intKnots = knots, by=f) # one sparse matrix
str(zosuMat_by)

zosuMat_by &lt;- smZ(x, intKnots = knots, by=f, group=TRUE) # a list of sparse matrix
str(zosuMat_by)
</code></pre>


</div>