<div class="container">

<table style="width: 100%;"><tr>
<td>merlin</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pedigree likelihoods computed by MERLIN</h2>

<h3>Description</h3>

<p>These functions enable users to call MERLIN (Abecasis et al., 2002) from
within R.
</p>


<h3>Usage</h3>

<pre><code class="language-R">merlin(
  x,
  options,
  markers = NULL,
  linkageMap = NULL,
  verbose = TRUE,
  generateFiles = TRUE,
  cleanup = TRUE,
  dir = tempdir(),
  logfile = NULL,
  merlinpath = NULL,
  checkpath = TRUE
)

likelihoodMerlin(
  x,
  markers = NULL,
  linkageMap = NULL,
  rho = NULL,
  logbase = NULL,
  perChrom = FALSE,
  options = "--likelihood --bits:100 --megabytes:4000 --quiet",
  ...
)

checkMerlin(program = NULL, version = TRUE, error = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>ped</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>A single string containing all arguments to merlin except for
the input file indications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>markers</code></td>
<td>
<p>A vector of names or indices of markers attached to <code>x</code>.
(Default: all markers).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linkageMap</code></td>
<td>
<p>A data frame with three columns (chromosome; marker name;
centiMorgan position) to be used as the marker map by MERLIN.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A logical.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>generateFiles</code></td>
<td>
<p>A logical. If TRUE (default), input files to MERLIN
named '_merlin.ped', '_merlin.dat', '_merlin.map', and '_merlin.freq' are
created in the directory indicated by <code>dir</code>. If FALSE, no files are
created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cleanup</code></td>
<td>
<p>A logical. If TRUE (default), the MERLIN input files are
deleted after the call to MERLIN.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dir</code></td>
<td>
<p>The name of the directory where input files should be written.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logfile</code></td>
<td>
<p>A character. If this is given, the MERLIN screen output will
be dumped to a file with this name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>merlinpath</code></td>
<td>
<p>The path to the folder containing the merlin executables.
If the executables are on the system's search path, this can be left as
NULL (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>checkpath</code></td>
<td>
<p>A logical indicating whether to check that the merlin
executable is found.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>A vector of length one less than the number of markers, specifying
the recombination rate between each consecutive pair.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logbase</code></td>
<td>
<p>Either NULL (default) or a positive number indicating the
basis for logarithmic output. Typical values are <code>exp(1)</code> and 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perChrom</code></td>
<td>
<p>A logical; if TRUE, likelihoods are reported per chromosome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed on to <code>merlin()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>program</code></td>
<td>
<p>A character containing "merlin", "minx" or both (default),
optionally including full paths.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>version</code></td>
<td>
<p>A logical. If TRUE (default), it is checked that running
<code>program</code> produces a printout starting with "MERLIN 1.1.2".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error</code></td>
<td>
<p>A logical, indicating if an error should be raised if <code>program</code>
is not found. Default: FALSE.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For these functions to work, the program MERLIN must be installed (see link
in the Reference section below) and correctly pointed to in the PATH
variable. The <code>merlin()</code> function is a general wrapper which runs MERLIN with
the indicated options, after creating the appropriate input files. For
convenience, MERLIN's "â€“likelihood" functionality is wrapped in a separate
function.
</p>
<p>The <code>merlin()</code> function creates input files "_merlin.ped", "_merlin.dat",
"_merlin.map" and "_merlin.freq" in the <code>dir</code> directory, and then runs the
following command through a call to <code>system()</code>:
</p>
<pre>merlin -p _merlin.ped -d _merlin.dat -m _merlin.map -f
_merlin.freq  &lt;options&gt; </pre>
<p><code>likelihoodMerlin()</code> first runs <code>merlin()</code> with <code>options = "--likelihood --bits:100 --megabytes:4000 --quiet"</code>, and then extracts the likelihood
values from the MERLIN output. Note that the output is the <em>total</em> likelihood
including all markers.
</p>
<p>For likelihood computations with linked markers, the argument <code>rho</code> should
indicate the recombination fractions between each consecutive pair of markers
(i.e., <code>rho[i]</code> is the recombination rate between markers <code>i-1</code> and <code>i</code>).
These will be converted to centiMorgan distances using Haldane's map
function, and used to create genetic marker map in a MERLIN-friendly format.
</p>


<h3>Value</h3>

<p><code>merlin()</code> returns the screen output of MERLIN invisibly.
</p>
<p><code>likelihoodMerlin()</code> returns a single number; the total likelihood using
all indicated markers.
</p>
<p><code>checkMerlin()</code> returns TRUE if the MERLIN executable indicated by
<code>program</code> is found on the system. Otherwise FALSE, or (if <code>error = TRUE</code>)
an error is raised.
</p>


<h3>Author(s)</h3>

<p>Magnus Dehli Vigeland
</p>


<h3>References</h3>

<p>Abecasis et al. (2002) Nat Gen 30:97-101.
<a href="https://csg.sph.umich.edu/abecasis/merlin/">https://csg.sph.umich.edu/abecasis/merlin/</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
if(checkMerlin()) {

### Trivial example for validation
x = nuclearPed(1) |&gt;
  addMarker("1" = "1/2") |&gt;            # likelihood = 1/2
  addMarker("1" = "1/1", "3" = "1/2")  # likelihood = 1/8

# MERLIN likelihoods
lik1 = likelihoodMerlin(x, markers = 1, verbose = FALSE)
lik2 = likelihoodMerlin(x, markers = 2, verbose = FALSE)
likTot = likelihoodMerlin(x, verbose = FALSE)
stopifnot(all.equal(
  round(c(lik1, lik2, likTot), c(3,3,4)), c(1/2, 1/8, 1/16)))

# Example with ped lists
y = singletons(1:2) |&gt;
  addMarker(`1` = "1/2", `2` = "1/1", alleles = 1:2)
lik = likelihoodMerlin(y, verbose = FALSE)
stopifnot(all.equal(round(lik, 3), 1/8))

### Linked markers
z = nuclearPed(2)
m = marker(z, geno = c("1/1", "1/2", "1/2", "1/2"))
z = setMarkers(z, list(m, m))

# By MERLIN...
L1 = likelihoodMerlin(z, markers = 1:2, rho = 0.25, verbose = FALSE)

# ...and by pedprobr
L2 = likelihood2(z, marker1 = 1, marker2 = 2, rho = 0.25)

# stopifnot(all.equal(signif(L1, 3), signif(L2, 3)))
}

</code></pre>


</div>