<div class="container">

<table style="width: 100%;"><tr>
<td>powerCT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Power Calculation in the Analysis of Survival Data for Clinical Trials </h2>

<h3>Description</h3>

<p>Power calculation for the Comparison of Survival Curves Between Two Groups under
the Cox Proportional-Hazards Model for clinical trials. Some parameters will be estimated based on a pilot data set.
</p>


<h3>Usage</h3>

<pre><code class="language-R">powerCT(formula, 
	dat, 
	nE, 
	nC, 
	RR, 
	alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p> A formula object, e.g. <code>Surv(time, status) ~ x</code>, where 
<code>time</code> is a vector of survival/censoring time, <code>status</code> is a vector of 
censoring indicator, <code>x</code> is the group indicator,
which is a factor object in R and takes only two possible values (<code>C</code> for control group 
and <code>E</code> for experimental group). See also the documentation of the function <code>survfit</code> in the 
library <code>survival</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p> a data frame representing the pilot data set and containing at least 3 columns: (1) survival/censoring time; (2) censoring indicator;
(3) group indicator which is a factor object in R and takes only two possible values (<code>C</code> for control group 
and <code>E</code> for experimental group). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nE</code></td>
<td>
<p>integer. number of participants in the experimental group. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nC</code></td>
<td>
<p>integer. number of participants in the control group. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RR</code></td>
<td>
<p>numeric. postulated hazard ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>numeric. type I error rate. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is an implementation of the power calculation method described in Section 14.12 (page 807)
of Rosner (2006). The method was proposed by Freedman (1982).
</p>
<p>The movitation of this function is that some times we do not have information about <code class="reqn">m</code> or <code class="reqn">p_E</code>
and <code class="reqn">p_C</code> available, but we have a pilot data set that can be used to estimate <code class="reqn">p_E</code> and <code class="reqn">p_C</code> hence
<code class="reqn">m</code>, where  <code class="reqn">m=n_E p_E + n_C p_C</code> is the expected total number of events over both groups, <code class="reqn">n_E</code>
and <code class="reqn">n_C</code> are numbers of participants in group E (experimental group) and group C (control group), respectively.
<code class="reqn">p_E</code> is the probability of failure in group E (experimental group) over the maximum time period of the study (t years).  <code class="reqn">p_C</code> is the probability of failure in group C (control group) over the maximum time period of the study 
(t years). 
</p>
<p>Suppose we want to compare the survival curves between an experimental group (<code class="reqn">E</code>) and 
a control group (<code class="reqn">C</code>) in a clinical trial with a maximum follow-up of <code class="reqn">t</code> years. 
The Cox proportional hazards regression model is assumed to have the form:
</p>
<p style="text-align: center;"><code class="reqn">h(t|X_1)=h_0(t)\exp(\beta_1 X_1).</code>
</p>

<p>Let <code class="reqn">n_E</code> be the number of participants in the <code class="reqn">E</code> group
and <code class="reqn">n_C</code> be the number of participants in the <code class="reqn">C</code> group.  
We wish to test the hypothesis <code class="reqn">H0: RR=1</code> versus <code class="reqn">H1: RR</code> not equal to 1, 
where <code class="reqn">RR=\exp(\beta_1)=</code>underlying hazard ratio
for the <code class="reqn">E</code> group versus the <code class="reqn">C</code> group. Let <code class="reqn">RR</code> be the postulated hazard ratio,
<code class="reqn">\alpha</code> be the significance level. Assume that the test is a two-sided test.
If the ratio of participants in group 
E compared to group C <code class="reqn">= n_E/n_C=k</code>, then the power of the test is
</p>
<p style="text-align: center;"><code class="reqn">power=\Phi(\sqrt{k*m}*|RR-1|/(k*RR+1)-z_{1-\alpha/2}),</code>
</p>
 
<p>where </p>
<p style="text-align: center;"><code class="reqn">m=n_E p_E+n_C p_C,</code>
</p>
 
<p>and <code class="reqn">z_{1-\alpha/2}</code> 
is the <code class="reqn">100 (1-\alpha/2)</code>-th percentile of
the standard normal distribution <code class="reqn">N(0, 1)</code>, <code class="reqn">\Phi</code> is the cumulative distribution function (CDF) 
of <code class="reqn">N(0, 1)</code>.
</p>
<p><code class="reqn">p_C</code> and <code class="reqn">p_E</code> can be calculated from the following formulaes:
</p>
<p style="text-align: center;"><code class="reqn">p_C=\sum_{i=1}^{t}D_i, p_E=\sum_{i=1}^{t}E_i,</code>
</p>

<p>where <code class="reqn">D_i=\lambda_i A_i C_i</code>, <code class="reqn">E_i=RR\lambda_i B_i C_i</code>, 
<code class="reqn">A_i=\prod_{j=0}^{i-1}(1-\lambda_j)</code>, <code class="reqn">B_i=\prod_{j=0}^{i-1}(1-RR\lambda_j)</code>, 
<code class="reqn">C_i=\prod_{j=0}^{i-1}(1-\delta_j)</code>.  And
<code class="reqn">\lambda_i</code> is the probability of failure at time <code>i</code> among participants in the 
control group, given that a participant has survived to time <code class="reqn">i-1</code> and is not censored at time <code class="reqn">i-1</code>,
i.e., the approximate hazard time <code class="reqn">i</code> in the control group, <code class="reqn">i=1,...,t</code>; 
<code class="reqn">RRlambda_i</code> is the probability of failure at time <code>i</code> among participants in the 
experimental group, given that a participant has survived to time <code class="reqn">i-1</code> and is not censored at time <code class="reqn">i-1</code>,
i.e., the approximate hazard time <code class="reqn">i</code> in the experimental group, <code class="reqn">i=1,...,t</code>; 
<code class="reqn">delta</code> is the prbability that a participant is censored at time <code class="reqn">i</code> given that he was 
followed up to time <code class="reqn">i</code> and has not failed, <code class="reqn">i=0, 1, ..., t</code>, which is assumed the same in each group. 
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mat.lambda </code></td>
<td>
<p>a matrix with 9 columns and <code>nTimes+1</code> rows, where <code>nTimes</code> is the number of
observed time points for the control group in the data set. The 9 columns are 
(1) <code>time</code> - observed time point for the control group; 
(2) <code>lambda</code>;  
(3) <code>RRlambda</code>; 
(4) <code>delta</code>; 
(5) <code>A</code>; 
(6) <code>B</code>; 
(7) <code>C</code>; 
(8) <code>D</code>; 
(9) <code>E</code>. 
Please refer to the Details section for the definitions of elements
of these quantities. See also Table 14.24 on page 809 of Rosner (2006). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mat.event </code></td>
<td>
<p>a matrix with 5 columns and <code>nTimes+1</code> rows, where <code>nTimes</code> is the number of
observed time points for control group in the data set. The 5 columns are 
(1) <code>time</code> - observed time point for the control group; 
(2) <code>nEvent.C</code> - number of events in the control group at each time point;
(3) <code>nCensored.C</code> - number of censorings in the control group at each time point;
(4) <code>nSurvive.C</code> - number of alived in the control group at each time point;
(5) <code>nRisk.C</code> - number of participants at risk in the control group at each time point.
Please refer to Table 14.12 on page 787 of Rosner (2006). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pC</code></td>
<td>
<p> estimated probability of failure in group C (control group) over the maximum time period of the study (t years). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pE</code></td>
<td>
<p> estimated probability of failure in group E (experimental group) over the maximum time period of the study (t years). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>
<p>the power of the test.</p>
</td>
</tr>
</table>
<h3>Note</h3>

 
<p>(1) The estimates of <code class="reqn">RRlambda_i=RR*\lambda_i</code>. That is, <code>RRlambda</code> is not directly estimated based on data
from the experimental group;
(2) The power formula assumes that the central-limit theorem is valid and hence is appropriate for large samples.
</p>


<h3>References</h3>

 
<p>Freedman, L.S. (1982). 
Tables of the number of patients required in clinical trials using the log-rank test. 
<em>Statistics in Medicine</em>. 1: 121-129
</p>
<p>Rosner B. (2006).
<em>Fundamentals of Biostatistics</em>. (6-th edition). Thomson Brooks/Cole.
</p>


<h3>See Also</h3>

 <p><code>powerCT.default0</code>, 
<code>powerCT.default</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">  # Example 14.42 in Rosner B. Fundamentals of Biostatistics. 
  # (6-th edition). (2006) page 809

  library(survival)

  data(Oph)
  res &lt;- powerCT(formula = Surv(times, status) ~ group, 
		 dat = Oph, 
                 nE = 200, 
		 nC = 200, 
		 RR = 0.7, 
		 alpha = 0.05)

  # Table 14.24 on page 809 of Rosner (2006)
  print(round(res$mat.lambda, 4))

  # Table 14.12 on page 787 of Rosner (2006)
  print(round(res$mat.event, 4))

  # the power
  print(round(res$power, 2))
</code></pre>


</div>