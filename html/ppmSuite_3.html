<div class="container">

<table style="width: 100%;"><tr>
<td>curve_ppmx</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gaussian PPMx Model for Functional Realizations</h2>

<h3>Description</h3>

<p><code>curve_ppmx</code> is the main function used to fit Functional Gaussian PPMx model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">curve_ppmx(y, z, subject,
            Xcon=NULL,Xcat=NULL,
            Xconp=NULL,Xcatp=NULL,
            PPM, M,
            q=3, rw_order=1, balanced=1,
            nknots,npredobs,
            Aparm, modelPriors,
            similarity_function=1,
            consim, calibrate,
            simParms,
            mh=c(1,1),
            draws=1100,burn=100,thin=1)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>numeric vector or a matrix with two columns that contains measured functional response in long format</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>numeric vector contains time points at which functional response is measured in long format</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subject</code></td>
<td>
<p>vector of the same length as z that identies the subject to which each measurement in y corresponds.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xcon</code></td>
<td>
<p>a data-frame with number of rows being equal to the number of subjects and whose columns consist of continuous covariates.  These covariates are included in the PPMx model and therefore influence clusters and thus are only used if the PPM argument is FALSE.  This argument is set to NULL by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xcat</code></td>
<td>
<p>a data-frame  with nsubject number of rows and whose columns consist of categorical covariates.  These covariates are included in the PPMx model and therefore influence clusters and thus are only used if the PPM argument is FALSE.  The categories must be labeled using integers starting at zero. This argument is set to NULL by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xconp</code></td>
<td>
<p>a data-frame with the number of rows corresponding to the number of out-of-sample predictions that are desired and columns consist of continuous covariates that are contained in Xcon.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xcatp</code></td>
<td>
<p>a data-frame with the number of rows corresponding to the number of out-of-sample predictions that are desired and columns consist of categorical covariates that are contained in Xcat.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PPM</code></td>
<td>
<p>Logical argument that indicates if the PPM or PPMx partition model should be employed.  If PPM = FALSE, then at least one of Xcon and Xcat must be supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>Scale parameter connected to the dispersion parameter of a Dirichlet process.  Default is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>Degree of B-spline employed to fit curves</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rw_order</code></td>
<td>
<p>Order of the random walk.  This specifies the type of penalty matrix employed in the penalized B-splines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balanced</code></td>
<td>
<p>scalar with 1 - indicating the design was balanced in the sense that all subjects measurements occur at the same time and 0 - indicating design was not balanced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nknots</code></td>
<td>
<p>scalar indicating the number of evenly spaced knots to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npredobs</code></td>
<td>
<p>number of time predictions to make for each subjects curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Aparm</code></td>
<td>
<p>Upper bound parameter for lambda wich regulates the similarity of curves with in a cluster.  Larger values result in clusters with curves that can be more dissimilar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelPriors</code></td>
<td>
<p>Vector of prior parameter values for priors assigned to parameters of the Gaussian Functional data model.
</p>

<ul>
<li>
<p> A - upper bound on sigma*_j.
</p>
</li>
<li>
<p> s2mu - prior variance for mu the mean vector of theta which are cluster specific spline coefficients,
</p>
</li>
<li>
<p> mb0 - prior mean for beta0_i (subject specific intercept)
</p>
</li>
<li>
<p> s2b0 - prior variance for beta0_i (subject specific intercept)
</p>
</li>
<li>
<p> as2b0 - prior shape associated with IG prior on variance of beta0_i (subject specific intercept)
</p>
</li>
<li>
<p> bs2b0 - prior scale associated with IG prior on variacne of beta0_i (subject specific intercept)
</p>
</li>
<li>
<p> at - prior shape associated with IG prior on tau (smoothing parameter for theta)
</p>
</li>
<li>
<p> bt - prior scale associated with IG prior on tau (smoothing parameter for theta)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>similarity_function</code></td>
<td>
<p>Type of similarity function that is employed for the PPMx prior on partitions.  Options are 1-4 with
</p>

<ul>
<li>
<p>  1 - Auxilliary similarity
</p>
</li>
<li>
<p>  2 - Double dipper similarity
</p>
</li>
<li>
<p>  3 - Cluster variance or entropy for categorical covariates
</p>
</li>
<li>
<p> 4 - Mean Gower dissimilarity (Gower dissimilarity is not available if missing values are present in X)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>consim</code></td>
<td>
<p>If similarity_function is set to either 1 or 2, then consim specifies the type of marginal likelihood used as the similarity function. Options are 1 or 2 with
</p>

<ul>
<li>
<p> 1 - N-N(m0, s20, v) (v variance of “likelihood”, m0 and s20 “prior” parameters),
</p>
</li>
<li>
<p> 2 - N-NIG(m0, k0, nu0, s20) (m0 and k0 center and inverse scalar of a Gaussian, and nu0 and s20 are the number of prior observations and prior variance guess of a Inverse-Chi-Square distribution.)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calibrate</code></td>
<td>
<p>Indicates if the similarity should be calibrated.  Options are 0-2 with
</p>

<ul>
<li>
<p> 0 - no calibration
</p>
</li>
<li>
<p> 1 - standardize similarity value for each covariate
</p>
</li>
<li>
<p> 2 - coarsening is applied so that each similarity is raised to the 1/p power</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simParms</code></td>
<td>
<p>Vector of parameter values employed in the similarity function of the PPMx. Entries of the vector correspond to
</p>

<ul>
<li>
<p> m0 - center continuous similarity with default 0,
</p>
</li>
<li>
<p> s20 - spread of continuous similarity with default 1 if consim=1.  For consim=2 guess of x's variance,
</p>
</li>
<li>
<p> v2 - spread of 'likelihood' for conitnuous similarity (smaller values place more weight on partitions with clusters that contain homogeneous  covariate values)
</p>
</li>
<li>
<p>  k0 - inverse scale for v (only used for N-NIG similarity model)
</p>
</li>
<li>
<p> nu0 - prior number of x "observations" (only used for N-NIG similarity model)
</p>
</li>
<li>
<p> a0 - dirichlet weight for categorical similarity with default of 0.1 (smaller values place more weight on partitions with individuals that are in the same category.)
</p>
</li>
<li>
<p>  alpha - weight associated with cluster-variance and Gower disimilarity
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mh</code></td>
<td>
<p>two dimensional vector containing values for tunning parameter associated with MH update for sigma2 and sigma20</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draws</code></td>
<td>
<p>number of MCMC iterates to be collected. default is 1100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burn</code></td>
<td>
<p>number of MCMC iterates discared as burn-in. default is 100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>number by which the MCMC chain is thinne. default is 1.  Thin must be selected so that it is a multilple of (draws - thin)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function fits a hierarhical functional data model where B-spline coefficients are clustered using either a PPM or a PPMx prior on partitions.
</p>


<h3>Value</h3>

<p>The function returns a list containing arrays filled with MCMC iterates corresponding to model parameters and model fit metrics. In order to provide more detail, in what follows let
</p>
<p>"T" - be the number of MCMC iterates collected,
</p>
<p>"N" - be the number of subjects/units,
</p>
<p>"P" - be the number of knots + degree of spline.
</p>
<p>The output list contains the following
</p>

<ul>
<li>
<p> Si - a matrix of dimension (T, N) containing MCMC iterates assocated with each subjects cluster label.
</p>
</li>
<li>
<p> nclus - a matrix  of dimension (T, 1) containing MCMC iterates associated with the number of clusters
</p>
</li>
<li>
<p> beta - an array of dimension (N, P, T) containing the MCMC iterates assocated with each subjects P-dimensional B-spline coefficients
</p>
</li>
<li>
<p> theta - an array of dimension (N, P, T) containing the MCMC iterates assocated with the cluster specific P-dimensional B-spline coefficients.  Each subjects theta value is reported.
</p>
</li>
<li>
<p> sig2 - a matrix of dimension (T, N) containing MCMC iterates associated with each subjects variance parameter (sigma2*_c_i)
</p>
</li>
<li>
<p> tau2 - a matrix of dimension (T, N) containing MCMC iterates associated with each the cluster-specific smoothing parameter for theta
</p>
</li>
<li>
<p> mu - a matrix of dimension (T, P) containing MCMC iterates for the the P-dimensional B-spline coefficients associated with the global mean.
</p>
</li>
<li>
<p> lam - a matrix of dimension (T, N) containing MCMC iterates for the cluster-specific lambda parameter that dictates the similarity of curves within a cluster
</p>
</li>
<li>
<p> beta0 - a matrix of dimension (T, N) containing MCMC iterates for the subject-specific intercepts
</p>
</li>
<li>
<p> mub0 - vector of length T containing MCMC iterates for mean of beta0
</p>
</li>
<li>
<p> sig2b0 - vector of length T containing MCMC iterates for variance of beta0
</p>
</li>
<li>
<p> like - a matrix of dimension (T, N) containing likelihood values at each MCMC iterate.
</p>
</li>
<li>
<p> WAIC - scalar containing the WAIC value
</p>
</li>
<li>
<p> lpml - scalar containing lpml value
</p>
</li>
<li>
<p> Hmat - a spline design matrix of dimension (N, P)
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">


# Example with balanced data.
# generate data for two clusters with 10 subjects each.

nobs &lt;- 100
nsubject &lt;- 2*10

set.seed(101)
xx &lt;- seq(0,2*pi, length=nobs)
y &lt;- cbind(replicate(n=10, sin(xx) + rnorm(nobs,0,0.5)),
           replicate(n=10, cos(xx) + rnorm(nobs,0,0.5)))

dat &lt;- data.frame(y=c(y),
                  z=rep(1:nobs, times=nsubject),
                  Name=rep(1:nsubject, each=nobs))

subject_obs_vec &lt;- dat$Name

nknots &lt;- 15



# Small number of iterates for illustrative purposes only
niter &lt;- 5000
nburn &lt;- 2000
nthin &lt;- 3
nout &lt;- (niter-nburn)/nthin

z &lt;- dat$z

## the order here is c(mu0, s20, v, k0, nu0, a0, alpha)
## If simularity is N-NIG then k0 and nu0 are used but v is not
## If simularity is N-N then v is used but no k0 and nu0
simparms &lt;- c(0.0, 1.0, 0.1, 1.0, 1.0, 0.1, 1)

fits &lt;- list()

# fit vgrf only
y &lt;- dat$y

modelPriors &lt;- c(0.5,      # Asig
                 1000^2,   # s2_mu
                 0,        # mb0
                 1000^2,   # s2b0
                 1,        # as2b0
                 1,        # bs2b0
                 1,        # at
                 1.0/0.05) # bt


fit &lt;- curve_ppmx(y=cbind(y), z=z,
             subject=subject_obs_vec,
             Xcon = NULL, Xcat = NULL,
             Xconp=NULL, Xcatp=NULL,
             PPM=TRUE, M=1,
             q=3, rw_order=1, balanced=1,
             nknots=nknots,  npredobs=1,
             Aparm=100,
             modelPriors=modelPriors,
             similarity_function=1,
             consim=1, calibrate=0,
             simParms=simparms,
             mh=c(0.1, 1e-4),
             draws=niter,
             burn=nburn,
             thin=nthin)


Hmat &lt;- fit$Hmat

# For a point estimate of partition, take first MCMC interate
# This is done only for illustrative purposes.  Recommend using
# the salso R package.

p.est &lt;- fit$Si[1,]

nc &lt;- length(unique(p.est))


oldpar &lt;- par(no.readonly = TRUE)


# Plot individual subject fits.

tmp &lt;- c(1,6,11,16)
par(mfrow=c(2,2))
for(j in tmp){
  bmn &lt;- apply(fit$beta[j,,],1,mean)
  b0mn &lt;- mean(fit$beta0[,j])

  ytmp &lt;- y[dat$Name==j]

  b0vec &lt;- rep(b0mn, nobs)

  plot(1:nobs,c(ytmp),
		  type='n',ylab="Response",
		  xlab="Time")

  points(1:nobs,ytmp)
  lines(1:nobs,  b0vec+Hmat%*%bmn, col=p.est[j],lwd=2)

}

# plot all curves in one plot
par(mfrow=c(1,1))

plot(dat$z, dat$y, type="n",ylab="",xlab="Time")

for(j in 1:nsubject){

  bmn &lt;- apply(fit$beta[j,,],1,mean)
  b0mn &lt;- mean(fit$beta0[,j])

  b0vec &lt;- rep(b0mn, nobs)

  lines((1:nobs),  b0vec+Hmat%*%bmn, col=p.est[j],lwd=0.5)

}


par(oldpar)






</code></pre>


</div>