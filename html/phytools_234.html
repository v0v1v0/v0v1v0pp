<div class="container">

<table style="width: 100%;"><tr>
<td>contMap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Map continuous trait evolution on the tree</h2>

<h3>Description</h3>

<p>Projects the observed and reconstructed values of a continuous trait onto the edges of a tree using a color gradient.
</p>


<h3>Usage</h3>

<pre><code class="language-R">contMap(tree, x, res=100, fsize=NULL, ftype=NULL, lwd=4, legend=NULL,
   lims=NULL, outline=TRUE, sig=3, type="phylogram", direction="rightwards", 
   plot=TRUE, ...)
## S3 method for class 'contMap'
plot(x, ...)
errorbar.contMap(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p>object of class <code>"phylo"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a numerical vector of phenotypic trait values for species. <code>names(x)</code> should contain the species names and match <code>tree$tip.label</code>. Or, for <code>plot.contMap</code>, an object of class <code>"contMap"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>resolution for gradient plotting. Larger numbers (to a point) indicate a finer (smoother) gradient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fsize</code></td>
<td>
<p>relative font size - can be a vector of length 2 in which the first element gives the font size for the tip labels &amp; the second element giving the font size for the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ftype</code></td>
<td>
<p>font type - see options in <code>plotSimmap</code>. As with <code>fsize</code>, this can be a vector with the second element giving font type for the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>line width for branches. Can be a single integer number or a vector. In the latter case, the second number will be taken to be the desired legend width.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>if <code>FALSE</code> no legend is plotted; if a numeric value, it gives the length of the legend in units of branch length. Default is 0.5 times the total tree length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lims</code></td>
<td>
<p>range for the color map. By default, this will be <code>c(min(x),max(x))</code>, and should always include this range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outline</code></td>
<td>
<p>logical value indicating whether or not to outline the branches of the tree in black.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig</code></td>
<td>
<p>the number of decimal places to show on the legend limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of plot desired. Options are <code>"phylogram"</code> for a rightward square phylogram; and <code>"fan"</code> for a circular phylogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>plotting direction for <code>type="phylogram"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logical value indicating whether or not to plot the tree. If <code>plot=FALSE</code> then an object of class <code>"contMap"</code> will be returned without plotting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>object of class <code>"contMap"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments for <code>plot.contMap</code> which include all the arguments of <code>contMap</code> except for <code>tree</code>, <code>x</code>, <code>res</code>, and <code>lims</code>. Also <code>method</code>, <code>"fastAnc"</code>, <code>"anc.ML"</code>, or <code>"user"</code> (for user-supplied states) specifying which function to use for ancestral state estimation; <code>hold</code> specifies whether or not to hold output to graphical device before plotting (defaults to <code>hold=TRUE</code>); and <code>anc.states</code> a vector containing some or multiple ancestral user-supplied ancestral states at nodes. Some other plotting arguments, such as <code>xlim</code> and <code>ylim</code>, may also work. Optional arguments for <code>errorbar.contMap</code> include <code>x</code>, a vector containing the original trait values mapped onto the tree (otherwise these will be obtained from <code>obj</code>), <code>scale.by.ci</code>, a logical argument (defaulting to <code>TRUE</code>) that determines whether or not the length of the error bars will be scaled by the CI width, and <code>lwd</code>, which determines the line width of the plotted error bars.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function plots a tree with a mapped continuous character.
</p>
<p>The mapping is accomplished by estimating states at internal nodes using ML with <code>fastAnc</code>, and then interpolating the states along each edge using equation [2] of Felsenstein (1985). This makes these interpolated values equal to the maximum likelihood estimates under a Brownian evolutionary process.
</p>
<p>The default color palette is <em>not</em> recommended as it is not colorblind friendly and does not render well into gray scale; however, this can be updated using the helper function <code>setMap</code>.
</p>
<p><code>errorbar.contMap</code> adds error bars to an existing plot.
</p>


<h3>Value</h3>

<p>Plots a tree. An object of class <code>"contMap"</code> is returned invisibly.
</p>
<p><code>errorbar.contMap</code> adds colorful error bars to a plotted tree.
</p>


<h3>Author(s)</h3>

<p>Liam Revell <a href="mailto:liam.revell@umb.edu">liam.revell@umb.edu</a></p>


<h3>References</h3>

<p>Felsenstein, J. (1985) Phylogenies and the comparative method. <em>American Naturalist</em>, <b>125</b>, 1-15. 
</p>
<p>Revell, L. J. (2013) Two new graphical methods for mapping trait evolution on phylogenies. <em>Methods in Ecology and Evolution</em>, <b>4</b>, 754-759.
</p>
<p>Revell, L. J. (2014) Graphical methods for visualizing comparative data on phylogenies. Chapter 4 in <em>Modern phylogenetic comparative methods and their application in evolutionary biology: Concepts and practice</em> (L. Z. Garamszegi ed.), pp. 77-103.
</p>
<p>Revell, L. J. (2024) phytools 2.0: an updated R ecosystem for phylogenetic comparative methods (and other things). <em>PeerJ</em>, <b>12</b>, e16505.
</p>
<p>Revell, L. J., K. Schliep, E. Valderrama, and J. E. Richardson (2018) Graphs in phylogenetic comparative analysis: Anscombe's quartet revisited. <em>Methods in Ecology and Evolution</em>, <b>9</b>, 2145-2154.
</p>


<h3>See Also</h3>

<p><code>anc.ML</code>, <code>densityMap</code>, <code>fastAnc</code>, <code>plotSimmap</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## load data from Garland et al. (1992)
data(mammal.tree)
data(mammal.data)
## extract character of interest
ln.bodyMass&lt;-log(setNames(mammal.data$bodyMass,
    rownames(mammal.data)))
## create "contMap" object
mammal.contMap&lt;-contMap(mammal.tree,
    ln.bodyMass,plot=FALSE,res=200)
## change color scheme
mammal.contMap&lt;-setMap(mammal.contMap,
    c("white","#FFFFB2","#FECC5C","#FD8D3C",
    "#E31A1C"))
plot(mammal.contMap,fsize=c(0.7,0.8),
    leg.txt="log(body mass)")
par(mar=c(5.1,4.1,4.1,2.1)) ## reset margins to default
</code></pre>


</div>