<div class="container">

<table style="width: 100%;"><tr>
<td>pwexp.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit the Piecewise Exponential Distribution</h2>

<h3>Description</h3>

<p>Fit the piecewise exponential distribution with right censoring data. User can specifity all breakpoints, some of the breakpoints or let the function estimate the breakpoints.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pwexp.fit(time, event, breakpoint=NULL, nbreak=0, exclude_int=NULL, min_pt_tail=5,
        max_set=10000, seed=1818, trace=FALSE, optimizer='mle', tol=1e-4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>observed time from randomization. For right censored data, this is the follow-up time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>the status indicator, normally 0=censor, 1=event. Other choices are TRUE/FALSE (TRUE = event). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breakpoint</code></td>
<td>
<p>fixed breakpoints. Pre-specifity some breakpionts. The maximum value must be earlier than the last event time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbreak</code></td>
<td>
<p>total number of breakpoints in the model. This number includes the points specified in <code>breakpoint</code>. If <code>nbreak=NULL</code>, then <code>nbreak=ceiling(8*(# unique events)^0.2)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_int</code></td>
<td>
<p>an interval that excludes any estimated breakpoints (e.g., <code>exclude_int=c(10,Inf)</code> will exclude any estimated breakpoints after t=10). See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_pt_tail</code></td>
<td>
<p>the minimum number of events used for estimating the tail (the hazard rate of the last piece). See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_set</code></td>
<td>
<p>maximum estimated combination of breakpoints. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>a random seed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>(internal use) logical; if TRUE, the returned data frame contains the log-likelihood of all possible breakpoints instead of the one with maximum likelihood. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optimizer</code></td>
<td>
<p>one of the optimizers: <code>mle</code>, <code>ols</code>, or <code>hybrid</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the minimum allowed gap between two breakpoints. The gap is calculated as <code>(max(time)-min(time))*tol</code>. Keep it as default in most cases. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See webpage <a href="https://zjph602xtc.github.io/PWEXP/">https://zjph602xtc.github.io/PWEXP/</a> for a detailed description of the model and optimizers.
</p>
<p>If user specifies <code>breakpoint</code>, we will check the values to make the model identifiable. Any breakpoints after the last event time will be removed;  Any breakpoints before the first event time will be removed; a mid-point will be used if there are NO events between  any two concesutive breakpoints. A warning will be given.
</p>
<p>If user sets <code>nbreak=NULL</code>, then the function will automatically apply <code>nbreak=ceiling(8*(# unique events)^0.2)</code>. This empirical number of breakpoints is for the reference below, and it may be too large in many cases.
</p>
<p>Argument <code>exclude_int</code> is a vector of two values such as <code>exclude_int=c(a, b)</code> (<code>b</code> can be <code>Inf</code>). It defines an interval that excludes any estimated breakpoints. It is helpful when excluding breakpoints that are too close to the tail.
</p>
<p>In order to obtain a more robust hazard rate estimation of the tail, user can set <code>min_pt_tail</code> to the minimum number of events for estimating the tail (last piece of the piecewise exponential). It only works for <code>optimizer='mle'</code>.
</p>


<h3>Value</h3>

<p>A data frame (<code>res</code>) containing these columns:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>brk1, ..., brkx</code></td>
<td>
<p>estimated breakpoints. The <code>attr(res,'brk')</code> can extract the vector of breakpoint from the model (<code>res</code> is the returned model from <code>pwexp.fit</code>). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lam1, ..., lamx</code></td>
<td>
<p>estimated piecewise hazard rates. The <code>attr(res,'lam')</code> can extract the vector of hazard rates from the model (<code>res</code> is the returned model from <code>pwexp.fit</code>). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>likelihood</code></td>
<td>
<p>the log-likelihood of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC</code></td>
<td>
<p>the Akaike information criterion of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BIC</code></td>
<td>
<p>the Bayesian information criterion of the model.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Tianchen Xu <a href="mailto:zjph602xutianchen@gmail.com">zjph602xutianchen@gmail.com</a>
</p>


<h3>References</h3>

<p>Muller, H. G., &amp; Wang, J. L. (1994). Hazard rate estimation under random censoring with varying kernels and bandwidths. Biometrics, 61-76.
</p>


<h3>See Also</h3>

<p><code>boot.pwexp.fit</code>, <code>cv.pwexp.fit</code></p>


<h3>Examples</h3>

<pre><code class="language-R">event_dist &lt;- function(n)rpwexp(n, rate=c(0.1, 0.01, 0.2), breakpoint=c(5,14))
dat &lt;- simdata(rand_rate = 20, total_sample = 1000, drop_rate = 0.03,
               advanced_dist = list(event_dist=event_dist),
               add_column = c('censor_reason','event','followT','followT_abs'))
cut &lt;- quantile(dat$randT, 0.8)
train &lt;- cut_dat(var_randT = 'randT', cut = cut, data = dat,
                 var_followT = 'followT', var_followT_abs = 'followT_abs',
                 var_event = 'event', var_censor_reason = 'censor_reason')

fit_a0 &lt;- pwexp.fit(train$followT, train$event, breakpoint = c(5,14))
fit_a1 &lt;- pwexp.fit(train$followT, train$event, nbreak = 2, breakpoint = c(14))
fit_b0 &lt;- pwexp.fit(train$followT, train$event, nbreak = 0)
fit_b1 &lt;- pwexp.fit(train$followT, train$event, nbreak = 1)
fit_b2 &lt;- pwexp.fit(train$followT, train$event, nbreak = 2)
</code></pre>


</div>