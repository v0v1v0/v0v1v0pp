<div class="container">

<table style="width: 100%;"><tr>
<td>catefit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of the conditional average treatment effect (CATE) score for count, survival and continuous data</h2>

<h3>Description</h3>

<p>Provides singly robust and doubly robust estimation of CATE score for count, survival and continuous data with
up the following scoring methods among the following: Random forest (survival, continuous only), boosting,
poisson regression (count, survival only), two regressions, contrast regression, negative binomial regression (count only),
linear regression (continuous only), and generalized additive model (continuous only).
</p>


<h3>Usage</h3>

<pre><code class="language-R">catefit(
  response,
  data,
  score.method,
  cate.model,
  ps.model,
  ps.method = "glm",
  init.model = NULL,
  initial.predictor.method = NULL,
  ipcw.model = NULL,
  ipcw.method = "breslow",
  minPS = 0.01,
  maxPS = 0.99,
  followup.time = NULL,
  tau0 = NULL,
  higher.y = TRUE,
  prop.cutoff = seq(0.5, 1, length = 6),
  surv.min = 0.025,
  xvar.smooth.score = NULL,
  xvar.smooth.init = NULL,
  tree.depth = 2,
  n.trees.rf = 1000,
  n.trees.boosting = 200,
  B = 3,
  Kfold = 5,
  error.maxNR = 0.001,
  max.iterNR = 150,
  tune = c(0.5, 2),
  seed = NULL,
  plot.gbmperf = TRUE,
  verbose = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>A string describing the type of outcome in the data. Allowed values include
"count" (see <code>catecvcount()</code>), "survival" (see <code>catecvsurv()</code>) and "continuous" (see <code>catecvmean()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the variables in the outcome, propensity score, and inverse
probability of censoring models (if specified); a data frame with <code>n</code> rows (1 row per observation).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>score.method</code></td>
<td>
<p>A vector of one or multiple methods to estimate the CATE score.
Allowed values are: <code>'boosting'</code>, <code>'twoReg'</code>, <code>'contrastReg'</code>, <code>'poisson'</code> (count and survival outcomes only),
<code>'randomForest'</code> (survival, continuous outcomes only), <code>negBin</code> (count outcomes only), <code>'gam'</code> (continuous outcomes only),
<code>'gaussian'</code> (continuous outcomes only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cate.model</code></td>
<td>
<p>A formula describing the outcome model to be fitted.
The outcome must appear on the left-hand side. For survival outcomes, a <code>Surv</code> object
must be used to describe the outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps.model</code></td>
<td>
<p>A formula describing the propensity score (PS) model to be fitted. The treatment must
appear on the left-hand side. The treatment must be a numeric vector coded as 0/1.
If data are from a randomized controlled trial, specify <code>ps.model = ~1</code> as an intercept-only model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps.method</code></td>
<td>
<p>A character value for the method to estimate the propensity score.
Allowed values include one of:
<code>'glm'</code> for logistic regression with main effects only (default), or
<code>'lasso'</code> for a logistic regression with main effects and LASSO penalization on
two-way interactions (added to the model if interactions are not specified in <code>ps.model</code>).
Relevant only when <code>ps.model</code> has more than one variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.model</code></td>
<td>
<p>A formula describing the initial predictor model. The outcome must appear on the left-hand side.
It must be specified when <code>score.method = contrastReg</code> or <code>twoReg</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.predictor.method</code></td>
<td>
<p>A character vector for the method used to get initial
outcome predictions conditional on the covariates specified in <code>cate.model</code>. Only applies
when <code>score.method</code> includes <code>'twoReg'</code> or <code>'contrastReg'</code>.Allowed values include one of
<code>'randomForest'</code> (survival outcomes only), <code>'boosting'</code>, <code>'logistic'</code>
(survival outcomes only, fast), <code>'poisson'</code> (count outcomes only, fast), <code>'gaussian'</code> (continuous outcomes only) and
<code>'gam'</code> (count and continuous outcomes only). Default is <code>NULL</code>, which assigns <code>'boosting'</code>
for count outcomes and <code>'randomForest'</code> for survival outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ipcw.model</code></td>
<td>
<p>A formula describing the inverse probability of censoring weighting (IPCW)
model to be fitted. The left-hand side must be empty. Only applies for survival outcomes.
Default is <code>NULL</code>, which corresponds to specifying the IPCW with the same covariates
as the outcome model <code>cate.model</code>, plus the treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ipcw.method</code></td>
<td>
<p>A character value for the censoring model. Only applies for survival
outcomes. Allowed values are: <code>'breslow'</code> (Cox regression with Breslow estimator of t
he baseline survivor function), <code>'aft (exponential)'</code>, <code>'aft (weibull)'</code>,
<code>'aft (lognormal)'</code> or <code>'aft (loglogistic)'</code> (accelerated failure time model
with different distributions for y variable). Default is <code>'breslow'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minPS</code></td>
<td>
<p>A numerical value (in '[0, 1]') below which estimated propensity scores should be
truncated. Default is <code>0.01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxPS</code></td>
<td>
<p>A numerical value (in '(0, 1]') above which estimated propensity scores should be
truncated. Must be strictly greater than <code>minPS</code>. Default is <code>0.99</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup.time</code></td>
<td>
<p>A column name in <code>data</code> specifying the maximum follow-up time,
interpreted as the potential censoring time. Only applies for survival outcomes.
Default is <code>NULL</code>, which corresponds to unknown potential censoring time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau0</code></td>
<td>
<p>The truncation time for defining restricted mean time lost. Only applies for
survival outcomes. Default is <code>NULL</code>, which corresponds to setting the truncation time as the
maximum survival time in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>higher.y</code></td>
<td>
<p>A logical value indicating whether higher (<code>TRUE</code>) or
lower (<code>FALSE</code>) values of the outcome are more desirable. Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop.cutoff</code></td>
<td>
<p>A vector of numerical values (in '(0, 1]') specifying percentiles of the
estimated log CATE scores to define nested subgroups. Each element represents the cutoff to
separate observations in nested subgroups (below vs above cutoff).
The length of <code>prop.cutoff</code> is the number of nested subgroups.
An equally-spaced sequence of proportions ending with 1 is recommended.
Default is <code>seq(0.5, 1, length = 6)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.min</code></td>
<td>
<p>Lower truncation limit for the probability of being censored.
It must be a positive value and should be chosen close to 0. Only applies for survival
outcomes. Default is <code>0.025</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xvar.smooth.score</code></td>
<td>
<p>A vector of characters indicating the name of the variables used as
the smooth terms if <code>score.method = 'gam'</code>. The variables must be selected
from the variables listed in <code>cate.model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xvar.smooth.init</code></td>
<td>
<p>A vector of characters indicating the name of the variables used as
the smooth terms if <code>initial.predictor.method = 'gam'</code>. The variables must be selected
from the variables listed in <code>init.model</code>.
Default is <code>NULL</code>, which uses all variables in <code>init.model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree.depth</code></td>
<td>
<p>A positive integer specifying the depth of individual trees in boosting
(usually 2-3). Used only if <code>score.method = 'boosting'</code> or
if <code>initial.predictor.method = 'boosting'</code> with <code>score.method = 'twoReg'</code> or
<code>'contrastReg'</code>. Default is 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.trees.rf</code></td>
<td>
<p>A positive integer specifying the maximum number of trees in random forest.
Used if <code>score.method = 'ranfomForest'</code> or if <code>initial.predictor.method = 'randomForest'</code>
with <code>score.method = 'twoReg'</code> or <code>'contrastReg'</code>. Only applies for survival outcomes.
Default is <code>1000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.trees.boosting</code></td>
<td>
<p>A positive integer specifying the maximum number of trees in boosting
(usually 100-1000). Used if <code>score.method = 'boosting'</code> or
if <code>initial.predictor.method = 'boosting'</code> with <code>score.method = 'twoReg'</code> or
<code>'contrastReg'</code>. Default is <code>200</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>A positive integer specifying the number of time cross-fitting is repeated in
<code>score.method = 'twoReg'</code> and <code>'contrastReg'</code>. Default is <code>3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Kfold</code></td>
<td>
<p>A positive integer specifying the number of folds used in cross-fitting
to partition the data in <code>score.method = 'twoReg'</code> and <code>'contrastReg'</code>.
Default is <code>5</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error.maxNR</code></td>
<td>
<p>A numerical value &gt; 0 indicating the minimum value of the mean absolute
error in Newton Raphson algorithm. Used only if <code>score.method = 'contrastReg'</code>.
Default is <code>0.001</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.iterNR</code></td>
<td>
<p>A positive integer indicating the maximum number of iterations in the
Newton Raphson algorithm. Used only if <code>score.method = 'contrastReg'</code>.
Default is <code>150</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tune</code></td>
<td>
<p>A vector of 2 numerical values &gt; 0 specifying tuning parameters for the
Newton Raphson algorithm. <code>tune[1]</code> is the step size, <code>tune[2]</code> specifies a
quantity to be added to diagonal of the slope matrix to prevent singularity.
Used only if <code>score.method = 'contrastReg'</code>. Default is <code>c(0.5, 2)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>An optional integer specifying an initial randomization seed for reproducibility.
Default is <code>NULL</code>, corresponding to no seed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.gbmperf</code></td>
<td>
<p>A logical value indicating whether to plot the performance measures in
boosting. Used only if <code>score.method = 'boosting'</code> or if <code>score.method = 'twoReg'</code>
or <code>'contrastReg'</code> and <code>initial.predictor.method = 'boosting'</code>. Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>An integer value indicating whether intermediate progress messages and histograms should
be printed. <code>1</code> indicates messages are printed and <code>0</code> otherwise. Default is <code>0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments for <code>gbm()</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For count response, see details in <code>catefitcount()</code>.
For survival response, see details in <code>catefitsurv()</code>.
</p>


<h3>Value</h3>

<p>For count response, see description of outputs in <code>catefitcount()</code>.
For survival response, see description of outputs in <code>catefitsurv()</code>.
</p>


<h3>References</h3>

<p>Yadlowsky, S., Pellegrini, F., Lionetto, F., Braune, S., &amp; Tian, L. (2020).
<em>Estimation and validation of ratio-based conditional average treatment effects using
observational data. Journal of the American Statistical Association, 1-18.</em> DOI: 10.1080/01621459.2020.1772080.
</p>


<h3>See Also</h3>

<p><code>catecv()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Count outcome
fit_1 &lt;- catefit(response = "count",
                 data = countExample,
                 score.method = "poisson",
                 cate.model = y ~ age + female + previous_treatment +
                                  previous_cost + previous_number_relapses +
                                  offset(log(years)),
                 ps.model = trt ~ age + previous_treatment,
                 higher.y = TRUE,
                 seed = 999)

coef(fit_1)


# Survival outcome
library(survival)
tau0 &lt;- with(survivalExample,
                 min(quantile(y[trt == "drug1"], 0.95), quantile(y[trt == "drug0"], 0.95)))

fit_2 &lt;- catefit(response = "survival",
                 data = survivalExample,
                 score.method = c("poisson", "boosting", "randomForest"),
                 cate.model = Surv(y, d) ~ age + female + previous_cost +
                                           previous_number_relapses,
                 ps.model = trt ~ age + previous_treatment,
                 initial.predictor.method = "logistic",
                 ipcw.model = ~ age + previous_cost + previous_treatment,
                 tau0 = tau0, higher.y = TRUE, seed = 999, n.cores = 1)

coef(fit_2)


</code></pre>


</div>