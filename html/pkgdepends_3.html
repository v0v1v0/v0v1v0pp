<div class="container">

<table style="width: 100%;"><tr>
<td>config</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Package configuration (internals)</h2>

<h3>Description</h3>

<p>Internal machinery for pkgdepends configuration. See <code>current_config()</code>
for how this machinery can be used to define the configuration of a
package.
</p>
<p>This is a standalone file that can be copied into another package without
changes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">config
</code></pre>


<h3>Format</h3>

<p><code>config</code> is a list of functions with a closure. You can use it two ways.
</p>
<p>For <em>one</em> set of configuration values in a package, include this in
<code>.onLoad()</code>:
</p>
<div class="sourceCode r"><pre>conf &lt;- config$new("prefix")
conf$add("myenrry", "string", "default-value")
...
conf$lock()
</pre></div>
<p>For _multiple _ sets of configuration values (e.g. one per object),
include a function like this in the package:
</p>
<div class="sourceCode r"><pre>current_config &lt;- function() {
  conf &lt;- config$new("prefix")
  conf$add("myentry", "string", "default-value")
  ...
  conf$lock()
  conf
}
</pre></div>
<p>and then call <code>current_config()</code> every time you need to create a
new set of configuration values.
</p>


<h3>Terminology</h3>



<h4>Config entry (or entry)</h4>

<p>A single configurable entity. A config entry has a name. This name is
always standardized by replacing dashes with underscores.
</p>
<p>A config entry has a type: a string, a flag, or some
user defined type. It can also have a default value. Examples:
</p>

<ul>
<li>
<p> The URL of an API, which can be a string.
</p>
</li>
<li>
<p> Path to a directory to use for caching, either a string, or NULL
(<code>string_or_null</code> type).
</p>
</li>
<li>
<p> Number of processor cores to use, a positive integer (<code>count</code> type).
</p>
</li>
</ul>
<h4>Configuration (or config)</h4>

<p>A set of configuration entries. <code>config$new()</code> returns a configuration.
A configuration can be extended by adding new entries to it, until it
is locked.
</p>



<h4>R option (or option)</h4>

<p>An option set with <code>base::options()</code> and queried with <code>base::getOption()</code>.
</p>



<h4>Configuration prefix</h4>

<p>A prefix that is typically package specific, and it is used for all
config entries of a package, to avoid environment variable and option
name clashes between packages.
</p>



<h4>Config entry type</h4>

<p>It defines the allowed values of configuration entries, and also how
a string from an environment variable is translated to the value of
the entry. See the list of builtin types below. You can also define new
types.
</p>



<h3>Built-in types</h3>



<h4><code>string</code></h4>

<p>String scalar, <code>NA</code> is not allowed.
</p>



<h4><code>count</code></h4>

<p>Non-negative integer, <code>NA</code> is not allowed.
</p>



<h4><code>flag</code></h4>

<p>Logical scalar, <code>NA</code> is not allowed. For environment variables the
<code>TRUE</code> values are: <code>yes</code>, <code>true</code>, <code>1</code> and <code>on</code>, and the <code>FALSE</code> values
are: <code>no</code>, <code>false</code>, <code>0</code>, <code>off</code>. (All are case insensitive.)
</p>



<h4><code>string_or_null</code></h4>

<p>String or <code>NULL</code>. <code>NA</code> is not allowed. In environment variables the
string <code>NULL</code> means an R <code>NULL</code> value.
</p>



<h4><code>character</code></h4>

<p>Character vector without <code>NA</code> values. In environment variables the
entries are separated by a semicolon.
</p>



<h4><code>custom</code></h4>

<p>Custom type. An <code>env_decode</code> function must be specified for each config
entry of this type, otherwise an error is throw if the corresponding
environment variable is set.
</p>



<h3>
<code>config$onload_hook()</code>: pretty-printing configuration</h3>

<p>Call <code>config$onload_hook()</code> from the package's <code>.onLoad()</code> function
if you want to define S3 methods to print the package configuration
nicer.
</p>


<h4>Usage</h4>

<div class="sourceCode"><pre>config$onload_hook()
</pre></div>



<h3>
<code>config$new()</code>: Create a new configuration</h3>

<p>Typically <code>new()</code> is called outside of the functions of the
package, so the <code>config</code> object is created at install time.
</p>


<h4>Usage</h4>

<div class="sourceCode"><pre>conf &lt;- config$new(prefix = utils::packageName(parent.frame()))
</pre></div>



<h4>Arguments</h4>


<ul><li> <p><code>prefix</code>: prefix of the config entry names. For environment
variables it is converted to uppercase, and dots are converted
to underscores. The default prefix is the name of the calling package.
An underscore separator is used between the prefix and the entry
name for environment variable names. A dot separator is used for
R option names.
</p>
</li></ul>
<h4>Value</h4>

<p><code>new()</code> returns a <code>config</code> object, which is a list containing
the configuration data and functions (methods) to query and change it.
</p>
<div class="sourceCode r"><pre>conf &lt;- config$new()
</pre></div>



<h3>Configuration methods</h3>



<h4>
<code>conf$add()</code>: add a new configuration entry</h4>



<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$add(
  name,
  type = conf$types,
  default = NULL,
  check = type[1],
  env_decode = type[1]
)
</pre></div>



<h5>Arguments</h5>


<ul>
<li> <p><code>name</code>: name of the entry.
</p>
</li>
<li> <p><code>type</code>: type of the entry, string.
</p>
</li>
<li> <p><code>default</code>: default value of config entry. If this is a function,
then it is called to generate the default, at the time the
config entry's value is queried.
</p>
</li>
<li> <p><code>check</code>: if it is a function, it is called to check the value of
the entry. The function should return <code>TRUE</code> for successful and
<code>FALSE</code> for unsuccessful checks. If <code>NULL</code>, then no check is
performed. It can also be the name of a type, then the default
check for that type is performed, if any.
</p>
</li>
<li> <p><code>env_decode</code>: if it is a function, then it is used to decode the
value of the entry from an environment variable, i.e. a string.
It can also be the name of a type, then the <code>env_decode()</code>
function of that type is used for decoding.
</p>
</li>
</ul>
<h5>Value</h5>

<p>The configuration, invisibly.
</p>




<h4>
<code>conf$get()</code>: query the value of a configuration entry</h4>



<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$get(name)
</pre></div>



<h5>Arguments</h5>


<ul><li> <p><code>name</code>: name of the entry.
</p>
</li></ul>
<h5>Value</h5>

<p>Value of the entry.
</p>

<ul>
<li>
<p> If the entry was set via <code>conf$set()</code> or <code>conf$update()</code>, then
that value is returned.
</p>
</li>
<li>
<p> Otherwise, if the entry is set via an R option (see
<code>base::getOption()</code>), then that value is returned. The config
prefix is used to get the option name, with a dot separator.
I.e. for an entry called 'foo', and prefix 'pkg', the <code>pkg.foo</code>
option is used. If the entry has a check function, that is called
before returning.
</p>
</li>
<li>
<p> Otherwise, if the entry is set via an environment variable, then
that value is returned. The config prefix is used to get the name
of the environment variable. In addition, dots are replaced with
underscores and the name is converted to uppercase. I.e. for an
entry called 'foo.bar', and prefix 'pkg', the 'PKG_FOO_BAR'
environment variable is used.
</p>
</li>
<li>
<p> Otherwise, if the entry has a default value, that is returned.
The default value might be a function, in which case that function
is called to produce a default value. If the entry has a check
function, that is called before returning.
</p>
</li>
</ul>
<h4>
<code>conf$set()</code>: set the value of a configuration entry</h4>

<p>If you <code style="white-space: pre;">⁠$set()⁠</code> a config entry, then the <code>value</code> used in <code style="white-space: pre;">⁠$set()⁠</code>
will be returned by <code style="white-space: pre;">⁠$get()⁠</code>, without consulting R options or
environment variables.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$set(name, value)
</pre></div>



<h5>Arguments</h5>


<ul>
<li> <p><code>name</code>: name of the entry.
</p>
</li>
<li> <p><code>value</code>: value of the entry. If the entry has a check function,
it is called here.
</p>
</li>
</ul>
<h5>Value</h5>

<p>The configuration, invisibly.
</p>




<h4>
<code style="white-space: pre;">⁠$conf$unset()⁠</code>: unset a configuration entry</h4>

<p>Note that this function does <em>not</em> unset R options and environment
variables. It merely removes a value that was assigned by <code style="white-space: pre;">⁠$set()⁠</code>
or <code style="white-space: pre;">⁠$update()⁠</code>.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$unset(name)
</pre></div>



<h5>Arguments</h5>


<ul><li> <p><code>name</code>: name of the entry.
</p>
</li></ul>
<h5>Value</h5>

<p>The configuration, invisibly.
</p>




<h4>
<code>cond$update()</code>: update the values of configuration entries</h4>

<p>You can use this method to set()<code>and/or</code>$unset()<code style="white-space: pre;">⁠multiple config entries.⁠</code>NULL<code style="white-space: pre;">⁠values in⁠</code>new' will unset the corresponding entry.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$update(new)
</pre></div>



<h5>Arguments</h5>


<ul><li> <p><code>new</code>: named list, where names are config entry names and values
are the corresponding config entry values. <code>NULL</code> values will
unset the config entry. The list is processed sequentially, so
for duplicates the latest values will be in effect. (But every
value is checked with its check function, if any.)
</p>
</li></ul>
<h5>Value</h5>

<p>The configuration, invisibly.
</p>




<h4>
<code>conf$list()</code>: query the names of all config entries</h4>

<p>Note that their order is non-deterministic currently.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$list()
</pre></div>



<h5>Value</h5>

<p>Character vector.
</p>




<h4>
<code>conf$exists()</code>: check if a config entry exists</h4>



<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$exists(name)
</pre></div>



<h5>Arguments</h5>


<ul><li> <p><code>name</code>: name of the entry.
</p>
</li></ul>
<h5>Value</h5>

<p>Logical scalar, <code>TRUE</code> if the entry exists in the configuration,
<code>FALSE</code> otherwise. Note that <code>TRUE</code> does not mean that the value
of the entry was set.
</p>




<h4>
<code>conf$lock()</code>: lock the configuration</h4>

<p>If a configuration is locked, then no more entries can be added to
it.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$lock()
</pre></div>



<h5>Value</h5>

<p>The configuration, invisibly.
</p>




<h4>
<code>conf$fix()</code>: fix the value of a single configuration entry</h4>

<p>The currently <code style="white-space: pre;">⁠$set()⁠</code> value is fixed and cannot be changed any
more. You can fix an entry without setting its value, in which case
R options and environment variables can still be used to update it.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$unset(name)
</pre></div>



<h5>Arguments</h5>


<ul><li> <p><code>name</code>: name of the entry.
</p>
</li></ul>
<h5>Value</h5>

<p>The configuration, invisibly.
</p>




<h4>
<code>conf$add_type()</code>: add a new config entry type to a configuration</h4>

<p>After this the new type can be used in <code>conf$add()</code> calls.
</p>


<h5>Usage</h5>

<div class="sourceCode r"><pre>conf$add_type(type_name, check, env_decode)
</pre></div>



<h5>Arguments</h5>


<ul>
<li> <p><code>type_name</code>: type name.
</p>
</li>
<li> <p><code>check</code>: default check function of the type. Use <code>NULL</code> for no
checks.
</p>
</li>
<li> <p><code>env_decode</code>: function to use to decode a value of the type from
an environment variable (i.e. string).
</p>
</li>
</ul>
<h5>Value</h5>

<p>The configuration, invisibly.
</p>




</div>