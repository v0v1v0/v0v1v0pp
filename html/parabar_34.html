<div class="container">

<table style="width: 100%;"><tr>
<td>TaskState</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>TaskState</h2>

<h3>Description</h3>

<p>This class holds the state of a task deployed to an asynchronous backend
(i.e., <code>AsyncBackend</code>). See the <strong>Details</strong> section for more
information.
</p>


<h3>Details</h3>

<p>The task state is useful to check if an asynchronous backend is free to
execute other operations. A task can only be in one of the following three
states at a time:
</p>

<ul>
<li> <p><code>task_not_started</code>: When <code>TRUE</code>, it indicates whether the backend is free
to execute another operation.
</p>
</li>
<li> <p><code>task_is_running</code>: When <code>TRUE</code>, it indicates that there is a task running
on the backend.
</p>
</li>
<li> <p><code>task_is_completed</code>: When <code>TRUE</code>, it indicates that the task has been
completed, but the backend is still busy because the task output has not
been retrieved.
</p>
</li>
</ul>
<p>The task state is determined based on the state of the background
<code>session</code> (i.e., see the <code>get_state</code> method for
<code>callr::r_session</code>) and the state of the task execution inferred from
polling the process (i.e., see the <code>poll_process</code> method for
<code>callr::r_session</code>) as follows:</p>

<table>
<tr>
<td style="text-align: center;">
   Session State </td>
<td style="text-align: center;"> Execution State </td>
<td style="text-align: center;"> Not Started </td>
<td style="text-align: center;"> Is Running </td>
<td style="text-align: center;"> Is Completed </td>
</tr>
<tr>
<td style="text-align: center;">
   <code>idle</code> </td>
<td style="text-align: center;"> <code>timeout</code> </td>
<td style="text-align: center;"> <code>TRUE</code> </td>
<td style="text-align: center;"> <code>FALSE</code> </td>
<td style="text-align: center;"> <code>FALSE</code> </td>
</tr>
<tr>
<td style="text-align: center;">
   <code>busy</code> </td>
<td style="text-align: center;"> <code>timeout</code> </td>
<td style="text-align: center;"> <code>FALSE</code> </td>
<td style="text-align: center;"> <code>TRUE</code> </td>
<td style="text-align: center;"> <code>FALSE</code> </td>
</tr>
<tr>
<td style="text-align: center;">
   <code>busy</code> </td>
<td style="text-align: center;"> <code>ready</code> </td>
<td style="text-align: center;"> <code>FALSE</code> </td>
<td style="text-align: center;"> <code>FALSE</code> </td>
<td style="text-align: center;"> <code>TRUE</code> </td>
</tr>
<tr>
<td style="text-align: center;">
</td>
</tr>
</table>
<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>task_not_started</code></dt>
<dd>
<p>A logical value indicating whether the task
has been started. It is used to determine if the backend is free to
execute another operation.</p>
</dd>
<dt><code>task_is_running</code></dt>
<dd>
<p>A logical value indicating whether the task is
running.</p>
</dd>
<dt><code>task_is_completed</code></dt>
<dd>
<p>A logical value indicating whether the task
has been completed and the output needs to be retrieved.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-TaskState-new"><code>TaskState$new()</code></a>
</p>
</li>
<li> <p><a href="#method-TaskState-clone"><code>TaskState$clone()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-TaskState-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new <code>TaskState</code> object and determine the state of
a task on a given session.
</p>


<h5>Usage</h5>

<div class="r"><pre>TaskState$new(session)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>session</code></dt>
<dd>
<p>A <code>callr::r_session</code> object.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>An object of class <code>TaskState</code>.
</p>


<hr>
<a id="method-TaskState-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>TaskState$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>See Also</h3>

<p><code>AsyncBackend</code> and <code>ProgressTrackingContext</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Handy function to print the task states all at once.
check_state &lt;- function(session) {
    # Create a task state object and determine the state.
    task_state &lt;- TaskState$new(session)

    # Print the state.
    cat(
        "Task not started: ", task_state$task_not_started, "\n",
        "Task is running: ", task_state$task_is_running, "\n",
        "Task is completed: ", task_state$task_is_completed, "\n",
        sep = ""
    )
}

# Create a specification object.
specification &lt;- Specification$new()

# Set the number of cores.
specification$set_cores(cores = 2)

# Set the cluster type.
specification$set_type(type = "psock")

# Create an asynchronous backend object.
backend &lt;- AsyncBackend$new()

# Start the cluster on the backend.
backend$start(specification)

# Check that the task has not been started (i.e., the backend is free).
check_state(backend$cluster)

{
    # Run a task in parallel (i.e., approx. 0.25 seconds).
    backend$sapply(
        x = 1:10,
        fun = function(x) {
            # Sleep a bit.
            Sys.sleep(0.05)

            # Compute something.
            output &lt;- x + 1

            # Return the result.
            return(output)
        }
    )

    # And immediately check the state to see that the task is running.
    check_state(backend$cluster)
}

# Sleep for a bit to wait for the task to complete.
Sys.sleep(1)

# Check that the task is completed (i.e., the output needs to be retrieved).
check_state(backend$cluster)

# Get the output.
output &lt;- backend$get_output(wait = TRUE)

# Check that the task has not been started (i.e., the backend is free again).
check_state(backend$cluster)

# Stop the backend.
backend$stop()

</code></pre>


</div>