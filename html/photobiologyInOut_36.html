<div class="container">

<table style="width: 100%;"><tr>
<td>read_cid_spectravue_csv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Read File Saved by CID's SpectraVue.</h2>

<h3>Description</h3>

<p>Read wavelength and spectral data from Measurements.CSV files exported from
CID Bio-Sciences' <strong>SpectraVue CI-710s</strong> (not the older CI-710!) leaf
spectrometer, importing them into R. Available metadata is also extracted
from the file. <code>read_cid_spectravue_csv()</code> only accepts "row oriented"
CSV files. These may contain multiple spectra, one per row.
</p>


<h3>Usage</h3>

<pre><code class="language-R">read_cid_spectravue_csv(
  file,
  date = NULL,
  geocode = NULL,
  label = NULL,
  tz = NULL,
  locale = readr::default_locale(),
  range = c(380, 1100),
  simplify = TRUE,
  absorbance.to = "object",
  strict.range = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>character</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date</code></td>
<td>
<p>a <code>POSIXct</code> object to use to set the <code>"when.measured"</code>
attribute. If <code>NULL</code>, the default, the date and time are extracted
from the file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geocode</code></td>
<td>
<p>A data frame with columns <code>lon</code> and <code>lat</code> used to
set attribute <code>"where.measured"</code>. If <code>NULL</code>, the default, the
geocode is extracted from the file, if present, and if <code>NA</code> the
"where.measured" attribute is not set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>character string. If <code>NULL</code>, the default, the value of the
"tag" present in the file is used, and if <code>NA</code> the "what.measured"
attribute is not set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tz</code></td>
<td>
<p>character Time zone is by default that of the machine's locale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locale</code></td>
<td>
<p>The locale controls defaults that vary from place to place. The
default locale is US-centric (like R), but you can use
<code>locale</code> to create your own locale that controls things
like the default time zone, encoding, decimal mark, big mark, and day/month
names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range</code></td>
<td>
<p>numeric A vector of length two, or any other object for which
function <code>range()</code> will return range of wavelengths expressed in
nanometres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simplify</code></td>
<td>
<p>logical If TRUE, single spectra are returned as individual
spectra instead of collections of length one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>absorbance.to</code></td>
<td>
<p>character Affects only absorbance measurements:
<code>"object"</code>, <code>"all"</code> or <code>"A"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strict.range</code></td>
<td>
<p>logical Flag indicating whether off-range values result
in an error (<code>TRUE</code>) instead of a warning (<code>FALSE</code>), or the test
is disabled (<code>NA</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to the constructor of the
'filter_spct' object.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SpectraVue's row-wise spectral <code>Measurements.CSV</code> files contain
columns with metadata on the right edge, followed by columns with data for
each of the 2048 pixels or wavelengths. The value in column "Mode"
indicates the quantity measured, decoded into variables <code>Tpc</code>,
<code>Rpc</code> or <code>A</code>. The data the rows in the CSV file are read and
stored in <code>filter_spct</code>,  <code>reflector_spct</code> or <code>object_spct</code>
objects. These objects are collected into a single <code>filter_mspct</code>,
<code>reflector_mspct</code>, <code>object_mspct</code> or <code>generic_spct</code> object
and returned.
</p>
<p>Spectral data outside the range 400 nm to 1000 nm are very noisy and thus
outside the valid range for the measurements. Out-of-range spectral data
can also be cause by calibration drift. Consequently, reading of data is
done always with the range check disabled, while whether a check is used
before returning the collection of spectra depends on the argument passed
to <code>strict.range</code> which by default is set to disable checks. This is
done, because in most cases measurements from this instrument tend to
require further processing before they comply with theoretical expectations
of <code class="reqn">Tfr + Rfr + Afr = 1</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>filter_spct</code>, <code>relector_spct</code>,
<code>object_spct</code> or <code>generic_mspct</code>.
</p>


<h3>Internal <em>vs.</em> total transmittance and absorbance</h3>

<p>Spectravue
returns transmittance values labelled with <code>Transmittance</code> as
<code>Mode</code>. Transmittance values are not <em>total</em> as most of the
scattered light transmitted is not detected. Absorbance (<code>Abs</code>) values
returned labelled with <code>Absorbance</code> as <code>Mode</code> are for absorbance
computed from the Transmittance. This estimate of absorbance overestimates
real absorbance in the case of scattering materials like plant leaves. It
is best to save spectral data acquired as absorbance into objects of class
'object_spct' containing reflectance and transmittance, the default, as
this preserves all the acquired data.
</p>


<h3>Specular <em>vs.</em> total reflectance</h3>

<p>This function assumes that
SpectraVue returns close to <em>total</em> reflectance readings. Given the optics
of the instrument this is likely only an approximation.
</p>


<h3>Warning!!</h3>

<p>CID's support has answered on 2022-05-19 that the extremely biased (plainly
wrong!) values of transmittance measured by this instrument are due to a
design flaw and that they are working on a solution for the problem. In
practice, reflectance seems biased but usable as an instrument-specific
quantity with arbitrary units. Transmittance and absorbance seem useless as
values are wrong by about an order of magnitude.
</p>


<h3>Note</h3>

<p>SpectraVue creates three or four <code>.CSV</code> files for each series of
measurements saved. Of these files, this function reads the one with name
ending in <code>Measurements.CSV</code>. The first part of the file name gives
the time of the session, but as the files can contain multiple spectra
measured at different times, the time metadata is extracted separately for
each spectrum. We provide a default argument for <code>range</code> that discards
data for short and long wavelengths because values outside this range are
according to the instrument's manual outside the usable range and in
practice extremely noisy.
</p>


<h3>References</h3>

<p><em>https://cid-inc.com/</em>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# read file containing a single reflectaance spectrum

 file.name &lt;-
   system.file("extdata", "cid-spectravue-Rpc-Measurements.csv",
               package = "photobiologyInOut", mustWork = TRUE)

 cid_filter.spct &lt;-
   read_cid_spectravue_csv(file = file.name)
 summary(cid_filter.spct)

 cid_filter.spct &lt;-
   read_cid_spectravue_csv(file = file.name, simplify = FALSE)
 summary(cid_filter.spct)

 # read data measured as absorbance (A, Rpc and Tpc)

 file.name &lt;-
   system.file("extdata", "cid-spectravue-Abs-Measurements.csv",
               package = "photobiologyInOut", mustWork = TRUE)
 cid.object_spct &lt;-
   read_cid_spectravue_csv(file = file.name)
 summary(cid.object_spct)

 cid_A.filter_spct &lt;-
   read_cid_spectravue_csv(file = file.name, absorbance.to = "A")
 summary(cid_A.filter_spct)

</code></pre>


</div>