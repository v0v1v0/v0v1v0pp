<div class="container">

<table style="width: 100%;"><tr>
<td>projectKNNs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Project a distance matrix into a lower-dimensional space. (from elbamos/largeVis)</h2>

<h3>Description</h3>

<p>Takes as input a sparse matrix of the edge weights connecting each node to its nearest neighbors, and outputs
a matrix of coordinates embedding the inputs in a lower-dimensional space.
</p>


<h3>Usage</h3>

<pre><code class="language-R">projectKNNs(
  wij,
  dim = 2,
  sgd_batches = NULL,
  M = 5,
  gamma = 7,
  alpha = 1,
  rho = 1,
  coords = NULL,
  useDegree = FALSE,
  momentum = NULL,
  seed = NULL,
  threads = NULL,
  verbose = getOption("verbose", TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>wij</code></td>
<td>
<p>A symmetric sparse matrix of edge weights, in C-compressed format, as created with the <code>Matrix</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dim</code></td>
<td>
<p>numeric The number of dimensions for the projection space (default=2)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sgd_batches</code></td>
<td>
<p>numeric The number of edges to process during SGD (default=NULL). Defaults to a value set based on the size of the dataset. If the parameter given is
between <code>0</code> and <code>1</code>, the default value will be multiplied by the parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>numeric (largeVis) The number of negative edges to sample for each positive edge (default=5).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>numeric (largeVis) The strength of the force pushing non-neighbor nodes apart (default=7).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>numeric (largeVis) The hyperparameter in the distance function (default=1). The default distance function, <code class="reqn">1 / (1 + \alpha \dot ||y_i - y_j||^2)</code>.
The function relates the distance between points in the low-dimensional projection to the likelihood that the two points are nearest neighbors. Increasing <code class="reqn">\alpha</code> tends
to push nodes and their neighbors closer together; decreasing <code class="reqn">\alpha</code> produces a broader distribution. Setting <code class="reqn">\alpha</code> to zero
enables the alternative distance function. <code class="reqn">\alpha</code> below zero is meaningless.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>(largeVis) numeric Initial learning rate (default=1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>An initialized coordinate matrix (default=NULL)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useDegree</code></td>
<td>
<p>boolean Whether to use vertex degree to determine weights in negative sampling (if TRUE) or the sum of the vertex's edges (if FALSE) (default=FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>momentum</code></td>
<td>
<p>If not NULL, SGD with momentum is used, with this multiplier, which must be between 0 and 1 (default=NULL). Note that
momentum can drastically speed-up training time, at the cost of additional memory consumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>numeric Random seed to be passed to the C++ functions (default=NULL). Sampled from hardware entropy pool if <code>NULL</code> (the default).
Note that if the seed is not <code>NULL</code> (the default), the maximum number of threads will be set to 1 in phases of the algorithm
that would otherwise be non-deterministic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threads</code></td>
<td>
<p>numeric The maximum number of threads to spawn (default=NULL). Determined automatically if <code>NULL</code> (the default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>boolean Verbosity (default=getOption("verbose", TRUE))</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The algorithm attempts to estimate a <code>dim</code>-dimensional embedding using stochastic gradient descent and
negative sampling.
</p>
<p>The objective function is: </p>
<p style="text-align: center;"><code class="reqn"> O = \sum_{(i,j)\in E} w_{ij} (\log f(||p(e_{ij} = 1||) + \sum_{k=1}^{M} E_{jk~P_{n}(j)} \gamma \log(1 - f(||p(e_{ij_k} - 1||)))</code>
</p>

<p>where <code class="reqn">f()</code> is a probabilistic function relating the distance between two points in the low-dimensional projection space,
and the probability that they are nearest neighbors.
</p>
<p>The default probabilistic function is <code class="reqn">1 / (1 + \alpha \dot ||x||^2)</code>. If <code class="reqn">\alpha</code> is set to zero,
an alternative probabilistic function, <code class="reqn">1 / (1 + \exp(x^2))</code> will be used instead.
</p>
<p>Note that the input matrix should be symmetric.  If any columns in the matrix are empty, the function will fail.
</p>


<h3>Value</h3>

<p>A dense [N,D] matrix of the coordinates projecting the w_ij matrix into the lower-dimensional space.
</p>


<h3>Note</h3>

<p>If specified, <code>seed</code> is passed to the C++ and used to initialize the random number generator. This will not, however, be
sufficient to ensure reproducible results, because the initial coordinate matrix is generated using the <code>R</code> random number generator.
To ensure reproducibility, call <code>set.seed</code> before calling this function, or pass it a pre-allocated coordinate matrix.
</p>
<p>The original paper called for weights in negative sampling to be calculated according to the degree of each vertex, the number of edges
connecting to the vertex. The reference implementation, however, uses the sum of the weights of the edges to each vertex. In experiments, the
difference was imperceptible with small (MNIST-size) datasets, but the results seems aesthetically preferrable using degree. The default
is to use the edge weights, consistent with the reference implementation.
</p>


</div>