<div class="container">

<table style="width: 100%;"><tr>
<td>pred_validate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Validate an existing prediction</h2>

<h3>Description</h3>

<p>Validate an existing prediction model, to calculate the predictive
performance against a new (validation) dataset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pred_validate(
  x,
  new_data,
  binary_outcome = NULL,
  survival_time = NULL,
  event_indicator = NULL,
  time_horizon = NULL,
  level = 0.95,
  cal_plot = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class "<code>predinfo</code>" produced by calling
<code>pred_input_info</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_data</code></td>
<td>
<p>data.frame upon which the prediction model should be
evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binary_outcome</code></td>
<td>
<p>Character variable giving the name of the column in
<code>new_data</code> that represents the observed binary outcomes (should be
coded 0 and 1 for non-event and event, respectively). Only relevant for
<code>model_type</code>="logistic"; leave as <code>NULL</code> otherwise. Leave as
<code>NULL</code> if <code>new_data</code> does not contain any outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>survival_time</code></td>
<td>
<p>Character variable giving the name of the column in
<code>new_data</code> that represents the observed survival times. Only relevant
for <code>x$model_type</code>="survival"; leave as <code>NULL</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event_indicator</code></td>
<td>
<p>Character variable giving the name of the column in
<code>new_data</code> that represents the observed survival indicator (1 for
event, 0 for censoring). Only relevant for <code>x$model_type</code>="survival";
leave as <code>NULL</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_horizon</code></td>
<td>
<p>for survival models, an integer giving the time horizon
(post baseline) at which a prediction is required. Currently, this must
match a time in x$cum_hazard.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>the confidence level required for all performance metrics.
Defaults at 95%. Must be a value between 0 and 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cal_plot</code></td>
<td>
<p>indicate if a flexible calibration plot should be produced
(TRUE) or not (FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further plotting arguments for the calibration plot. See Details
below.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function takes an existing prediction model formatted according
to <code>pred_input_info</code>, and calculates measures of predictive
performance on new data (e.g., within an external validation study). The
information about the existing prediction model should first be inputted by
calling <code>pred_input_info</code>, before passing the resulting object
to <code>pred_validate</code>.
</p>
<p><code>new_data</code> should be a data.frame, where each row should be an
observation (e.g. patient) and each variable/column should be a predictor
variable. The predictor variables need to include (as a minimum) all of the
predictor variables that are included in the existing prediction model
(i.e., each of the variable names supplied to
<code>pred_input_info</code>, through the <code>model_info</code> parameter,
must match the name of a variables in <code>new_data</code>).
</p>
<p>Any factor variables within <code>new_data</code> must be converted to dummy
(0/1) variables before calling this function. <code>dummy_vars</code> can
help with this. See <code>pred_predict</code> for examples.
</p>
<p><code>binary_outcome</code>, <code>survival_time</code> and <code>event_indicator</code> are
used to specify the outcome variable(s) within <code>new_data</code> (use
<code>binary_outcome</code> if <code>x$model_type</code> = "logistic", or use
<code>survival_time</code> and <code>event_indicator</code> if <code>x$model_type</code> =
"survival").
</p>
<p>In the case of validating a logistic regression model, this function
assesses the predictive performance of the predicted risks against an
observed binary outcome. Various metrics of calibration (agreement between
the observed risk and the predicted risks, across the full risk range) and
discrimination (ability of the model to distinguish between those who
develop the outcome and those who do not) are calculated. For calibration,
the observed-to-expected ratio, calibration intercept and calibration
slopes are estimated. The calibration intercept is estimated by fitting a
logistic regression model to the observed binary outcomes, with the linear
predictor of the model as an offset. For calibration slope, a logistic
regression model is fit to the observed binary outcome with the linear
predictor from the model as the only covariate. For discrimination, the
function estimates the area under the receiver operating characteristic
curve (AUC). Various other metrics are also calculated to assess overall
accuracy (Brier score, Cox-Snell R2).
</p>
<p>In the case of validating a survival prediction model, this function
assesses the predictive performance of the linear predictor and
(optionally) the predicted event probabilities at a fixed time horizon
against an observed time-to-event outcome. Various metrics of calibration
and discrimination are calculated. For calibration, the
observed-to-expected ratio at the specified <code>time_horizon</code> (if
predicted risks are available through specification of <code>x$cum_hazard</code>)
and calibration slope are produced. For discrimination, Harrell's
C-statistic is calculated.
</p>
<p>For both model types, a flexible calibration plot is produced (for survival
models, the cumulative baseline hazard must be available in the
<code>predinfo</code> object, <code>x$cum_hazard</code>). Specify parameter
<code>cal_plot</code> to indicate whether a calibration plot should be produced
(TRUE), or not (FALSE). The calibration plot is produced by regressing the
observed outcomes against a cubic spline of the logit of predicted risks
(for a logistic model) or the complementary log-log of the predicted risks
(for a survival model). Users can specify the following additional
parameters to <code>pred_validate</code> to modify the calibration plot:
</p>

<ul>
<li> <p><code>xlim</code> as a numeric vector of length 2, giving the lower and
upper range of the x-axis scale - defaults at 0 and 1. Changes here should
match changes to the <code>ylim</code> such that the plot remains 'square'.
</p>
</li>
<li> <p><code>ylim</code> as a numeric vector of length 2, giving the lower and
upper range of the y-axis scale - defaults at 0 and 1. Changes here should
match changes to the <code>xlim</code> such that the plot remains 'square'.
</p>
</li>
<li> <p><code>xlab</code> string giving the x-axis label. Defaults as
"Predicted Probability".
</p>
</li>
<li> <p><code>ylab</code> string giving the x-axis label. Defaults as
"Observed Probability".
</p>
</li>
<li> <p><code>pred_rug</code> TRUE/FALSE of whether a 'rug' should be placed
along the x-axis of the calibration plot showing the distribution of
predicted risks. Defaults as FALSE in favour of examining the
box-plot/violin plot that is produced.
</p>
</li>
<li> <p><code>cal_plot_n_sample</code> numeric value (less than nrow(new_data))
giving a random subset of observations to render the calibration plot
over. The calibration plot is always created using all data, but for
rendering speed in large datasets, it can sometimes be useful to render
the plot over a smaller (random) subset of observations.
Final (e.g. publication-ready) plots should always show the full plot,
so a warning is created if users enter a value of cal_plot_n_sample.
</p>
</li>
</ul>
<h3>Value</h3>

<p><code>pred_validate</code> returns an object of class
"<code>predvalidate</code>", with child classes per <code>model_type</code>. This is a
list of performance metrics, estimated by applying the existing prediction
model to the new_data. An object of class "<code>predvalidate</code>" is a list
containing relevant calibration and discrimination measures. For logistic
regression models, this will include observed:expected ratio,
calibration-intercept, calibration slope, area under the ROC curve,
R-squared, and Brier Score. For survival models, this will include
observed:expected ratio (if <code>cum_hazard</code> is provided to <code>x</code>),
calibration slope, and Harrell's C-statistic. Optionally, a flexible
calibration plot is also produced, along with a box-plot and violin plot of
the predicted risk distribution.
</p>
<p>The <code>summary</code> function can be used to extract and print summary
performance results (calibration and discrimination metrics). The graphical
assessments of performance can be extracted using <code>plot</code>.
</p>


<h3>See Also</h3>

<p><code>pred_input_info</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Example 1 - multiple existing model, with outcome specified; uses
#            an example dataset within the package
model1 &lt;- pred_input_info(model_type = "logistic",
                          model_info = SYNPM$Existing_logistic_models)
val_results &lt;- pred_validate(x = model1,
                             new_data = SYNPM$ValidationData,
                             binary_outcome = "Y",
                             cal_plot = FALSE)
summary(val_results)

</code></pre>


</div>