<div class="container">

<table style="width: 100%;"><tr>
<td>MakeCompositePSDForAllWindows</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Make PSD for each window (dataframe) in a list and then find the average of all the PSDs</h2>

<h3>Description</h3>

<p>Given multiple windows of time series data, if the sampling frequency for
all time series is the same, then the PSD for each window can be calculated,
and then averaged to create a composite PSD.
</p>


<h3>Usage</h3>

<pre><code class="language-R">MakeCompositePSDForAllWindows(
  list.of.windows,
  name.of.col.containing.time.series,
  sampling_frequency,
  x_start = 0,
  x_end,
  x_increment
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>list.of.windows</code></td>
<td>
<p>A list of windows (dataframes).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name.of.col.containing.time.series</code></td>
<td>
<p>A string that specifies the name of the column in the windows that correspond to the time series that should be used for making PSD.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampling_frequency</code></td>
<td>
<p>Numeric value specifying sampling frequency in hertz. If data is sampled once every second, then sampling frequency is 1 Hz. If data is sampled once every 2 seconds, then sampling frequency is 0.5 Hz.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_start</code></td>
<td>
<p>Numeric value specifying start of the new x-axis for the averaged PSD. Default is 0 Hz.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_end</code></td>
<td>
<p>Numeric value specifying end of the new x-axis for the averaged PSD. Maximum value is the sampling_frequency divided by 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_increment</code></td>
<td>
<p>Numeric value specifying increment of the new x-axis for the averaged PSD.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Using fft(), the PSD of a time series dataset can be calculated.This is done
for multiple windows of time using the MakePowerSpectralDensity() function
for each window. When the code executes, a counter is displayed to indicate
how many windows have been analyzed.
</p>


<h3>Value</h3>

<p>A List with two objects:
</p>

<ol>
<li>
<p> Vector of frequencies in Hz. The maximum frequency should be half the sampling frequency. Called Nyquist Frequency.
</p>
</li>
<li>
<p> Vector of averaged PSD values corresponding with each frequency. Units should be in the original units of the data vector squared and divided by frequency.
</p>
</li>
<li>
<p> Vector of standard deviation of PSD values corresponding with each frequency. This can be used to generate error envelopes or error bars to show the variation between windows.
</p>
</li>
</ol>
<p>The vector of frequencies can be used as the x-axis values of a single sided spectrum amplitude plot.
The vector of PSD values can be used as the y-axis values of the PSD plot.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Create a vector of time that represent times where data are sampled.
Fs = 100; #sampling frequency in Hz
T = 1/Fs; #sampling period
L = 1000; #length of time vector
t = (0:(L-1))*T; #time vector

#First signal
#1. 10 Hz with amplitude of 4
#2. 25 Hz with amplitude of 4
S1 &lt;- 1*sin(2*pi*10*t) + 2*sin(2*pi*25*t);
S1 &lt;- S1 + rnorm(length(t)) #Add some noise
S1.data.frame &lt;- as.data.frame(cbind(t, S1))
colnames(S1.data.frame) &lt;- c("Time", "Signal")

#Second signal
#1. 5 Hz with amplitude of 2
#2. 8 Hz with amplitude of 2
S2 &lt;- 2*sin(2*pi*5*t) + 2*sin(2*pi*8*t);
S2 &lt;- S2 + rnorm(length(t)) #Add some noise
S2.data.frame &lt;- as.data.frame(cbind(t, S2))
colnames(S2.data.frame) &lt;- c("Time", "Signal")

#Third signal
#1. 5 Hz with amplitude of 2
#2. 8 Hz with amplitude of 2
S3 &lt;- 2*sin(2*pi*5*t) + 2*sin(2*pi*8*t);
S3 &lt;- S3 + rnorm(length(t)) #Add some noise
S3.data.frame &lt;- as.data.frame(cbind(t, S3))
colnames(S3.data.frame) &lt;- c("Time", "Signal")

#Add all signals to a List
list.of.windows &lt;- list(S1.data.frame, S2.data.frame, S3.data.frame)

results &lt;- MakeCompositePSDForAllWindows(list.of.windows, "Signal", Fs, 0, 30, 0.1)

frequencies &lt;- results[[1]]

averaged.PSD &lt;- results[[2]]

stddev.PSD &lt;- results[[3]]

#dev.new()
plot(frequencies, averaged.PSD, type = "l")

#dev.new()
plot(frequencies, averaged.PSD, type = "l")
#Add error bars
arrows(frequencies, averaged.PSD, frequencies, averaged.PSD + stddev.PSD, length=0.05, angle=90)
arrows(frequencies, averaged.PSD, frequencies, averaged.PSD - stddev.PSD, length=0.05, angle=90)


</code></pre>


</div>