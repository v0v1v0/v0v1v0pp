<div class="container">

<table style="width: 100%;"><tr>
<td>explain</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Explain predictions from final prediction rule ensemble</h2>

<h3>Description</h3>

<p><code>explain</code> shows which rules apply to which observations and visualizes
the contribution of rules and linear predictors to the predicted values
</p>


<h3>Usage</h3>

<pre><code class="language-R">explain(
  object,
  newdata,
  penalty.par.val = "lambda.1se",
  response = 1L,
  plot = TRUE,
  intercept = FALSE,
  center.linear = FALSE,
  plot.max.nobs = 4,
  plot.dim = c(2, 2),
  plot.obs.names = TRUE,
  pred.type = "response",
  digits = 3L,
  cex = 0.8,
  ylab = "Contribution to linear predictor",
  bar.col = c("#E495A5", "#39BEB1"),
  rule.col = "darkgrey",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object of class <code>pre</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>optional dataframe of new (test) observations, including all
predictor variables used for deriving the prediction rule ensemble.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>penalty.par.val</code></td>
<td>
<p>character or numeric. Value of the penalty parameter
<code class="reqn">\lambda</code> to be employed for selecting the final ensemble. The default
<code>"lambda.min"</code> employs the <code class="reqn">\lambda</code> value within 1 standard
error of the minimum cross-validated error. Alternatively, 
<code>"lambda.min"</code> may be specified, to employ the <code class="reqn">\lambda</code> value
with minimum cross-validated error, or a numeric value <code class="reqn">&gt;0</code> may be 
specified, with higher values yielding a sparser ensemble. To evaluate the 
trade-off between accuracy and sparsity of the final ensemble, inspect
<code>pre_object$glmnet.fit</code> and <code>plot(pre_object$glmnet.fit)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>numeric or character vector of length one. Specifies the
name or number of the response variable (for multivariate responses) or
the name or number of the factor level (for multinomial responses) for 
which explanations and contributions should be computed and/or plotted.
Only used for<code>pre</code>s fitted to multivariate or multinomial responses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logical. Should explanations be plotted?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>logical. Specifies whether intercept should be included in
explaining predictions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center.linear</code></td>
<td>
<p>logical. Specifies whether linear terms should be
centered with respect to the training sample mean before computing their 
contribution to the predicted value. If <code>intercept = TRUE</code>, this
will also affect the intercept. That is, the value of the intercept returned
will differ from that of the value returned by the <code>print</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.max.nobs</code></td>
<td>
<p>numeric. Specifies maximum number of observations
for which explanations will be plotted. The default (<code>4</code>) plots the
explanation for the first four observations supplied in <code>newdata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.dim</code></td>
<td>
<p>numeric vector of length 2. Specifies the number of rows and
columns in the resulting plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.obs.names</code></td>
<td>
<p>logical vector of length 1, NULL, or character vector 
of length <code>nrow(data)</code> supplying the names that should be used for
individual observations' plots. If <code>TRUE</code> (default), 
<code>rownames(newdata)</code> will be used as titles. If <code>NULL</code>,
<code>paste("Observation", 1:nrow(newdata))</code> will be used as titles. If 
<code>FALSE</code>, no titles will be plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred.type</code></td>
<td>
<p>character. Specifies the type of predicted values to be 
computed, returned and provided in the plot(s). Note that the computed 
contributions must be additive and are therefore always on the scale of 
the linear predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>integer. Specifies the number of digits used in depcting the
predicted values in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex</code></td>
<td>
<p>numeric. Specifies the relative text size of title, tick and axis
labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>character. Specifies the label for the horizonantal (y-) axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar.col</code></td>
<td>
<p>character vector of length two. Specifies the colors to be used for
plotting the positive and negative contributions to the predictions, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rule.col</code></td>
<td>
<p>character. Specifies the color to be used for plotting the rule
descriptions. If <code>NULL</code>, rule descriptions are not plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed to <code>predict.pre</code> and 
<code>predict.cv.glmnet</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Provides a graphical depiction of the contribution of rules and
linear terms to the individual predictions (if <code>plot = TRUE</code>.
Invisibly returns a list with objects <code>predictors</code> and
<code>contribution</code>. <code>predictors</code> contains the values of the rules and
linear terms for each observation in <code>newdata</code>, for those rules
and linear terms included in the final ensemble with the specified
value of <code>penalty.par.val</code>. <code>contribution</code> contains the
values of <code>predictors</code>, multiplied by the estimated values
of the coefficients in the final ensemble selected with the
specified value of <code>penalty.par.val</code>.
All contributions are calculated w.r.t. the intercept, by default.
Thus, if a given rule applies to an observation in <code>newdata</code>, 
the contribution of that rule equals the estimated coefficient of
that rule. If a given rule does not apply to an observation in
<code>newdata</code>, the contribution of that rule equals 0. 
For linear terms, contributions can be centered, or not (the default).
Thus, by default the contribution of a linear terms for an 
observation in <code>newdata</code> equals the obeservation's value of the 
linear term, times the estimated coefficient of the linear term.
If <code>center.linear = TRUE</code>, the contribution of a linear term 
for an observation in <code>newdata</code> equals (the value of the linear
temr, minus the mean value of the linear term in the training data)
times the estimated coefficient for the linear term.
</p>


<h3>References</h3>

<p>Fokkema, M. &amp; Strobl, C. (2020). Fitting prediction rule 
ensembles to psychological research data: An introduction and tutorial. 
<em>Psychological Methods 25</em>(5), 636-652. <a href="https://doi.org/10.1037/met0000256">doi:10.1037/met0000256</a>,
<a href="https://arxiv.org/abs/1907.05302">https://arxiv.org/abs/1907.05302</a>
</p>


<h3>See Also</h3>

<p><code>pre</code>, <code>plot.pre</code>,
<code>coef.pre</code>, <code>importance.pre</code>, <code>cvpre</code>,
<code>interact</code>, <code>print.pre</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">airq &lt;- airquality[complete.cases(airquality), ]
set.seed(1)
train &lt;- sample(1:nrow(airq), size = 100)
set.seed(42)
airq.ens &lt;- pre(Ozone ~ ., data = airq[train,])
airq.ens.exp &lt;- explain(airq.ens, newdata = airq[-train,])
airq.ens.exp$predictors
airq.ens.exp$contribution

## Can also include intercept in explanation:
airq.ens.exp &lt;- explain(airq.ens, newdata = airq[-train,])

## Fit PRE with linear terms only to illustrate effect of center.linear:
set.seed(42)
airq.ens2 &lt;- pre(Ozone ~ ., data = airq[train,], type = "linear")
## When not centered around their means, Month has negative and 
##   Day has positive contribution:
explain(airq.ens2, newdata = airq[-train,][1:2,],
        penalty.par.val = "lambda.min")$contribution
## After mean centering, contributions of Month and Day have switched
##   sign (for these two observations): 
explain(airq.ens2, newdata = airq[-train,][1:2,], 
        penalty.par.val = "lambda.min", center.linear = TRUE)$contribution

</code></pre>


</div>