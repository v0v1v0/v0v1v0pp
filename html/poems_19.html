<div class="container">

<table style="width: 100%;"><tr>
<td>population_simulator</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Runs a stage-based demographic population model simulation.</h2>

<h3>Description</h3>

<p>Simulates a stage-based demographic population model and returns simulation results
across multiple replicate runs. Processes run at each simulation time-step include:
</p>

<ol>
<li>
<p> Density dependence calculations (ceiling, logistic, or user-defined)
</p>
</li>
<li>
<p> Environmental stochasticity calculations
</p>
</li>
<li>
<p> Stage transition (stochastic) calculations
</p>
</li>
<li>
<p> Translocation calculations (user-defined)
</p>
</li>
<li>
<p> Harvest calculations (user-defined)
</p>
</li>
<li>
<p> Mortality calculations (user-defined)
</p>
</li>
<li>
<p> Dispersal calculations (default or user-defined)
</p>
</li>
<li>
<p> Results collection
</p>
</li>
</ol>
<h3>Usage</h3>

<pre><code class="language-R">population_simulator(inputs)
</code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>inputs</code></td>
<td>
<p>Nested list/object with named elements:
</p>

<dl>
<dt><code>random_seed</code></dt>
<dd>
<p>Number to seed the random number generation for stochasticity.</p>
</dd>
<dt><code>replicates</code></dt>
<dd>
<p>Number of replicate simulation runs (default is 1).</p>
</dd>
<dt><code>time_steps</code></dt>
<dd>
<p>Number of simulation time steps. Required input.</p>
</dd>
<dt><code>years_per_step</code></dt>
<dd>
<p>Number of years per time step (default is 1).</p>
</dd>
<dt><code>populations</code></dt>
<dd>
<p>Number of populations. Required input.</p>
</dd>
<dt><code>coordinates</code></dt>
<dd>
<p>Data frame (or matrix) of X-Y population coordinates.</p>
</dd>
<dt><code>stages</code></dt>
<dd>
<p>Number of life cycle stages.</p>
</dd>
<dt><code>region</code></dt>
<dd>
<p>A <code>Region</code> object
defining the study region.</p>
</dd>
<dt><code>initial_abundance</code></dt>
<dd>
<p>Array (or matrix) of initial abundances (at each stage in rows) for each population (in columns). If there is only one stage and a region object is attached, then initial
abundance may be provided in the form of a raster with the same specs as
the region raster. A vector can be provided that will be forced to a matrix. Required input.</p>
</dd>
<dt><code>stage_matrix</code></dt>
<dd>
<p>Matrix of transition (fecundity &amp; survival) rates between stages at each time step (Leslie/Lefkovitch matrix). Required input.</p>
</dd>
<dt><code>fecundity_mask</code></dt>
<dd>
<p>Matrix of 0-1 to indicate which (proportions) of transition rates refer to fecundity.</p>
</dd>
<dt><code>fecundity_max</code></dt>
<dd>
<p>Maximum transition fecundity rate (in Leslie/Lefkovitch matrix).</p>
</dd>
<dt><code>demographic_stochasticity</code></dt>
<dd>
<p>Boolean for choosing demographic stochasticity for transition, dispersal, harvest and/or other processes (default is TRUE).</p>
</dd>
<dt><code>standard_deviation</code></dt>
<dd>
<p>Standard deviation matrix (or single value) for applying environmental stochasticity to transition rates.</p>
</dd>
<dt><code>correlation</code></dt>
<dd>
<p>List containing either an environmental correlation matrix (correlation_matrix), a pre-calculated transposed (Cholesky) decomposition matrix (t_decomposition_matrix), or a compact transposed (Cholesky) decomposition matrix (t_decomposition_compact_matrix) and a corresponding map of population indices (t_decomposition_compact_map), as per <code>SpatialCorrelation</code> class attributes.</p>
</dd>
<dt><code>carrying_capacity</code></dt>
<dd>
<p>Array (matrix) of carrying capacity values at each population cell (<em>populations</em> rows by <em>time_steps</em> columns when across time). Required input.</p>
</dd>
<dt><code>density_dependence</code></dt>
<dd>
<p>Density dependence can be "ceiling" (default), "logistic" (Ricker), or a user-defined function (optionally nested in a list with additional attributes) for adjusting transition rates: <code>function(params)</code>, where <em>params</em> is a list passed to the function containing:
</p>

<dl>
<dt><code>transition_array</code></dt>
<dd>
<p>3D array of transition rates: stages by stages by populations.</p>
</dd>
<dt><code>fecundity_mask</code></dt>
<dd>
<p>Matrix of 0-1 to indicate which (proportions) of transition rates refer to fecundity.</p>
</dd>
<dt><code>fecundity_max</code></dt>
<dd>
<p>Maximum transition fecundity rate (in Leslie/Lefkovitch matrix).</p>
</dd>
<dt><code>carrying_capacity</code></dt>
<dd>
<p>Array of carrying capacity values for each population.</p>
</dd>
<dt><code>stage_abundance</code></dt>
<dd>
<p>Matrix of abundances for each stage (rows) and population (columns).</p>
</dd>
<dt><code>population_abundance</code></dt>
<dd>
<p>Array of summed population abundances for all stages.</p>
</dd>
<dt><code>density_abundance</code></dt>
<dd>
<p>Array of summed population abundances for stages affected by density.</p>
</dd>
<dt><code>growth_rate_max</code></dt>
<dd>
<p>Maximum growth rate value or array for populations.</p>
</dd>
<dt><code>occupied_indices</code></dt>
<dd>
<p>Array of indices for populations occupied at (current) time step.</p>
</dd>
<dt><code>calculate_multipliers</code></dt>
<dd>
<p>Function (<code>function(growth_rates)</code>) for finding multipliers (when stages &gt; 1) to apply to affected transitions that result in target growth rates (dominant eigenvalues).</p>
</dd>
<dt><code>apply_multipliers</code></dt>
<dd>
<p>Function (<code>function(transition_array, multipliers</code>) for applying multipliers (when stages &gt; 1) to the affected transition rates within a transition array (returns multiplied array).</p>
</dd>
<dt><code>simulator</code></dt>
<dd>
<p><code>SimulatorReference</code> object with dynamically accessible <em>attached</em> and <em>results</em> lists.</p>
</dd>
<dt><code>optional attributes</code></dt>
<dd>
<p>Additional numeric attributes when density dependence is optionally nested in a list.</p>
</dd>
</dl>
<p>returns a transformed transition 3D array
</p>
</dd>
<dt><code>growth_rate_max</code></dt>
<dd>
<p>Maximum growth rate (utilized by density dependence processes).</p>
</dd>
<dt><code>density_affects</code></dt>
<dd>
<p>Matrix of booleans or numeric (0-1) indicating the transition vital rates affected by density (default is all).</p>
</dd>
<dt><code>density_stages</code></dt>
<dd>
<p>Array of booleans or numeric (0,1) for each stage to indicate which stages are affected by density (default is all).</p>
</dd>
<dt><code>density_precision</code></dt>
<dd>
<p>Numeric precision of the calculated multipliers (used when stages &gt; 1) applied to affected transition rates (default is 3 decimal places).</p>
</dd>
<dt><code>translocation</code></dt>
<dd>
<p>An optional user-defined function (optionally nested in a list with additional attributes) for applying translocation or spatio-temporal management (to abundances): <code>function(params)</code>, where <em>params</em> is a list passed to the function containing:
</p>

<dl>
<dt><code>replicates</code></dt>
<dd>
<p>Number of replicate simulation runs.</p>
</dd>
<dt><code>time_steps</code></dt>
<dd>
<p>Number of simulation time steps.</p>
</dd>
<dt><code>years_per_step</code></dt>
<dd>
<p>Number of years per time step.</p>
</dd>
<dt><code>populations</code></dt>
<dd>
<p>Number of populations.</p>
</dd>
<dt><code>stages</code></dt>
<dd>
<p>Number of lifecycle stages.</p>
</dd>
<dt><code>demographic_stochasticity</code></dt>
<dd>
<p>Boolean for optionally choosing demographic stochasticity for the transformation.</p>
</dd>
<dt><code>density_stages</code></dt>
<dd>
<p>Array of booleans or numeric (0,1) for each stage to indicate which stages are affected by density.</p>
</dd>
<dt><code>r</code></dt>
<dd>
<p>Simulation replicate.</p>
</dd>
<dt><code>tm</code></dt>
<dd>
<p>Simulation time step.</p>
</dd>
<dt><code>carrying_capacity</code></dt>
<dd>
<p>Array of carrying capacity values for each population at time step.</p>
</dd>
<dt><code>stage_abundance</code></dt>
<dd>
<p>Matrix of (current) abundance for each stage (rows) and population (columns) at time step.</p>
</dd>
<dt><code>occupied_indices</code></dt>
<dd>
<p>Array of indices for populations occupied at (current) time step.</p>
</dd>
<dt><code>simulator</code></dt>
<dd>
<p><code>SimulatorReference</code> object with dynamically accessible <em>attached</em> and <em>results</em> lists.</p>
</dd>
<dt><code>additional attributes</code></dt>
<dd>
<p>Additional attributes when the transformation is optionally nested in a list.</p>
</dd>
</dl>
<p>returns a transformed stage abundance matrix (or a list with stage abundance and carrying capacity)
</p>
</dd>
<dt><code>harvest</code></dt>
<dd>
<p>An optional user-defined function (optionally nested in a list with additional attributes) for applying harvesting (to abundances): <code>function(params)</code> as per translocation.</p>
</dd>
<dt><code>mortality</code></dt>
<dd>
<p>An optional user-defined function (optionally nested in a list with additional attributes) for applying mortality (to abundances): <code>function(params)</code> as per translocation.</p>
</dd>
<dt><code>dispersal</code></dt>
<dd>
<p>Either a matrix of dispersal rates between populations (source columns to target rows) or a list of data frames of non-zero dispersal rates and indices for constructing a compact dispersal matrix, and optional changing rates over time (as per class <code>DispersalGenerator</code> <em>dispersal_data</em> attribute). Alternatively a user-defined function (optionally nested in a list with additional attributes) may be used: <code>function(params)</code>, where <em>params</em> is a list passed to the function containing:
</p>

<dl>
<dt><code>replicates</code></dt>
<dd>
<p>Number of replicate simulation runs.</p>
</dd>
<dt><code>time_steps</code></dt>
<dd>
<p>Number of simulation time steps.</p>
</dd>
<dt><code>years_per_step</code></dt>
<dd>
<p>Number of years per time step.</p>
</dd>
<dt><code>populations</code></dt>
<dd>
<p>Number of populations.</p>
</dd>
<dt><code>demographic_stochasticity</code></dt>
<dd>
<p>Boolean for optionally choosing demographic stochasticity for the transformation.</p>
</dd>
<dt><code>density_stages</code></dt>
<dd>
<p>Array of booleans or numeric (0,1) for each stage to indicate which stages are affected by density.</p>
</dd>
<dt><code>dispersal_stages</code></dt>
<dd>
<p>Array of relative dispersal (0-1) for each stage to indicate the degree to which each stage participates in dispersal.</p>
</dd>
<dt><code>r</code></dt>
<dd>
<p>Simulation replicate.</p>
</dd>
<dt><code>tm</code></dt>
<dd>
<p>Simulation time step.</p>
</dd>
<dt><code>carrying_capacity</code></dt>
<dd>
<p>Array of carrying capacity values for each population at time step.</p>
</dd>
<dt><code>stage_abundance</code></dt>
<dd>
<p>Matrix of abundance for each stage (rows) and population (columns) at time step.</p>
</dd>
<dt><code>occupied_indices</code></dt>
<dd>
<p>Array of indices for populations occupied at time step.</p>
</dd>
<dt><code>simulator</code></dt>
<dd>
<p><code>SimulatorReference</code> object with dynamically accessible <em>attached</em> and <em>results</em> lists.</p>
</dd>
<dt><code>additional attributes</code></dt>
<dd>
<p>Additional attributes when the transformation is optionally nested in a list.</p>
</dd>
</dl>
<p>returns the post-dispersal abundance matrix
</p>
</dd>
<dt><code>dispersal_stages</code></dt>
<dd>
<p>Array of relative dispersal (0-1) for each stage to indicate the degree to which each stage participates in dispersal (default is 1 for all stages).</p>
</dd>
<dt><code>dispersal_source_n_k</code></dt>
<dd>
<p>Dispersal proportion (p) density dependence via source population abundance divided by carrying capacity (n/k), where p is reduced via a linear slope (defined by two list items) from n/k &lt;= <em>cutoff</em> (p = 0) to n/k &gt;= <em>threshold</em> (aliases: <em>dispersal_n_k_cutoff</em> &amp; <em>dispersal_n_k_threshold</em>).</p>
</dd>
<dt><code>dispersal_target_k</code></dt>
<dd>
<p>Dispersal rate (r) density dependence via target population carrying capacity (k), where r is reduced via a linear slope (through the origin) when k &lt;= <em>threshold</em> (alias: <em>dispersal_k_threshold</em>).</p>
</dd>
<dt><code>dispersal_target_n</code></dt>
<dd>
<p>Dispersal rate (r) density dependence via target population abundance (n), where r is reduced via a linear slope (defined by two list items) from n &gt;= <em>threshold</em> to n &lt;= <em>cutoff</em> (r = 0) or vice versa (aliases: <em>dispersal_n_threshold</em> &amp; <em>dispersal_n_cutoff</em>).</p>
</dd>
<dt><code>dispersal_target_n_k</code></dt>
<dd>
<p>Dispersal rate (r) density dependence via target population abundance divided by carrying capacity (n/k), where r is reduced via a linear slope (defined by two list items) from n/k &gt;= <em>threshold</em> to n/k &lt;= <em>cutoff</em> (r = 0) or vica versa.</p>
</dd>
<dt><code>abundance_threshold</code></dt>
<dd>
<p>Abundance threshold (that needs to be exceeded) for each population to persist.</p>
</dd>
<dt><code>simulation_order</code></dt>
<dd>
<p>A vector of simulation process names in configured order of execution (default is "transition", "translocation", "harvest" (plus harvested results), "mortality", "dispersal", "results" (except harvested).</p>
</dd>
<dt><code>additional transformation functions</code></dt>
<dd>
<p>Additional user-defined abundance transformation functions (optionally nested in lists with additional attributes) are utilised when listed in <em>simulation_order</em> (function as per translocation).</p>
</dd>
<dt><code>results_selection</code></dt>
<dd>
<p>List of results selection from: "abundance" (default), "ema", "extirpation", "extinction_location", "harvested", "occupancy"; "summarize" (default) or "replicate".</p>
</dd>
<dt><code>result_stages</code></dt>
<dd>
<p>Array of booleans or numeric (0, 1, 2, ...) for each stage to indicate which stages are included/combined (each unique digit &gt; 0; optionally named) in the results (default is 1 for all stages).</p>
</dd>
</dl>
</td>
</tr></table>
<h3>Value</h3>

<p>Selected simulation results as a nested list summarized (mean, sd, min, max) across multiple replicates (default), or 2-3D arrays including results for each replicate:
</p>

<dl>
<dt><code>abundance</code></dt>
<dd>
<p>Matrix or 3D array of simulation abundance: <em>populations</em> rows by <em>time_steps</em> columns (by <em>replicates</em> deep).</p>
</dd>
<dt><code>abundance_stages</code></dt>
<dd>
<p>List of matrices or 3D arrays of simulation abundance for unique stage combinations when present: each <em>populations</em> rows by <em>time_steps</em> columns (by <em>replicates</em> deep).</p>
</dd>
<dt><code>all$abundance</code></dt>
<dd>
<p>Array or matrix of total abundance across populations: <em>time_steps</em> (rows by <em>replicates</em> columns).</p>
</dd>
<dt><code>all$abundance_stages</code></dt>
<dd>
<p>List of arrays or matrices of total abundance across populations for unique stage combinations when present: each <em>time_steps</em> (rows by <em>replicates</em> columns).</p>
</dd>
<dt><code>all$ema</code></dt>
<dd>
<p>Array of expected minimum abundance at each time step (averaged across replicates).</p>
</dd>
<dt><code>extirpation</code></dt>
<dd>
<p>Array or matrix of extirpation times: <em>populations</em> (rows by <em>replicates</em> columns).</p>
</dd>
<dt><code>all$extirpation</code></dt>
<dd>
<p>Array of extirpation time across populations for each replicate.</p>
</dd>
<dt><code>all$extinction_location</code></dt>
<dd>
<p>The weighted centroid of cells occupied in the time-step prior to the extirpation of all populations (if it occurred) for each replicate.</p>
</dd>
<dt><code>harvested</code></dt>
<dd>
<p>Matrix or 3D array of individuals harvested: <em>populations</em> rows by <em>time_steps</em> columns (by <em>replicates</em> deep).</p>
</dd>
<dt><code>harvested_stages</code></dt>
<dd>
<p>List of matrices or 3D arrays of individuals harvested for unique stage combinations when present: each <em>populations</em> rows by <em>time_steps</em> columns (by <em>replicates</em> deep).</p>
</dd>
<dt><code>all$harvested</code></dt>
<dd>
<p>Array or matrix of individuals harvested across populations: <em>time_steps</em> (rows by <em>replicates</em> columns).</p>
</dd>
<dt><code>all$harvested_stages</code></dt>
<dd>
<p>List of arrays or matrices of individuals harvested across populations for unique stage combinations when present: each <em>time_steps</em> (rows by <em>replicates</em> columns).</p>
</dd>
<dt><code>all$occupancy</code></dt>
<dd>
<p>Array or matrix of the number of populations occupied at each time-step: <em>time_steps</em> (rows by <em>replicates</em> columns).</p>
</dd>
<dt><code>additional results</code></dt>
<dd>
<p>Additional results may be attached via user-defined functions (using <code>params$simulator$results</code>).</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R"># U Island example region
coordinates &lt;- data.frame(
  x = rep(seq(177.01, 177.05, 0.01), 5),
  y = rep(seq(-18.01, -18.05, -0.01), each = 5)
)
template_raster &lt;- Region$new(coordinates = coordinates)$region_raster # full extent
template_raster[][-c(7, 9, 12, 14, 17:19)] &lt;- NA # make U Island
region &lt;- Region$new(template_raster = template_raster)
# Harvest function
harvest &lt;- list(
  rate = 0.3,
  function(params) round(params$stage_abundance * (1 - params$rate))
)
# Population model
stage_matrix &lt;- matrix(c(
  0, 2.5, # Leslie/Lefkovitch matrix
  0.8, 0.5
), nrow = 2, ncol = 2, byrow = TRUE)
pop_model &lt;- PopulationModel$new(
  region = region,
  time_steps = 10, # years
  populations = region$region_cells, # 7
  stage_matrix = stage_matrix,
  initial_abundance = rep(10, 7),
  carrying_capacity = array(70:1, c(7, 10)),
  harvest = harvest,
  results_selection = c("abundance", "harvested")
)
# Simulations
population_simulator(pop_model) # model
inputs &lt;- pop_model$get_attributes()
population_simulator(inputs) # list

</code></pre>


</div>