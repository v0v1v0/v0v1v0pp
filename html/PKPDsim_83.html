<div class="container">

<table style="width: 100%;"><tr>
<td>sim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate ODE or analytical equation</h2>

<h3>Description</h3>

<p>Simulates a specified regimen using ODE system or analytical equation
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim(
  ode = NULL,
  analytical = NULL,
  parameters = NULL,
  parameters_table = NULL,
  mixture_group = NULL,
  omega = NULL,
  omega_type = "exponential",
  res_var = NULL,
  iov_bins = NULL,
  seed = NULL,
  sequence = NULL,
  n_ind = 1,
  event_table = NULL,
  regimen = NULL,
  lagtime = NULL,
  covariates = NULL,
  covariates_table = NULL,
  covariates_implementation = list(),
  covariate_model = NULL,
  A_init = NULL,
  only_obs = FALSE,
  obs_step_size = NULL,
  int_step_size = 0.01,
  t_max = NULL,
  t_obs = NULL,
  t_tte = NULL,
  t_init = 0,
  obs_type = NULL,
  duplicate_t_obs = FALSE,
  extra_t_obs = TRUE,
  rtte = FALSE,
  checks = TRUE,
  verbose = FALSE,
  return_event_table = FALSE,
  return_design = FALSE,
  output_include = list(parameters = FALSE, covariates = FALSE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ode</code></td>
<td>
<p>function describing the ODE system</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>analytical</code></td>
<td>
<p>string specifying analytical equation model to use (similar to ADVAN1-5 in NONMEM). If specified, will not use ODEs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameters</code></td>
<td>
<p>model parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameters_table</code></td>
<td>
<p>dataframe of parameters (with parameters as columns) containing parameter estimates for individuals to simulate. Formats accepted: data.frame, data.table, or list of lists.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mixture_group</code></td>
<td>
<p>mixture group for models containing mixtures. Should be either <code>1</code> or <code>2</code>, since only two groups are currently allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omega</code></td>
<td>
<p>vector describing the lower-diagonal of the between-subject variability matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omega_type</code></td>
<td>
<p>exponential or normal, specified as vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res_var</code></td>
<td>
<p>residual variability. Expected a list with arguments <code>prop</code>, <code>add</code>, and/or <code>exp</code>. NULL by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iov_bins</code></td>
<td>
<p>allow override of the default IOV bins for a model. Specified as a vector of timepoints specifying the bin separators, e.g. <code>iov_bins = c(0, 24, 48, 72, 9999)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>set seed for reproducible results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sequence</code></td>
<td>
<p>if not NULL specifies the pseudo-random sequence to use, e.g. "halton" or "sobol". See <code>mvrnorm2</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_ind</code></td>
<td>
<p>number of individuals to simulate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event_table</code></td>
<td>
<p>use a previously created <code>design</code> object used for ODE simulation instead of calling create_event_table() to create a new one. Especially useful for repeated calling of sim(), such as in optimizations or optimal design analysis. Also see <code>sim_core()</code> for even faster simulations using precalculated <code>design</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regimen</code></td>
<td>
<p>a regimen object created using the regimen() function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lagtime</code></td>
<td>
<p>either a value (numeric) or a parameter (character) or NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>list of covariates (for single individual) created using <code>new_covariate()</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates_table</code></td>
<td>
<p>data.frame (or unnamed list of named lists per individual) with covariate values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates_implementation</code></td>
<td>
<p>used only for <code>covariates_table</code>, a named list of covariate implementation methods per covariate, e.g. <code>list(WT = "interpolate", BIN = "locf")</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariate_model</code></td>
<td>
<p>R code used to pre-calculate effective parameters for use in ADVAN-style analytical equations. Not used in ODE simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A_init</code></td>
<td>
<p>vector with the initial state of the ODE system</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only_obs</code></td>
<td>
<p>only return the observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_step_size</code></td>
<td>
<p>the step size between the observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>int_step_size</code></td>
<td>
<p>the step size for the numerical integrator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t_max</code></td>
<td>
<p>maximum simulation time, if not specified will pick the end of the regimen as maximum</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t_obs</code></td>
<td>
<p>vector of observation times, only output these values (only used when t_obs==NULL)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t_tte</code></td>
<td>
<p>vector of observation times for time-to-event simulation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t_init</code></td>
<td>
<p>initialization time before first dose, default 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_type</code></td>
<td>
<p>vector of observation types. Only valid in combination with equal length vector <code>t_obs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>duplicate_t_obs</code></td>
<td>
<p>allow duplicate t_obs in output? E.g. for optimal design calculations when t_obs = c(0,1,2,2,3). Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra_t_obs</code></td>
<td>
<p>include extra t_obs in output for bolus doses? This is only activated when <code>t_obs</code> is not specified manually. E.g. for a bolus dose at t=24, if FALSE, PKPDsim will output only the trough, so for bolus doses you might want to switch this setting to TRUE. When set to "auto" (default), it will be TRUE by default, but will switch to FALSE whenever <code>t_obs</code> is specified manually.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rtte</code></td>
<td>
<p>should repeated events be allowed (FALSE by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>checks</code></td>
<td>
<p>perform input checks? Default is TRUE. For calculations where sim_ode is invoked many times (e.g. population estimation, optimal design) it makes sense to switch this to FALSE (after confirming the input is correct) to improve speed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>show more output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_event_table</code></td>
<td>
<p>return the event table for the simulation only, does not run the actual simulation. Useful for iterative use of sim().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_design</code></td>
<td>
<p>returns the design (event table and several other details) for the simulation, does not run the actual simulation. Useful for iterative functions like estimation in combination with <code>sim_core()</code>, e.g. for estimation and optimal design.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_include</code></td>
<td>
<p>list specifying what to include in output table, with keys <code>parameters</code> and <code>covariates</code>. Both are FALSE by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>extra parameters</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a data frame of compartments with associated concentrations at requested times
</p>
<p>Simulated regimen
</p>


<h3>See Also</h3>

<p>sim_ode_shiny
</p>


<h3>Examples</h3>

<pre><code class="language-R">
p &lt;- list(
  CL = 38.48,
  V  = 7.4,
  Q  = 7.844,
  V2 = 5.19,
  Q2  = 9.324,
  V3 = 111
)

omega &lt;- c(0.3,       # IIV CL
           0.1, 0.3)  # IIV V

r1 &lt;- new_regimen(
  amt = 100,
  times = c(0, 24, 36),
  type = "infusion"
)

mod &lt;- new_ode_model("pk_3cmt_iv")
dat &lt;- sim(
  ode = mod,
  parameters = p,
  omega = omega,
  n_ind = 20,
  regimen = r1
)

</code></pre>


</div>