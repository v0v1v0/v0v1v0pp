<div class="container">

<table style="width: 100%;"><tr>
<td>kde,prevR-method</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Kernel density estimation for prevR object.</h2>

<h3>Description</h3>

<p>This function allows to calculate a prevalence surface (ratio of two
intensity surfaces) and/or a relative risks surface (ratio of two density
surfaces) using gaussian kernel estimators with adaptative bandwidths of
equal number of observations or equal radius.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S4 method for signature 'prevR'
kde(
  object,
  N = NULL,
  R = NULL,
  weighted = TRUE,
  risk.ratio = FALSE,
  keep.details = FALSE,
  nb.cells = 100,
  cell.size = NULL,
  progression = TRUE,
  short.names = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object of class prevR.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>integer or list of integers corresponding to the rings to use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>integer or list of integers corresponding to the rings to use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighted</code></td>
<td>
<p>use weighted data (<code>TRUE</code>, <code>FALSE</code> or <code>2</code>)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>risk.ratio</code></td>
<td>
<p>calculate a relative risks surface instead of a
prevalence surface (<code>TRUE</code>, <code>FALSE</code> or <code>2</code>)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.details</code></td>
<td>
<p>return surface of positive cases and surface of
observed cases?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb.cells</code></td>
<td>
<p>number of cells on the longest side of the studied area
(unused if <code>cell.size</code> is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cell.size</code></td>
<td>
<p>size of each cell (in the unit of the projection).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progression</code></td>
<td>
<p>show a progress bar?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>short.names</code></td>
<td>
<p>should names of the output be short?</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function calculates a prevalence surface as the ratio of the
intensity surface (expressed in cases per surface unit) of positive cases
on the intensity surface of observed cases and could also calculate a
relative risks surface corresponding to the ratio of the density surface
(whose integral has been normalized to one) of positive cases on density
surface of observed cases.
</p>
<p>This method is a variant of the nearest neighbor technique. Surfaces are
estimated using gaussian kernel estimators with adaptative bandwidths,
bandwidth size being determined by a minimum number of
observations in the neighborhood (see <code>rings()</code> for more details).
Fixed bandwidths could also be used. More precisely, the bandwidth used is
half the radius of rings of equal number of observations or equal radius
(parameters <code>N</code> and <code>R</code>) calculated by the' function <code>rings()</code>.
</p>
<p>See references for a detailed explanation of the implemented methodology.
</p>
<p><code>N</code> and <code>R</code> determine the rings to use for the estimation. If they are not
defined, surfaces will be estimated for each available couples (N,R)
available in <code>object</code>. Several estimations could be
simultaneously calculated if several values of N and R are defined.
</p>
<p>A suggested value of N could be computed with <code>Noptim()</code>.
</p>


<h3>Value</h3>

<p>Object of class sf::sf.
Surfaces are named according to the name of the corresponding N and R
(for example: <em>k.prev.N300.RInf</em>). If <code>short.names</code> is <code>TRUE</code> and
if there is only one combination of couples (N, R), variable names will not
be suffixed by the value of N and R.
</p>
<p>Estimated variables are (depending on the function parameters) :</p>

<ul>
<li>
<p> "k.pos" unweighted intensity surface of positive cases.
</p>
</li>
<li>
<p> "k.obs" unweighted intensity surface of observed cases.
</p>
</li>
<li>
<p> "k.prev" unweighted surface of prevalence (k.pos/k.obs).
</p>
</li>
<li>
<p> "k.case" unweighted density surface of positive cases.
</p>
</li>
<li>
<p> "k.control" unweighted density surface of observed cases.
</p>
</li>
<li>
<p> "k.rr" unweighted surface of relative risks (k.case/k.control).
</p>
</li>
<li>
<p> "k.wpos" weighted intensity surface of positive cases.
</p>
</li>
<li>
<p> "k.wobs" weighted intensity surface of observed cases.
</p>
</li>
<li>
<p> "k.wprev" weighted surface of prevalence (k.wpos/k.wobs).
</p>
</li>
<li>
<p> "k.wcase" weighted density surface of positive cases.
</p>
</li>
<li>
<p> "k.wcontrol" weighted density surface of observed cases.
</p>
</li>
<li>
<p> "k.wrr" weighted surface of relative risks (k.wcase/k.wcontrol).
</p>
</li>
</ul>
<h3>Note</h3>

<p>Results could be plotted with <code>sf::plot()</code> or with <span class="pkg">ggplot2</span>
using <code>ggplot2::geom_sf()</code>. See examples.
</p>
<p><span class="pkg">prevR</span> provides several continuous color palettes
(see prevR.colors).
</p>
<p>Results could be turned into a <span class="pkg">stars</span> raster using
<code>stars::st_rasterize()</code>.
</p>
<p>To export to ASCII grid, rasterize the results with <code>stars::st_rasterize()</code>,
convert to <code>SpatRast</code> with <code>terra::rast()</code>, extract the desired layer with
<code style="white-space: pre;">⁠[[]]⁠</code> and then use <code>terra::writeRaster()</code>. See examples.
</p>
<p>See the package <span class="pkg">sparr</span> for another methodology to estimate relative
risks surfaces, adapted for other kind of data than Demographic and
Health Surveys (DHS).
</p>


<h3>References</h3>

<p>Larmarange Joseph, Vallo Roselyne, Yaro Seydou, Msellati Philippe
and Meda Nicolas (2011) "Methods for mapping regional trends of HIV
prevalence from Demographic and Health Surveys (DHS)",
<em>Cybergeo: European Journal of Geography</em>, no 558,
<a href="https://journals.openedition.org/cybergeo/24606">https://journals.openedition.org/cybergeo/24606</a>,
DOI: 10.4000/cybergeo.24606.
</p>


<h3>See Also</h3>

<p><code>KernSmooth::bkde2D()</code>, <code>rings()</code>, <code>Noptim()</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
dhs &lt;- rings(fdhs, N = c(100, 200, 300, 400, 500))

prev.N300 &lt;- kde(dhs, N = 300, nb.cells = 200)

plot(prev.N300, lty = 0)

library(ggplot2)
ggplot(prev.N300) +
  aes(fill = k.wprev.N300.RInf) +
  geom_sf(colour = "transparent") +
  scale_fill_gradientn(colors = prevR.colors.red()) +
  theme_prevR_light()

# Export k.wprev.N300.RInf surface in ASCII Grid
r &lt;- terra::rast(stars::st_rasterize(prev.N300))
# writeRaster(r[[2]], "kprev.N300.asc")

## End(Not run)

</code></pre>


</div>