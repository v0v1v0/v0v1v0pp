<div class="container">

<table style="width: 100%;"><tr>
<td>pairwiseCI</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Wrapper function for two-sample confidence intervals</h2>

<h3>Description</h3>

<p>Confidence intervals (CI) for difference or ratio of location parameters of two independent samples.
The CI are NOT adjusted for multiplicity by default. A by statement allows for separate calculation
of pairwise comparisons according to further factors in the given dataframe. 
The function applies the intervals available from t.test(stats) for difference of means with
and without assumptions of homogeneous variances; large sample approximations for the difference and ratio of means of lognormal data; the exact CI for difference (wilcox.exact(exactRankTests))
and ratio of location based on the Hodges-Lehmann estimator; bootstrap intervalls for ratio and difference
of Medians and Harrell-Davis estimators a more robust alternatives to the Hodges-Lehmann estimator (boot, Hmisc); 
the Score test derived CI for the difference (prop.test(stats)), Woolf-interval for the odds-ratio
and a crude asymptotic as well as an iterative interval for the ratio of proportions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pairwiseCI(formula, data, by = NULL,
 alternative = "two.sided", conf.level = 0.95,
 method = "Param.diff", control = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p> A formula of the structure <kbd>response ~ treatment</kbd> for numerical variables,
and of structure <kbd>cbind(success, failure)</kbd> <kbd>~ treatment</kbd> for binomial variables </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> A data.frame containing the numerical response variable and the treatment
and by variable as factors. Note, that for binomial data, two columns containing the number
of successes and failures must be present in the data. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p> A character string or character vector giving the name(s) of additional
factors by which the data set is to be split. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p> Character string, either "two.sided", "less" or "greater"  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p> The comparisonwise confidence level of the intervals, where 0.95 is default </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p> A character string specifying the confidence interval method, with the following options
<kbd>"Param.diff"</kbd>: Difference of two means, with additional argument <kbd>var.equal=FALSE</kbd>(default) as in <kbd>t.test(stats)</kbd>,
<kbd>"Param.ratio"</kbd>: Ratio of two means, with additional argument <kbd>var.equal=FALSE</kbd>(default) as in <kbd>ttestratio(mratios)</kbd>,
<kbd>"Lognorm.diff"</kbd>: Difference of two means, assuming a lognormal distribution, based on generalized pivotal quantities,
<kbd>"Lognorm.ratio"</kbd>: Ratio of two means, assuming a lognormal distribution, based on generalized pivotal quantities,
<kbd>"np.re"</kbd>: nonparametric confidence interval for relative effects suitable for the Behrens Fisher problem,
<kbd>"HL.diff"</kbd>: Exact conditional nonparametric CI for difference of locations based on the Hodges-Lehmann estimator,
<kbd>"HL.ratio"</kbd>: Exact conditional nonparametric CI for ratio of locations, based on the Hodges-Lehmann estimator,
<kbd>"Median.diff"</kbd>: Nonparametric CI for difference of locations, based on the medians (percentile bootstrap, stratified by the grouping variable),
<kbd>"Median.ratio"</kbd>: Nonparametric CI for ratio of locations, based on the medians (percentile bootstrap, stratified by the grouping variable),
<kbd>"Negbin.ratio"</kbd>: Profile-likelihood CI for ratio of expected values assuming the negative binomial distribution, adapting code from the profile function of MASS (Venables and Ripley,2002),
<kbd>"Quasipoisson.ratio"</kbd>: Profile-deviance CI for the ratio of expected values with a quasipoisson assumption, using the adapted code of the profile function in MASS 
<kbd>"Poisson.ratio"</kbd>: Profile-likelihood CI for the ratio of expected values with a Poisson assumption, again using slightly changed code from MASS,
<kbd>"Prop.diff"</kbd>: Asymptotic CI for the difference of proportions with the following options: <kbd>CImethod="NHS"</kbd> Newcombes Hybrid Score interval (Newcombe, 1998), <kbd>CImethod="CC"</kbd> continuity corrected interval (Newcombe, 1998) as implemented in <kbd>prop.test(stats)</kbd>,  <kbd>CImethod="AC"</kbd> Agresti-Caffo interval (Agresti and Caffo, 2000)
<kbd>"Prop.ratio"</kbd>: Asymptotic CI (normal approximation on the log: <kbd>CImethod="GNC"</kbd>) or iterative CI (<kbd>CImethod="Score"</kbd>) for ratio of proportions,
<kbd>"Prop.or"</kbd>: Asymptotic CI for the odds ratio (normal approximation on the log: <kbd>CImethod="Woolf"</kbd>), or the exact CI corresponding to Fishers exact test (<kbd>CImethod="Exact"</kbd>, taken from <kbd>fisher.test</kbd>, package <kbd>stats</kbd>)
See <kbd>?pairwiseCImethods</kbd> for details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p> Character string, specifying one of the levels of the treatment variable as 
control group in the comparisons; default is NULL, then CI for all pairwise comparisons are calculated. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments to be passed to the functions specified in <code>pairwiseCImethodsCont</code>, <code>pairwiseCImethodsCount</code> and <code>pairwiseCImethodsProp</code>. 
In particular, different methods to calculate confidence intervals can be specified via the argument <kbd>CImethod</kbd> for the comparison of binomial proportions, see details in <code>pairwiseCImethodsProp</code>. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that all the computed intervals are without adjustment for multiplicity by default. 
When based on crude normal approximations or crude non-parametric bootstrap methods, the derived confidence intervals can be unreliable for small sample sizes.
The method implemented here split the data set into small subsets (according to the grouping variable in <kbd>formula</kbd> and the variable specified in <kbd>by</kbd>)
and compute confidence intervals only based each particular subset. Please note that, when a (generalized) linear model can be reasonable assumed to describe the 
complete data set, it is smarter to compute confidence intervals based on the model estimators. Methods to do this are, e.g., implemented in the packages <span class="pkg">stats</span>, <span class="pkg">multcomp</span>, <span class="pkg">mratios</span>.
</p>


<h3>Value</h3>

<p>an object of class "pairwiseCI" structured as:
</p>
<p>a list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>byout</code></td>
<td>
<p>A named list, ordered by the levels of the by-factor, where each element is a list
containing the numeric vectors <kbd>estimate</kbd>, <kbd>lower</kbd>, <kbd>upper</kbd> and the character vector <kbd>compnames</kbd></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bynames</code></td>
<td>
<p>the level names of the by-factor</p>
</td>
</tr>
</table>
<p>and further elements as input, try str() for details.
</p>
<p>the object is printed by <code>print.pairwiseCI</code>.
</p>


<h3>References</h3>

 

<ul>
<li> <p><kbd>Param.diff</kbd> simply uses: <kbd>t.test</kbd> in <span class="pkg">stats</span>, note that the default setting assums possibly heterogeneous variances (<kbd>var.equal=FALSE</kbd>).
</p>
</li>
<li> <p><kbd>Param.ratio</kbd> for homogeneous variances (<kbd>var.equal=TRUE</kbd>): <b>Fieller EC (1954):</b> Some problems in interval estimation. Journal of the Royal Statistical Society, Series B, 16, 175-185.
</p>
</li>
<li> <p><kbd>Param.ratio</kbd> for heterogenous variances (<kbd>var.equal=FALSE</kbd>): : the test proposed in: <b>Tamhane, AC, Logan, BR (2004):</b> Finding the maximum safe dose level for heteroscedastic data. Journal of Biopharmaceutical Statistics 14, 843-856.
is inverted by solving a quadratic equation according to Fieller, where the estimated ratio is simply plugged in order to get Satterthwaite approximated degrees of freedom.
See also: <b>Hasler, M,  Vonk, R, Hothorn, LA:</b> Assessing non-inferiority of a new treatment in a three arm trial in the presence of heteroscedasticity. Statistics in Medicine 2007 (in press).
</p>
</li>
<li> <p><kbd>Lognorm.ratio</kbd> and <kbd>Lognorm.ratio</kbd>: <b>Chen, Y-H, Zhou, X-H (2006)</b>: Interval estimates for the ratio and the difference of two lognormal means.
Statistics in Medicine 25, 4099-4113.
</p>
</li>
<li> <p><kbd>Np.re</kbd>: <b>Brunner, E., Munzel, U. (2000).</b> The Nonparametric Behrens-Fisher Problem: Asymptotic Theory and a Small Sample Approximation. Biometrical Journal 42, 17 -25.
<b>Neubert, K., Brunner, E., (2006).</b> A Studentized Permutation Test for the Nonparametric Behrens-Fisher Problem. Computational Statistics and Data Analysis.
</p>
</li>
<li> <p><kbd>HL.diff</kbd>: <kbd>wilcox.exact</kbd> in <span class="pkg">exactRankTests</span> 
</p>
</li>
<li> <p><kbd>HL.ratio</kbd>: <b>Hothorn, T, Munzel, U:</b> Non-parametric confidence interval for the ratio. Report University of Erlangen, Department Medical Statistics 2002;
available via: http://www.imbe.med.uni-erlangen.de/~hothorn/
For the Hodges-Lehmann estimator see: <b>Hodges, J.L., Lehmann E.L.(1963):</b> Estimates of location based on rank tests. Ann. Math. Statist. 34, 598-611.
</p>
</li>
<li> <p><kbd>Median.diff</kbd>: The interval is calculated from a bootstrap sample (stratified according to the group variable) of the difference of sample Medians, using package boot.
</p>
</li>
<li> <p><kbd>Median.ratio</kbd>: The interval is calculated from a bootstrap sample (stratified according to the group variable) of the ratio of sample Medians, using package boot.
</p>
<p>Note, that the 4 bootstrap versions will hardly make sense for small samples, because of the discreteness of the resulting bootstrap sample.
</p>
</li>
<li> <p><kbd>Poisson.ratio</kbd>: Profile-likelihood CI, based on the assumption of a Poisson distribution, basic method described in <b>Venables, W.N., Ripley, B.D. (2002):</b> Modern Applied Statistics with S. Springer Verlag, New York.
</p>
</li>
<li> <p><kbd>Quasipoisson.ratio</kbd>: Profile-deviance CI, based on the quasipoisson assumption, basic method  described in Venables, <b>W.N., Ripley, B.D. (2002):</b> Modern Applied Statistics with S. Springer Verlag, New York.
</p>
</li>
<li> <p><kbd>Negbin.ratio</kbd>: Profile-likelihood CI, based on the assumption of the negative binomial distribution, basic method  described in <b>Venables, W.N., Ripley, B.D. (2002):</b> Modern Applied Statistics with S. Springer Verlag, New York.
</p>
</li>
<li> <p><kbd>Prop.diff</kbd>: provides three approximate methods to calculate confidence intervals for the difference of proportions: Default is <kbd>CImethod="NHS"</kbd>: Newcombes Hybrid Score interval (Newcombe, 1998), other options are <kbd>CImethod="CC"</kbd> continuity corrected interval (Newcombe, 1998) as implemented in <kbd>prop.test(stats)</kbd> and <kbd>CImethod="AC"</kbd> Agresti-Caffo interval (Agresti and Caffo, 2000) 
<b>Newcombe R.G. (1998):</b> Interval Estimation for the Difference Between Independent Proportions: Comparison of Eleven Methods. Statistics in Medicine 17, 873-890. 
</p>
</li>
<li> <p><kbd>Prop.ratio</kbd> calculates the crude asymptotic interval (normal approximation on the log-scale, <kbd>CImethod="GNC"</kbd>) or the Score interval (<kbd>CImethod="Score"</kbd>), both described in:
<b>Gart, JJ and Nam, J (1988)</b>: Approximate interval estimation of the ratio of binomial parameters: A review and corrections for skewness.
Biometrics 44, 323-338. 
</p>
</li>
<li> <p><kbd>Prop.or</kbd> Adjusted Woolf interval (<kbd>CImethod="Woolf"</kbd>), e.g. in: <b>Lawson, R (2005):</b> Small sample confidence intervals for the odds ratio. Communication in Statistics Simulation and Computation, 33, 1095-1113.
or the exact interval corresponding to Fishers exact test (<kbd>CImethod="Exact"</kbd>, taken from <kbd>fisher.test(stats)</kbd>, see references there)
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>as.data.frame.pairwiseCI</code> to create a data.frame from the output,
<code>summary.pairwiseCI</code> to create a more easily accessable list from the output,
<code>plot.pairwiseCI</code> to plot the intervals.
Further, see 
<span class="pkg">multcomp</span> for simultaneous intervals for difference for various contrasts,
<span class="pkg">mratios</span> for simultaneous intervals for the ratio of means,
<span class="pkg">stats</span> <kbd>p.adjust</kbd>, <kbd>pairwise.t.test</kbd>, <kbd>pairwise.prop.test</kbd>, <kbd>pairwise.wilcox.test</kbd>,
<kbd>TukeyHSD</kbd> for methods of multiple comparisons.</p>


<h3>Examples</h3>

<pre><code class="language-R">
# some examples:
# In many cases the shown examples might not make sense,
# but display how the functions can be used.

data(Oats)

# # all pairwise comparisons,
# separately for each level of nitro:

apc &lt;- pairwiseCI(yield ~ Variety, data=Oats,
 by="nitro", method="Param.diff")

apc

plot(apc)

# # many to one comparisons, with variety Marvellous as control,
# for each level of nitro separately:

m21 &lt;- pairwiseCI(yield ~ Variety, data=Oats,
 by="nitro", method="Param.diff", control="Marvellous")

 plot(m21)

# # the same using confidence intervals for the ratio of means:

m21 &lt;- pairwiseCI(yield ~ Variety, data=Oats,
 by="nitro", method="Param.diff", control="Marvellous")

 plot(m21, CIvert=TRUE, H0line=0.9)

###############################################

# The repellent data set (a trial on repellent 
# effect of sulphur on honey bees): Measured was
# the decrease of sugar solutions (the higher the decrease,
# the higher the feeding, and the less the repellent effect).
# Homogeneity of variances is questionable. Which of the doses
# leads to decrease of the variable decrease compared to the
# control group "H"?

data(repellent)
boxplot(decrease ~ treatment, data=repellent)

# as difference to control (corresponding to Welch tests)
beeCId&lt;-pairwiseCI(decrease ~ treatment, data=repellent,
 method="Param.diff", control="H", alternative="less",
 var.equal=FALSE)
beeCId
plot(beeCId)

# as ratio to control:

## Not run: 
beeCIr&lt;-pairwiseCI(decrease ~ treatment, data=repellent,
 method="Param.ratio", control="H", alternative="less",
 var.equal=FALSE)
beeCIr
plot(beeCIr)

# Bonferroni-adjustment can be applied:

beeCIrBonf&lt;-pairwiseCI(decrease ~ treatment, data=repellent,
 method="Param.ratio", control="H", alternative="less",
 var.equal=FALSE, conf.level=1-0.05/7)
beeCIrBonf
plot(beeCIrBonf)

## End(Not run)

##############################################

# Proportions:

# The rooting example:
# Calculate confidence intervals for the 
# difference of proportions between the 3 doses of IBA,
# separately for 4 combinations of "Age" and "Position".
# Note: we pool over Rep in that way. Whether this makes
# sense or not, is decision of the user.

data(rooting)

# Risk difference

aprootsRD&lt;-pairwiseCI(cbind(root, noroot) ~ IBA,
 data=rooting, by=c("Age", "Position"), method="Prop.diff")

aprootsRD

# Odds ratio


aprootsOR&lt;-pairwiseCI(cbind(root, noroot) ~ IBA,
 data=rooting, by=c("Age", "Position"), method="Prop.or")

aprootsOR

# Risk ratio

aprootsRR&lt;-pairwiseCI(cbind(root, noroot) ~ IBA,
 data=rooting, by=c("Age", "Position"), method="Prop.ratio")

aprootsRR

# CI can be plotted:

plot(aprootsRR)

###############################################

# CIs assuming lognormal distribution of the response:

resp&lt;-rlnorm(n=20, meanlog = 0, sdlog = 1)
treat&lt;-as.factor(rep(c("A","B")))
datln&lt;-data.frame(resp=resp, treat=treat)

pairwiseCI(resp~treat, data=datln, method="Lognorm.diff")
pairwiseCI(resp~treat, data=datln,  method="Lognorm.ratio")

</code></pre>


</div>