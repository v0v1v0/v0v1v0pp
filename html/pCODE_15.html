<div class="container">

<table style="width: 100%;"><tr>
<td>pcode</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Parameter Cascade Method for Ordinary Differential Equation Models</h2>

<h3>Description</h3>

<p>Obtain estimates of both structural and nuisance parameters of an ODE model by parameter cascade method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pcode(data, time, ode.model, par.names, state.names,
             likelihood.fun, par.initial, basis.list,lambda,controls)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame or a matrix contain observations from each dimension of the ODE model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>A vector contain observation times or a matrix if time points are different between dimensions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ode.model</code></td>
<td>
<p>An R function that computes the time derivative of the ODE model given observations of states variable and structural parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.names</code></td>
<td>
<p>The names of structural parameters defined in the 'ode.model'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state.names</code></td>
<td>
<p>The names of state variables defined in the 'ode.model'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>likelihood.fun</code></td>
<td>
<p>A likelihood function passed to PCODE in case of that the error terms do not have a Normal distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.initial</code></td>
<td>
<p>Initial value of structural parameters to be optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>basis.list</code></td>
<td>
<p>A list of basis objects for smoothing each dimension's observations. Can be the same or different across dimensions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>Penalty parameter for controling the fidelity of interpolation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>controls</code></td>
<td>
<p>A list of control parameters. See Details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>controls</code> argument is a list providing addition inputs for the nonlinear least square optimizer or general optimizer <code>optim</code>:
</p>

<dl>
<dt><code>nquadpts</code></dt>
<dd>
<p>Determine the number of quadrature points for approximating an integral. Default is 101.</p>
</dd>
<dt><code>smooth.lambda</code></dt>
<dd>
<p>Determine the smoothness penalty for obtaining initial value of nuisance parameters.</p>
</dd>
<dt><code>tau</code></dt>
<dd>
<p>Initial value of Marquardt parameter. Small values indicate good initial values for structural parameters.</p>
</dd>
<dt><code>tolx</code></dt>
<dd>
<p>Tolerance for parameters of objective functions. Default is set at 1e-6.</p>
</dd>
<dt><code>tolg</code></dt>
<dd>
<p>Tolerance for the gradient of parameters of objective functions. Default is set at 1e-6.</p>
</dd>
<dt><code>maxeval</code></dt>
<dd>
<p>The maximum number of evaluation of the outter optimizer. Default is set at 20.</p>
</dd>
</dl>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>structural.par</code></td>
<td>
<p>The structural parameters of the ODE model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nuisance.par</code></td>
<td>
<p>The nuisance parameters or the basis coefficients for interpolating observations.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">library(fda)
library(deSolve)
library(MASS)
library(pracma)
#Simple ode model example
#define model parameters
model.par   &lt;- c(theta = c(0.1))
#define state initial value
state       &lt;- c(X     = 0.1)
#Define model for function 'ode' to numerically solve the system
ode.model &lt;- function(t, state,parameters){
 with(as.list(c(state,parameters)),
      {
        dX &lt;- theta*X*(1-X/10)
        return(list(dX))
      })
}
#Observation time points
times &lt;- seq(0,100,length.out=101)
#Solve the ode model
desolve.mod &lt;- ode(y=state,times=times,func=ode.model,parms = model.par)
#Prepare for doing parameter cascading method
#Generate basis object for interpolation and as argument of pcode
#21 konts equally spaced within [0,100]
knots &lt;- seq(0,100,length.out=21)
#order of basis functions
norder &lt;- 4
#number of basis funtions
nbasis &lt;- length(knots) + norder - 2
#creating Bspline basis
basis  &lt;- create.bspline.basis(c(0,100),nbasis,norder,breaks = knots)
#Add random noise to ode solution for simulating data
nobs  &lt;- length(times)
scale &lt;- 0.1
noise &lt;- scale*rnorm(n = nobs, mean = 0 , sd = 1)
observation &lt;- desolve.mod[,2] + noise
#parameter estimation
pcode(data = observation, time = times, ode.model = ode.model,
                     par.initial = 0.1, par.names = 'theta',state.names = 'X',
                     basis.list = basis, lambda = 1e2)

</code></pre>


</div>