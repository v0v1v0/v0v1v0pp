<div class="container">

<table style="width: 100%;"><tr>
<td>data.preproc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Data preprocessing
Apply at the beginning of <code>pmcount()</code> and <code>cvcount()</code>, after <code>arg.checks()</code>
</h2>

<h3>Description</h3>

<p>Data preprocessing
Apply at the beginning of <code>pmcount()</code> and <code>cvcount()</code>, after <code>arg.checks()</code>
</p>


<h3>Usage</h3>

<pre><code class="language-R">data.preproc(
  fun,
  cate.model,
  ps.model,
  data,
  prop.cutoff = NULL,
  prop.multi = NULL,
  ps.method,
  initial.predictor.method = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>A function for which argument check is needed; "pm" for <code>pmcount()</code>, "cv" for <code>cvcount()</code>,
and "drinf" for <code>drcount.inference()</code>. No default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cate.model</code></td>
<td>
<p>A formula describing the outcome model to be fitted.
The outcome must appear on the left-hand side.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps.model</code></td>
<td>
<p>A formula describing the propensity score model to be fitted.
The treatment must appear on the left-hand side. The treatment must be a numeric vector
coded as 0/1. If data are from a RCT, specify <code>ps.model</code> as an intercept-only model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the variables in the outcome and propensity score models;
a data frame with <code>n</code> rows (1 row per observation).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop.cutoff</code></td>
<td>
<p>A vector of numerical values (in '(0, 1]') specifying percentiles of the
estimated log CATE scores to define nested subgroups. Each element represents the cutoff to
separate observations in nested subgroups (below vs above cutoff).
The length of <code>prop.cutoff</code> is the number of nested subgroups.
An equally-spaced sequence of proportions ending with 1 is recommended.
Default is <code>seq(0.5, 1, length = 6)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop.multi</code></td>
<td>
<p>A vector of numerical values (in '[0, 1]') specifying percentiles of the
estimated log CATE scores to define mutually exclusive subgroups.
It should start with 0, end with 1, and be of <code>length(prop.multi) &gt; 2</code>.
Each element represents the cutoff to separate the observations into
<code>length(prop.multi) - 1</code> mutually exclusive subgroups.
Default is <code>c(0, 1/3, 2/3, 1)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps.method</code></td>
<td>
<p>A character value for the method to estimate the propensity score.
Allowed values include one of:
<code>'glm'</code> for logistic regression with main effects only (default), or
<code>'lasso'</code> for a logistic regression with main effects and LASSO penalization on
two-way interactions (added to the model if interactions are not specified in <code>ps.model</code>).
Relevant only when <code>ps.model</code> has more than one variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.predictor.method</code></td>
<td>
<p>A character vector for the method used to get initial
outcome predictions conditional on the covariates. Only applies when <code>score.method</code>
includes <code>'twoReg'</code> or <code>'contrastReg'</code>. Allowed values include one of
<code>'boosting'</code>, <code>'poisson'</code> (fast), and <code>'gam'</code>. Default is <code>NULL</code>, which assigns
<code>'boosting'</code> for count outcomes.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of 6 elements:
- y: outcome; vector of length <code>n</code> (observations)
- trt: binary treatment; vector of length <code>n</code>
- x.ps: matrix of <code>p.ps</code> baseline covariates (plus intercept); dimension <code>n</code> by <code>p.ps + 1</code>
- x.cate: matrix of <code>p.cate</code> baseline covariates; dimension <code>n</code> by <code>p.cate</code>
- time: offset; vector of length <code>n</code>
- if <code>fun = "pm"</code>:
- prop: formatted <code>prop.cutoff</code>
- if <code>fun = "cv"</code>
- prop.onlyhigh: formatted <code>prop.cutoff</code> with 0 removed if applicable
- prop.bi; formatted <code>prop.cutoff</code> with 0 and 1 removed if applicable
- prop.multi: formatted <code>prop.multi</code>, starting with 0 and ending with 1
</p>


</div>