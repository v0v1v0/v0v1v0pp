<div class="container">

<table style="width: 100%;"><tr>
<td>ph_ensemble</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Classify phenotypes via ensemble learning.</h2>

<h3>Description</h3>

<p>The <code>ph_ensemble</code> function uses classification predictions from a list of algorithms to train an ensemble model.
This can be a list of manually trained algorithms from <code>train</code> or, more conveniently, the output from <code>ph_train</code>.
The hyperparameter tuning and model evaluations are handled internally to simplify the ensembling process. This function
assumes some preprocessing has been performed, hence the training, validation, and test set requirements.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ph_ensemble(
  train_models,
  train_df,
  vali_df,
  test_df,
  class_col,
  ctrl,
  train_seed = 123,
  n_cores = 2,
  task = "multi",
  metric = ifelse(task == "multi", "Kappa", "ROC"),
  top_models = 3,
  metalearner = ifelse(task == "multi", "glmnet", "rf"),
  tune_length = 10,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>train_models</code></td>
<td>
<p>A <code>list</code> of at least two <code>train</code> models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>train_df</code></td>
<td>
<p>A <code>data.frame</code> containing a class column and the training data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vali_df</code></td>
<td>
<p>A <code>data.frame</code> containing a class column and the validation data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_df</code></td>
<td>
<p>A <code>data.frame</code> containing a class column and the test data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>class_col</code></td>
<td>
<p>A <code>character</code> value for the name of the class column. This should be consistent across data frames.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctrl</code></td>
<td>
<p>A <code>list</code> containing the resampling strategy (e.g., "boot") and other parameters for <code>trainControl</code>. Automatically create one via <code>ph_ctrl</code> or manually create it with <code>trainControl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>train_seed</code></td>
<td>
<p>A <code>numeric</code> value to set the training seed and control the randomness of creating resamples: 123 (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_cores</code></td>
<td>
<p>An <code>integer</code> value for the number of cores to include in the cluster: 2 (default). We highly recommend increasing this value to, e.g., parallel::detectCores() - 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>task</code></td>
<td>
<p>A <code>character</code> value for the type of classification <code>task</code>: "multi" (default), "binary".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>A <code>character</code> value for which summary metric should be used to select the optimal model: "ROC" (default for "binary") and "Kappa" (default for "multi"). Other options include "logLoss", "Accuracy", "Mean_Balanced_Accuracy", and "Mean_F1".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>top_models</code></td>
<td>
<p>A <code>numeric</code> value for the top n training models to ensemble: 3 (default). Every training model is ordered according to their final metric value (e.g., "ROC" or "Kappa") and the top n models are selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metalearner</code></td>
<td>
<p>A <code>character</code> value for the algorithm used to train the ensemble: "glmnet" (default), "rf". Other methods, such as those listed in ph_train methods, may also be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tune_length</code></td>
<td>
<p>If <code>search = "random"</code> (default), this is an <code>integer</code> value for the maximum number of hyperparameter combinations to test for each training model in the ensemble; if <code>search = "grid"</code>, this is an <code>integer</code> value for the number of levels of each hyperparameter to test for each model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>A <code>logical</code> value for whether progress should be printed: TRUE (default), FALSE.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list containing the following components:</p>

<table>
<tr>
<td style="text-align: left;">
<code>ensemble_test_preds</code> </td>
<td style="text-align: left;"> The ensemble predictions for the test set. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vali_preds</code> </td>
<td style="text-align: left;"> The validation predictions for the top models. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>test_preds</code> </td>
<td style="text-align: left;"> The test predictions for the top models. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>all_test_preds</code> </td>
<td style="text-align: left;"> The test predictions for every successfully trained model. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>all_test_results</code> </td>
<td style="text-align: left;"> The confusion matrix results obtained from comparing the model test predictions (i.e., original models and ensemble) against the actual test classes.  </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ensemble_model</code> </td>
<td style="text-align: left;"> The ensemble <code>train</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>var_imps</code> </td>
<td style="text-align: left;"> The ensemble variable importances obtained via weighted averaging. The original train importances are multiplied by the model's importance in the ensemble, then averaged across models and normalized.  </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>train_df</code> </td>
<td style="text-align: left;"> The training data frame. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vali_df</code> </td>
<td style="text-align: left;"> The validation data frame. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>test_df</code> </td>
<td style="text-align: left;"> The test data frame. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>train_models</code> </td>
<td style="text-align: left;"> The <code>train</code> models for the ensemble. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ctrl</code> </td>
<td style="text-align: left;"> A <code>trainControl</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>metric</code> </td>
<td style="text-align: left;"> The summary metric used to select the optimal model. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>task</code> </td>
<td style="text-align: left;"> The type of classification task. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>tune_length</code> </td>
<td style="text-align: left;"> The maximum number of hyperparameter combinations ("random") or individual hyperparameter depth ("grid").  </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>top_models</code> </td>
<td style="text-align: left;"> The number of top methods selected for the ensemble.  </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>metalearner</code> </td>
<td style="text-align: left;"> The algorithm used to train the ensemble. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">## Import data.
data(ph_crocs)

## Remove anomalies with autoencoder.
rm_outs &lt;- ph_anomaly(df = ph_crocs, ids_col = "Biosample",
                      class_col = "Species", method = "ae")
## Preprocess anomaly-free data frame into train, validation, and test sets
## with PCs as predictors.
pc_dfs &lt;- ph_prep(df = rm_outs$df, ids_col = "Biosample",
                  class_col = "Species", vali_pct = 0.15,
                  test_pct = 0.15, method = "pca")
## Echo control object for train function.
ctrl &lt;- ph_ctrl(ph_crocs$Species, resample_method = "boot")
## Train all models for ensemble.
## Note: Increasing n_cores will dramatically reduce train time.
train_models &lt;- ph_train(train_df = pc_dfs$train_df,
                         vali_df = pc_dfs$vali_df,
                         test_df = pc_dfs$test_df,
                         class_col = "Species",
                         ctrl = ctrl,
                         task = "multi",
                         methods = "all",
                         tune_length = 5,
                         quiet = FALSE)
## You can also train just a few, although more is preferable.
## Note: Increasing n_cores will dramatically reduce train time.
train_models &lt;- ph_train(train_df = pc_dfs$train_df,
                         vali_df = pc_dfs$vali_df,
                         test_df = pc_dfs$test_df,
                         class_col = "Species",
                         ctrl = ctrl,
                         task = "multi",
                         methods = c("lda", "mda",
                         "nnet", "pda", "sparseLDA"),
                         tune_length = 5,
                         quiet = FALSE)
## Train the ensemble.
## Note: Increasing n_cores will dramatically reduce train time.
ensemble_model &lt;- ph_ensemble(train_models = train_models$train_models,
                              train_df = pc_dfs$train_df,
                              vali_df = pc_dfs$vali_df,
                              test_df = pc_dfs$test_df,
                              class_col = "Species",
                              ctrl = ctrl,
                              task = "multi",
                              top_models = 3,
                              metalearner = "glmnet",
                              tune_length = 25,
                              quiet = FALSE)

</code></pre>


</div>