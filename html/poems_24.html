<div class="container">

<table style="width: 100%;"><tr>
<td>SimulationManager</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>R6 class representing a simulation manager.</h2>

<h3>Description</h3>

<p><code>R6</code> class to represent a manager for running multiple model
simulations and saving results.
</p>


<h3>Super classes</h3>

<p><code>poems::GenericClass</code> -&gt; <code>poems::GenericManager</code> -&gt; <code>SimulationManager</code>
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>attached</code></dt>
<dd>
<p>A list of dynamically attached attributes (name-value pairs).</p>
</dd>
</dl>
</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>sample_data</code></dt>
<dd>
<p>A data frame of sampled parameters for each simulation/result.</p>
</dd>
<dt><code>model_template</code></dt>
<dd>
<p>A <code>SimulationModel</code> (or inherited class) object with parameters common to all simulations.</p>
</dd>
<dt><code>nested_model</code></dt>
<dd>
<p>A <code>SimulationModel</code> (or inherited class) object with empty sample parameters and a nested model template common to all simulations.</p>
</dd>
<dt><code>generators</code></dt>
<dd>
<p>A list of generators (<code>Generator</code> or inherited class) objects for generating simulation model values.</p>
</dd>
<dt><code>model_simulator</code></dt>
<dd>
<p>A <code>ModelSimulator</code> (or inherited class) object for running the simulations.</p>
</dd>
<dt><code>parallel_cores</code></dt>
<dd>
<p>Number of cores for running the simulations in parallel.</p>
</dd>
<dt><code>results_dir</code></dt>
<dd>
<p>Results directory path.</p>
</dd>
<dt><code>results_ext</code></dt>
<dd>
<p>Result file extension (default is .RData).</p>
</dd>
<dt><code>results_filename_attributes</code></dt>
<dd>
<p>A vector of: prefix (optional); attribute names (from the sample data frame); postfix (optional); utilized to construct results filenames.</p>
</dd>
<dt><code>error_messages</code></dt>
<dd>
<p>A vector of error messages encountered when setting model attributes.</p>
</dd>
<dt><code>warning_messages</code></dt>
<dd>
<p>A vector of warning messages encountered when setting model attributes.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-SimulationManager-new"><code>SimulationManager$new()</code></a>
</p>
</li>
<li> <p><a href="#method-SimulationManager-run"><code>SimulationManager$run()</code></a>
</p>
</li>
<li> <p><a href="#method-SimulationManager-set_model_sample"><code>SimulationManager$set_model_sample()</code></a>
</p>
</li>
<li> <p><a href="#method-SimulationManager-log_simulation"><code>SimulationManager$log_simulation()</code></a>
</p>
</li>
<li> <p><a href="#method-SimulationManager-clone"><code>SimulationManager$clone()</code></a>
</p>
</li>
</ul>
<details open><summary>Inherited methods</summary><ul>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericClass" data-id="new_clone"><a href="../../poems/html/GenericClass.html#method-GenericClass-new_clone"><code>poems::GenericClass$new_clone()</code></a></span></li>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericManager" data-id="get_attribute"><a href="../../poems/html/GenericManager.html#method-GenericManager-get_attribute"><code>poems::GenericManager$get_attribute()</code></a></span></li>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericManager" data-id="get_message_sample"><a href="../../poems/html/GenericManager.html#method-GenericManager-get_message_sample"><code>poems::GenericManager$get_message_sample()</code></a></span></li>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericManager" data-id="get_results_filename"><a href="../../poems/html/GenericManager.html#method-GenericManager-get_results_filename"><code>poems::GenericManager$get_results_filename()</code></a></span></li>
</ul></details><hr>
<a id="method-SimulationManager-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Initialization method sets any included attributes (<em>sample_data</em>, <em>model_template</em>, <em>generators</em>, <em>model_simulator</em>, <em>parallel_cores</em>, <em>results_dir</em>, <em>results_filename_attributes</em>) and attaches other attributes individually listed.
</p>


<h5>Usage</h5>

<div class="r"><pre>SimulationManager$new(model_template = NULL, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>model_template</code></dt>
<dd>
<p>A SimulationModel (or inherited class) object with parameters common to all simulations.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Parameters listed individually.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-SimulationManager-run"></a>



<h4>Method <code>run()</code>
</h4>

<p>Runs the multiple population simulations (via the set function), stores the results, and creates/writes a simulation log.
</p>


<h5>Usage</h5>

<div class="r"><pre>SimulationManager$run(results_dir = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>results_dir</code></dt>
<dd>
<p>Results directory path (must be present if not already set within manager class object).</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>Simulator log as a list.
</p>


<hr>
<a id="method-SimulationManager-set_model_sample"></a>



<h4>Method <code>set_model_sample()</code>
</h4>

<p>Sets the model sample attributes via the sample data frame and the generators.
</p>


<h5>Usage</h5>

<div class="r"><pre>SimulationManager$set_model_sample(model, sample_index)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>model</code></dt>
<dd>
<p><code>SimulationModel</code> (or inherited class) object (clone) to receive sample attributes.</p>
</dd>
<dt><code>sample_index</code></dt>
<dd>
<p>Index of sample from data frame.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-SimulationManager-log_simulation"></a>



<h4>Method <code>log_simulation()</code>
</h4>

<p>Summarizes the simulation log generated within the run method and writes it to a text file in the results directory.
</p>


<h5>Usage</h5>

<div class="r"><pre>SimulationManager$log_simulation(simulation_log)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>simulation_log</code></dt>
<dd>
<p>Nested list of simulation log entries generated via the run method.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-SimulationManager-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>SimulationManager$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Examples</h3>

<pre><code class="language-R">
# U Island example region
coordinates &lt;- data.frame(
  x = rep(seq(177.01, 177.05, 0.01), 5),
  y = rep(seq(-18.01, -18.05, -0.01), each = 5)
)
template_raster &lt;- Region$new(coordinates = coordinates)$region_raster # full extent
template_raster[][-c(7, 9, 12, 14, 17:19)] &lt;- NA # make U Island
region &lt;- Region$new(template_raster = template_raster)
raster::plot(region$region_raster,
  main = "Example region (indices)",
  xlab = "Longitude (degrees)", ylab = "Latitude (degrees)",
  colNA = "blue"
)
# Example population model template
model_template &lt;- PopulationModel$new(
  region = region,
  time_steps = 10, # years
  populations = region$region_cells, # 7
  stage_matrix = 1
)
# Example generators for initial abundance and carrying capacity
hs_matrix &lt;- c(0.5, 0.3, 0.7, 0.9, 0.6, 0.7, 0.8)
initial_gen &lt;- Generator$new(
  description = "initial abundance",
  region = region,
  hs_matrix = hs_matrix, # template attached
  inputs = c("initial_n"),
  outputs = c("initial_abundance")
)
initial_gen$add_generative_requirements(list(initial_abundance = "function"))
initial_gen$add_function_template("initial_abundance",
  function_def = function(params) {
    stats::rmultinom(1,
      size = params$initial_n,
      prob = params$hs_matrix
    )[, 1]
  },
  call_params = c("initial_n", "hs_matrix")
)
capacity_gen &lt;- Generator$new(
  description = "carrying capacity",
  region = region,
  hs_matrix = hs_matrix, # template attached
  inputs = c("density_max"),
  outputs = c("carrying_capacity")
)
capacity_gen$add_generative_requirements(list(carrying_capacity = "function"))
capacity_gen$add_function_template("carrying_capacity",
  function_def = function(params) {
    round(params$density_max * params$hs_matrix)
  },
  call_params = c("density_max", "hs_matrix")
)
# Sample input parameters
sample_data &lt;- data.frame(initial_n = c(40, 60, 80), density_max = c(15, 20, 25))
# Simulation manager
sim_manager &lt;- SimulationManager$new(
  sample_data = sample_data,
  model_template = model_template,
  generators = list(initial_gen, capacity_gen),
  parallel_cores = 2,
  results_dir = tempdir()
)
run_output &lt;- sim_manager$run()
run_output$summary
dir(tempdir(), "*.RData") # includes 3 result files
for (i in 1:3) {
  print(paste("Run", i, "results:"))
  file_name &lt;- paste0(sim_manager$get_results_filename(i), ".RData")
  print(readRDS(file.path(tempdir(), file_name)))
}
dir(tempdir(), "*.txt") # plus simulation log

</code></pre>


</div>