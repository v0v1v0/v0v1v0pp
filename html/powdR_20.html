<div class="container">

<table style="width: 100%;"><tr>
<td>fps.powdRlib</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Full pattern summation</h2>

<h3>Description</h3>

<p><code>fps.powdRlib</code> returns estimates of phase concentrations using full pattern
summation of X-ray powder diffraction data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'powdRlib'
fps(
  lib,
  smpl,
  harmonise,
  solver,
  obj,
  refs,
  std,
  force,
  std_conc,
  omit_std,
  normalise,
  closed,
  tth_align,
  align,
  manual_align,
  tth_fps,
  shift,
  remove_trace,
  weighting,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lib</code></td>
<td>
<p>A <code>powdRlib</code> object representing the reference library. Created using the
<code>powdRlib</code> constructor function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smpl</code></td>
<td>
<p>A data frame. First column is 2theta, second column is counts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>harmonise</code></td>
<td>
<p>logical parameter defining whether to harmonise the <code>lib</code> and <code>smpl</code>.
Default = <code>TRUE</code>. When <code>TRUE</code> the function will harmonise the <code>lib</code> and
<code>smpl</code> to the intersecting 2theta range at the coarsest resolution available using
natural splines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>solver</code></td>
<td>
<p>The optimisation routine to be used. One of <code>"BFGS", "Nelder-Mead",
"CG", "NNLS"</code>. Default = <code>"BFGS"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>The objective function to minimise when "BFGS", "Nelder-Mead",
or "CG" are used as the <code>solver</code> argument. One of <code>"Delta", "R", "Rwp"</code>.
Default = <code>"Rwp"</code>. See Chipera and Bish (2002) and page 247 of Bish and Post (1989)
for definitions of these functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refs</code></td>
<td>
<p>A character string of reference pattern IDs or names from the specified library.
The IDs or names supplied must be present within the <code>lib$phases$phase_id</code> or
<code>lib$phases$phase_name</code> columns. If missing from the function call then all phases in
the reference library will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std</code></td>
<td>
<p>The phase ID (e.g. "QUA.1") to be used as an internal
standard. Must match an ID provided in the <code>refs</code> parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force</code></td>
<td>
<p>An optional string of phase IDs or names specifying which phases should be forced to
remain throughout the automated full pattern summation. The IDs or names supplied must be present
within the <code>lib$phases$phase_id</code> or <code>lib$phases$phase_name</code> columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std_conc</code></td>
<td>
<p>The concentration of the internal standard (if known) in weight percent. If
unknown then omit the argument from the function call or use <code>std_conc = NA</code> (default),
n which case it will be assumed that all phases sum to 100 percent.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omit_std</code></td>
<td>
<p>A logical parameter to be used when the <code>std_conc</code> argument is defined. When
<code>omit_std = TRUE</code> the phase concentrations are recomputed to account for the value supplied in
<code>std_conc</code>. Default <code>= FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalise</code></td>
<td>
<p>deprecated. Please use the <code>omit_std</code> and <code>closed</code> arguments instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>closed</code></td>
<td>
<p>A logical parameter to be used when the <code>std_conc</code> argument is defined and
<code>omit_std = TRUE</code>. When <code>closed = TRUE</code> the internal standard concentration is removed
and the remaining phase concentrations closed to sum to 100 percent. Default <code>= FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tth_align</code></td>
<td>
<p>A vector defining the minimum and maximum 2theta values to be used during
alignment (e.g. <code>c(5,65)</code>). If not defined, then the full range is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>align</code></td>
<td>
<p>The maximum shift that is allowed during initial 2theta
alignment (degrees). Default = 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>manual_align</code></td>
<td>
<p>A logical operator denoting whether to optimise the alignment within the
negative/position 2theta range defined in the <code>align</code> argument, or to use the specified
value of the <code>align</code> argument for alignment of the sample to the standards. Default
= <code>FALSE</code>, i.e. alignment is optimised.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tth_fps</code></td>
<td>
<p>A vector defining the minimum and maximum 2theta values to be used during
full pattern summation (e.g. <code>c(5,65)</code>). If not defined, then the full range is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shift</code></td>
<td>
<p>A single numeric value denoting the maximum (positive or negative) shift,
in degrees 2theta, that is allowed during the shifting of reference patterns. Default = 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove_trace</code></td>
<td>
<p>A single numeric value representing the limit for the concentration
of trace phases to be retained, i.e. any mineral with an estimated concentration below
<code>remove_trace</code> will be omitted. Default = 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>an optional 2 column data frame specifying the 2theta values in the first
column and a numeric weighting vector in the second column that specifies areas of the pattern
to either emphasise (values &gt; 1) or omit (values = 0) when minimising the objective function
defined in the <code>obj</code> argument. Use this weighting parameter with caution. The default
is simply a weighting vector where all values are 1, which hence has no effect on the computed
objective function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Applies full pattern summation (Chipera &amp; Bish, 2002, 2013; Eberl, 2003) to an XRPD
sample to quantify phase concentrations. Requires a <code>powdRlib</code> library of reference
patterns with reference intensity ratios in order to derive mineral
concentrations. Details provided in Butler and Hillier (2021)
</p>


<h3>Value</h3>

<p>a powdRfps object with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>tth</code></td>
<td>
<p>a vector of the 2theta scale of the fitted data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p>a vector of the fitted XRPD pattern</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>measured</code></td>
<td>
<p>a vector of the original XRPD measurement (aligned and harmonised)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>a vector of the residuals (measured minus fitted)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phases</code></td>
<td>
<p>a dataframe of the phases used to produce the fitted pattern and their concentrations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phases_grouped</code></td>
<td>
<p>the phases dataframe grouped by phase_name and concentrations summed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>named vector of the objective parameters summarising the quality of the fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighted_pure_patterns</code></td>
<td>
<p>a dataframe of reference patterns used to produce the fitted pattern.
All patterns have been weighted according to the coefficients used in the fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients used to produce the fitted pattern</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputs</code></td>
<td>
<p>a list of input arguments used in the function call</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Butler, B. M., Hillier, S., 2021.powdR: An R package for quantitative mineralogy using full pattern
summation of X-ray powder diffraction data. Comp. Geo. 147, 104662. doi:10.1016/j.cageo.2020.104662
</p>
<p>Bish, D.L., Post, J.E., 1989. Modern powder diffraction. Mineralogical Society of America.
</p>
<p>Chipera, S.J., Bish, D.L., 2013. Fitting Full X-Ray Diffraction Patterns for Quantitative Analysis:
A Method for Readily Quantifying Crystalline and Disordered Phases. Adv. Mater. Phys. Chem. 03, 47-53.
doi:10.4236/ampc.2013.31A007
</p>
<p>Chipera, S.J., Bish, D.L., 2002. FULLPAT: A full-pattern quantitative analysis program for X-ray powder
diffraction using measured and calculated patterns. J. Appl. Crystallogr. 35, 744-749.
doi:10.1107/S0021889802017405
</p>
<p>Eberl, D.D., 2003. User's guide to RockJock - A program for determining quantitative mineralogy from
powder X-ray diffraction data. Boulder, CA.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Load the minerals library
data(minerals)

# Load the soils data
data(soils)

#Since the reference library is relatively small,
#the whole library can be used at once to get an
#estimate of the phases within each sample.
## Not run: 
fps_sand &lt;-  fps(lib = minerals,
                 smpl = soils$sandstone,
                 refs = minerals$phases$phase_id,
                 std = "QUA.1",
                 align = 0.2)

fps_lime &lt;- fps(lib = minerals,
                smpl = soils$limestone,
                refs = minerals$phases$phase_id,
                std = "QUA.1",
                align = 0.2)

fps_granite &lt;- fps(lib = minerals,
                   smpl = soils$granite,
                   refs = minerals$phases$phase_id,
                   std = "QUA.1",
                   align = 0.2)

#Alternatively run all 3 at once using lapply

fps_soils &lt;- lapply(soils, fps,
                    lib = minerals,
                    std = "QUA.2",
                    refs = minerals$phases$phase_id,
                    align = 0.2)

#Using the rockjock library:

data(rockjock)
data(rockjock_mixtures)

rockjock_1 &lt;- fps(lib = rockjock,
                  smpl = rockjock_mixtures$Mix1,
                  refs = c("ORDERED_MICROCLINE",
                           "LABRADORITE",
                           "KAOLINITE_DRY_BRANCH",
                           "MONTMORILLONITE_WYO",
                           "ILLITE_1M_RM30",
                           "CORUNDUM"),
                  std = "CORUNDUM",
                  align = 0.3)

#Alternatively you can specify the internal standard
#concentration if known:
rockjock_1s &lt;- fps(lib = rockjock,
                 smpl = rockjock_mixtures$Mix1,
                 refs = c("ORDERED_MICROCLINE",
                          "LABRADORITE",
                          "KAOLINITE_DRY_BRANCH",
                          "MONTMORILLONITE_WYO",
                          "ILLITE_1M_RM30",
                          "CORUNDUM"),
                 std = "CORUNDUM",
                 std_conc = 20,
                 align = 0.3)


## End(Not run)
</code></pre>


</div>