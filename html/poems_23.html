<div class="container">

<table style="width: 100%;"><tr>
<td>ResultsManager</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>R6 class representing a results manager.</h2>

<h3>Description</h3>

<p><code>R6</code> class to represent a manager for generating summary
metrics and/or matrices from simulation results, as well as optionally regenerating
values via generators.
</p>


<h3>Super classes</h3>

<p><code>poems::GenericClass</code> -&gt; <code>poems::GenericManager</code> -&gt; <code>ResultsManager</code>
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>attached</code></dt>
<dd>
<p>A list of dynamically attached attributes (name-value pairs).</p>
</dd>
</dl>
</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>sample_data</code></dt>
<dd>
<p>A data frame of sampled parameters for each simulation/result.</p>
</dd>
<dt><code>simulation_results</code></dt>
<dd>
<p>An object of a class inherited from the <code>SimulationResults</code> class for encapsulating and dynamically generating simulation results.</p>
</dd>
<dt><code>generators</code></dt>
<dd>
<p>A list of generators (<code>Generator</code> or inherited class) objects for (optionally) regenerating simulation model values.</p>
</dd>
<dt><code>result_attachment_functions</code></dt>
<dd>
<p>A list of functions for attaching intermediate values to the simulation results prior to generation.</p>
</dd>
<dt><code>summary_metrics</code></dt>
<dd>
<p>An array of names for summary metrics, each of which are calculated as single values for each simulation. These should refer to list names for the summary functions.</p>
</dd>
<dt><code>summary_matrices</code></dt>
<dd>
<p>An array of names for summary matrices, each of which are calculated as a single matrix row for each simulation. These should refer to list names for the summary functions.</p>
</dd>
<dt><code>summary_functions</code></dt>
<dd>
<p>A list of functions, result attributes, or constants for transforming individual simulation results to single summary metric values stored in the metric data frame, or to matrix rows stored in the summary matrix list.</p>
</dd>
<dt><code>summary_metric_data</code></dt>
<dd>
<p>A data frame of generated summary metrics (one row per simulation).</p>
</dd>
<dt><code>summary_matrix_list</code></dt>
<dd>
<p>A list of generated matrices of summary results (each having one row per simulation).</p>
</dd>
<dt><code>summary_matrix_weighted_averages</code></dt>
<dd>
<p>A list of calculated weighted averages for each of the summary matrices (using the sample data <em>weight</em> column).</p>
</dd>
<dt><code>parallel_cores</code></dt>
<dd>
<p>Number of cores for running the simulations in parallel.</p>
</dd>
<dt><code>results_dir</code></dt>
<dd>
<p>Results directory path.</p>
</dd>
<dt><code>results_ext</code></dt>
<dd>
<p>Result file extension (default is .RData).</p>
</dd>
<dt><code>results_filename_attributes</code></dt>
<dd>
<p>A vector of: prefix (optional); attribute names (from the sample data frame); postfix (optional); utilized to construct results filenames.</p>
</dd>
<dt><code>error_messages</code></dt>
<dd>
<p>A vector of error messages encountered when setting model attributes.</p>
</dd>
<dt><code>warning_messages</code></dt>
<dd>
<p>A vector of warning messages encountered when setting model attributes.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-ResultsManager-new"><code>ResultsManager$new()</code></a>
</p>
</li>
<li> <p><a href="#method-ResultsManager-generate"><code>ResultsManager$generate()</code></a>
</p>
</li>
<li> <p><a href="#method-ResultsManager-calculate_result_attachments"><code>ResultsManager$calculate_result_attachments()</code></a>
</p>
</li>
<li> <p><a href="#method-ResultsManager-calculate_summaries"><code>ResultsManager$calculate_summaries()</code></a>
</p>
</li>
<li> <p><a href="#method-ResultsManager-log_generation"><code>ResultsManager$log_generation()</code></a>
</p>
</li>
<li> <p><a href="#method-ResultsManager-calculate_summary_weighted_averages"><code>ResultsManager$calculate_summary_weighted_averages()</code></a>
</p>
</li>
<li> <p><a href="#method-ResultsManager-clone"><code>ResultsManager$clone()</code></a>
</p>
</li>
</ul>
<details open><summary>Inherited methods</summary><ul>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericClass" data-id="new_clone"><a href="../../poems/html/GenericClass.html#method-GenericClass-new_clone"><code>poems::GenericClass$new_clone()</code></a></span></li>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericManager" data-id="get_attribute"><a href="../../poems/html/GenericManager.html#method-GenericManager-get_attribute"><code>poems::GenericManager$get_attribute()</code></a></span></li>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericManager" data-id="get_message_sample"><a href="../../poems/html/GenericManager.html#method-GenericManager-get_message_sample"><code>poems::GenericManager$get_message_sample()</code></a></span></li>
<li><span class="pkg-link" data-pkg="poems" data-topic="GenericManager" data-id="get_results_filename"><a href="../../poems/html/GenericManager.html#method-GenericManager-get_results_filename"><code>poems::GenericManager$get_results_filename()</code></a></span></li>
</ul></details><hr>
<a id="method-ResultsManager-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Initialization method optionally copies attributes from a simulation (results) manager, sets any included attributes (<em>sample_data</em>, <em>simulation_results</em>, <em>generators</em>, <em>result_attachment_functions</em>, <em>summary_metrics</em>, <em>summary_functions</em>, <em>parallel_cores</em>, <em>results_dir</em>, <em>results_ext</em>, <em>results_filename_attributes</em>), and attaches other attributes individually listed.
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$new(simulation_manager = NULL, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>simulation_manager</code></dt>
<dd>
<p>Optional <code>SimulationManager</code> object (or an object inherited from the <code>GenericManager</code> class), from which simulation attributes can be copied.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Parameters listed individually.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ResultsManager-generate"></a>



<h4>Method <code>generate()</code>
</h4>

<p>Generates the summary metric data and/or matrix list via the summary functions for each simulation sample, and creates/writes a generation log.
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$generate(results_dir = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>results_dir</code></dt>
<dd>
<p>Results directory path (must be present if not already set within manager class object).</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>Generation log as a list.
</p>


<hr>
<a id="method-ResultsManager-calculate_result_attachments"></a>



<h4>Method <code>calculate_result_attachments()</code>
</h4>

<p>Calculates and attaches intermediate values to the sample result model (via the result attachment functions).
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$calculate_result_attachments(simulation_results)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>simulation_results</code></dt>
<dd>
<p>The sample simulation results, an object of a class inherited from <code>SimulationResults</code>, to which the intermediate results are attached.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ResultsManager-calculate_summaries"></a>



<h4>Method <code>calculate_summaries()</code>
</h4>

<p>Calculates the summary metrics and/or matrices for the results of a sample simulation (via the summary functions).
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$calculate_summaries(simulation_results, sample_index)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>simulation_results</code></dt>
<dd>
<p>The sample simulation results, an object of a class inherited from <code>SimulationResults</code>.</p>
</dd>
<dt><code>sample_index</code></dt>
<dd>
<p>Index of sample from data frame.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>Generation log entry as a (nested) list, including generated summary metric data and (optionally) matrices.
</p>


<hr>
<a id="method-ResultsManager-log_generation"></a>



<h4>Method <code>log_generation()</code>
</h4>

<p>Summarizes the log generated within the generate method and writes it to a text file in the results directory.
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$log_generation(generation_log)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>generation_log</code></dt>
<dd>
<p>Nested list of log entries generated via the generate method.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>Extended generation log as a nested with added summary and failure/warning indices.
</p>


<hr>
<a id="method-ResultsManager-calculate_summary_weighted_averages"></a>



<h4>Method <code>calculate_summary_weighted_averages()</code>
</h4>

<p>Calculates the weighted averages for each of the summary matrices (providing the sample data has a <em>weight</em> column).
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$calculate_summary_weighted_averages(na_replacements = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>na_replacements</code></dt>
<dd>
<p>List of values or functions (form: <code>modified_matrix &lt;- function(matrix)</code>) for dealing with NA values in each summary matrix (default NULL will ignore NAs).</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ResultsManager-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>ResultsManager$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Examples</h3>

<pre><code class="language-R">
# U Island example region
coordinates &lt;- data.frame(
  x = rep(seq(177.01, 177.05, 0.01), 5),
  y = rep(seq(-18.01, -18.05, -0.01), each = 5)
)
template_raster &lt;- Region$new(coordinates = coordinates)$region_raster # full extent
template_raster[][-c(7, 9, 12, 14, 17:19)] &lt;- NA # make U Island
region &lt;- Region$new(template_raster = template_raster)
raster::plot(region$region_raster,
  main = "Example region (indices)",
  xlab = "Longitude (degrees)", ylab = "Latitude (degrees)",
  colNA = "blue"
)
# Results manager
results_manager &lt;- ResultsManager$new(
  sample_data = data.frame(index = 1:3),
  simulation_results = PopulationResults$new(region = region),
  summary_metrics = c("trend_n", "total_h"),
  summary_matrices = c("n", "h"),
  summary_functions = list(
    trend_n = function(results) {
      round(results$all$abundance_trend, 2)
    },
    total_h = function(results) {
      sum(results$harvested)
    },
    n = "all$abundance", # string
    h = "all$harvested"
  ),
  parallel_cores = 2,
  results_dir = tempdir()
)
# Write example result files
results &lt;- list()
for (i in 1:3) {
  results[[i]] &lt;- list(abundance = t(apply(
    matrix(11:17), 1,
    function(n) round(n * exp(-(0:9) / i))
  )))
  results[[i]]$harvested &lt;- round(results[[i]]$abundance * i / 7)
  file_name &lt;- paste0(results_manager$get_results_filename(i), ".RData")
  saveRDS(results[[i]], file.path(tempdir(), file_name))
}
# Generate result metrics and matrices
gen_output &lt;- results_manager$generate()
gen_output$summary
dir(tempdir(), "*.txt") # plus generation log
results_manager$summary_metric_data
results_manager$summary_matrix_list

</code></pre>


</div>