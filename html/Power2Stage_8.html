<div class="container">

<table style="width: 100%;"><tr>
<td>power.tsd.in</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Power calculation of adaptive 2-stage BE studies with 2x2 crossover design,
based on the Inverse Normal method
</h2>

<h3>Description</h3>

<p>The function calculates the ‘empirical’ power of 2-stage BE studies based
on the Inverse-Normal combination method. The main design scheme is according
to Maurer <em>et al.</em> (Maximum Combination Test), but it may also be used
for other/modified designs, e.g. standard combination method, usage of the
observed treatment difference after stage 1
in the sample size re-estimation step or different futility criteria.
</p>


<h3>Usage</h3>

<pre><code class="language-R">power.tsd.in(alpha, weight, max.comb.test = TRUE, n1, CV, targetpower = 0.8,
             theta0, theta1, theta2, GMR, usePE = FALSE, min.n2 = 4, max.n = Inf,
             fCpower = targetpower, fCrit = "CI", fClower, fCupper, fCNmax,
             ssr.conditional = c("error_power", "error", "no"),
             pmethod = c("nct", "exact", "shifted"), npct = c(0.05, 0.5, 0.95),
             nsims, setseed = TRUE, details = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>If one element is given, the overall one-sided significance level. In this
case the adjusted alpha levels will be calculated internally. If two
elements are given, the argument refers to the two adjusted one-sided alpha
levels for stage 1 and
stage 2, respectively.<br>
If missing, defaults to <code style="white-space: pre;">⁠0.05⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>

<p>Pre-defined weight(s) of stage 1, see
'Details' for more information.
Note that using the notation from Maurer et al, weight corresponds to
information fraction, other literature may refer to sqrt(weight) as being
the weight. <code style="white-space: pre;">⁠weight⁠</code> must either contain one element (in case of
<code style="white-space: pre;">⁠max.comb.test = FALSE⁠</code>) or two elements (in case of
<code style="white-space: pre;">⁠max.comb.test = TRUE⁠</code>).<br>
If missing, defaults to <code style="white-space: pre;">⁠0.5⁠</code> for <code style="white-space: pre;">⁠max.comb.test = FALSE⁠</code> and to
<code style="white-space: pre;">⁠c(0.5, 0.25)⁠</code> for <code style="white-space: pre;">⁠max.comb.test = TRUE⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.comb.test</code></td>
<td>

<p>Logical; if <code style="white-space: pre;">⁠TRUE⁠</code> (default) the maximum combination test will be
used, otherwise the standard combination test.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n1</code></td>
<td>

<p>Sample size of stage 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CV</code></td>
<td>

<p>Coefficient of variation of the intra-subject variability (use <em>e.g.</em>, 0.3 for
30%).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>targetpower</code></td>
<td>

<p>Desired (overall) target power to declare <abbr><span class="acronym">BE</span></abbr> at the end of the trial.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta0</code></td>
<td>

<p>Assumed ratio of geometric means (T/R) for simulations. If missing,
defaults to <code style="white-space: pre;">⁠GMR⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta1</code></td>
<td>

<p>Lower bioequivalence limit. Defaults to 0.8.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta2</code></td>
<td>

<p>Upper bioequivalence limit. Defaults to 1.25.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>GMR</code></td>
<td>

<p>Assumed ratio of geometric means (T/R) to be used in power calculation
for stage 1 and sample size re-estimation
for stage 2. If missing, defaults to 0.95.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usePE</code></td>
<td>

<p>If <code style="white-space: pre;">⁠TRUE⁠</code> the sample size re-estimation is done with the observed
point estimate (<abbr><span class="acronym">PE</span></abbr>) of the treatment difference in
stage 1.<br>
Defaults to <code style="white-space: pre;">⁠FALSE⁠</code>.<br>
Note: The power of stage 1 used for the futility inspection and calculation
of the estimated conditional target power is always calculated with the
the planning value <code>GMR</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.n2</code></td>
<td>

<p>Minimum sample size of stage 2. Defaults to 4.<br>
If the sample size re-estimation step gives a sample size for
stage 2 less than <code style="white-space: pre;">⁠min.n2⁠</code>, then
<code style="white-space: pre;">⁠min.n2⁠</code> will be used for stage 2.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.n</code></td>
<td>

<p>Maximum overall sample size stage 1 +
stage 2.<br>
This is <em>not</em> a futility criterion regarding the maximum sample size! If
<code style="white-space: pre;">⁠max.n⁠</code> is set to a finite value and the sample size re-estimation gives a
sample size for stage 2 (<code style="white-space: pre;">⁠n2⁠</code>) such
that <code style="white-space: pre;">⁠n1 + n2 &gt; max.n⁠</code>, then the sample size for
stage 2 will be set to <code style="white-space: pre;">⁠n2 = max.n - n1⁠</code>.<br>
Defaults to <code style="white-space: pre;">⁠Inf⁠</code>, <em>i.e.</em>, no constraint on the re-estimated sample size.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fCpower</code></td>
<td>

<p>Threshold for power monitoring step to decide on futility for cases where
<abbr><span class="acronym">BE</span></abbr> has not been achieved after
stage 1: If <abbr><span class="acronym">BE</span></abbr> has not been
achieved after stage 1 and the power for
stage 1 is greater than or equal to
<code style="white-space: pre;">⁠fCpower⁠</code>, then the study will be considered a failure.<br><br>
See ‘Details’ for more information on the choice of
<code style="white-space: pre;">⁠fCpower⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fCrit</code></td>
<td>

<p>Futility criterion to use: <code style="white-space: pre;">⁠"No"⁠</code> (no futility criterion regarding
observed point estimate, confidence interval and maximum sample size),
<code style="white-space: pre;">⁠"PE"⁠</code> (observed point estimate of the geometric mean ratio from
stage 1),
<code style="white-space: pre;">⁠"CI"⁠</code> (90% confidence interval of the geometric mean ratio from
stage 1), <code>"Nmax"</code> (overall maximum
sample size); or a combination thereof (concatenate abbreviations; see
‘Examples’). Defaults to "CI".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fClower</code></td>
<td>

<p>Lower futility limit for the <abbr><span class="acronym">PE</span></abbr> or <abbr><span class="acronym">CI</span></abbr> of
stage 1.<br>
If the <abbr><span class="acronym">PE</span></abbr> or <abbr><span class="acronym">CI</span></abbr> is completely outside of <code style="white-space: pre;">⁠fClower⁠</code>
... <code style="white-space: pre;">⁠fCupper⁠</code> the study is stopped due to futility (not <abbr><span class="acronym">BE</span></abbr>).<br>
May be missing. If <code style="white-space: pre;">⁠"PE"⁠</code> or <code style="white-space: pre;">⁠"CI"⁠</code> is specified within <code style="white-space: pre;">⁠fCrit⁠</code>,
the default will be set to 0.8 for <code style="white-space: pre;">⁠fCrit = "PE"⁠</code> or 0.95 for <code style="white-space: pre;">⁠fCrit = "CI"⁠</code>.
If neither <code style="white-space: pre;">⁠"PE"⁠</code> nor <code style="white-space: pre;">⁠"CI"⁠</code> is specified within <code style="white-space: pre;">⁠fCrit⁠</code>, there
will be no futility constraint regarding point estimate or confidence interval
from stage 1 (regardless of any
specification of <code style="white-space: pre;">⁠fClower⁠</code> and/or <code style="white-space: pre;">⁠fCupper⁠</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fCupper</code></td>
<td>

<p>Upper futility limit for the <abbr><span class="acronym">PE</span></abbr> or <abbr><span class="acronym">CI</span></abbr> of
stage 1.<br>
Analogous to <code style="white-space: pre;">⁠fClower⁠</code>: Will be set to <code style="white-space: pre;">⁠1/fClower⁠</code> if missing.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fCNmax</code></td>
<td>

<p>Futility criterion regarding maximum sample size. If the determined sample size
for stage 2 (<code style="white-space: pre;">⁠n2⁠</code>) is such that
<code style="white-space: pre;">⁠n1 + n2 &gt; fCNmax⁠</code>, the study will not continue to
stage 2 and stopped due to futility (not
<abbr><span class="acronym">BE</span></abbr>).<br>
If <code style="white-space: pre;">⁠"Nmax"⁠</code> is specified within <code style="white-space: pre;">⁠fCrit⁠</code> and argument <code style="white-space: pre;">⁠fCNmax⁠</code>
is missing, the value will be set to <code style="white-space: pre;">⁠fCNmax = 4*n1⁠</code>. If <code style="white-space: pre;">⁠"Nmax"⁠</code> is
not specified within <code style="white-space: pre;">⁠fCrit⁠</code>, then there will be no futility constraint
regarding maximum sample size (regardless of any specification of <code style="white-space: pre;">⁠fCNmax⁠</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ssr.conditional</code></td>
<td>

<p>Method for sample size re-estimation step: <code style="white-space: pre;">⁠"no"⁠</code> does not use
conditional error rates nor the estimated conditional target power for
the second stage, <code style="white-space: pre;">⁠"error"⁠</code> uses conditional error rates for the
second stage, and <code style="white-space: pre;">⁠"error_power"⁠</code> uses both conditional error rates
and the estimated conditional target power for the second stage.<br>
Defaults to <code style="white-space: pre;">⁠"error_power"⁠</code>.<br><br>
See also ‘Details’.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pmethod</code></td>
<td>

<p>Power calculation method, also to be used in the sample size estimation for
stage 2.<br>
Implemented are <code style="white-space: pre;">⁠"nct"⁠</code> (approximate calculations via non-central
<em>t</em>-distribution, <code style="white-space: pre;">⁠"exact"⁠</code> (exact calculations via Owen’s Q),
and <code style="white-space: pre;">⁠"shifted"⁠</code> (approximate calculation via shifted central <em>t</em>-distribution
like in the paper of Potvin <em>et al.</em>)<br>
Defaults to <code style="white-space: pre;">⁠"nct"⁠</code> as it is a reasonable compromise between speed and
accuracy in the sample size estimation step.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npct</code></td>
<td>

<p>Percentiles to be used for the presentation of the distribution of
<code style="white-space: pre;">⁠n(total)=n1+n2⁠</code>.<br>
Defaults to <code style="white-space: pre;">⁠c(0.05, 0.5, 0.95)⁠</code> to obtain the 5% and 95% percentiles
and the median.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsims</code></td>
<td>

<p>Number of studies to simulate.<br>
If missing, <code style="white-space: pre;">⁠nsims⁠</code> is set to 1E+05 = 100,000 or to 1E+06 = 1 Mio if
estimating the empiric Type I Error (<code style="white-space: pre;">⁠'alpha'⁠</code>), <em>i.e.</em>, with <code style="white-space: pre;">⁠theta0⁠</code> at
the border of the acceptance range <code style="white-space: pre;">⁠theta1⁠</code> ... <code style="white-space: pre;">⁠theta2⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>setseed</code></td>
<td>

<p>Simulations are dependent on the starting point of the (pseudo) random number
generator. To avoid differences in power for different runs a
<code>set.seed(1234567)</code> is issued if <code style="white-space: pre;">⁠setseed=TRUE⁠</code>, the default.<br>
Set this argument to <code style="white-space: pre;">⁠FALSE⁠</code> to view the variation in power between
different runs.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>details</code></td>
<td>

<p>If set to <code style="white-space: pre;">⁠TRUE⁠</code> the function prints the results of time measurements
of the simulation steps. Default to <code style="white-space: pre;">⁠FALSE⁠</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The underlying subject data are assumed to be evaluated after log-transformation.
But instead of simulating subject data, the statistics pe1, mse1 and pe2, mse2
are simulated via their associated distributions (Normal and
χ<sup>2</sup> distribution).<br><br>
The <code>weight</code> argument always refers to the first weight of a pair of
weights. For example, in case of <code>max.comb.test = FALSE</code> the standard
combination test requires two weights (w, 1-w) but only the first one, w,
is required as input argument here because the second weight is
automatically specified once the first is given. Similarly for
<code>max.comb.test = TRUE</code>, w and w* need to be specified, which in turn
define the two pairs of weights (w, 1-w) and (w*, 1-w*).<br><br>
If <code style="white-space: pre;">⁠ssr.conditional = "error_power"⁠</code>, the design scheme generally
calculates the estimated conditional target power of the second stage and
uses this value as desired target power in the sample size re-estimation process:<br>
If <code>fCpower</code> &gt; <code>targetpower</code>, then the conditional estimated
target power may be negative. This does not seem sensible. Therefore, for such
cases the desired target power for the sample size re-calculation will be set
to <code>targetpower</code>, i.e. <code>ssr.conditional</code> will be set to <code>"error"</code>.
</p>


<h3>Value</h3>

<p>Returns an object of class <code style="white-space: pre;">⁠"pwrtsd"⁠</code> with all the input arguments and results
as components. As part of the input arguments a component <code>cval</code> is also
presented, containing the critical values for stage 1 and 2 according to the
input based on <code>alpha</code>, <code>weight</code> and <code>max.comb.test</code>.<br>
The class <code style="white-space: pre;">⁠"pwrtsd"⁠</code> has an S3 print method.<br><br>
The results are in the components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>pBE</code></td>
<td>
<p>Fraction of studies found BE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pBE_s1</code></td>
<td>
<p>Fraction of studies found BE in stage 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pct_stop_s1</code></td>
<td>
<p>Percentage of studies stopped after
stage 1 (due to BE or due to futility).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pct_stop_fut</code></td>
<td>
<p>Percentage of studies stopped after
stage 1 due to futility.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pct_s2</code></td>
<td>
<p>Percentage of studies continuing to stage 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmean</code></td>
<td>
<p>Mean of n(total).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrange</code></td>
<td>
<p>Range (min, max) of n(total).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperc</code></td>
<td>
<p>Vector of percentiles of the distribution of n(total).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>B. Lang
</p>


<h3>References</h3>

<p>König F, Wolfsegger M, Jaki T, Schütz H, Wassmer G.<br><em>Adaptive two-stage bioequivalence trials with early stopping and sample size re-estimation.</em><br>
Vienna: 2014; 35<sup>th</sup> Annual Conference of the International Society for Clinical Biostatistics. Poster P1.2.88 <br>
doi: <a href="https://doi.org/10.13140/RG.2.1.5190.0967">10.13140/RG.2.1.5190.0967</a>.
</p>
<p>Patterson SD, Jones B. <em>Bioequivalence and Statistics in Clinical Pharmacology.</em><br>
Boca Raton: CRC Press; 2<sup>nd</sup> edition 2017.
</p>
<p>Kieser M, Rauch G. <em>Two-stage designs for cross-over bioequivalence trials.</em><br>
Stat Med. 2015; 34(16): 2403–16. doi: <a href="https://doi.org/10.1002/sim.6487">10.1002/sim.6487</a>.
</p>
<p>Maurer W, Jones B, Chen Y. <em>Controlling the type 1 error rate in two-stage
sequential designs when testing for average bioequivalence.</em><br>
Stat Med. 2018; 37(10): 1587–1607. doi: <a href="https://doi.org/10.1002/sim.7614">10.1002/sim.7614</a>.
</p>
<p>Wassmer G, Brannath W. <em>Group Sequential and Confirmatory Adaptive Designs
in Clinical Trials.</em><br>
Springer 2016. doi: <a href="https://doi.org/10.1007/978-3-319-32562-0">10.1007/978-3-319-32562-0</a>.
</p>


<h3>See Also</h3>

<p><code>interim.tsd.in, final.tsd.in</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># 12 subjects in stage 1, CV of 20%, no futility rule, otherwise all defaults
# except too low number of sims due to CRAN policy for run-time of examples
# This setting resembles values in Table 6.8 and 6.10 in Patterson and Jones
# if nsims=1e5 (default)
power.tsd.in(n1 = 12, CV = 0.2, fCrit = "No", nsims=1e4)

# Note that actual replication would require the following additional
# arguments (extremely long run-time)
## Not run: 
power.tsd.in(n1 = 12, CV = 0.2, fCrit = "No", max.n = 4000,
             pmethod = "exact", nsims = 1E6)
## End(Not run)

# Table 8 in Maurer et al
power.tsd.in(n1 = 36, CV = 0.4, max.n = 4000)

# Same example as before but with additional futility criterion regarding
# maximum sample size (using the default 4*n1 as maximum bound)
power.tsd.in(n1 = 36, CV = 0.4, max.n = 4000, fCrit = c("CI", "Nmax"))
</code></pre>


</div>