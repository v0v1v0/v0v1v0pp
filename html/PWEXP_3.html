<div class="container">

<table style="width: 100%;"><tr>
<td>boot.pwexp.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bootstrap a Piecewise Exponential Model</h2>

<h3>Description</h3>

<p>Bootstrap a existing piecewise exponential model or build a piecewise exponential model with bootstrapping.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## Default S3 method:
boot.pwexp.fit(time, event, nsim=100, breakpoint=NULL, nbreak=0,
               exclude_int=NULL, min_pt_tail=5, max_set=1000, seed=1818,
               optimizer='mle', tol=1e-4, parallel=FALSE, mc.core=4, ...)
## S3 method for class 'pwexp.fit'
boot.pwexp.fit(time, nsim=100, max_set=1000, seed=1818,
               optimizer='mle', tol=1e-4, parallel=FALSE, mc.core=4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>observed time from randomization or a <code>pwexp.fit</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>the status indicator. See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>the number of repeated bootstraping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breakpoint</code></td>
<td>
<p>pre-specified breakpoints. See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbreak</code></td>
<td>
<p>total number of breakpoints. See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_int</code></td>
<td>
<p>an interval that excludes any estimated breakpoints.  See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_pt_tail</code></td>
<td>
<p>the minimum number of events used for estimating the tail (the hazard rate of the last piece). See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_set</code></td>
<td>
<p>maximum estimated combination of breakpoints. See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>a random seed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optimizer</code></td>
<td>
<p>one of the optimizers: <code>mle</code>, <code>ols</code>, or <code>hybrid</code>. See <code>pwexp.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the minimum allowed gap between two breakpoints. The gap is calculated as <code>(max(time)-min(time))*tol</code>. Keep it as default in most cases. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>logical. If <code>TRUE</code>, use <span class="pkg">doSNOW</span> package to run in parallel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.core</code></td>
<td>
<p>number of processes allowed to be run in parallel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>internal function reserved. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Use bootstrap to repeatdly call <code>pwexp.fit</code> to estimate the uncertainty of parameters.
</p>


<h3>Value</h3>

<p>A data frame (<code>res</code>) containing these columns:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>brk1, ..., brkx</code></td>
<td>
<p>estimated breakpoints. The <code>attr(res,'brk')</code> can extract the result of breakpoint from each bootstrap sample (<code>res</code> is the returned model from <code>boot.pwexp.fit</code>). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lam1, ..., lamx</code></td>
<td>
<p>estimated piecewise hazard rates. The <code>attr(res,'lam')</code> can extract the result of hazard rates from bootstrap sample (<code>res</code> is the returned model from <code>boot.pwexp.fit</code>). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>likelihood</code></td>
<td>
<p>the log-likelihood of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC</code></td>
<td>
<p>the Akaike information criterion of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BIC</code></td>
<td>
<p>the Bayesian information criterion of the model.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Tianchen Xu <a href="mailto:zjph602xutianchen@gmail.com">zjph602xutianchen@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code>pwexp.fit</code></p>


<h3>Examples</h3>

<pre><code class="language-R">event_dist &lt;- function(n)rpwexp(n, rate = c(0.1, 0.01, 0.2), breakpoint =  c(5,14))
dat &lt;- simdata(rand_rate = 20, drop_rate = 0.03,  total_sample = 1000,
               advanced_dist = list(event_dist=event_dist),
               add_column = c('censor_reason','event','followT','followT_abs'))

fit_res3 &lt;- pwexp.fit(dat$followT, dat$event, nbreak = 2)
fit_res_boot &lt;- boot.pwexp.fit(fit_res3, nsim = 10) # here nsim=10 is for demo purpose,
                                                    # pls increase it in practice
plot_survival(dat$followT, dat$event, xlim=c(0,40))
plot_survival(fit_res_boot, col='red', CI_par = list(col='red'))
brk_ci &lt;- apply(attr(fit_res_boot, 'brk'), 2, function(x)quantile(x,c(0.025,0.975)))
abline(v=brk_ci, col='grey', lwd=2)
</code></pre>


</div>