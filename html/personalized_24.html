<div class="container">

<table style="width: 100%;"><tr>
<td>treatment.effects</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculation of covariate-conditional treatment effects</h2>

<h3>Description</h3>

<p>Calculates covariate conditional treatment effects using estimated benefit scores
</p>


<h3>Usage</h3>

<pre><code class="language-R">treatment.effects(x, ...)

## Default S3 method:
treatment.effects(x, ...)

treat.effects(
  benefit.scores,
  loss = c("sq_loss_lasso", "logistic_loss_lasso", "poisson_loss_lasso",
    "cox_loss_lasso", "owl_logistic_loss_lasso", "owl_logistic_flip_loss_lasso",
    "owl_hinge_loss", "owl_hinge_flip_loss", "sq_loss_lasso_gam",
    "poisson_loss_lasso_gam", "logistic_loss_lasso_gam", "sq_loss_gam",
    "poisson_loss_gam", "logistic_loss_gam", "owl_logistic_loss_gam",
    "owl_logistic_flip_loss_gam", "owl_logistic_loss_lasso_gam",
    "owl_logistic_flip_loss_lasso_gam", "sq_loss_xgboost", "custom"),
  method = c("weighting", "a_learning"),
  pi.x = NULL,
  ...
)

## S3 method for class 'subgroup_fitted'
treatment.effects(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a fitted object from <code>fit.subgroup()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>not used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>benefit.scores</code></td>
<td>
<p>vector of estimated benefit scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loss</code></td>
<td>
<p>loss choice USED TO CALCULATE <code>benefit.scores</code> of both the M function from Chen, et al (2017) and
potentially the penalty used for variable selection. See <code>fit.subgroup</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>method choice USED TO CALCULATE <code>benefit.scores</code>. Either the <code>"weighting"</code> method or
<code>"a_learning"</code> method. See <code>fit.subgroup</code> for more details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi.x</code></td>
<td>
<p>The propensity score for each observation</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A List with elements <code>delta</code> (if the treatment effects are a difference/contrast,
i.e. <code class="reqn">E[Y|T=1, X] - E[Y|T=-1, X]</code>) and <code>gamma</code> (if the treatment effects are a ratio,
i.e. <code class="reqn">E[Y|T=1, X] / E[Y|T=-1, X]</code>)
</p>


<h3>See Also</h3>

<p><code>fit.subgroup</code> for function which fits subgroup identification models.
</p>
<p><code>print.individual_treatment_effects</code> for printing of objects returned by
<code>treat.effects</code> or <code>treatment.effects</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(personalized)

set.seed(123)
n.obs  &lt;- 500
n.vars &lt;- 25
x &lt;- matrix(rnorm(n.obs * n.vars, sd = 3), n.obs, n.vars)


# simulate non-randomized treatment
xbetat   &lt;- 0.5 + 0.5 * x[,21] - 0.5 * x[,11]
trt.prob &lt;- exp(xbetat) / (1 + exp(xbetat))
trt01    &lt;- rbinom(n.obs, 1, prob = trt.prob)

trt      &lt;- 2 * trt01 - 1

# simulate response
delta &lt;- 2 * (0.5 + x[,2] - x[,3] - x[,11] + x[,1] * x[,12])
xbeta &lt;- x[,1] + x[,11] - 2 * x[,12]^2 + x[,13]
xbeta &lt;- xbeta + delta * trt

# continuous outcomes
y &lt;- drop(xbeta) + rnorm(n.obs, sd = 2)

# time-to-event outcomes
surv.time &lt;- exp(-20 - xbeta + rnorm(n.obs, sd = 1))
cens.time &lt;- exp(rnorm(n.obs, sd = 3))
y.time.to.event  &lt;- pmin(surv.time, cens.time)
status           &lt;- 1 * (surv.time &lt;= cens.time)

# create function for fitting propensity score model
prop.func &lt;- function(x, trt)
{
    # fit propensity score model
    propens.model &lt;- cv.glmnet(y = trt,
                               x = x, family = "binomial")
    pi.x &lt;- predict(propens.model, s = "lambda.min",
                    newx = x, type = "response")[,1]
    pi.x
}

subgrp.model &lt;- fit.subgroup(x = x, y = y,
                             trt = trt01,
                             propensity.func = prop.func,
                             loss   = "sq_loss_lasso",
                             nfolds = 3)    # option for cv.glmnet

trt_eff &lt;- treatment.effects(subgrp.model)
str(trt_eff)

trt_eff


library(survival)
subgrp.model.cox &lt;- fit.subgroup(x = x, y = Surv(y.time.to.event, status),
                           trt = trt01,
                           propensity.func = prop.func,
                           loss   = "cox_loss_lasso",
                           nfolds = 3)              # option for cv.glmnet

trt_eff_c &lt;- treatment.effects(subgrp.model.cox)
str(trt_eff_c)

trt_eff_c

</code></pre>


</div>