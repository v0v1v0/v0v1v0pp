<div class="container">

<table style="width: 100%;"><tr>
<td>simulate_error</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate gas exchange data with measurement error</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
</p>


<h3>Usage</h3>

<pre><code class="language-R">simulate_error(
  ph_out,
  chamber_pars,
  n = 1L,
  use_tealeaves = ("T_air" %in% colnames(ph_out))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ph_out</code></td>
<td>
<p>A data frame of output from <code>photo()</code> or <code>photosynthesis()</code>
with units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chamber_pars</code></td>
<td>
<p>A data frame with a single row of chamber parameters.
See Note below for table of required parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Integer. Number of replicated simulations per row of <code>ph_out</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_tealeaves</code></td>
<td>
<p>Flag. The <strong>tealeaves</strong> package uses a slightly
different equation to calculate the saturating water content of air as a
function temperature and pressure than LI-COR. If FALSE, the function uses
LI-COR's equation in the LI6800 manual. If TRUE, it uses the <strong>tealeaves</strong>
function for internal consistency. The function attempts to guess whether
<code>ph_out</code> was run with <strong>tealeaves</strong>, but this can be manually overridden by
providing a value for the argument.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame with <code>n * nrow(ph_out)</code> rows. It contains all the
original output in <code>ph_out</code> as well as a column <code>.rep</code> indicating replicate
number from 1 to <code>n</code>. Other new columns are assumed or measured chamber
parameters and 'measured' values estimated from synthetic data with
measurement error:</p>

<table>
<tr>
<td style="text-align: left;">
   column name </td>
<td style="text-align: left;"> assumed or derived? </td>
<td style="text-align: left;"> description </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>flow</code> </td>
<td style="text-align: left;"> assumed </td>
<td style="text-align: left;"> chamber flow rate </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>leaf_area</code> </td>
<td style="text-align: left;"> assumed </td>
<td style="text-align: left;"> leaf area in chamber </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>sigma_CO2_r</code> </td>
<td style="text-align: left;"> assumed </td>
<td style="text-align: left;"> standard deviation of measurement error in CO2_r </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>sigma_CO2_s</code> </td>
<td style="text-align: left;"> assumed </td>
<td style="text-align: left;"> standard deviation of measurement error in CO2_s </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>sigma_H2O_r</code> </td>
<td style="text-align: left;"> assumed </td>
<td style="text-align: left;"> standard deviation of measurement error in H2O_r </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>sigma_H2O_s</code> </td>
<td style="text-align: left;"> assumed </td>
<td style="text-align: left;"> standard deviation of measurement error in H2O_s </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>c_0</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> CO<code class="reqn">_2</code> concentration before entering chamber [<code class="reqn">\mu</code>mol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>w_i</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Water vapor concentration within leaf [mmol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>w_a</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Water vapor concentration in chamber [mmol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>w_0</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Water vapor concentration before entering chamber [mmol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>g_tw</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Leaf conductance to water vapor [mol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>E_area</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Evaporation rate per area [mmol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>E</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Total evaporation rate [mmol/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>CO2_r</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> CO<code class="reqn">_2</code> concentration before entering chamber with measurement error [<code class="reqn">\mu</code>mol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>CO2_s</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> CO<code class="reqn">_2</code> concentration in chamber with measurement error [<code class="reqn">\mu</code>mol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>H2O_s</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Water vapor concentration in chamber with measurement error [mmol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>H2O_r</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Water vapor concentration before entering chamber with measurement error [mmol / mol] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>E_meas</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Total evaporation rate (measured) [mmol/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>E_area_meas</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Evaporation rate per area (measured) [mmol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>g_tw_meas</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Leaf conductance to water vapor (measured) [mol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>g_sc_meas</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Stomatal conductance to CO<code class="reqn">_2</code> (measured) [mol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>g_tc_meas</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Leaf conductance to CO<code class="reqn">_2</code> (measured) [mol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>A_meas</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Net photosynthetic CO<code class="reqn">_2</code> assimilation (measured) [<code class="reqn">\mu</code>mol/m<code class="reqn">^2</code>/s] </td>
</tr>
<tr>
<td style="text-align: left;">
   <code>C_i</code> </td>
<td style="text-align: left;"> derived </td>
<td style="text-align: left;"> Intercellular CO<code class="reqn">_2</code> concentration (measured) [<code class="reqn">\mu</code>mol/mol] </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Note</h3>

<p>The required parameters for the <code>chamber_pars</code> argument are:
</p>

<ul>
<li> <p><code>flow</code> [<code class="reqn">\mu</code>mol / s]: chamber flow rate
</p>
</li>
<li> <p><code>leaf_area</code> [cm ^ 2]: leaf area in chamber
</p>
</li>
<li> <p><code>sigma_CO2_s</code> [<code class="reqn">\mu</code>mol / mol]: standard deviation of sample [CO<code class="reqn">_2</code>] measurement error
</p>
</li>
<li> <p><code>sigma_CO2_r</code> [<code class="reqn">\mu</code>mol / mol]: standard deviation of reference [CO<code class="reqn">_2</code>]
</p>
</li>
<li> <p><code>sigma_H2O_s</code> [mmol / mol]: standard deviation of sample [H<code class="reqn">_2</code>O] measurement error
</p>
</li>
<li> <p><code>sigma_H2O_r</code> [mmol / mol]: standard deviation of sample [H<code class="reqn">_2</code>O] measurement error
</p>
</li>
</ul>
<p>Units for <code>flow</code> and <code>leaf_area</code> should be provided; units are implied for sigma's but not necessary to specify because <code>rnorm()</code> drop units.
</p>
<p>To evaluate the accuracy and precision of parameter estimation methods, it
may be useful to simulate data with realistic measurement error. This
function takes output from from <code>photo()</code> or <code>photosynthesis()</code> models, adds
measurement error in CO<code class="reqn">_2</code> and H<code class="reqn">_2</code>O concentrations, and calculates
parameter estimates with synthetic data. Currently, the function assumes a
simplified 1-dimensional CO<code class="reqn">_2</code> and H<code class="reqn">_2</code>O conductance model: zero
cuticular conductance, infinite boundary layer conductance, and infinite
airspace conductance. Other assumptions include:
</p>

<ul>
<li>
<p> chamber flow rate, leaf area, leaf temperature, and air pressure are known
without error
</p>
</li>
<li>
<p> measurement error is normally distributed mean 0 and standard deviation
specified in <code>chamber_pars</code>
</p>
</li>
</ul>
<p>This function was designed with the LI-COR LI6800 instrument in mind, but in
principle applies to any open path gas exchange system.
</p>
<p>[COQyjnqgugpiWjwbNIBuz5yhp7XSctzgs1-5-]: R:COQyjnqgugpiWjwbNIBuz5yhp7XSctzgs1-5-%5C
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(photosynthesis)

# Use photosynthesis() to simulate 'real' values
# `replace = ...` sets parameters to meet assumptions of `simulate_error()`
lp = make_leafpar(replace = list(
  g_sc = set_units(0.1, mol/m^2/s),
  g_uc = set_units(0, mol/m^2/s),
  k_mc = set_units(0, 1),
  k_sc = set_units(0, 1),
  k_uc = set_units(0, 1)
  ),
  use_tealeaves = FALSE)
   
 ep = make_enviropar(replace = list(
   wind = set_units(Inf, m/s)
 ), use_tealeaves = FALSE) 
 bp = make_bakepar()
 cs = make_constants(use_tealeaves = FALSE)
 
 chamber_pars = data.frame(
   flow = set_units(600, umol / s),
   leaf_area = set_units(6, cm ^ 2),
   sigma_CO2_s = 0.1,
   sigma_CO2_r = 0.1,
   sigma_H2O_s = 0.1,
   sigma_H2O_r = 0.1
 )
   
ph = photosynthesis(lp, ep, bp, cs, use_tealeaves = FALSE, quiet = TRUE) |&gt;
  simulate_error(chamber_pars, n = 1L)
  
</code></pre>


</div>