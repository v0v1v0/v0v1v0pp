<div class="container">

<table style="width: 100%;"><tr>
<td>PopED-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>PopED - <b>Pop</b>ulation (and individual) optimal <b>E</b>xperimental <b>D</b>esign.</h2>

<h3>Description</h3>

<p>PopED computes optimal experimental designs for both 
population  and individual studies based on nonlinear mixed-effect models.  
Often this is based on a computation of the Fisher Information Matrix (FIM).
</p>


<h3>Details</h3>

<p>To get started you need to define 
</p>

<ol>
<li>
<p> A model.
</p>
</li>
<li>
<p> An initial design (and design space if you want to optimize). 
</p>
</li>
<li>
<p> The tasks to perform.  
</p>
</li>
</ol>
<p>There are a number of functions to help you with these tasks.  The user-level functions  defined below are 
meant to be run with a minimum of arguments (for beginners to advanced users).  Many of the other functions in the package
(and not listed here) are called by these user-level functions 
and are often not as user 
friendly (developer level or advanced user functions).
</p>
<p>Define a structural model: 
<code>ff.PK.1.comp.oral.md.CL</code>, 
<code>ff.PK.1.comp.oral.md.KE</code>, 
<code>ff.PK.1.comp.oral.sd.CL</code>, 
<code>ff.PK.1.comp.oral.sd.KE</code>, 
<code>ff.PKPD.1.comp.oral.md.CL.imax</code>, 
<code>ff.PKPD.1.comp.sd.CL.emax</code>.
</p>
<p>Define a residual unexplained variability model (residual error model): 
<code>feps.add.prop</code>,
<code>feps.add</code>, 
<code>feps.prop</code>.
</p>
<p>Create an initial study design (and design space): 
<code>create.poped.database</code>.
</p>
<p>Evaluate the model and/or design through simulation and graphics:
<code>plot_model_prediction</code>, 
<code>model_prediction</code>, 
<code>plot_efficiency_of_windows</code>.
</p>
<p>Evaluate the design using the FIM:
<code>evaluate_design</code>, 
<code>evaluate.fim</code>, 
<code>evaluate.e.ofv.fim</code>, 
<code>ofv_fim</code>,
<code>get_rse</code>.
</p>
<p>Optimize the design (evaluate afterwards using the above functions): 
<code>poped_optim</code>, 
</p>
<p>See the "Examples" section below for a short introduction to using the above functions. 
There are several other examples, as r-scripts, in the "examples" folder in the 
PopED installation directory located at (run at the R command line):
</p>
<p><code>system.file("examples", package="PopED")</code>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Andrew C. Hooker <a href="mailto:andrew.hooker@farmaci.uu.se">andrew.hooker@farmaci.uu.se</a> (<a href="https://orcid.org/0000-0002-2676-5912">ORCID</a>) [translator, copyright holder]
</p>
<p>Authors:
</p>

<ul>
<li>
<p> Marco Foracchia (O-Matrix version)
</p>
</li>
<li>
<p> Sebastian Ueckert (<a href="https://orcid.org/0000-0002-3712-0255">ORCID</a>) (MATLAB version)
</p>
</li>
<li>
<p> Joakim Nyberg (MATLAB version)
</p>
</li>
</ul>
<p>Other contributors:
</p>

<ul>
<li>
<p> Eric Stroemberg (MATLAB version) [contributor]
</p>
</li>
<li>
<p> Martin Fink (Streamlining code, added functionality, vignettes) [contributor]
</p>
</li>
<li>
<p> Giulia Lestini (Streamlining code, added functionality, vignettes) [contributor]
</p>
</li>
</ul>
<h3>References</h3>


<ol>
<li>
<p> J. Nyberg, S. Ueckert, E.A. Stroemberg, S. Hennig, M.O. Karlsson and A.C. Hooker, "PopED: An extended, 
parallelized, nonlinear mixed effects models optimal design tool",  
Computer Methods and Programs in Biomedicine, 108, 2012.
</p>
</li>
<li>
<p> M. Foracchia, A.C. Hooker, P. Vicini and A. Ruggeri, "PopED, a software for optimal 
experimental design in population kinetics", Computer Methods and Programs in Biomedicine, 74, 2004. 
</p>
</li>
<li> <p><a href="https://andrewhooker.github.io/PopED/">https://andrewhooker.github.io/PopED/</a>
</p>
</li>
</ol>
<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://andrewhooker.github.io/PopED/">https://andrewhooker.github.io/PopED/</a>
</p>
</li>
<li> <p><a href="https://github.com/andrewhooker/PopED">https://github.com/andrewhooker/PopED</a>
</p>
</li>
<li>
<p> Report bugs at <a href="https://github.com/andrewhooker/PopED/issues">https://github.com/andrewhooker/PopED/issues</a>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
library(PopED)

##-- Model: One comp first order absorption
## -- Analytic solution for both mutiple and single dosing
ff &lt;- function(model_switch,xt,parameters,poped.db){
  with(as.list(parameters),{
    y=xt 
    N = floor(xt/TAU)+1
    y=(DOSE*Favail/V)*(KA/(KA - CL/V)) * 
      (exp(-CL/V * (xt - (N - 1) * TAU)) * (1 - exp(-N * CL/V * TAU))/(1 - exp(-CL/V * TAU)) - 
         exp(-KA * (xt - (N - 1) * TAU)) * (1 - exp(-N * KA * TAU))/(1 - exp(-KA * TAU)))  
    return(list( y=y,poped.db=poped.db))
  })
}

## -- parameter definition function 
## -- names match parameters in function ff
sfg &lt;- function(x,a,bpop,b,bocc){
  parameters=c( V=bpop[1]*exp(b[1]),
                KA=bpop[2]*exp(b[2]),
                CL=bpop[3]*exp(b[3]),
                Favail=bpop[4],
                DOSE=a[1],
                TAU=a[2])
  return( parameters ) 
}

## -- Residual unexplained variablity (RUV) function
## -- Additive + Proportional  
feps &lt;- function(model_switch,xt,parameters,epsi,poped.db){
  returnArgs &lt;- do.call(poped.db$model$ff_pointer,list(model_switch,xt,parameters,poped.db)) 
  y &lt;- returnArgs[[1]]
  poped.db &lt;- returnArgs[[2]]
  
  y = y*(1+epsi[,1])+epsi[,2]
  
  return(list( y= y,poped.db =poped.db )) 
}

## -- Define design and design space
poped.db &lt;- create.poped.database(ff_fun=ff,
                                  fg_fun=sfg,
                                  fError_fun=feps,
                                  bpop=c(V=72.8,KA=0.25,CL=3.75,Favail=0.9), 
                                  notfixed_bpop=c(1,1,1,0),
                                  d=c(V=0.09,KA=0.09,CL=0.25^2), 
                                  sigma=c(0.04,5e-6),
                                  notfixed_sigma=c(0,0),
                                  m=2,
                                  groupsize=20,
                                  xt=c( 1,2,8,240,245),
                                  minxt=c(0,0,0,240,240),
                                  maxxt=c(10,10,10,248,248),
                                  bUseGrouped_xt=1,
                                  a=list(c(DOSE=20,TAU=24),c(DOSE=40, TAU=24)),
                                  maxa=c(DOSE=200,TAU=24),
                                  mina=c(DOSE=0,TAU=24))

##  create plot of model without variability 
plot_model_prediction(poped.db, model_num_points = 300)


## Not run: 
  
  ##  create plot of model with variability 
  plot_model_prediction(poped.db, IPRED=T, DV=T, separate.groups=T, model_num_points = 300)
  

## End(Not run)

## evaluate initial design
evaluate_design(poped.db)

## Not run: 
  
  # Optimization of sample times
  output &lt;- poped_optim(poped.db, opt_xt=TRUE, parallel = TRUE)
  summary(output)
  get_rse(output$FIM, output$poped.db)
  plot_model_prediction(output$poped.db)
  
  # Optimization of sample times and doses
  output_2 &lt;- poped_optim(poped.db, opt_xt=TRUE, opt_a=TRUE, parallel = TRUE)
  summary(output_2)
  get_rse(output_2$FIM,output_2$poped.db)
  plot_model_prediction(output_2$poped.db)
  
  # Optimization of sample times with only integer time points in design space
  # faster than continuous optimization in this case
  poped.db.discrete &lt;- create.poped.database(ff_fun=ff,
                                             fg_fun=sfg,
                                             fError_fun=feps,
                                             bpop=c(V=72.8,KA=0.25,CL=3.75,Favail=0.9), 
                                             notfixed_bpop=c(1,1,1,0),
                                             d=c(V=0.09,KA=0.09,CL=0.25^2), 
                                             sigma=c(0.04,5e-6),
                                             notfixed_sigma=c(0,0),
                                             m=2,
                                             groupsize=20,
                                             xt=c( 1,2,8,240,245),
                                             minxt=c(0,0,0,240,240),
                                             maxxt=c(10,10,10,248,248),
                                             discrete_xt = list(0:248),
                                             bUseGrouped_xt=1,
                                             a=list(c(DOSE=20,TAU=24),c(DOSE=40, TAU=24)),
                                             maxa=c(DOSE=200,TAU=24),
                                             mina=c(DOSE=0,TAU=24),
                                             ourzero = 0)
  
  output_discrete &lt;- poped_optim(poped.db.discrete, opt_xt=T, parallel = TRUE)
  
  
  summary(output_discrete)
  get_rse(output_discrete$FIM,output_discrete$poped.db)
  plot_model_prediction(output_discrete$poped.db)
  
  # Efficiency of sampling windows
  plot_efficiency_of_windows(output_discrete$poped.db,xt_windows=0.5)
  plot_efficiency_of_windows(output_discrete$poped.db,xt_windows=1)
  

## End(Not run)
</code></pre>


</div>