<div class="container">

<table style="width: 100%;"><tr>
<td>ancr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute marginal or joint ancestral state estimates</h2>

<h3>Description</h3>

<p>By default, <code>ancr</code> computes marginal ancestral states, also known as empirical Bayes posterior probabilities, conditioning on the fitted (or set) model of <code>object</code>.
</p>
<p>Can also perform <em>joint</em> ancestral state estimation, if the optional argument <code>type</code> is set to <code>type="joint"</code>.
</p>
<p><code>hide.hidden</code> merges hidden states (if any).
</p>


<h3>Usage</h3>

<pre><code class="language-R">ancr(object, ...)
hide.hidden(object, ...)
## S3 method for class 'ancr'
plot(x, args.plotTree=list(...), args.nodelabels=list(...), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>fitted M<em>k</em> model (presently object of class <code>"fitMk"</code>, <code>"fitpolyMk"</code>, and <code>"fitHRM"</code>), or a set of models in the form of a table from <code>anova</code> comparison. For <code>hide.hidden</code>, object of class <code>"ancr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>in the case of <code>plot.ancr</code>, an object of class <code>"ancr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>args.plotTree</code></td>
<td>
<p>arguments to be passed to <code>plotTree</code>, in a list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>args.nodelabels</code></td>
<td>
<p>arguments to be passed to <code>nodelabels</code>, in a list.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If the optional argument <code>tips=TRUE</code>, then the matrix returned contains empirical Bayes posterior probabilities (marginal scaled likelihoods) for both tips <em>and</em> internal nodes. Otherwise (the default) only node marginal states are returned.
</p>
<p>If the input object is a set of models (in the form of an <code>anova</code> table), then <code>ancr</code> will compute model-averaged marginal ancestral states (for <code>type="marginal"</code>, unless the optional argument <code>weighted=FALSE</code>, in which case only the best-supported model is used.
</p>


<h3>Value</h3>

<p>An object of class <code>"ancr"</code>. In the case of <code>type="marginal"</code>, this object consists of a matrix of marginal (empirical Bayes) probabilities and a likelihood. In the case of <code>type="joint"</code>, the object contains a set of most-likely internal node states stored in a data frame.
</p>


<h3>Author(s)</h3>

<p>Liam Revell <a href="mailto:liam.revell@umb.edu">liam.revell@umb.edu</a></p>


<h3>References</h3>

<p>Pagel, M. (1999) The Maximum Likelihood approach to reconstructing ancestral character states of discrete characters on phylogenies. <em>Systematic Biology</em>, <b>3</b>, 612-622.
</p>
<p>Revell, L. J. (2024) phytools 2.0: an updated R ecosystem for phylogenetic comparative methods (and other things). <em>PeerJ</em>, <b>12</b>, e16505.
</p>


<h3>See Also</h3>

<p><code>fitMk</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## load tree and data from Revell &amp; Collar (2009)
data(sunfish.tree)
data(sunfish.data)
## extract discrete character (feeding mode)
fmode&lt;-setNames(sunfish.data$feeding.mode,
  rownames(sunfish.data))
## fit ARD model
ard_fmode&lt;-fitMk(sunfish.tree,fmode,model="ARD",
  pi="fitzjohn")
## compute ancestral states
anc_fmode&lt;-ancr(ard_fmode)
## plot the results
par(mfrow=c(2,1))
cols&lt;-setNames(c("blue","red"),levels(fmode))
plot(anc_fmode,
  args.plotTree=list(lwd=2,direction="upwards",
    mar=c(0.1,1.1,2.1,1.1),fsize=0.8),
  args.nodelabels=list(piecol=cols),
  args.tiplabels=list(cex=0.3),
  legend="bottomright")
mtext("a) marginal states under ARD model",adj=0)
## fit ER model
er_fmode&lt;-fitMk(sunfish.tree,fmode,model="ER",
  pi="fitzjohn")
## compare models
aov_fmode&lt;-anova(er_fmode,ard_fmode)
## compute model-averaged ancestral states
anc_fmode_model.averaged&lt;-ancr(aov_fmode)
plot(anc_fmode_model.averaged,
  args.plotTree=list(lwd=2,direction="upwards",
    mar=c(0.1,1.1,2.1,1.1),fsize=0.8),
  args.nodelabels=list(piecol=cols),
  args.tiplabels=list(cex=0.3),
  legend="bottomright")
mtext("b) marginal states model-averaging ER &amp; ARD models",
  adj=0)
par(mar=c(5.1,4.1,4.1,2.1),mfrow=c(1,1))
</code></pre>


</div>