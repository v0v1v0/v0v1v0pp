<div class="container">

<table style="width: 100%;"><tr>
<td>survtab</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate Survival Time Functions</h2>

<h3>Description</h3>

<p>This function estimates survival time functions: survival, 
relative/net survival, and crude/absolute risk functions (CIF).
</p>


<h3>Usage</h3>

<pre><code class="language-R">survtab(
  formula,
  data,
  adjust = NULL,
  breaks = NULL,
  pophaz = NULL,
  weights = NULL,
  surv.type = "surv.rel",
  surv.method = "hazard",
  relsurv.method = "e2",
  subset = NULL,
  conf.level = 0.95,
  conf.type = "log-log",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a <code>formula</code>; e.g. <code>fot ~ sex</code>,
where <code>fot</code> is the time scale over which you wish to estimate a
survival time function; this
assumes that <code>lex.Xst</code> in your data is the status variable in the
intended format (almost always right). 
To be explicit, use <code>Surv</code>: e.g. 
<code>Surv(fot, lex.Xst) ~ sex</code>. 
Variables on the right-hand side of the formula
separated by <code>+</code> are considered stratifying variables, for which 
estimates are computed separately. May contain usage of <code>adjust()</code> 
— see Details and Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a <code>Lexis</code> object with at least the survival time scale</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>can be used as an alternative to passing variables to 
argument <code>formula</code> within a call to <code>adjust()</code>; e.g.
<code>adjust = "agegr"</code>. Flexible input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>a named list of breaks, e.g.
<code>list(FUT = 0:5)</code>. If data is not split in advance, <code>breaks</code>
must at the very least contain a vector of breaks to split the survival time 
scale (mentioned in argument <code>formula</code>). If data has already been split
(using e.g. <code>splitMulti</code>) along at least the used survival time
scale, this may be <code>NULL</code>. It is generally recommended (and sufficient; 
see Seppa, Dyban and Hakulinen (2015)) to use monthly
intervals where applicable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pophaz</code></td>
<td>
<p>a <code>data.frame</code> containing
expected hazards for the event of interest to occur. See the
dedicated help page. Required when
<code>surv.type = "surv.rel"</code> or <code>"cif.rel"</code>. <code>pophaz</code> must
contain one column named <code>"haz"</code>, and any number of other columns
identifying levels of variables to do a merge with split data within
<code>survtab</code>. Some columns may be time scales, which will
allow for the expected hazard to vary by e.g. calendar time and age.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>typically a list of weights or a <code>character</code> string
specifying an age group standardization scheme; see
the dedicated help page 
and examples. NOTE: <code>weights = "internal"</code> is based on the counts
of persons in follow-up at the start of follow-up (typically T = 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.type</code></td>
<td>
<p>one of <code>'surv.obs'</code>,
<code>'surv.cause'</code>, <code>'surv.rel'</code>, 
<code>'cif.obs'</code> or <code>'cif.rel'</code>; 
defines what kind of survival time function(s) is/are estimated; see Details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.method</code></td>
<td>
<p>either <code>'lifetable'</code> or <code>'hazard'</code>; determines
the method of calculating survival time functions, where the former computes
ratios such as <code>p = d/(n - n.cens)</code> 
and the latter utilizes subject-times 
(typically person-years) for hazard estimates such as <code>d/pyrs</code> 
which are used to compute survival time function estimates.
The former method requires argument <code>n.cens</code> and the latter 
argument <code>pyrs</code> to be supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relsurv.method</code></td>
<td>
<p>either <code>'e2'</code> or <code>'pp'</code>; 
defines whether to compute relative survival using the
EdererII method or using Pohar-Perme weighting;
ignored if <code>surv.type != "surv.rel"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>a logical condition; e.g. <code>subset = sex == 1</code>; 
subsets the data before computations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>confidence level used in confidence intervals; 
e.g. <code>0.95</code> for 95 percent confidence intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.type</code></td>
<td>
<p>character string; must be one of <code>"plain"</code>, 
<code>"log-log"</code> and <code>"log"</code>; 
defines the transformation used on the survival time
function to yield confidence 
intervals via the delta method</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical; if <code>TRUE</code>, the function is chatty and
returns some messages and timings along the process</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a table of life time function values and other 
information with survival intervals as rows.
Returns some of the following estimates of survival time functions:
</p>

<ul>
<li> <p><code>surv.obs</code> - observed (raw, overall) survival
</p>
</li>
<li> <p><code>surv.obs.K</code> - observed cause-specific survival for cause K
</p>
</li>
<li> <p><code>CIF_k</code> - cumulative incidence function for cause <code>k</code>
</p>
</li>
<li> <p><code>CIF.rel</code> - cumulative incidence function using excess cases
</p>
</li>
<li> <p><code>r.e2</code> -  relative survival, EdererII
</p>
</li>
<li> <p><code>r.pp</code> -  relative survival, Pohar-Perme weighted
</p>
</li>
</ul>
<p>The suffix <code>.as</code> implies adjusted estimates, and <code>.lo</code> and
<code>.hi</code> imply lower and upper confidence limits, respectively. 
The prefix <code>SE.</code> stands for standard error.
</p>


<h3>Basics</h3>

<p>This function computes interval-based estimates of survival time functions,
where the intervals are set by the user. For product-limit-based
estimation see packages <span class="pkg">survival</span> and <span class="pkg">relsurv</span>.
</p>
<p>if <code>surv.type = 'surv.obs'</code>, only 'raw' observed survival 
is estimated over the chosen time intervals. With
<code>surv.type = 'surv.rel'</code>, also relative survival estimates 
are supplied in addition to observed survival figures. 
</p>
<p><code>surv.type = 'cif.obs'</code> requests cumulative incidence functions (CIF) 
to be estimated. 
CIFs are estimated for each competing risk based 
on a survival-interval-specific proportional hazards
assumption as described by Chiang (1968).  
With <code>surv.type = 'cif.rel'</code>, a CIF is estimated with using 
excess cases as the ”cause-specific” cases. Finally, with 
<code>surv.type = 'surv.cause'</code>, cause-specific survivals are 
estimated separately for each separate type of event. 
</p>
<p>In hazard-based estimation (<code>surv.method = "hazard"</code>) survival
time functions are transformations of the estimated corresponding hazard
in the intervals. The hazard itself is estimated using counts of events
(or excess events) and total subject-time in the interval. Life table
<code>surv.method = "lifetable"</code> estimates are constructed as transformations 
of probabilities computed using counts of events and counts of subjects 
at risk.
</p>
<p>The vignette <a href="../doc/survtab_examples.html">survtab_examples</a> 
has some practical examples.
</p>


<h3>Relative survival</h3>

<p>When <code>surv.type = 'surv.rel'</code>, the user can choose 
<code>relsurv.method = 'pp'</code>, whereupon Pohar-Perme weighting is used.
By default <code>relsurv.method = 'e2'</code>, i.e. the Ederer II method
is used to estimate relative survival.
</p>


<h3>Adjusted estimates</h3>

<p>Adjusted estimates in this context mean computing estimates separately
by the levels of adjusting variables and returning weighted averages
of the estimates. For example, computing estimates separately by
age groups and returning a weighted average estimate (age-adjusted estimate).
</p>
<p>Adjusting requires specification of both the adjusting variables and
the weights for all the levels of the adjusting variables. The former can be
accomplished by using <code>adjust()</code> with the argument <code>formula</code>,
or by supplying variables directly to argument <code>adjust</code>. E.g. the
following are all equivalent:
</p>
<p><code>formula = fot ~ sex + adjust(agegr) + adjust(area)</code>
</p>
<p><code>formula = fot ~ sex + adjust(agegr, area)</code>
</p>
<p><code>formula  = fot ~ sex, adjust = c("agegr", "area")</code>
</p>
<p><code>formula  = fot ~ sex, adjust = list(agegr, area)</code>
</p>
<p>The adjusting variables must match with the variable names in the
argument <code>weights</code>;
see the dedicated help page. 
Typically weights are supplied as a <code>list</code> or
a <code>data.frame</code>. The former can be done by e.g.
</p>
<p><code>weights = list(agegr = VEC1, area = VEC2)</code>,
</p>
<p>where <code>VEC1</code> and <code>VEC2</code> are vectors of weights (which do not
have to add up to one). See 
<a href="../doc/survtab_examples.html">survtab_examples</a> 
for an example of using a <code>data.frame</code> to pass weights.
</p>


<h3>Period analysis and other data selection schemes</h3>

<p>To calculate e.g. period analysis (delayed entry) estimates, 
limit the data when/before supplying to this function.See 
<a href="../doc/survtab_examples.html">survtab_examples</a>.
</p>


<h3>References</h3>

<p>Perme, Maja Pohar, Janez Stare, and Jacques Esteve. 
"On estimation in relative survival." Biometrics 68.1 (2012): 113-120.
<a href="https://doi.org/10.1111/j.1541-0420.2011.01640.x">doi:10.1111/j.1541-0420.2011.01640.x</a>
</p>
<p>Hakulinen, Timo, Karri Seppa, and Paul C. Lambert. 
"Choosing the relative survival method for cancer survival estimation." 
European Journal of Cancer 47.14 (2011): 2202-2210.
<a href="https://doi.org/10.1016/j.ejca.2011.03.011">doi:10.1016/j.ejca.2011.03.011</a>
</p>
<p>Seppa, Karri, Timo Hakulinen, and Arun Pokhrel. 
"Choosing the net survival method for cancer survival estimation." 
European Journal of Cancer (2013).
<a href="https://doi.org/10.1016/j.ejca.2013.09.019">doi:10.1016/j.ejca.2013.09.019</a>
</p>
<p>CHIANG, Chin Long. Introduction to stochastic processes in biostatistics. 
1968. ISBN-14: 978-0471155003
</p>
<p>Seppa K., Dyba T. and Hakulinen T.: Cancer Survival, 
Reference Module in Biomedical Sciences. Elsevier. 08-Jan-2015.
<a href="https://doi.org/10.1016/B978-0-12-801238-3.02745-8">doi:10.1016/B978-0-12-801238-3.02745-8</a>
</p>


<h3>See Also</h3>

<p><code>splitMulti</code>, <code>lexpand</code>, 
<code>ICSS</code>, <code>sire</code>
<a href="../doc/survtab_examples.html">The survtab_examples vignette</a>
</p>
<p>Other main functions: 
<code>Surv()</code>,
<code>rate()</code>,
<code>relpois()</code>,
<code>relpois_ag()</code>,
<code>sir()</code>,
<code>sirspline()</code>,
<code>survmean()</code>,
<code>survtab_ag()</code>
</p>
<p>Other survtab functions: 
<code>Surv()</code>,
<code>lines.survtab()</code>,
<code>plot.survtab()</code>,
<code>print.survtab()</code>,
<code>summary.survtab()</code>,
<code>survtab_ag()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data("sire", package = "popEpi")
library(Epi)

## NOTE: recommended to use factor status variable
x &lt;- Lexis(entry = list(FUT = 0, AGE = dg_age, CAL = get.yrs(dg_date)), 
           exit = list(CAL = get.yrs(ex_date)), 
           data = sire[sire$dg_date &lt; sire$ex_date, ],
           exit.status = factor(status, levels = 0:2, 
                                labels = c("alive", "canD", "othD")), 
           merge = TRUE)

## phony group variable
set.seed(1L)
x$group &lt;- rbinom(nrow(x), 1, 0.5)

## observed survival. explicit supplying of status:
st &lt;- survtab(Surv(time = FUT, event = lex.Xst) ~ group, data = x, 
              surv.type = "surv.obs",
              breaks = list(FUT = seq(0, 5, 1/12)))
## this assumes the status is lex.Xst (right 99.9 % of the time)
st &lt;- survtab(FUT ~ group, data = x, 
              surv.type = "surv.obs",
              breaks = list(FUT = seq(0, 5, 1/12)))
              
## relative survival (ederer II)
data("popmort", package = "popEpi")
pm &lt;- data.frame(popmort)
names(pm) &lt;- c("sex", "CAL", "AGE", "haz")
st &lt;- survtab(FUT ~ group, data = x, 
              surv.type = "surv.rel",
              pophaz = pm,
              breaks = list(FUT = seq(0, 5, 1/12)))

## ICSS weights usage
data("ICSS", package = "popEpi")
cut &lt;- c(0, 30, 50, 70, Inf)
agegr &lt;- cut(ICSS$age, cut, right = FALSE)
w &lt;- aggregate(ICSS1~agegr, data = ICSS, FUN = sum)
x$agegr &lt;- cut(x$dg_age, cut, right = FALSE)
st &lt;- survtab(FUT ~ group + adjust(agegr), data = x, 
              surv.type = "surv.rel",
              pophaz = pm, weights = w$ICSS1,
              breaks = list(FUT = seq(0, 5, 1/12)))

#### using dates with survtab
x &lt;- Lexis(entry = list(FUT = 0L, AGE = dg_date-bi_date, CAL = dg_date),
           exit = list(CAL = ex_date),
           data = sire[sire$dg_date &lt; sire$ex_date, ],
           exit.status = factor(status, levels = 0:2, 
                                labels = c("alive", "canD", "othD")), 
           merge = TRUE)
## phony group variable
set.seed(1L)
x$group &lt;- rbinom(nrow(x), 1, 0.5)

st &lt;- survtab(Surv(time = FUT, event = lex.Xst) ~ group, data = x, 
              surv.type = "surv.obs",
              breaks = list(FUT = seq(0, 5, 1/12)*365.25))    
                  
## NOTE: population hazard should be reported at the same scale
## as time variables in your Lexis data.
data(popmort, package = "popEpi")
pm &lt;- data.frame(popmort)
names(pm) &lt;- c("sex", "CAL", "AGE", "haz")
## from year to day level
pm$haz &lt;- pm$haz/365.25 
pm$CAL &lt;- as.Date(paste0(pm$CAL, "-01-01")) 
pm$AGE &lt;- pm$AGE*365.25 

st &lt;- survtab(Surv(time = FUT, event = lex.Xst) ~ group, data = x, 
              surv.type = "surv.rel", relsurv.method = "e2",
              pophaz = pm,
              breaks = list(FUT = seq(0, 5, 1/12)*365.25))  

</code></pre>


</div>