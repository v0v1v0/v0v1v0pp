<div class="container">

<table style="width: 100%;"><tr>
<td>ci.coords</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Compute the confidence interval of arbitrary coordinates
</h2>

<h3>Description</h3>

<p>This function computes the confidence interval (CI) of the coordinates
of a ROC curves with the <code>coords</code> function.
By default, the 95% CI are computed with 2000 stratified bootstrap replicates.
</p>


<h3>Usage</h3>

<pre><code class="language-R"># ci.coords(...)
## S3 method for class 'roc'
ci.coords(roc, x,
input=c("threshold", "specificity", "sensitivity"),
ret=c("threshold", "specificity", "sensitivity"),
best.method=c("youden", "closest.topleft"), best.weights=c(1, 0.5),
best.policy = c("stop", "omit", "random"),
conf.level=0.95, boot.n=2000,
boot.stratified=TRUE,
progress=getOption("pROCProgress")$name, ...) 
## S3 method for class 'formula'
ci.coords(formula, data, ...)
## S3 method for class 'smooth.roc'
ci.coords(smooth.roc, x,
input=c("specificity", "sensitivity"), ret=c("specificity", "sensitivity"),
best.method=c("youden", "closest.topleft"), best.weights=c(1, 0.5),
best.policy = c("stop", "omit", "random"),
conf.level=0.95, boot.n=2000,
boot.stratified=TRUE,
progress=getOption("pROCProgress")$name, ...)
## Default S3 method:
ci.coords(response, predictor, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>roc, smooth.roc</code></td>
<td>
<p>a “roc” object from the
<code>roc</code> function, or a “smooth.roc” object from the
<code>smooth</code> function.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response, predictor</code></td>
<td>
<p>arguments for the <code>roc</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula, data</code></td>
<td>
<p>a formula (and possibly a data object) of type
response~predictor for the <code>roc</code> function.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, input, ret, best.method, best.weights</code></td>
<td>
<p>Arguments passed to <code>coords</code>.
See there for more details. The only difference is on the <code>x</code> argument which cannot be
“all” or “local maximas”.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>best.policy</code></td>
<td>
<p>The policy follow when multiple “best” thresholds are returned by <code>coords</code>.
“stop” will abort the processing with <code>stop</code> (default),
“omit” will ignore the sample (as in <code>NA</code>) 
and “random” will select one of the threshold randomly.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the width of the confidence interval as [0,1], never
in percent. Default: 0.95, resulting in a 95% CI.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.n</code></td>
<td>
<p>the number of bootstrap replicates. Default: 2000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.stratified</code></td>
<td>
<p>should the bootstrap be stratified (default, same number
of cases/controls in each replicate than in the original sample) or
not.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>the name of progress bar to display. Typically
“none”, “win”, “tk” or “text” (see the
<code>name</code> argument to <code>create_progress_bar</code> for
more information), but a list as returned by <code>create_progress_bar</code>
is also accepted. See also the “Progress bars” section of
this package's documentation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods,
especially arguments for <code>roc</code> and <code>ci.coords.roc</code>
when calling <code>ci.coords.default</code> or <code>ci.coords.formula</code>.
Arguments for <code>txtProgressBar</code> (only 
<code>char</code> and <code>style</code>) if applicable.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ci.coords.formula</code> and <code>ci.coords.default</code> are convenience methods
that build the ROC curve (with the <code>roc</code> function) before
calling <code>ci.coords.roc</code>. You can pass them arguments for both
<code>roc</code> and <code>ci.coords.roc</code>. Simply use <code>ci.coords</code>
that will dispatch to the correct method.
</p>
<p>This function creates <code>boot.n</code> bootstrap replicate of the ROC
curve, and evaluates the coordinates specified by the <code>x</code>, <code>input</code>,
<code>ret</code>, <code>best.method</code> and <code>best.weights</code> arguments. Then it computes the
confidence interval as the percentiles given by <code>conf.level</code>.
</p>
<p>When <code>x="best"</code>, the best threshold is determined at each bootstrap 
iteration, effectively assessing the confidence interval of choice of the "best"
threshold itself.  This differs from the behavior of <code>ci.thresholds</code>,
where the "best" threshold is assessed on the given ROC curve before
resampling.
</p>
<p>For more details about the bootstrap, see the Bootstrap section in
this package's documentation.
</p>


<h3>Value</h3>

<p><b>Note:</b> changed in version 1.16.
</p>
<p>A list of the same length as <code>ret</code> and named as <code>ret</code>, and of 
class “ci.thresholds”, “ci” and “list” (in this order).
</p>
<p>Each element of the list is a matrix of the confidence intervals with
rows given by <code>x</code> and with 3 columns, the lower bound of the CI, 
the median, and the upper bound of the CI.
</p>
<p>Additionally, the list has the following attributes: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the width of the CI, in fraction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.n</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.stratified</code></td>
<td>
<p>whether or not the bootstrapping was stratified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input</code></td>
<td>
<p>the input coordinate, as given in argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the coordinates used to calculate the CI, as given in argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ret</code></td>
<td>
<p>the return values, as given in argument or substituted by
<code>link{coords}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roc</code></td>
<td>
<p>the object of class “roc” that was used to
compute the CI.
</p>
</td>
</tr>
</table>
<h3>Warnings</h3>

<p>If <code>boot.stratified=FALSE</code> and the sample has a large imbalance between
cases and controls, it could happen that one or more of the replicates
contains no case or control observation, producing a <code>NA</code> area.
The warning “NA value(s) produced during bootstrap were ignored.”
will be issued and the observation will be ignored. If you have a large
imbalance in your sample, it could be safer to keep
<code>boot.stratified=TRUE</code>.
</p>
<p>This warning will also be displayed if you chose <code>best.policy = "omit"</code>
and a ROC curve with multiple “best” threshold was generated
during at least one of the replicates.
</p>


<h3>References</h3>

<p>James Carpenter and John Bithell (2000) “Bootstrap condence intervals:
when, which, what? A practical guide for medical statisticians”.
<em>Statistics in Medicine</em> <b>19</b>, 1141–1164.
DOI: doi: <a href="https://doi.org/10.1002/(SICI)1097-0258(20000515)19:9%3C1141::AID-SIM479%3E3.0.CO;2-F">10.1002/(SICI)1097-0258(20000515)19:9&lt;1141::AID-SIM479&gt;3.0.CO;2-F</a>.
</p>
<p>Tom Fawcett (2006) “An introduction to ROC analysis”. <em>Pattern
Recognition Letters</em> <b>27</b>, 861–874. DOI:
doi: <a href="https://doi.org/10.1016/j.patrec.2005.10.010">10.1016/j.patrec.2005.10.010</a>.
</p>
<p>Hadley Wickham (2011) “The Split-Apply-Combine Strategy for Data Analysis”. <em>Journal of Statistical Software</em>, <b>40</b>, 1–29.
URL: doi: <a href="https://doi.org/10.18637/jss.v040.i01">10.18637/jss.v040.i01</a>.
</p>


<h3>See Also</h3>

<p><code>roc</code>,
<code>coords</code>,
<code>ci</code>
</p>
<p>CRAN package <span class="pkg">plyr</span>, employed in this function.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create a ROC curve:
data(aSAH)
roc1 &lt;- roc(aSAH$outcome, aSAH$s100b)


## Basic example ##
## Not run: 
ci.coords(roc1, x="best", input = "threshold", 
          ret=c("specificity", "ppv", "tp"))


## More options ##
ci.coords(roc1, x=0.9, input = "sensitivity", ret="specificity")
ci.coords(roc1, x=0.9, input = "sensitivity", ret=c("specificity", "ppv", "tp"))
ci.coords(roc1, x=c(0.1, 0.5, 0.9), input = "sensitivity", ret="specificity")
ci.coords(roc1, x=c(0.1, 0.5, 0.9), input = "sensitivity", ret=c("specificity", "ppv", "tp"))

# Return everything we can:
rets &lt;- c("threshold", "specificity", "sensitivity", "accuracy", "tn", "tp", "fn", "fp", "npv", 
          "ppv", "1-specificity", "1-sensitivity", "1-accuracy", "1-npv", "1-ppv")
ci.coords(roc1, x="best", input = "threshold", ret=rets)
## End(Not run)


## On smoothed ROC curves with bootstrap ##
## Not run: 
ci.coords(smooth(roc1), x=0.9, input = "sensitivity", ret=c("specificity", "ppv", "tp"))
## End(Not run)
</code></pre>


</div>