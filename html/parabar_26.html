<div class="container">

<table style="width: 100%;"><tr>
<td>ProgressTrackingContext</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>ProgressTrackingContext</h2>

<h3>Description</h3>

<p>This class represents a progress tracking context for interacting with
<code>Backend</code> implementations via the <code>Service</code> interface.
</p>


<h3>Details</h3>

<p>This class extends the base <code>Context</code> class and overrides the
<code>sapply</code> parent method to decorate the backend instance
with additional functionality. Specifically, this class creates a temporary
file to log the progress of backend tasks, and then creates a progress bar to
display the progress of the backend tasks.
</p>
<p>The progress bar is updated after each backend task execution. The timeout
between subsequent checks of the temporary log file is controlled by the
<code>Options</code> class and defaults to <code>0.001</code>. This value can be
adjusted via the <code>Options</code> instance present in the session
<code>base::.Options</code> list (i.e., see <code>set_option()</code>). For example, to
set the timeout to <code>0.1</code> we can run <code>set_option("progress_timeout", 0.1)</code>.
</p>
<p>This class is a good example of how to extend the base <code>Context</code>
class to decorate the backend instance with additional functionality.
</p>


<h3>Super class</h3>

<p><code>parabar::Context</code> -&gt; <code>ProgressTrackingContext</code>
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>bar</code></dt>
<dd>
<p>The <code>Bar</code> instance registered with the context.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-ProgressTrackingContext-set_backend"><code>ProgressTrackingContext$set_backend()</code></a>
</p>
</li>
<li> <p><a href="#method-ProgressTrackingContext-set_bar"><code>ProgressTrackingContext$set_bar()</code></a>
</p>
</li>
<li> <p><a href="#method-ProgressTrackingContext-configure_bar"><code>ProgressTrackingContext$configure_bar()</code></a>
</p>
</li>
<li> <p><a href="#method-ProgressTrackingContext-sapply"><code>ProgressTrackingContext$sapply()</code></a>
</p>
</li>
<li> <p><a href="#method-ProgressTrackingContext-lapply"><code>ProgressTrackingContext$lapply()</code></a>
</p>
</li>
<li> <p><a href="#method-ProgressTrackingContext-apply"><code>ProgressTrackingContext$apply()</code></a>
</p>
</li>
<li> <p><a href="#method-ProgressTrackingContext-clone"><code>ProgressTrackingContext$clone()</code></a>
</p>
</li>
</ul>
<details><summary>Inherited methods</summary><ul>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="clear"><a href="../../parabar/html/Context.html#method-Context-clear"><code>parabar::Context$clear()</code></a></span></li>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="evaluate"><a href="../../parabar/html/Context.html#method-Context-evaluate"><code>parabar::Context$evaluate()</code></a></span></li>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="export"><a href="../../parabar/html/Context.html#method-Context-export"><code>parabar::Context$export()</code></a></span></li>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="get_output"><a href="../../parabar/html/Context.html#method-Context-get_output"><code>parabar::Context$get_output()</code></a></span></li>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="peek"><a href="../../parabar/html/Context.html#method-Context-peek"><code>parabar::Context$peek()</code></a></span></li>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="start"><a href="../../parabar/html/Context.html#method-Context-start"><code>parabar::Context$start()</code></a></span></li>
<li><span class="pkg-link" data-pkg="parabar" data-topic="Context" data-id="stop"><a href="../../parabar/html/Context.html#method-Context-stop"><code>parabar::Context$stop()</code></a></span></li>
</ul></details><hr>
<a id="method-ProgressTrackingContext-set_backend"></a>



<h4>Method <code>set_backend()</code>
</h4>

<p>Set the backend instance to be used by the context.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$set_backend(backend)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>backend</code></dt>
<dd>
<p>An object of class <code>Backend</code> that supports
progress tracking implements the <code>Service</code> interface.</p>
</dd>
</dl>
</div>



<h5>Details</h5>

<p>This method overrides the parent method to validate the backend
provided and guarantee it is an instance of the
<code>AsyncBackend</code> class.
</p>


<hr>
<a id="method-ProgressTrackingContext-set_bar"></a>



<h4>Method <code>set_bar()</code>
</h4>

<p>Set the <code>Bar</code> instance to be used by the context.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$set_bar(bar)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>bar</code></dt>
<dd>
<p>An object of class <code>Bar</code>.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ProgressTrackingContext-configure_bar"></a>



<h4>Method <code>configure_bar()</code>
</h4>

<p>Configure the <code>Bar</code> instance registered with the context.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$configure_bar(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>A list of named arguments passed to the <code>create()</code> method
of the <code>Bar</code> instance. See the documentation of the
specific concrete bar for details (e.g., <code>ModernBar</code>).</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ProgressTrackingContext-sapply"></a>



<h4>Method <code>sapply()</code>
</h4>

<p>Run a task on the backend akin to <code>parallel::parSapply()</code>, but with a
progress bar.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$sapply(x, fun, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt>
<dd>
<p>An atomic vector or list to pass to the <code>fun</code> function.</p>
</dd>
<dt><code>fun</code></dt>
<dd>
<p>A function to apply to each element of <code>x</code>.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to pass to the <code>fun</code> function.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>This method returns void. The output of the task execution must be
stored in the private field <code>.output</code> on the <code>Backend</code>
abstract class, and is accessible via the <code>get_output()</code> method.
</p>


<hr>
<a id="method-ProgressTrackingContext-lapply"></a>



<h4>Method <code>lapply()</code>
</h4>

<p>Run a task on the backend akin to <code>parallel::parLapply()</code>, but with a
progress bar.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$lapply(x, fun, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt>
<dd>
<p>An atomic vector or list to pass to the <code>fun</code> function.</p>
</dd>
<dt><code>fun</code></dt>
<dd>
<p>A function to apply to each element of <code>x</code>.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to pass to the <code>fun</code> function.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>This method returns void. The output of the task execution must be
stored in the private field <code>.output</code> on the <code>Backend</code>
abstract class, and is accessible via the <code>get_output()</code> method.
</p>


<hr>
<a id="method-ProgressTrackingContext-apply"></a>



<h4>Method <code>apply()</code>
</h4>

<p>Run a task on the backend akin to <code>parallel::parApply()</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$apply(x, margin, fun, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt>
<dd>
<p>An array to pass to the <code>fun</code> function.</p>
</dd>
<dt><code>margin</code></dt>
<dd>
<p>A numeric vector indicating the dimensions of <code>x</code> the
<code>fun</code> function should be applied over. For example, for a matrix,
<code>margin = 1</code> indicates applying <code>fun</code> rows-wise, <code>margin = 2</code>
indicates applying <code>fun</code> columns-wise, and <code>margin = c(1, 2)</code>
indicates applying <code>fun</code> element-wise. Named dimensions are also
possible depending on <code>x</code>. See <code>parallel::parApply()</code> and
<code>base::apply()</code> for more details.</p>
</dd>
<dt><code>fun</code></dt>
<dd>
<p>A function to apply to <code>x</code> according to the <code>margin</code>.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to pass to the <code>fun</code> function.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>This method returns void. The output of the task execution must be
stored in the private field <code>.output</code> on the <code>Backend</code>
abstract class, and is accessible via the <code>get_output()</code> method.
</p>


<hr>
<a id="method-ProgressTrackingContext-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>ProgressTrackingContext$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>See Also</h3>

<p><code>Context</code>, <code>Service</code>, <code>Backend</code>, and
<code>AsyncBackend</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Define a task to run in parallel.
task &lt;- function(x, y) {
    # Sleep a bit.
    Sys.sleep(0.15)

    # Return the result of a computation.
    return(x + y)
}

# Create a specification object.
specification &lt;- Specification$new()

# Set the number of cores.
specification$set_cores(cores = 2)

# Set the cluster type.
specification$set_type(type = "psock")

# Create a backend factory.
backend_factory &lt;- BackendFactory$new()

# Get a backend instance that does not support progress tracking.
backend &lt;- backend_factory$get("sync")

# Create a progress tracking context object.
context &lt;- ProgressTrackingContext$new()

# Attempt to set the incompatible backend instance.
try(context$set_backend(backend))

# Get a backend instance that does support progress tracking.
backend &lt;- backend_factory$get("async")

# Register the backend with the context.
context$set_backend(backend)

# From now all, all backend operations are intercepted by the context.

# Start the backend.
context$start(specification)

# Create a bar factory.
bar_factory &lt;- BarFactory$new()

# Get a modern bar instance.
bar &lt;- bar_factory$get("modern")

# Register the bar with the context.
context$set_bar(bar)

# Configure the bar.
context$configure_bar(
    show_after = 0,
    format = " &gt; completed :current out of :total tasks [:percent] [:elapsed]"
)

# Run a task in parallel (i.e., approx. 1.9 seconds).
context$sapply(x = 1:25, fun = task, y = 10)

# Get the task output.
backend$get_output(wait = TRUE)

# Change the bar type.
bar &lt;- bar_factory$get("basic")

# Register the bar with the context.
context$set_bar(bar)

# Remove the previous bar configuration.
context$configure_bar()

# Run a task in parallel (i.e., approx. 1.9 seconds).
context$sapply(x = 1:25, fun = task, y = 10)

# Get the task output.
backend$get_output(wait = TRUE)

# Close the backend.
context$stop()

</code></pre>


</div>