<div class="container">

<table style="width: 100%;"><tr>
<td>acfpacf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Plotting usual ACF and PACF
</h2>

<h3>Description</h3>

<p>Plots values of usual ACF and PACF functions with confidence
intervals. Function <code>acfpacf</code> uses procedures <code>acfpacf.acf</code> and
<code>acfpacf.pacf</code>, which computes values of ACF and PACF function, respectively.
</p>


<h3>Usage</h3>

<pre><code class="language-R">acfpacf(x, nac, npac, datastr,...)
acfpacf.acf(x, normflg)
acfpacf.pacf(x, m)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>input time series, missing values are not permitted.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nac</code></td>
<td>

<p>number of ACF values to return (typically much less than length of <code>x</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npac</code></td>
<td>

<p>number of PACF values to return (typically much less than length of <code>x</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datastr</code></td>
<td>

<p>string name of data to be printed on the plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normflg</code></td>
<td>

<p>computing parameter for ACF values. These values are returned as a series <code>acf(k)</code> for <code>k = 0, ..., nr</code>, where <code>nr</code>
is length of <code>x</code>. Parameter <code>normflg</code> can be equal to: <br>
0 - <code>acf(k)</code> values will be normalized by <code>nr</code>,<br>
1 - <code>acf(k)</code> values will be normalized by <code>nr</code> multiplied by sample variance (to obtain correlations), <br>
2 - <code>acf(k)</code> values will be divided by <code>nr-k</code>, thus normalized by number of samples at each lag,<br>
3 - <code>acf(k)</code> values will be divided by <code>nr-k</code> multiplied by sample variance.<br>
In <code>acfpacf</code> procedure <code>normflg=3</code> is used.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>

<p>maximum lag to compute PACF values. Value for the first lag (<code>pacf(1)</code>) is equal to <code>acf(2)</code>, which is the lag 1 acf
value, and then for computing values for <code>k = 2, ..., m</code> the Toeplitz structure
of the projection equations is used (see Brockwell, P. J., Davis, R. A., 1991, Time Series: Theory and Methods, example 4.4.2).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments:<br><code>plfg</code>, <code>acalpha</code>, <code>pacacalpha</code>, <code>valcol</code>, <code>thrcol</code>, <code>thrmhcol</code>, where <br><code>plfg</code> is plotting flag, this parameter should be positive number to plot computed <code>acfpacf</code> values,<br><code>acalpha</code> and <code>pacalpha</code> are p-values (or <code>alpha</code> is I type error) thresholds for ACF and PACF plots based on independent normal values,<br><code>valcol,thrcol,thrmhcol</code> are colors of function values, confidence interval markers on the ACF/PACF and confidence interval markers on the ACF/PACF
for multiple hypothesis alpha correction on the plot.<br>
By default parameters are fixed to <code>plfg=1</code>, <code>acalpha=.05</code>, <code>pacacalpha=.05</code>, <code>valcol="red"</code>, <code>thrcol="green"</code>, <code>thrmhcol="blue"</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>acfpacf</code> returns plot of ACF and PACF values with two types of
thresholds for input <code>acalpha</code> and <code>pacalpha</code>, respectively. The first one
denoted by <code>thr</code> is given for ACF values by <code class="reqn"> Pr[acf(j)&gt;thr] = \alpha/2</code> and <code class="reqn">Pr[acf(j)&lt;-thr] = \alpha/2</code>
where <code>acf(k)</code> is the ACF value at lag <code>k</code>. This threshold corresponds to type I
error for null hypothesis that <code>acf(k) = 0</code>. The plot allows to check if any of
the ACF values are significantly non-zero. Actual
threshold calculations are based on the following asymptotic result:
if <code class="reqn">X_t</code> is <code class="reqn">IID (0,\sigma^2)</code>, then for large <code class="reqn">n</code>, <code class="reqn">\hat{\rho}(k)</code> for
<code class="reqn">k &lt;&lt; n</code> are <code class="reqn">IID N(0,1/n)</code> (see Brockwell, P. J., Davis, R. A., 1991, Time Series: Theory and Methods, example 7.2.1, p. 222).
Thus, under the null hypothesis, the plots for <code>thr = qnorm(1-acalpha/2,0,1/sqrt(nr))</code>
should exhibit a proportion of roughly <code>acalpha</code> points that lie outside
the interval <code>[-thr, thr]</code>. Threshold for PACF is based on the same results. <br>
On the other hand we can also interpret the plots as a multiple hypothesis testing problem to compute second
threshold <code>thrm</code>. Suppose, we decided to plot some number of nonzero lags (equal to <code>nac</code>)
of the ACF function. If the estimated <code>acf</code> values estimates
are IID then we have <code>nac</code> independent tests of <code>acf(k) = 0</code>. The probability that at least one of values
lies outside the interval <code>[-thr, thr]</code> is equal to <code>1-Pr[all lie inside]</code>, which is <code>[1-(1-acalpha)]^nac</code>.
Finally, the last expression is approximately
equal to <code>nac*acalpha</code>. To get a threshold <code>thrmh</code> such that <code>1-Pr[all lie inside] = acalpha</code>  we
take the threshold as <br><code>thrmh = qnorm (1-(acalpha/2)/nac, 0, 1/sqrt(nr))</code> (for more details check the Bonferroni correction).<br>
For the PACF, the threshold <code>thrm</code> calculation is based on Theorem 8.1.2
of Time Series: Theory and Methods, p. 241, which states that the PACF values for an AR sequence are
asymptotically normal.
</p>


<h3>Value</h3>

<p>No return value, called for side effects</p>


<h3>Note</h3>

<p>Procedure <code>acfpacf</code> is an implementation of the usual (meaning not periodic) ACF and PACF functions.
It happens that for PC time series the usual ACF and PACF are still useful in the identification of model orders and in some cases can be more sensitive than
the perodic versions. The ACF and PACF values inform about the correlations of the random part. It is possible to run <code>acfpacf</code> on original data which include the peridic mean as a deterministic component. But typically the periodic mean can distort our understanding
(or view) of the random fluctuations, thus running <code>acfpacf</code> additionally on the data after removing periodic mean is suggested.
It is possible to use also <code>acfpacf.acf</code>, <code>acfpacf.pacf</code> procedures to obtain values of
ACF and PACF functions, respectively. When subjected to a truly PC sequence, the usual
ACF and PACF produce an average of the instantaneous (time indexed)
values produced by periodic ACF and periodic PACF. Depending therefore on correlations
between these averaged quantities, the usual ACF and PACF may be more or
less sensitive that the instantaneous ones.
</p>


<h3>Author(s)</h3>

<p>Harry Hurd
</p>


<h3>References</h3>

<p>Box, G. E. P., Jenkins, G. M., Reinsel, G. (1994), Time Series Analysis, 3rd Ed., Prentice-Hall,
Englewood Cliffs, NJ.
<br><br>
Brockwell, P. J., Davis, R. A. (1991), Time Series: Theory and Methods, 2nd Ed., Springer: New York.
<br><br>
Bretz, F., Hothorn, T., Westfall, P. (2010), Multiple Comparisons Using R, CRC Press.
<br><br>
Westfall, P. H., Young, S. S. (1993), Resampling-Based Multiple Testing: Examples and Methods
for p-Value Adjustment, Wiley Series in Probability and Statistics.
</p>


<h3>See Also</h3>

<p><code>peracf</code>, <code>perpacf</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(volumes)
# for original data
dev.set(which=1)
acfpacf(volumes,24,24,'volumes')

# for data after removing periodic mean
pmean_out&lt;-permest(t(volumes),24, 0.05, NaN,'volumes',pp=0)
xd=pmean_out$xd
dev.set(which=1)
acfpacf(xd,24,24,'volumes')
</code></pre>


</div>