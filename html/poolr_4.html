<div class="container">

<table style="width: 100%;"><tr>
<td>empirical</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate Empirically-Derived Null Distributions</h2>

<h3>Description</h3>

<p>Function to simulate empirically-derived null distributions of various methods for combining \(p\)-values using pseudo replicates.<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>


<h3>Usage</h3>

<pre><code class="language-R">empirical(R, method, side = 2, size = 10000, batchsize, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>a \(k \times k\) symmetric matrix that contains the correlations among the test statistics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character string to specify for which method to simulate the null distribution (either <code>"fisher"</code>, <code>"stouffer"</code>, <code>"invchisq"</code>, <code>"binomtest"</code>, <code>"bonferroni"</code>, or <code>"tippett"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>side</code></td>
<td>
<p>scalar to specify the sidedness of the \(p\)-values that are used to simulate the null distribution (2, by default, for two-sided tests; 1 for one-sided tests).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>size of the empirically-derived null distribution that should be generated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batchsize</code></td>
<td>
<p>optional scalar to specify the batch size for generating the null distribution. When unspecified (the default), this is done in a single batch.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function simulates the null distribution of a particular method for combining \(p\)-values when the test statistics that generate the \(p\)-values to be combined can be assumed to follow a multivariate normal distribution and a matrix is available that reflects the correlations among the test statistics (which is specified via the <code>R</code> argument). In this case, test statistics are repeatedly simulated from a multivariate normal distribution under the joint null hypothesis, converted into one- or two-sided \(p\)-values (depending on the <code>side</code> argument), and the chosen method is applied. Repeating this process <code>size</code> times yields the null distribution.
</p>
<p>If <code>batchsize</code> is unspecified, the null distribution is simulated in a single batch, which requires temporarily storing a matrix with dimensions <code>[size,k]</code>. When <code>size*k</code> is large, allocating the memory for this matrix might not be possible. Instead, one can specify a <code>batchsize</code> value, in which case a matrix with dimensions <code>[batchsize,k]</code> is repeatedly simulated until the desired size of the null distribution has been obtained.
</p>


<h3>Value</h3>

<p>A vector of combined \(p\)-values as simulated under the joint null hypothesis for a given method.
</p>


<h3>Note</h3>

<p>The <code>R</code> matrix must be positive definite. If it is not, the function uses <code>nearPD</code> to find the nearest positive definite matrix (Higham, 2002) before simulating the null distribution.
</p>


<h3>Author(s)</h3>

<p>Ozan Cinar <a href="mailto:ozancinar86@gmail.com">ozancinar86@gmail.com</a> <br>
Wolfgang Viechtbauer <a href="mailto:wvb@wvbauer.com">wvb@wvbauer.com</a> <br></p>


<h3>References</h3>

<p>Cinar, O. &amp; Viechtbauer, W. (2022). The poolr package for combining independent and dependent p values. <em>Journal of Statistical Software</em>, <b>101</b>(1), 1–42. <code style="white-space: pre;">⁠https://doi.org/10.18637/jss.v101.i01⁠</code>
</p>
<p>Higham, N. J. (2002). Computing the nearest correlation matrix: A problem from finance. <em>IMA Journal of Numerical Analysis, 22</em>(3), 329–343.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># create an example correlation matrix with constant positive correlations
R &lt;- matrix(0.6, nrow = 10, ncol = 10)
diag(R) &lt;- 1

# generate null distribution for Fisher's method (setting the seed for reproducibility)
set.seed(1234)
psim &lt;- empirical(R, method = "fisher")

# Fisher's method is liberal in this scenario (i.e., its actual Type I error
# rate is around .14 instead of the nominal significance level of .05)
mean(psim &lt;= .05)

# estimate the actual Type I error rate of the other methods in this scenario
psim &lt;- empirical(R, method = "stouffer")
mean(psim &lt;= .05)
psim &lt;- empirical(R, method = "invchisq")
mean(psim &lt;= .05)
psim &lt;- empirical(R, method = "binomtest")
mean(psim &lt;= .05)
psim &lt;- empirical(R, method = "bonferroni")
mean(psim &lt;= .05)
psim &lt;- empirical(R, method = "tippett")
mean(psim &lt;= .05)

# Stouffer's and the inverse chi-square method also have clearly inflated
# Type I error rates and the binomial test just barely. As expected, the
# Bonferroni method is overly conservative and so is Tippett's method.
</code></pre>


</div>