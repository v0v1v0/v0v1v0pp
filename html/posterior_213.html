<div class="container">

<table style="width: 100%;"><tr>
<td>pareto_diags</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pareto smoothing diagnostics</h2>

<h3>Description</h3>

<p>Compute diagnostics for Pareto smoothing the tail draws of x by
replacing tail draws by order statistics of a generalized Pareto
distribution fit to the tail(s).
</p>


<h3>Usage</h3>

<pre><code class="language-R">pareto_diags(x, ...)

## Default S3 method:
pareto_diags(
  x,
  tail = c("both", "right", "left"),
  r_eff = NULL,
  ndraws_tail = NULL,
  verbose = FALSE,
  are_log_weights = FALSE,
  ...
)

## S3 method for class 'rvar'
pareto_diags(x, ...)

pareto_khat_threshold(x, ...)

## Default S3 method:
pareto_khat_threshold(x, ...)

## S3 method for class 'rvar'
pareto_khat_threshold(x, ...)

pareto_min_ss(x, ...)

## Default S3 method:
pareto_min_ss(x, ...)

## S3 method for class 'rvar'
pareto_min_ss(x, ...)

pareto_convergence_rate(x, ...)

## Default S3 method:
pareto_convergence_rate(x, ...)

## S3 method for class 'rvar'
pareto_convergence_rate(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>(multiple options) One of:
</p>

<ul>
<li>
<p> A matrix of draws for a single variable (iterations x chains). See
<code>extract_variable_matrix()</code>.
</p>
</li>
<li>
<p> An <code>rvar</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to individual methods (if applicable).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tail</code></td>
<td>
<p>(string) The tail to diagnose/smooth:
</p>

<ul>
<li> <p><code>"right"</code>: diagnose/smooth only the right (upper) tail
</p>
</li>
<li> <p><code>"left"</code>: diagnose/smooth only the left (lower) tail
</p>
</li>
<li> <p><code>"both"</code>: diagnose/smooth both tails and return the maximum k-hat value
</p>
</li>
</ul>
<p>The default is <code>"both"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_eff</code></td>
<td>
<p>(numeric) relative effective sample size estimate. If
<code>r_eff</code> is NULL, it will be calculated assuming the draws are
from MCMC. Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndraws_tail</code></td>
<td>
<p>(numeric) number of draws for the tail. If
<code>ndraws_tail</code> is not specified, it will be calculated as
ceiling(3 * sqrt(length(x) / r_eff)) if length(x) &gt; 225 and
length(x) / 5 otherwise (see Appendix H in Vehtari et
al. (2024)).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>(logical) Should diagnostic messages be printed? If
<code>TRUE</code>, messages related to Pareto diagnostics will be
printed. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>are_log_weights</code></td>
<td>
<p>(logical) Are the draws log weights? Default is
<code>FALSE</code>. If <code>TRUE</code> computation will take into account that the
draws are log weights, and only right tail will be smoothed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When the fitted Generalized Pareto Distribution is used to
smooth the tail values and these smoothed values are used to
compute expectations, the following diagnostics can give further
information about the reliability of these estimates.
</p>

<ul>
<li> <p><code>min_ss</code>: Minimum sample size for reliable Pareto smoothed
estimate. If the actual sample size is greater than <code>min_ss</code>, then
Pareto smoothed estimates can be considered reliable. If the actual
sample size is lower than <code>min_ss</code>, increasing the sample size
might result in more reliable estimates. For further details, see
Section 3.2.3, Equation 11 in Vehtari et al. (2024).
</p>
</li>
<li> <p><code>khat_threshold</code>: Threshold below which k-hat values result in
reliable Pareto smoothed estimates. The threshold is lower for
smaller effective sample sizes. If k-hat is larger than the
threshold, increasing the total sample size may improve reliability
of estimates. For further details, see Section 3.2.4, Equation 13
in Vehtari et al. (2024).
</p>
</li>
<li> <p><code>convergence_rate</code>: Relative convergence rate compared to the
central limit theorem. Applicable only if the actual sample size
is sufficiently large (greater than <code>min_ss</code>). The convergence
rate tells the rate at which the variance of an estimate reduces
when the sample size is increased, compared to the central limit
theorem convergence rate. See Appendix B in Vehtari et al. (2024).
</p>
</li>
</ul>
<h3>Value</h3>

<p>List of Pareto smoothing diagnostics:
</p>

<ul>
<li> <p><code>khat</code>: estimated Pareto k shape parameter,
</p>
</li>
<li> <p><code>min_ss</code>: minimum sample size for reliable Pareto smoothed estimate,
</p>
</li>
<li> <p><code>khat_threshold</code>: khat-threshold for reliable Pareto smoothed estimate,
</p>
</li>
<li> <p><code>convergence_rate</code>: Pareto smoothed estimate RMSE convergence rate.
</p>
</li>
</ul>
<h3>References</h3>

<p>Aki Vehtari, Daniel Simpson, Andrew Gelman, Yuling Yao and
Jonah Gabry (2024). Pareto Smoothed Importance Sampling.
<em>Journal of Machine Learning Research</em>, 25(72):1-58.
<a href="https://jmlr.org/papers/v25/19-556.html">PDF</a>
</p>


<h3>See Also</h3>

<p><code>pareto_khat</code>, <code>pareto_min_ss</code>,
<code>pareto_khat_threshold</code>, and <code>pareto_convergence_rate</code> for
individual diagnostics; and <code>pareto_smooth</code> for Pareto smoothing
draws.
</p>
<p>Other diagnostics: 
<code>ess_basic()</code>,
<code>ess_bulk()</code>,
<code>ess_quantile()</code>,
<code>ess_sd()</code>,
<code>ess_tail()</code>,
<code>mcse_mean()</code>,
<code>mcse_quantile()</code>,
<code>mcse_sd()</code>,
<code>pareto_khat()</code>,
<code>rhat()</code>,
<code>rhat_basic()</code>,
<code>rhat_nested()</code>,
<code>rstar()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">mu &lt;- extract_variable_matrix(example_draws(), "mu")
pareto_diags(mu)

d &lt;- as_draws_rvars(example_draws("multi_normal"))
pareto_diags(d$Sigma)
</code></pre>


</div>