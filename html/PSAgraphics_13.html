<div class="container">

<table style="width: 100%;"><tr>
<td>loess.psa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Graphic for data and loess-based estimate of effect size after propensity
score adjustment</h2>

<h3>Description</h3>

<p>Plots data points using propesity scores vs. the response, separately for
treatment and control groups; points are distinguished by both type and
color for the two groups.  Also shows (non-linear, loess-based) regression
curves for both groups.  The loess regresion curves are then used to derive
an overall estimate of effect size (based on number and/or location of
strata as set by the user).  Several other statistics are also provided, for
both description and inference.  Graphic motivated by a suggestion of R. L.
Obenchain.
</p>


<h3>Usage</h3>

<pre><code class="language-R">loess.psa(
  response,
  treatment = NULL,
  propensity = NULL,
  family = "gaussian",
  span = 0.7,
  degree = 1,
  minsize = 5,
  xlim = c(0, 1),
  colors = c("dark blue", "dark green", "blue", "dark green"),
  legend.xy = "topleft",
  legend = NULL,
  int = 10,
  lines = TRUE,
  strata.lines = TRUE,
  rg = TRUE,
  xlab = "Estimated Propensity Scores",
  ylab = "Response",
  pch = c(16, 1),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>Either a numeric vector containing the response of interest
in a propensity score analysis, or a three column array containing response,
treatment and strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treatment</code></td>
<td>
<p>Binary variable of same length as <code>response</code>; 0 for
'control,' 1 for 'treatment.'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>propensity</code></td>
<td>
<p>Numeric vector of estimated propensity scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Passed to loess. Either <code>"gaussian"</code> (default) or
<code>"symmetric"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>span</code></td>
<td>
<p>Parameter passed to loess governing degree of smoothing.
Default = 0.7.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>Parameter passed to loess governing degree of polynomials
used.  Default = 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minsize</code></td>
<td>
<p>Integer.  Determines the minimum number of observations in
each stratum treatment group allowed.  If one of the treatment groups in a
given statum does not meet this minsize, then all observations in this
stratum are ignored as far as the effect size calculation is concerned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>Binary vector <code>(min, max)</code> providing the horizontal axis
minimum and maximum.  Default is <code>c(0, 1)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colors</code></td>
<td>
<p>List of four colors used for control points, treatment points,
control loess line, treatment loess line respectively.  Default =
<code>c("seagreen3", "goldenrod1", "seagreen4", "goldenrod3")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.xy</code></td>
<td>
<p>Coordinates for legend box, see <code>legend</code>.  Default =
<code>"topleft"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>Binary character vector containing the text of the legend.
Default is taken from <code>treatment</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>int</code></td>
<td>
<p>Integer or ordered vector.  If an integer is used, it represents
the maximum number of equally sized strata.  Alternatively, it may be a
vector of cuts of the unit interval. Lower and upper ends need not be
included.  See examples. Default = 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lines</code></td>
<td>
<p>Logical; fitted loess values are plotted by default as points.
If true, values are plotted as two lines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata.lines</code></td>
<td>
<p>Logical; default = <code>TRUE</code>.  Creates light vertical
lines that delineate strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rg</code></td>
<td>
<p>Logical; if <code>TRUE</code> (default) then rug plots are given for
treatment and control propensity score and response distributions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>X axis label, default = <code>"Estimated Propensity Scores"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>Y axis label, default = <code>"Response"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>Character types for plotted points, default = <code>c(16, 1)</code>.
Note: must be of length 2 to allow different plotting points for each
treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional parameters passed to points command.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>In addition to the plot, the function returns a list with the
following components: </p>
<table>
<tr style="vertical-align: top;">
<td><code>ATE</code></td>
<td>
<p>Estimated effect size based upon (number
of) strata defined by <code>int</code>; that is, this is the Average Treatment
Effect, after propensity-based adjustment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.wtd</code></td>
<td>
<p>Weighted standard
error based on pooling of within-strata variance estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI.95</code></td>
<td>
<p>Approximate 95% confidence interval for the overall effect
size (conditional on the specification of <code>int</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summary.strata</code></td>
<td>
<p>A table with rows corresponding to strata; first two
columns show counts (by statum) for both control and treatment; followed by
mean differences for all strata.  for control and treatment, followed by
mean differences for all strata.  The weighted average difference yields the
effect size noted above.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>James E. Helmreich <a href="mailto:James.Helmreich@Marist.edu">James.Helmreich@Marist.edu</a>
</p>
<p>Robert M. Pruzek <a href="mailto:RMPruzek@yahoo.com">RMPruzek@yahoo.com</a>
</p>


<h3>See Also</h3>

<p><code>circ.psa</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#Artificial example where ATE should be 1 over all of (0,1).
response1 &lt;- c(rep(1, 100), rep(2, 100), rep(3, 100)) + rnorm(300, 0, .5)
response0 &lt;- c(rep(0, 100), rep(1, 100), rep(2, 100)) + rnorm(300, 0, .5)
response &lt;- c(response1, response0)
treatment &lt;- c(rep(1, 300), rep(0, 300))
propensity &lt;- rep(seq(.01, .99, (.98/299)), 2)
a &lt;- data.frame(response, treatment, propensity)
loess.psa(a, span = .15, degree = 1, int = c(0, .33, .67, 1))


#Artificial example where estimates are unstable with varying
#numbers of strata. Note: sometimes get empty treatment/strata error.
rr &lt;- c(rnorm(150, 3, .75), rnorm(700, 0, .75), rnorm(150, 3, .75),
     rnorm(150, -3, .75), rnorm(700, 0, .75), rnorm(150, -3, .75))
tt &lt;- c(rep(1, 1000),rep(0, 1000))
pp &lt;- NULL
for(i in 1:1000){pp &lt;- c(pp, rnorm(1, 0, .05) + .00045*i + .25)}
for(i in 1:1000){pp &lt;- c(pp, rnorm(1, 0, .05) + .00045*i + .4)}
a &lt;- data.frame(rr, tt, pp)
loess.psa(a, span=.5, cex = .6)

#Using strata of possible interest as determined by loess lines.
data(lindner)
attach(lindner)
lindner.ps &lt;- glm(abcix ~ stent + height + female +
      diabetic + acutemi + ejecfrac + ves1proc,
      data = lindner, family = binomial)
loess.psa(log(cardbill), abcix, lindner.ps$fitted,
         int = c(.37, .56, .87, 1), lines = TRUE)
         abline(v=c(.37, 56, .87))

</code></pre>


</div>