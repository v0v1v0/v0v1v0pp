<div class="container">

<table style="width: 100%;"><tr>
<td>diagnose_assertion_failure</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Implement a custom assertion</h2>

<h3>Description</h3>

<p><code>diagnose_assertion_failure()</code> displays customized failure message and
diagnosis in assertions such as <code>precondition()</code>. This can be used to
implement assertion helpers. This function does nothing if invoked outside
an assertion (see details). The function <code>forwarded_arg_label()</code> looks up a
forwarded argument and formats it as a string (used in custom diagnostic
messages).
</p>


<h3>Usage</h3>

<pre><code class="language-R">diagnose_assertion_failure(message, ..., .details)

forwarded_arg_label(arg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>diagnostic message to show (see <code>rlang::format_error_bullets()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>expressions to diagnose (forwarded to <code>diagnose_expressions()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.details</code></td>
<td>
<p>an optional data frame with diagnosis data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arg</code></td>
<td>
<p>a forwarded function argument</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If invoked as part of an assertion (e.g. <code>precondition()</code>),
<code>diagnose_assertion_failure()</code> provides a custom failure message and
diagnosis. If invoked in any other context, the function does nothing. This
can be used to implement custom assertions helpers that behave like regular
binary predicates (functions) under normal circumstances and generate a
customized assertion failure report when used as part of an assertion
(see examples).
</p>
<p>The first argument to <code>diagnose_assertion_failure()</code> is a character vector
with a custom failure message. This vector will be formatted as error
bullets via<code>rlang::format_error_bullets()</code>. Any subsequent argument will be
forwarded to <code>diagnose_assertion_failure()</code> for diagnosis. For custom
diagnosis, the user can supply their own data frame with diagnosis details
via optional argument <code>.details</code>. The format of this data frame must be
identical to one returned by <code>diagnose_assertion_failure()</code>.
</p>
<p>The function <code>forwarded_arg_label()</code> looks up a forwarded expression and
formats it as a single string suitable for inclusion in diagnostic
messages.
</p>


<h3>Value</h3>

<p><code>diagnose_assertion_failure()</code> always returns <code>FALSE</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# returns TRUE if x is a positive, integer, FALSE otherwise
# if invoked as part of an assertion displays a custom failure diagnosis
is_positive_int &lt;- function(x) {
  is.integer(x) &amp;&amp; length(x) == 1L &amp;&amp; (x &gt; 0) || {
    diagnose_assertion_failure(
      sprintf("`%s` must be a positive integer", forwarded_arg_label(x)),
      {{x}}
    )
  }
}

# for all intends and purposes this is just a regular R function that returns
# TRUE or FALSE
is_positive_int(5L)
is_positive_int(-5L)

# guard to avoid throwing errors
if(FALSE) {

# ... but it will provide custom diagnosis if invoked inside an assertion
precondition(is_positive_int(-5L))

}
</code></pre>


</div>