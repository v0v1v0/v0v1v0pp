<div class="container">

<table style="width: 100%;"><tr>
<td>bayes_met</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian model for multi-environment trials</h2>

<h3>Description</h3>

<p>This function runs a Bayesian model for analyzing data from
Multi-environment trials using <code>rstan</code>, the <code>R</code> interface to <code>Stan</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bayes_met(
  data,
  gen,
  loc,
  repl,
  trait,
  reg = NULL,
  year = NULL,
  res.het = FALSE,
  iter = 2000,
  cores = 2,
  chains = 4,
  pars = NA,
  warmup = floor(iter/2),
  thin = 1,
  seed = sample.int(.Machine$integer.max, 1),
  init = "random",
  verbose = FALSE,
  algorithm = c("NUTS", "HMC", "Fixed_param"),
  control = NULL,
  include = TRUE,
  show_messages = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gen, loc</code></td>
<td>
<p>A string. The name of the
column that corresponds to the evaluated genotype and location, respectively. If
the environment is a combination of other factors (for instance, location-year),
the name of the column that contains this information must be attributed to <code>loc</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>repl</code></td>
<td>
<p>A string, a vector, or <code>NULL</code>. If the trial is randomized in complete blocks,
<code>repl</code> will be a string representing the name of the column
that corresponds to the blocks. If the trial is randomized in incomplete blocks design,
<code>repl</code> will be a string vector containing the name of the column that corresponds to
the replicate and block effects on the first and second positions, respectively.
If the data do not have replicates, <code>repl</code> will be <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trait</code></td>
<td>
<p>A string. The name of the column that corresponds to the analysed variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reg</code></td>
<td>
<p>A string or NULL. If the data has information of regions,
<code>reg</code> will be a string with the name of the column that corresponds to the
region information. Otherwise, <code>reg = NULL</code> (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>year</code></td>
<td>
<p>A string or NULL. If the data set has information of time-related
environmental factors (years, seasons...), <code>year</code> will be a string with the
name of the column that corresponds to the time information. Otherwise, <code>year = NULL</code> (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res.het</code></td>
<td>
<p>Logical, indicating if the model should consider heterogeneous
residual variances. Default is <code>FALSE</code>. If <code>TRUE</code>, the model will estimate one
residual variance per location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for each 
chain (including warmup). The default is 2000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Number of cores to use when executing the chains in parallel,
which defaults to 1 but we recommend setting the <code>mc.cores</code> option 
to be as many processors as the hardware and RAM allow (up to the 
number of chains).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p>A positive integer specifying the number of Markov chains. 
The default is 4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pars</code></td>
<td>
<p>A vector of character strings specifying parameters of interest. 
The default is <code>NA</code> indicating all parameters in the model. 
If <code>include = TRUE</code>, only samples for parameters named in <code>pars</code> 
are stored in the fitted results. Conversely, if <code>include = FALSE</code>, 
samples for all parameters <em>except</em> those named in <code>pars</code> are 
stored in the fitted results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warmup</code></td>
<td>
<p>A positive integer specifying the number of warmup (aka burnin)
iterations per chain. If step-size adaptation is on (which it is by default), 
this also controls the number of iterations for which adaptation is run (and
hence these warmup samples should not be used for inference). The number of 
warmup iterations should be smaller than <code>iter</code> and the default is
<code>iter/2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>A positive integer specifying the period for saving samples. 
The default is 1, which is usually the recommended value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>The seed for random number generation. The default is generated 
from 1 to the maximum integer supported by <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> on the machine. Even if 
multiple chains are used, only one seed is needed, with other chains having 
seeds derived from that of the first chain to avoid dependent samples.
When a seed is specified by a number, <code>as.integer</code> will be applied to it. 
If <code>as.integer</code> produces <code>NA</code>, the seed is generated randomly. 
The seed can also be specified as a character string of digits, such as
<code>"12345"</code>, which is converted to integer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>Initial values specification. See the detailed documentation for 
the init argument in <code>stan</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>: flag indicating whether 
to print intermediate output from Stan on the console, which might
be helpful for model debugging.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>algorithm</code></td>
<td>
<p>One of sampling algorithms that are implemented in Stan. 
Current options are <code>"NUTS"</code> (No-U-Turn sampler, Hoffman and Gelman 2011, Betancourt 2017), 
<code>"HMC"</code> (static HMC), or <code>"Fixed_param"</code>. The default and 
preferred algorithm is <code>"NUTS"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A named <code>list</code> of parameters to control the sampler's
behavior. See the details in the documentation for the <code>control</code> argument
in <code>stan</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include</code></td>
<td>
<p>Logical scalar defaulting to <code>TRUE</code> indicating
whether to include or exclude the parameters given by the 
<code>pars</code> argument. If <code>FALSE</code>, only entire multidimensional
parameters can be excluded, rather than particular elements of them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_messages</code></td>
<td>
<p>Either a logical scalar (defaulting to <code>TRUE</code>)
indicating whether to print the summary of Informational Messages to
the screen after a chain is finished or a character string naming a path
where the summary is stored. Setting to <code>FALSE</code> is not recommended
unless you are very sure that the model is correct up to numerical 
error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments can be <code>chain_id</code>, <code>init_r</code>, 
<code>test_grad</code>, <code>append_samples</code>, <code>refresh</code>,
<code>enable_random_init</code>. See the documentation in <code>stan</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>More details about the usage of <code>bayes_met</code> and other function of
the <code>ProbBreed</code> package can be found at <a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a>.
Information on solutions to solve convergence or mixing issue can be found at
<a href="https://mc-stan.org/misc/warnings.html">https://mc-stan.org/misc/warnings.html</a>.
</p>


<h3>Value</h3>

<p>An object of S4 class <code>stanfit</code> representing
the fitted results. Slot <code>mode</code> for this object
indicates if the sampling is done or not.
</p>


<h3>Methods</h3>


<dl>
<dt><code>sampling</code></dt>
<dd>
<p><code>signature(object = "stanmodel")</code>
Call a sampler (NUTS, HMC, or Fixed_param depending on parameters) 
to draw samples from the model defined by S4 class <code>stanmodel</code> 
given the data, initial values, etc. 
</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>rstan::sampling()</code>, <code>rstan::stan()</code>, <code>rstan::stanfit()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
mod = bayes_met(data = maize,
                gen = "Hybrid",
                loc = "Location",
                repl = c("Rep", "Block"),
                year = NULL,
                reg = 'Region',
                res.het = FALSE,
                trait = 'GY',
                iter = 6000, cores = 4, chains = 4)
                
</code></pre>


</div>