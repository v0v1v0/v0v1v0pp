<div class="container">

<table style="width: 100%;"><tr>
<td>semireg_tmb</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fitting Semi Parametric Models Using glmmTMB
</h2>

<h3>Description</h3>

<p>Fit a semi parametric model based on glmmTMB.
</p>


<h3>Usage</h3>

<pre><code class="language-R">semireg_tmb(formula, data, family = gaussian(), smoothZ = list(), ziformula = ~0, 
        dispformula = ~1, weights = NULL, offset = NULL, contrasts = NULL, na.action, 
		se = TRUE, verbose = FALSE, doFit = TRUE, control = glmmTMBControl(), 
		REML = TRUE, start = NULL, map = NULL, sparseX = NULL, prt=TRUE, 
		predict_info=TRUE)
</code></pre>


<h3>Arguments</h3>

	
<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>

<p>A two-sided linear formula object describing both the fixed-effects and random-effects part of the model, with the response on the left of a ~ operator and the terms, separated by + operators, on the right. Random-effects terms are distinguished by vertical bars ("|") separating expressions for design matrices from grouping factors.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame (tibbles are OK) containing model variables. Not required, but strongly recommended; if <code>data</code> is not specified, downstream methods such as prediction with new data (<code>predict(fitted_model, newdata = ...)</code>) will fail. If it is necessary to call <code>glmmTMB</code> with model variables taken from the environment rather than from a data frame, specifying <code>data=NULL</code> will suppress the warning message.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a family function, a character string naming a family function, or the result of a call to a family function (variance/link function) information. See <code>family</code> for a generic discussion of families or <code>family_glmmTMB</code> for details of <code>glmmTMB</code>-specific families.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoothZ</code></td>
<td>

<p>A list includes a set of smooth Z matrixs (called 'smooth term') used in the mixed effects model, the name of 'smooth term' should be different any variables in the model, each 'smooth term' is the result of function <code>smZ</code>. e.g.
smoothZ=list(sm1=smZ(x1), sm2=smZ(x2, by=f1), sm3=smZ(x3, by=f2, group=TRUE), ...) where 'sm1' to 'sm3' should be new variable names in the <code>data</code>, and x1 to x3 are covariates, and f1, f2 are factors.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ziformula</code></td>
<td>
<p>a <em>one-sided</em> (i.e., no response variable) formula for zero-inflation combining fixed and random effects: the default <code>~0</code> specifies no zero-inflation. Specifying <code>~.</code> sets the zero-inflation formula identical to the right-hand side of <code>formula</code> (i.e., the conditional effects formula); terms can also be added or subtracted. <strong>When using <code>~.</code> as the zero-inflation formula in models where the conditional effects formula contains an offset term, the offset term will automatically be dropped</strong>. The zero-inflation model uses a logit link.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dispformula</code></td>
<td>
<p>a <em>one-sided</em> formula for dispersion containing only fixed effects: the default <code>~1</code> specifies the standard dispersion given any family. The argument is ignored for families that do not have a dispersion parameter. For an explanation of the dispersion parameter for each family, see <code>sigma</code>. The dispersion model uses a log link. In Gaussian mixed models, <code>dispformula=~0</code> fixes the residual variance to be 0 (actually a small non-zero value), forcing variance into the random effects. The precise value can be controlled via <code>control=glmmTMBControl(zero_dispval=...)</code>; the default value is <code>sqrt(.Machine$double.eps)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>weights, as in <code>glm</code>. Not automatically scaled to have sum 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>offset for conditional model (only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>an optional list, e.g., <code>list(fac1="contr.sum")</code>. See the <code>contrasts.arg</code> of <code>model.matrix.default</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a function that specifies how to handle observations
containing <code>NA</code>s.  The default action (<code>na.omit</code>,
inherited from the 'factory fresh' value of
<code>getOption("na.action")</code>) strips any observations with any
missing values in any variables. Using <code>na.action = na.exclude</code>
will similarly drop observations with missing values while fitting the model,
but will fill in <code>NA</code> values for the predicted and residual
values for cases that were excluded during the fitting process
because of missingness.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>whether to return standard errors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>whether progress indication should be printed to the console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doFit</code></td>
<td>
<p>whether to fit the full model, or (if FALSE) return the preprocessed data and parameter objects, without fitting the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>control parameters, see <code>glmmTMBControl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REML</code></td>
<td>
<p>whether to use REML estimation rather than maximum likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>starting values, expressed as a list with possible components <code>beta</code>, <code>betazi</code>, <code>betad</code> (fixed-effect parameters for conditional, zero-inflation, dispersion models); <code>b</code>, <code>bzi</code> (conditional modes for conditional and zero-inflation models); <code>theta</code>, <code>thetazi</code> (random-effect parameters, on the standard deviation/Cholesky scale, for conditional and z-i models); <code>psi</code> (extra family parameters, e.g., shape for Tweedie models).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>map</code></td>
<td>
<p>a list specifying which parameter values should be fixed to a constant value rather than estimated. <code>map</code> should be a named list containing factors corresponding to a subset of the internal parameter names (see <code>start</code> parameter). Distinct factor values are fitted as separate parameter values, <code>NA</code> values are held fixed: e.g., <code>map=list(beta=factor(c(1,2,3,NA)))</code> would fit the first three fixed-effect parameters of the conditional model and fix the fourth parameter to its starting value. In general, users will probably want to use <code>start</code> to specify non-default starting values for fixed parameters. See <code>MakeADFun</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparseX</code></td>
<td>
<p>a named logical vector containing (possibly) elements named "cond", "zi", "disp" to indicate whether fixed-effect model matrices for particular model components should be generated as sparse matrices, e.g. <code>c(cond=TRUE)</code>. Default is all <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prt</code></td>
<td>

<p>Logical scalar - Should the info to be print on screen in the middle of the process or not?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict_info</code></td>
<td>

<p>Logical scalar - Should provide the info for function semipred or not? In case of there is a correlation theta parameter appearing, you may set predict=FALSE.  
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A semi parametric model can be parameterized as a linear (or generalized linear) mixed model in which its random effects are smooth functions of some covariates (named ‘smooth term’). <code>semireg_tmb</code> follows the approach suggested by Wand and Ormerod (2008) and represents the 'smooth term' using O'Sullivan-type of Z. 
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>semer</code></td>
<td>
<p>A glmmTMB model used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data.frame with generated variables in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fomul_vars</code></td>
<td>
<p>Name of variables in the formula of semireg_tmb model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sm_vars</code></td>
<td>
<p>Name of variables in the smoothZ list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoothZ_call</code></td>
<td>
<p>A call used to produce smooth terms in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots_lst</code></td>
<td>
<p>Knots used in each smooth term in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range_lst</code></td>
<td>
<p>Range of covariate used in each smooth term in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov_lst</code></td>
<td>
<p>Covariance matrix list for each smooth term.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u_lst</code></td>
<td>
<p>Random effects list for each smooth term.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type_lst</code></td>
<td>
<p>Smooth type list of smooth terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CovMat</code></td>
<td>
<p>Covariance matrix for all smooth terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov_ind</code></td>
<td>
<p>Covariance matrix index for each smooth term.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov_indN</code></td>
<td>
<p>Covariance matrix index for each smooth term when <code>group=TRUE</code> in <code>smoothZ</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>Degree of freedom of all random terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tmbf</code></td>
<td>
<p>The glmmTMB model result using doFit=FALSE.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Dongwen Luo, Siva Ganesh and John Koolaard
</p>


<h3>References</h3>

<p>Wand, M.P. and Ormerod, J.T. (2008). On semiparametric regression with O'Sullivan penalized splines. <em>Australian and New Zealand Journal of Statistics.</em> <b>50</b>, 179-198. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run
# library(predictmeans)
# library(HRW) 
# data(WarsawApts)
# help(WarsawApts)
# str(WarsawApts)
# fit1 &lt;- semireg_tmb(areaPerMzloty ~ construction.date,
#                smoothZ=list(
#                  grp=smZ(construction.date, k=25)
#                ),
#                data = WarsawApts)
# sp_out1 &lt;- semipred(fit1, "construction.date", "construction.date")
# 
# WarsawApts$district &lt;- factor(WarsawApts$district)
# fit2 &lt;- semireg_tmb(areaPerMzloty ~ construction.date*district, resp_scale = TRUE,
#                 smoothZ=list(group=smZ(construction.date, k=15,
#                                        by = district, group=TRUE)), 
#                 data=WarsawApts)
# sp_out2_1 &lt;- semipred(fit2, "district", "construction.date")
# sp_out2_2 &lt;- semipred(fit2, "district", "construction.date", contr=c(2,1))
# 
# data(indonRespir)
# help(indonRespir)
# str(indonRespir)
# fit3 &lt;- semireg_tmb(respirInfec ~ age+vitAdefic + female + height
#                + stunted + visit2 + visit3 + visit4  + visit5 + visit6+(1|idnum),
#                smoothZ=list(
#                  grp=smZ(age)
#                ),
#                family = binomial,
#                data = indonRespir)
# sp_out3 &lt;- semipred(fit3, "age", "age")
# library(ggplot2)
# sp_out3$plt+
#   geom_rug(data = subset(indonRespir, respirInfec==0), sides = "b", col="deeppink") +
#   geom_rug(data = subset(indonRespir, respirInfec==1), sides = "t", col="deeppink")+
#   ylim(0, 0.2)                     
</code></pre>


</div>