<div class="container">

<table style="width: 100%;"><tr>
<td>create_img_db</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a database of DICOM headers.</h2>

<h3>Description</h3>

<p>The function creates a database of DICOM headers present in a folder structure. Each series should be in its own folder,
but they can be in a nested folder structure. Files where there are also folder present next to them at the same level will not be parsed.
That is the folder structure needs to comply with the DICOM standard.
Be aware that the function requires <a href="https://www.python.org">python</a> and <a href="https://pydicom.github.io">pydicom</a> to be installed!
The function cycles through all folders present in the provided path and recursively goes through them,
every subfolder, and extracts the DICOM header information from the files using the
<a href="https://pydicom.github.io/pydicom/dev/reference/generated/pydicom.filereader.dcmread.html">dcmread</a>
function of the <a href="https://pydicom.github.io">pydicom</a> package.
The extension of the files can be provided by the <em>ext</em> argument,
as DICOM files may have different extensions then that of .dcm. Also, using the <em>all</em> boolean argument, you can specify whether
the function provides output for each file, or only for the first file, which is beneficial if you are analyzing multi-slice series,
as all instances have almost all the same header information. Furthermore, using the <em>keywords</em> argument you can manually specify
which DICOM keywords you wish to extract. These need to be a valid keyword specified in the
<a href="https://dicom.nema.org/medical/dicom/current/output/chtml/part06/chapter_6.html">DICOM standard</a>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">create_img_db(
  path,
  ext = c(".dcm", ".dicom", ".ima", ".tmp", ""),
  all = TRUE,
  keywords = c("StudyDate", "StudyTime", "SeriesDate", "SeriesTime", "AcquisitionDate",
    "AcquisitionTime", "ConversionType", "Manufacturer", "InstitutionName",
    "InstitutionalDepartmentName", "ReferringPhysicianName", "Modality",
    "ManufacturerModelName", "StudyDescription", "SeriesDescription", "StudyComments",
    "ProtocolName", "RequestedProcedureID", "ViewPosition", "StudyInstanceUID",
    "SeriesInstanceUID", "SOPInstanceUID", "AccessionNumber", "PatientName", "PatientID",
    "IssuerOfPatientID", "PatientBirthDate", 
     "PatientSex", "PatientAge",
    "PatientSize", "PatientWeight", "StudyID", "SeriesNumber", "AcquisitionNumber",
    "InstanceNumber", "BodyPartExamined", "SliceThickness", "SpacingBetweenSlices",
    "PixelSpacing", "PixelAspectRatio", "Rows", "Columns", "FieldOfViewDimensions",
    "RescaleIntercept", "RescaleSlope", "WindowCenter", "WindowWidth", "BitsAllocated",
    "BitsStored", "PhotometricInterpretation", "KVP", "ExposureTime", "XRayTubeCurrent",
    "ExposureInuAs", "ImageAndFluoroscopyAreaDoseProduct", "FilterType", 
    
    "ConvolutionKernel", "CTDIvol", "ReconstructionFieldOfView"),
  nThread = parallel::detectCores() - 1,
  na = TRUE,
  identical = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>string vector, full folder path to folder that contains the images.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ext</code></td>
<td>
<p>string array, possible file extensions to parse. It is advised to add <em>.</em> before the extensions as the given character patterns
may be present elsewhere in the file names. Furthermore, if DICOM files without an extension should also be parsed, then add <em>""</em> to the
extensions as then the script will try to read all files without an extension. Also, the file names and the extensions are converted to lower case
before matching to avoid mismatches due to capitals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all</code></td>
<td>
<p>boolean, whether all files in a series should be parsed, or only the first one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keywords</code></td>
<td>
<p>string array, of valid DICOM keywords.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nThread</code></td>
<td>
<p>integer, number of threads to use for parsing data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na</code></td>
<td>
<p>boolean, whether to remove columns with only NA values. Defaults to <em>TRUE</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>identical</code></td>
<td>
<p>boolean, whether to remove columns with identical values. Defaults to <em>TRUE</em>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.table, with DICOM header information return unchanged. However, the function also provides additional new columns
which help further data manipulations, these are:
</p>

<dl>
<dt>time_study</dt>
<dd>
<p>POSIXct, StudyDate and StudyTime concatentated together to POSIXct.</p>
</dd>
<dt>time_series</dt>
<dd>
<p>POSIXct, SeriesDate and SeriesTime concatentated together to POSIXct.</p>
</dd>
<dt>time_acquisition</dt>
<dd>
<p>POSIXct, AcquisitionDate and AcquisitionTime concatentated together to POSIXct.</p>
</dd>
<dt>name_img</dt>
<dd>
<p>string, PatientName with special characters removed.</p>
</dd>
<dt>time_date_of_birth_img</dt>
<dd>
<p>POSIXct, PatientBirthDate as POSIXct.</p>
</dd>
<dt>img_pixel_spacing</dt>
<dd>
<p>numeric, PixelSpacing value of the first element in the array returned as numerical value.</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#Create a database with DICOM header information
all_dicom_headers &lt;- create_img_db(path = "/Users/Test/Data/DICOM/")
all_dicom_headers &lt;- create_img_db(path = "/Users/Test/Data/DICOM/", ext = c(".dcm", ".DICOM"))
#Create a database with DICOM header information for only IDs and accession numbers
all_dicom_headers &lt;- create_img_db(path = "/Users/Test/Data/DICOM/",
keywords = c("PatientID", "AccessionNumber"))

## End(Not run)
</code></pre>


</div>