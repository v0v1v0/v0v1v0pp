<div class="container">

<table style="width: 100%;"><tr>
<td>ci.sp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Compute the confidence interval of specificities at given sensitivities
</h2>

<h3>Description</h3>

<p>This function computes the confidence interval (CI) of the specificity
at the given sensitivity points.
By default, the 95% CI are computed with 2000 stratified bootstrap replicates.
</p>


<h3>Usage</h3>

<pre><code class="language-R"># ci.sp(...)
## S3 method for class 'roc'
ci.sp(roc, sensitivities = seq(0, 1, .1) * ifelse(roc$percent,
100, 1), conf.level=0.95, boot.n=2000, boot.stratified=TRUE,
progress=getOption("pROCProgress")$name, parallel=FALSE, ...) 
## S3 method for class 'smooth.roc'
ci.sp(smooth.roc, sensitivities = seq(0, 1, .1) *
ifelse(smooth.roc$percent, 100, 1), conf.level=0.95, boot.n=2000,
boot.stratified=TRUE, progress=getOption("pROCProgress")$name, parallel=FALSE, ...)
## S3 method for class 'formula'
ci.sp(formula, data, ...)
## Default S3 method:
ci.sp(response, predictor, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>roc, smooth.roc</code></td>
<td>
<p>a “roc” object from the
<code>roc</code> function, or a “smooth.roc” object from the
<code>smooth</code> function.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response, predictor</code></td>
<td>
<p>arguments for the <code>roc</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula, data</code></td>
<td>
<p>a formula (and possibly a data object) of type
response~predictor for the <code>roc</code> function.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sensitivities</code></td>
<td>
<p>on which sensitivities to evaluate the CI.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the width of the confidence interval as [0,1], never
in percent. Default: 0.95, resulting in a 95% CI.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.n</code></td>
<td>
<p>the number of bootstrap replicates. Default: 2000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.stratified</code></td>
<td>
<p>should the bootstrap be stratified (default, same number
of cases/controls in each replicate than in the original sample) or
not.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>the name of progress bar to display. Typically
“none”, “win”, “tk” or “text” (see the
<code>name</code> argument to <code>create_progress_bar</code> for
more information), but a list as returned by <code>create_progress_bar</code>
is also accepted. See also the “Progress bars” section of
this package's documentation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>if TRUE, the bootstrap is processed in parallel, using 
parallel backend provided by plyr (foreach).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods,
especially arguments for <code>roc</code> and <code>ci.sp.roc</code>
when calling <code>ci.sp.default</code> or <code>ci.sp.formula</code>.
Arguments for <code>txtProgressBar</code> (only 
<code>char</code> and <code>style</code>) if applicable.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ci.sp.formula</code> and <code>ci.sp.default</code> are convenience methods
that build the ROC curve (with the <code>roc</code> function) before
calling <code>ci.sp.roc</code>. You can pass them arguments for both
<code>roc</code> and <code>ci.sp.roc</code>. Simply use <code>ci.sp</code>
that will dispatch to the correct method.
</p>
<p>The <code>ci.sp.roc</code> function creates <code>boot.n</code> bootstrap replicate of the ROC
curve, and evaluates the specificity at sensitivities
given by the <code>sensitivities</code> argument. Then it computes the
confidence interval as the percentiles given by <code>conf.level</code>.
</p>
<p>For more details about the bootstrap, see the Bootstrap section in
this package's documentation.
</p>
<p>For smoothed ROC curves, smoothing is performed again at each
bootstrap replicate with the parameters originally provided.
If a density smoothing was performed with user-provided
<code>density.cases</code> or <code>density.controls</code> the bootstrap cannot
be performed and an error is issued.
</p>


<h3>Value</h3>

<p>A matrix of class “ci.sp”, “ci” and “matrix” (in this order)
containing the given specificities. Row (names) are the
sensitivities, the first column the lower bound, the 2nd column the
median and the 3rd column the upper bound.
</p>
<p>Additionally, the list has the following attributes: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the width of the CI, in fraction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.n</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.stratified</code></td>
<td>
<p>whether or not the bootstrapping was stratified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sensitivities</code></td>
<td>
<p>the sensitivities as given in argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roc</code></td>
<td>
<p>the object of class “roc” that was used to
compute the CI.
</p>
</td>
</tr>
</table>
<h3>Warnings</h3>

<p>If <code>boot.stratified=FALSE</code> and the sample has a large imbalance between
cases and controls, it could happen that one or more of the replicates
contains no case or control observation, or that there are not enough
points for smoothing, producing a <code>NA</code> area.
The warning “NA value(s) produced during bootstrap were ignored.”
will be issued and the observation will be ignored. If you have a large
imbalance in your sample, it could be safer to keep
<code>boot.stratified=TRUE</code>.
</p>


<h3>Errors</h3>

<p>If <code>density.cases</code> and <code>density.controls</code> were provided
for smoothing, the error “Cannot compute the statistic on ROC
curves smoothed with density.controls and density.cases.” is issued.
</p>


<h3>References</h3>

<p>James Carpenter and John Bithell (2000) “Bootstrap condence intervals:
when, which, what? A practical guide for medical statisticians”.
<em>Statistics in Medicine</em> <b>19</b>, 1141–1164.
DOI: doi: <a href="https://doi.org/10.1002/(SICI)1097-0258(20000515)19:9%3C1141::AID-SIM479%3E3.0.CO;2-F">10.1002/(SICI)1097-0258(20000515)19:9&lt;1141::AID-SIM479&gt;3.0.CO;2-F</a>.
</p>
<p>Tom Fawcett (2006) “An introduction to ROC analysis”. <em>Pattern
Recognition Letters</em> <b>27</b>, 861–874. DOI:
doi: <a href="https://doi.org/10.1016/j.patrec.2005.10.010">10.1016/j.patrec.2005.10.010</a>.
</p>
<p>Xavier Robin, Natacha Turck, Alexandre Hainard, <em>et al.</em>
(2011) “pROC: an open-source package for R and S+ to analyze and
compare ROC curves”. <em>BMC Bioinformatics</em>, <b>7</b>, 77.
DOI: doi: <a href="https://doi.org/10.1186/1471-2105-12-77">10.1186/1471-2105-12-77</a>.
</p>
<p>Hadley Wickham (2011) “The Split-Apply-Combine Strategy for Data Analysis”. <em>Journal of Statistical Software</em>, <b>40</b>, 1–29.
URL: doi: <a href="https://doi.org/10.18637/jss.v040.i01">10.18637/jss.v040.i01</a>.
</p>


<h3>See Also</h3>

<p><code>roc</code>,
<code>ci</code>,
<code>ci.se</code>,
<code>plot.ci</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create a ROC curve:
data(aSAH)
roc1 &lt;- roc(aSAH$outcome, aSAH$s100b)


## Basic example ##
## Not run: 
ci.sp(roc1)
## End(Not run)


## More options ##
# Customized bootstrap and sensitivities:
## Not run: 
ci.sp(roc1, c(.95, .9, .85), boot.n=10000, conf.level=0.9, stratified=FALSE)
## End(Not run)


## Plotting the CI ##
ci1 &lt;- ci.sp(roc1, boot.n = 10)
plot(roc1)
plot(ci1)


## On smoothed ROC curves with bootstrap ##
## Not run: 
ci.sp(smooth(roc1, method="density"))
## End(Not run)
</code></pre>


</div>