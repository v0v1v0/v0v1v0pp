<div class="container">

<table style="width: 100%;"><tr>
<td>replace_bad_pixs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Replace bad pixels in a spectrum</h2>

<h3>Description</h3>

<p>This function replaces data for bad pixels by a local estimate, by either
simple interpolation or using the algorithm of Whitaker and Hayes (2018).
</p>


<h3>Usage</h3>

<pre><code class="language-R">replace_bad_pixs(
  x,
  bad.pix.idx = FALSE,
  window.width = 11,
  method = "run.mean",
  na.rm = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>numeric vector containing spectral data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bad.pix.idx</code></td>
<td>
<p>logical vector or integer. Index into bad pixels in
<code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>window.width</code></td>
<td>
<p>integer. The full width of the window used for the
running mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character The name of the method: <code>"run.mean"</code> is running
mean as described in Whitaker and Hayes (2018); <code>"adj.mean"</code> is mean
of adjacent neighbors (isolated bad pixels only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>logical Treat <code>NA</code> values as additional bad pixels and
replace them.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Simple interpolation replaces values of isolated bad pixels by the mean of
their two closest neighbors. The running mean approach allows the replacement
of short runs of bad pixels by the running mean of neighboring pixels within
a window of user-specified width. The first approach works well for spectra
from array spectrometers to correct for hot and dead pixels in an instrument.
The second approach is most suitable for Raman spectra in which spikes
triggered by radiation are wider than a single pixel but usually not more
than five pixels wide.
</p>


<h3>Value</h3>

<p>A logical vector of the same length as <code>x</code>. Values that are TRUE
correspond to local spikes in the data.
</p>


<h3>Note</h3>

<p>In the current implementation <code>NA</code> values are not removed, and
if they are in the neighborhood of bad pixels, they will result in the
generation of additional <code>NA</code>s during their replacement.
</p>


<h3>References</h3>

<p>Whitaker, D. A.; Hayes, K. (2018) A simple algorithm for despiking Raman
spectra. Chemometrics and Intelligent Laboratory Systems, 179, 82-84.
</p>


<h3>See Also</h3>

<p>Other peaks and valleys functions: 
<code>find_peaks()</code>,
<code>find_spikes()</code>,
<code>get_peaks()</code>,
<code>peaks()</code>,
<code>spikes()</code>,
<code>valleys()</code>,
<code>wls_at_target()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># in a vector
replace_bad_pixs(c(1, 1, 45, 1, 1), bad.pix.idx = 3)

# before replacement
white_led.raw_spct$counts_3[120:125]

# replacing bad pixels at index positions 123 and 1994
with(white_led.raw_spct,
     replace_bad_pixs(counts_3, bad.pix.idx = c(123, 1994)))[120:125]

</code></pre>


</div>