<div class="container">

<table style="width: 100%;"><tr>
<td>sir</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate SIR or SMR</h2>

<h3>Description</h3>

<p>Poisson modelled standardised incidence or mortality ratios (SIRs / SMRs) i.e. 
indirect method for calculating standardised rates. SIR is a ratio of observed and expected cases.
Expected cases are derived by multiplying the strata-specific population rate with the
corresponding person-years of the cohort.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sir(
  coh.data,
  coh.obs,
  coh.pyrs,
  ref.data = NULL,
  ref.obs = NULL,
  ref.pyrs = NULL,
  ref.rate = NULL,
  subset = NULL,
  print = NULL,
  adjust = NULL,
  mstate = NULL,
  test.type = "homogeneity",
  conf.type = "profile",
  conf.level = 0.95,
  EAR = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coh.data</code></td>
<td>
<p>aggregated cohort data, see e.g. <code>lexpand</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coh.obs</code></td>
<td>
<p>variable name for observed cases; quoted or unquoted. A vector when using <code>mstata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coh.pyrs</code></td>
<td>
<p>variable name for person years in cohort data; 
quoted (as a string <code>'myvar'</code>) or unquoted (AKA as a name; <code>myvar</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.data</code></td>
<td>
<p>population data. Can be left NULL if <code>coh.data</code> 
is stratified in <code>print</code>. See <code>pophaz</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.obs</code></td>
<td>
<p>variable name for observed cases; quoted or unquoted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.pyrs</code></td>
<td>
<p>variable name for person-years in population data; quoted or unquoted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.rate</code></td>
<td>
<p>population rate variable (cases/person-years). Overwrites 
arguments <code>ref.pyrs</code> and <code>ref.obs</code>. Quoted or unquoted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>logical condition to select data from <code>coh.data</code> before any computations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print</code></td>
<td>
<p>variable names to stratify results; quoted vector or unquoted named list with functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>variable names for adjusting without stratifying output; quoted vector or unquoted list</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mstate</code></td>
<td>
<p>set column names for cause specific observations; quoted or unquoted. Relevant only
when <code>coh.obs</code> length is two or more. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test.type</code></td>
<td>
<p>Test for equal SIRs. Test available are 'homogeneity' and 'trend'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.type</code></td>
<td>
<p>Confidence interval type: 'profile'(=default), 'wald' or 'univariate'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>Level of type-I error in confidence intervals, default 0.05 is 95% CI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EAR</code></td>
<td>
<p>logical; TRUE calculates Excess Absolute Risks for univariate SIRs.
(see details)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>sir</code> is a comprehensive tool for modelling SIRs/SMRs with flexible 
options to adjust and print SIRs, test homogeneity and utilize 
multi-state data. The cohort data and the variable names for observation 
counts and person-years are required.
The reference data is optional, since the cohort data 
can be stratified (<code>print</code>) and compared to total.
</p>
<p><strong>Adjust and print</strong>
</p>
<p>A SIR can be adjusted or standardised using the covariates found in both <code>coh.data</code> and <code>ref.data</code>.
Variable to adjust are given in <code>adjust</code>.
Variable names needs to match in both <code>coh.data</code> and <code>ref.data</code>. 
Typical variables to adjust by are gender, age group and calendar period.
</p>
<p><code>print</code> is used to stratify the SIR output. In other words, the variables 
assigned to <code>print</code> are the covariates of the Poisson model.
Variable levels are treated as categorical.
Variables can be assigned in both <code>print</code> and <code>adjust</code>. 
This means the output it adjusted and printed by these variables.
</p>
<p><code>print</code> can also be a list of expressions. This enables changing variable 
names or transforming variables with functions such as <code>cut</code> and <code>round</code>.
For example, the existing variables <code>agegroup</code> and <code>year</code> could be
transformed to new levels using <code>cut</code> by
</p>
<p><code>print = list( age.category = cut(agegroup, breaks = c(0,50,75,100)), 
year.cat = cut(year, seq(1950,2010,20)))</code>
</p>
<p><strong>ref.rate or ref.obs &amp; ref.pyrs</strong>
</p>
<p>The population rate variable can be given to the <code>ref.rate</code> parameter. 
That is, when using e.g. the <code>popmort</code> or a comparable data file, one may
supply <code>ref.rate</code> instead of <code>ref.obs</code> and <code>ref.pyrs</code>, which
will be ignored if <code>ref.rate</code> is supplied. 
</p>
<p>Note that if all the stratifying variables in 
<code>ref.data</code> are not listed in <code>adjust</code>, 
or when the categories are otherwise combined,
the (unweighted) mean of rates is used for computing expected cases.
This might incur a small bias in comparison to when exact numbers of observations
and person-years are available. 
</p>
<p><strong>mstate</strong>
</p>
<p>E.g. using <code>lexpand</code> it's possible to compute counts for several outcomes
so that the population at risk is same for each 
outcome such as a certain kind of cancer. 
The transition counts are in wide data format, 
and the relevant columns can be supplied to <code>sir</code>
in a vector via the <code>coh.obs</code> argument. 
The name of the corresponding new column in <code>ref.data</code> is given in
<code>mstate</code>. It's recommended to include the <code>mstate</code> variable in <code>adjust</code>,
so the corresponding information should also be available in <code>ref.data</code>.
More examples in sir-vignette.
</p>
<p>This approach is analogous to where SIRs are calculated separately their 
own function calls.
</p>
<p><strong>Other parameters</strong>
</p>
<p><code>univariate</code> confidence intervals are calculated using exact 
Poisson intervals (<code>poisson.ci</code>). The options <code>profile</code> and <code>wald</code> are
is based on a Poisson regression model: profile-likelihood confidence intervals 
or Wald's normal-approximation. P-value is Poisson model based <code>conf.type</code>
or calculated using the method described by Breslow and Day. Function automatically
switches to another <code>conf.type</code> if calculation is not possible with a message.
Usually model fit fails if there is print stratum with zero expected values.
</p>
<p>The LRT p-value tests the levels of <code>print</code>. The test can be either 
<code>"homogeneity"</code>, a likelihood ratio test where the model variables defined in
<code>print</code> (factor) is compared to the constant model.
Option <code>"trend"</code> tests if the linear trend of the continuous variable in
<code>print</code> is significant (using model comparison).
</p>
<p><strong>EAR: Excess Absolute Risk</strong>
</p>
<p>Excess Absolute Risk is a simple way to quantify the absolute difference between cohort risk and 
population risk.
Make sure that the person-years are calculated accordingly before using EAR. (when using mstate)
</p>
<p>Formula for EAR:
</p>
<p style="text-align: center;"><code class="reqn">EAR = \frac{observed - expected}{person years} \times 1000.</code>
</p>

<p><strong>Data format</strong>
</p>
<p>The data should be given in tabulated format. That is the number of observations 
and person-years are represented for each stratum.
Note that also individual data is allowed as long as each observations, 
person-years, and print and adjust variables are presented in columns.
The extra variables and levels are reduced automatically before estimating SIRs. 
Example of data format:
</p>

<table>
<tr>
<td style="text-align: right;">
  sex </td>
<td style="text-align: right;"> age </td>
<td style="text-align: right;"> period </td>
<td style="text-align: right;"> obs </td>
<td style="text-align: right;"> pyrs </td>
</tr>
<tr>
<td style="text-align: right;">
  0 </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 2010 </td>
<td style="text-align: right;"> 0 </td>
<td style="text-align: right;"> 390 </td>
</tr>
<tr>
<td style="text-align: right;">
  0 </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 2010 </td>
<td style="text-align: right;"> 5 </td>
<td style="text-align: right;"> 385 </td>
</tr>
<tr>
<td style="text-align: right;">
  1 </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 2010 </td>
<td style="text-align: right;"> 3 </td>
<td style="text-align: right;"> 308 </td>
</tr>
<tr>
<td style="text-align: right;">
  1 </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 2010 </td>
<td style="text-align: right;"> 12 </td>
<td style="text-align: right;"> 315
</td>
</tr>
</table>
<h3>Value</h3>

<p>A sir-object that is a <code>data.table</code> with meta information in the attributes.
</p>


<h3>Author(s)</h3>

<p>Matti Rantanen, Joonas Miettinen
</p>


<h3>See Also</h3>

<p><code>lexpand</code>
<a href="../doc/sir.html">A SIR calculation vignette</a>
</p>
<p>Other sir functions: 
<code>lines.sirspline()</code>,
<code>plot.sirspline()</code>,
<code>sir_exp()</code>,
<code>sir_ratio()</code>,
<code>sirspline()</code>
</p>
<p>Other main functions: 
<code>Surv()</code>,
<code>rate()</code>,
<code>relpois()</code>,
<code>relpois_ag()</code>,
<code>sirspline()</code>,
<code>survmean()</code>,
<code>survtab()</code>,
<code>survtab_ag()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(popmort)
data(sire)
c &lt;- lexpand( sire, status = status, birth = bi_date, exit = ex_date, entry = dg_date,
              breaks = list(per = 1950:2013, age = 1:100, fot = c(0,10,20,Inf)), 
              aggre = list(fot, agegroup = age, year = per, sex) )
## SMR due other causes: status = 2
se &lt;- sir( coh.data = c, coh.obs = 'from0to2', coh.pyrs = 'pyrs', 
           ref.data = popmort, ref.rate = 'haz', 
           adjust = c('agegroup', 'year', 'sex'), print = 'fot')
se
## for examples see: vignette('sir')


</code></pre>


</div>