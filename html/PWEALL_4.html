<div class="container">

<table style="width: 100%;"><tr>
<td>cpstop</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>The stopping probability based on the stopping boundary</h2>

<h3>Description</h3>

<p>This will calculate the stopping probability given the stopping boundary. All the calculation is based on the proportional hazards assumption and the Cox model.</p>


<h3>Usage</h3>

<pre><code class="language-R">cpstop(Dplan=300,pi1=0.5,Beta1=log(0.8),Beta0=log(1),
        prop=seq(0.1,0.9,by=0.1),HRbound=rep(0.85,length(prop)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Dplan</code></td>
<td>
<p>Planned number of events at study end</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Beta1</code></td>
<td>
<p>designed log hazard ratio, i.e. under alternative hypothesis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Beta0</code></td>
<td>
<p>null log hazard ratio, i.e. under null hypothesis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop</code></td>
<td>
<p>proportion of <code>Dplan</code> observed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HRbound</code></td>
<td>
<p>the stopping boundary</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This will calculate the stopping probability given the stopping boundary. All the calculation is based on the proportional hazards assumption and the Cox model.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pstop0</code></td>
<td>
<p>Stopping probability under null hypothesis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pstop1</code></td>
<td>
<p>Stopping probability under alternative hypothesis</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>This will calculate the stopping probability given the stopping boundary</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Halperin, Lan, Ware, Johnson and DeMets (1982). Controlled Clinical Trials.
</p>


<h3>See Also</h3>

<p><code>cp</code>,<code>cpboundary</code></p>


<h3>Examples</h3>

<pre><code class="language-R">###Calculate the stopping boundary at 10-90 percent of the target 300 events 
###when the condition power are c(0.2,0.3,0.4) with 2:1 allocation ratio 
###between the treatment group and the control group, we pick the boundary 
###based on 20 percent conditional power according to design, i.e. under alternative
targetD&lt;-800 ###target number of events at study end
#############Allocation prob for the treatment group#############
pi1&lt;-2/3
propevent&lt;-seq(0.1,0.9,by=0.1) ###proportion of events at interim
HRbound&lt;-cpboundary(Dplan=targetD,pi1=pi1,prop=propevent)$CPDbound[,1]  ###picking a boundary
pa&lt;-cpstop(pi1=pi1,HRbound=HRbound)    ###stopping probabilities under null and alternative  
pa

###Calculate the stopping probability under non-constant hazard ratio
n1&lt;-length(propevent)

####time point at which hazard rates and hazard ratios change
tchange&lt;-c(0,6,12,24)                       
###annual event rates=0.09(1st yr), 0.07(2nd yr) and 0.05(2+yr) for control
ratet&lt;-c(0.09/12,0.09/12,0.07/12,0.05/12)   
###annual censoring rate=0%(1st yr) and 1.5%(after) for control and treatment
ratec0&lt;-c(0/12,0/12,0.015/12,0.015/12)      
ratec1&lt;-ratec0                              
###annual treatment discontinuation rate=4% (1st yr) and 3% (after)
rate31&lt;-c(0.04/12,0.04/12,0.03/12,0.03/12)  
rate30&lt;-rep(0,length(tchange))              

############Recruitment curve##################
oa&lt;-c(100,200,300,300,400,400,400,400,400,400,400,400,300,200)
ntotal&lt;-sum(oa)
ntotal

taur&lt;-length(oa)
ut&lt;-seq(1,taur,by=1)
u&lt;-oa/ntotal


#############Type-1 error rate#############
alpha&lt;-0.05

####null hypothesis
eta0&lt;-log(1)

####constant HR
etac&lt;-log(0.8)

####non-constant HR
eta&lt;-c(log(1),log(0.75),log(0.75),log(0.75)) ###6-m delayed 


####target number of events where calculations are performed##############
sevent&lt;-propevent*targetD
nse&lt;-length(sevent)
xtimeline&lt;-xbeta&lt;-xvar&lt;-pxstop&lt;-matrix(0,ncol=2,nrow=nse)
xtimeline[,1]&lt;-xbeta[,1]&lt;-xvar[,1]&lt;-pxstop[,1]&lt;-sevent
i&lt;-1
tbegin&lt;-proc.time()
for (i in 1:nse){
###find timeline
xtimeline[i,2]&lt;-pwecxpwufindt(target=sevent[i],ntotal=ntotal,
                taur=taur,u=u,ut=ut,pi1=0.5,
                rate11=exp(eta)*ratet,rate21=exp(eta)*ratet,rate31=rate31,ratec1=ratec1,
                rate10=ratet,rate20=ratet,rate30=rate30,ratec0=ratec0,
                tchange=tchange,eps=0.001,init=taur,epsilon=0.000001,maxiter=100)$tau1

#Overall hazard ratio and varaince
xbeta[i,2]&lt;-ovbeta(tfix=xtimeline[i,2],taur=taur,u=u,ut=ut,pi1=pi1,
                rate11=exp(eta)*ratet,rate21=exp(eta)*ratet,rate31=rate31,ratec1=ratec1,
                rate10=ratet,rate20=ratet,rate30=rate30,ratec0=ratec0,
                tchange=tchange,eps=0.001,veps=0.001,epsbeta=1.0e-10)$b1
xvar[i,2]&lt;-overallvar(tfix=xtimeline[i,2],taur=taur,u=u,ut=ut,pi1=pi1,
                rate11=exp(eta)*ratet,rate21=exp(eta)*ratet,rate31=rate31,ratec1=ratec1,
                rate10=ratet,rate20=ratet,rate30=rate30,ratec0=ratec0,
                tchange=tchange,eps=0.001,veps=0.001,beta=xbeta[i,2])$vbeta
}
##stopping prob
pxstop[,2]&lt;-1-pnorm(sqrt(ntotal)*(log(HRbound)-xbeta[,2])/sqrt(xvar[,2]))
tend&lt;-proc.time()

xout&lt;-cbind(xtimeline[,1],xtimeline[,2],xbeta[,2],xvar[,2]/ntotal,
            1/pi1/(1-pi1)/xtimeline[,1],pxstop[,2],pa$pstop0,pa$pstop1)
xnames&lt;-c("# of events", "Time", "Estbeta", "TrueV", "ApproxV", "NCHR", "Null", "CHR")
colnames(xout)&lt;-xnames
options(digits=2)
xout
</code></pre>


</div>