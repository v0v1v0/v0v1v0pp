<div class="container">

<table style="width: 100%;"><tr>
<td>prewhiten</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prepare a series for spectral estimation</h2>

<h3>Description</h3>

<p>Remove (optionally) mean, trend, and Auto Regressive (AR) model
from the original series.
</p>


<h3>Usage</h3>

<pre><code class="language-R">prewhiten(tser, ...)

## Default S3 method:
prewhiten(tser, x.fsamp = 1, x.start = c(1, 1), ...)

## S3 method for class 'ts'
prewhiten(
  tser,
  AR.max = 0L,
  detrend = TRUE,
  demean = TRUE,
  impute = TRUE,
  plot = TRUE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tser</code></td>
<td>
<p>vector; An object to prewhiten.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>variables passed to <code>prewhiten.ts</code> (for non <code>ts</code> objects)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.fsamp</code></td>
<td>
<p>sampling frequency (for non <code>ts</code> objects)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.start</code></td>
<td>
<p>start time of observations (for non <code>ts</code> objects)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AR.max</code></td>
<td>
<p>numeric; the maximum AR order to fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detrend</code></td>
<td>
<p>logical; Should a trend (and mean) be removed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demean</code></td>
<td>
<p>logical; Should a mean value be removed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>impute</code></td>
<td>
<p>logical; Should NA values be imputed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logical; Should the results be plotted?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical; Should messages be printed?</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The R-S multitapers do not exhibit the remarkable spectral-leakage 
suppression properties of the Thomson prolate tapers, 
so that in spectra with large dynamic range, 
power bleeds from the strong peaks into neighboring frequency bands of 
low amplitude – spectral leakage. 
Prewhitening can ameliorate the problem, at least for red spectra 
[see Chapter 9, Percival and Walden (1993)]. 
</p>
<p>The value of the <code>AR.max</code> argument is made absolute, after which
this function has essentially two modes of operation (detailed below):
</p>

<dl>
<dt>
<code>AR.max</code> == 0</dt>
<dd>
<p>Remove (optionally) a mean and/or linear trend.</p>
</dd>
<dt>
<code>AR.max</code> &gt; 0</dt>
<dd>
<p>Remove an autoregressive model</p>
</dd>
</dl>
<p>In the second case,
the time series is 
filtered in the time domain with a finite-impulse-response 
filter of <code>AR.max</code> terms. The filter is found by solving the Yule-Walker 
equations for 
which it is assumed the series was generated by an autoregressive process, up to
order <code>AR.max</code>.
</p>


<h4>Mean and trend (<code>AR.max == 0</code>)</h4>

<p>Power spectral density estimates can become badly biased
(especially at lower frequencies) if a signal of the form
<code class="reqn">f(x) = A x + B</code> is not removed from the series.  
If <code>detrend=TRUE</code> a model of this form is removed over the entire series using a
linear least-squares estimator; in this case a mean value is removed
regardless of the logical state of <code>demean</code>.
To remove <em>only</em> a mean value, set <code>detrend=FALSE</code> and (obviously) <code>demean=TRUE</code>.
</p>



<h4>Auto Regressive (AR) innovations (<code>AR.max &gt; 0</code>)</h4>

<p>When an autoregressive model is removed from a non-stationary series, the residuals
are known as 'innovations', and may be stationary (or very-nearly stationary).  
This function fits an AR model [order at least 1, but up to and including AR(<code>AR.max</code>)] to the series 
by solving the Yule-Walker equations; however, AIC is used to estimate the highest significant
order, which means that higher-order components may not necessarily be fit.
The resulting innovations can be used to better estimate the stationary component
of the original signal, and possibly in an interactive editing method.
</p>
<p>Note that the method used here–solving the Yule-Walker equations–is 
not a true maximum likelihood estimator; hence the AIC is calculated
based on the variance estimate (no determinant). From <code>?ar</code>:
<em>In <code>ar.yw</code> the variance matrix of the innovations is 
computed from the fitted coefficients and the autocovariance of <code>x</code>.</em>
</p>
<p>A quick way to determine whether this may be needed for the series is to run
<code>acf</code> on the series, and see if significant non-zero lag correlations
are found.  A warning is produced if the fit returns an AR(0) fit, indicating
that AR prewhitening most likely inappropriate for the series, which
is apparently stationary (or very nearly so).  (The innovations could end up
having <em>higher</em> variance than the input series in such a case.)
</p>
<p><em>Note that <code>AR.max</code> is restricted to the range <code class="reqn">[1,N-1]</code> where
<code class="reqn">N</code> is the series length.</em>
</p>



<h3>Value</h3>

<p>A list with the model fits (<code>lm</code> and <code>ar</code> objects),
the linear and AR prewhitened series (<code>ts</code> objects), and a logical
flag indicating whether the I/O has been imputed. This list includes:
<code>"lmdfit"</code>, <code>"ardfit"</code>, <code>"prew_lm"</code>, <code>"prew_ar"</code>, and <code>"imputed"</code>
</p>
<p><em>Note that if <code>AR.max=0</code> the AR information will exist as <code>NULL</code>.</em>
</p>


<h3>NA values</h3>

<p><code>NA</code> values are allowed.  If present, and <code>impute=TRUE</code>, 
the <code>na.locf</code> function in the package
<code>zoo</code> is used twice (with and without <code>fromLast</code> so that lead and
trailing <code>NA</code> values are also imputed).  The function name is an
acronym for "Last Observation Carried Forward", a very crude method
of imputation.
</p>


<h3>Author(s)</h3>

<p>A.J. Barbour and Robert L. Parker
</p>


<h3>See Also</h3>

<p><code>psdcore</code>, <code>pspectrum</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: #REX
library(psd)

##
## Using prewhiten to improve spectral estimates
##

data(magnet)
mts &lt;- ts(magnet$clean)
# add a slope
mts.slope &lt;- mts + seq_along(mts)

# Prewhiten by removing mean+trend, and
# AR model; fit truncates the series by 
# a few terms, so zero pad
mts &lt;- prewhiten(mts.slope,  AR.max=10, zero.pad="rear")
mts.p &lt;- mts[['prew_lm']]
mts.par &lt;- mts[['prew_ar']]

# uniformly-tapered spectral estimates
PSD &lt;- psdcore(mts.p, ntaper=20)
PSD.ar &lt;- psdcore(mts.par, ntaper=20)

# remove the effect of AR model
PSD.ar[['spec']] &lt;- PSD.ar[['spec']] / mean(PSD.ar[['spec']])
PSD[['spec']] &lt;- PSD[['spec']] / PSD.ar[['spec']]

plot(PSD, log='dB', lwd=2, ylim=c(-5,35))
plot(PSD, log='dB', add=TRUE, lwd=2, col="red")
plot(PSD.ar, log='dB', add=TRUE, col="blue", lwd=2)


## End(Not run)#REX
</code></pre>


</div>