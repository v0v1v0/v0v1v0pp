<div class="container">

<table style="width: 100%;"><tr>
<td>clusterlm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cluster-mass test for longitudinal data</h2>

<h3>Description</h3>

<p>Compute the cluster-mass test for longitudinal linear model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">clusterlm(
  formula,
  data = NULL,
  np = 5000,
  method = NULL,
  type = "permutation",
  test = "fisher",
  threshold = NULL,
  aggr_FUN = NULL,
  multcomp = "clustermass",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula object where the left part is a matrix defined in the global environment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame for the independent variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>np</code></td>
<td>
<p>The number of permutations. Default value is <code>5000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string indicating the method used to handle nuisance variables. Default is <code>NULL</code> and will switch to <code>"freedman_lane"</code> for the fixed effects model and to <code>"Rd_kheradPajouh_renaud"</code> for the repeated measures ANOVA. See lmperm or aovperm for details on the permutation methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A character string to specify the type of transformations: "permutation" and "signflip" are available. Is overridden if P is given. See help from Pmat.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>
<p>A character string to specify the name of the test. Default is <code>"fisher"</code>. <code>"t"</code> is available for the fixed effects model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>A numerical value that specify the threshold for the <code>"clustermass"</code> multiple comparisons procedure. If it is a vector each value will be associated to an effect. If it is scalar the same threshold will be used for each test. Default value is <code>NULL</code> and will compute a threshold based on the 0.95 quantile of the choosen test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggr_FUN</code></td>
<td>
<p>A function used as mass function. It should aggregate the statistics of a cluster into one scalar. Default is the sum of squares fot t statistic and sum for F statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multcomp</code></td>
<td>
<p>A vector of character defining the methods of multiple comparisons to compute. Default is <code>"clustermass"</code>, and the additional options are available : <code>"tfce"</code>,<code>"bonferroni"</code>, <code>"holm"</code>, <code>"troendle"</code>, <code>"minP"</code> and <code>"benjamini_hochberg"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Futher arguments, see details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The random effects model is only available with a F statistic.<br></p>
<p>Other arguments could be pass in <code>...</code> :<br><br><code>P</code> : A matrix containing the permutation of class <code>matrix</code> or <code>Pmat</code>; which is used for the reproducibility of the results. The first column must be the identity. <code>P</code> overwrites <code>np</code> argument.<br><br><code>rnd_rotation</code> : A matrix of random value to compute a rotation of size <code class="reqn">n \times n</code> that will be used for the <code>"huh_jhun"</code> method. <br><br><code>p_scale = FALSE</code> : if set to <code>TRUE</code>, the several multiple comparisons procedures are compute on the <code>1 - p</code> scale, where <code>p</code> is the p-value. The threshold have to be set between 0 and 1 (eg: <code>threshold = 0.95</code>). The function <code>aggr_FUN</code> should be big when there is evidence against the null (eg: <code>aggr_FUN = function(p)sum(abs(log(1-p)))</code>. Moreover under the probability scale the cluster mass statistics is sensitive to the number permutations.<br><br><code>H</code>, <code>E</code>, <code>ndh</code> : the parameters used for the <code>"tfce"</code> method. Default values are set to <code>H = 2</code> for the height parameter, to <code>E = 0.5</code> for the extend parameter and to <code>ndh = 500</code> for the number terms to approximate the integral.<br><br><code>alpha = 0.05</code> : the type I error rate. Used for the <code>troendle</code> multiple comparisons procedure.<br><br><code>return_distribution = FALSE</code> : return the permutation distribution of the statistics. Warnings : return one high dimensional matrices (number of test times number of permutation) for each test.<br><code>coding_sum</code> : a logical defining the coding of the design matrix to <code>contr.sum</code>: set by default to <code>TRUE</code> for ANOVA (when the argument <code>test</code> is <code>"fisher"</code> ) to tests main effects and is set to <code>FALSE</code> when <code>test</code> is <code>"t"</code>.  If <code>coding_sum</code> is set to <code>FALSE</code> the design matrix is computed with the coding defined in the dataframe and the tests of simple effets are possible with a coding of the dataframe set to <code>contr.treatment</code>. <br></p>


<h3>Value</h3>

<p>A <code>clusterlm</code> object. Use the plot.clusterlm or summary.clusterlm method to see results of the tests.
</p>


<h3>Author(s)</h3>

<p>jaromil.frossard@unige.ch
</p>


<h3>References</h3>

<p>Maris, E., &amp; Oostenveld, R. (2007). Nonparametric statistical testing of EEG-and MEG-data. Journal of neuroscience methods, 164(1), 177-190.
</p>
<p>Smith, S. M., &amp; Nichols, T. E. (2009). Threshold-free cluster enhancement: addressing problems of smoothing, threshold dependence and localisation in cluster inference. Neuroimage, 44(1), 83-98.
</p>


<h3>See Also</h3>

<p><code>plot.clusterlm</code> <code>summary.clusterlm</code>
</p>
<p>Other main function: 
<code>aovperm()</code>,
<code>lmperm()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Cluster-mass for repeated measures ANOVA
## Warning : np argument must be greater (recommendation: np &gt;= 5000)
electrod_O1 &lt;- clusterlm(attentionshifting_signal ~ visibility*emotion*direction
         + Error(id/(visibility*emotion*direction)), data = attentionshifting_design,
         np = 50)

## Results
plot(electrod_O1)

## Results with labels on the x axis that represent seconds from time-locked event:
plot(electrod_O1, nbbaselinepts = 200, nbptsperunit = 1024)

## Tables of clusters
electrod_O1

## Not run: 
## Change the function of the aggregation

## Sum of squares of F statistics
electrod_O1_sum &lt;- clusterlm(attentionshifting_signal ~ visibility*emotion*direction
         + Error(id/(visibility*emotion*direction)), data = attentionshifting_design,
         aggr_FUN = function(x)sum(x^2))

## Length of the cluster
electrod_O1_length &lt;- clusterlm(attentionshifting_signal ~ visibility*emotion*direction
         + Error(id/(visibility*emotion*direction)), data = attentionshifting_design,
         aggr_FUN = function(x)length(x))


## All multiple comparisons procedures for repeated measures ANOVA
## Permutation method "Rde_kheradPajouh_renaud"
full_electrod_O1 &lt;- clusterlm(attentionshifting_signal ~ visibility*emotion*direction
          + Error(id/(visibility*emotion*direction)), data = attentionshifting_design,
          method = "Rde_kheradPajouh_renaud", multcomp = c("troendle", "tfce",
          "clustermass", "bonferroni", "holm", "benjamini_hochberg"))

## End(Not run)

</code></pre>


</div>