<div class="container">

<table style="width: 100%;"><tr>
<td>add_max_phylo_end_objective</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add maximum phylogenetic endemism objective</h2>

<h3>Description</h3>

<p>Set the objective of a conservation planning problem to
maximize the phylogenetic endemism of the features represented in the
solution subject to a budget. This objective is similar to
<code>add_max_phylo_div_objective()</code> except
that emphasis is placed on representing species with geographically
restricted evolutionary histories, instead representing as much evolutionary
history as possible. This function was inspired by Faith (1992),
Rodrigues <em>et al.</em> (2002), and Rosauer <em>et al.</em> (2009).
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_max_phylo_end_objective(x, budget, tree)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p><code>problem()</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>budget</code></td>
<td>
<p><code>numeric</code> value specifying the maximum expenditure of
the prioritization. For problems with multiple zones, the argument
to <code>budget</code> can be (i) a single <code>numeric</code> value to specify a single budget
for the entire solution or (ii) a <code>numeric</code> vector to specify
a separate budget for each management zone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p><code>ape::phylo()</code> object specifying a phylogenetic tree
for the conservation features.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The maximum phylogenetic endemism objective finds the set of
planning units that meets representation targets for a phylogenetic tree
while staying within a fixed budget. If multiple solutions can meet all
targets while staying within budget, the cheapest solution is chosen.
Note that this objective is similar to the maximum
features objective (<code>add_max_features_objective()</code>) in that it
allows for both a budget and targets to be set for each feature. However,
unlike the maximum feature objective, the aim of this objective is to
maximize the total phylogenetic endemism of the targets met in the
solution, so if multiple targets are provided for a single feature, the
problem will only need to meet a single target for that feature
for the phylogenetic benefit for that feature to be counted when
calculating the phylogenetic endemism of the solution. In other words,
for multi-zone problems, this objective does not aim to maximize the
phylogenetic endemism in each zone, but rather this objective
aims to maximize the phylogenetic endemism of targets that can be met
through allocating planning units to any of the different zones in a
problem. This can be useful for problems where targets pertain to the total
amount held for each feature across multiple zones. For example,
each feature might have a non-zero amount of suitable habitat in each
planning unit when the planning units are assigned to a (i) not restored,
(ii) partially restored, or (iii) completely restored management zone.
Here each target corresponds to a single feature and can be met through
the total amount of habitat in planning units present to the three
zones.
</p>


<h3>Value</h3>

<p>An updated <code>problem()</code> object with the objective added to it.
</p>


<h3>Mathematical formulation</h3>

<p>This objective can be expressed mathematically for a set of planning units
(<code class="reqn">I</code> indexed by <code class="reqn">i</code>) and a set of features (<code class="reqn">J</code>
indexed by <code class="reqn">j</code>) as:
</p>
<p style="text-align: center;"><code class="reqn">\mathit{Maximize} \space \sum_{i = 1}^{I} -s \space c_i \space x_i +
\sum_{j = 1}^{J} m_b l_b \frac{1}{a_b} \\
\mathit{subject \space to} \\
\sum_{i = 1}^{I} x_i r_{ij} \geq y_j t_j \forall j \in J \\
m_b \leq y_j \forall j \in T(b) \\
\sum_{i = 1}^{I} x_i c_i \leq B</code>
</p>

<p>Here, <code class="reqn">x_i</code> is the decisions variable (e.g.,
specifying whether planning unit <code class="reqn">i</code> has been selected (1) or not
(0)), <code class="reqn">r_{ij}</code> is the amount of feature <code class="reqn">j</code> in planning
unit <code class="reqn">i</code>, <code class="reqn">t_j</code> is the representation target for feature
<code class="reqn">j</code>, <code class="reqn">y_j</code> indicates if the solution has meet
the target <code class="reqn">t_j</code> for feature <code class="reqn">j</code>. Additionally,
<code class="reqn">T</code> represents a phylogenetic tree containing features <code class="reqn">j</code>
and has the branches <code class="reqn">b</code> associated within lengths <code class="reqn">l_b</code>.
Each branch <code class="reqn">b \in B</code> is associated with a total amount
<code class="reqn">a_b</code> indicating the total geographic extent or amount of habitat.
The <code class="reqn">a_b</code> variable for a given branch is calculated by summing the
<code class="reqn">r_{ij}</code> data for all features <code class="reqn">j \in J</code> that are
associated with the branch. The binary variable <code class="reqn">m_b</code> denotes if
at least one feature associated with the branch <code class="reqn">b</code> has met its
representation as indicated by <code class="reqn">y_j</code>. For brevity, we denote
the features <code class="reqn">j</code> associated with branch <code class="reqn">b</code> using
<code class="reqn">T(b)</code>. Finally, <code class="reqn">B</code> is the budget allocated for the
solution, <code class="reqn">c_i</code> is the cost of planning unit <code class="reqn">i</code>, and
<code class="reqn">s</code> is a scaling factor used to shrink the costs so that the problem
will return a cheapest solution when there are multiple solutions that
represent the same amount of all features within the budget.
</p>


<h3>References</h3>

<p>Faith DP (1992) Conservation evaluation and phylogenetic diversity.
<em>Biological Conservation</em>, 61: 1–10.
</p>
<p>Rodrigues ASL and Gaston KJ (2002) Maximising phylogenetic diversity in the
selection of networks of conservation areas. <em>Biological Conservation</em>,
105: 103–111.
</p>
<p>Rosauer D, Laffan SW, Crisp, MD, Donnellan SC and Cook LG (2009)
Phylogenetic endemism: a new approach for identifying geographical
concentrations of evolutionary history. <em>Molecular Ecology</em>, 18:
4061–4072.
</p>


<h3>See Also</h3>

<p>See objectives for an overview of all functions for adding objectives.
Also, see targets for an overview of all functions for adding targets, and
<code>add_feature_weights()</code> to specify weights for different features.
</p>
<p>Other objectives: 
<code>add_max_cover_objective()</code>,
<code>add_max_features_objective()</code>,
<code>add_max_phylo_div_objective()</code>,
<code>add_max_utility_objective()</code>,
<code>add_min_largest_shortfall_objective()</code>,
<code>add_min_set_objective()</code>,
<code>add_min_shortfall_objective()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# load ape package
require(ape)

# load data
sim_pu_raster &lt;- get_sim_pu_raster()
sim_features &lt;- get_sim_features()
sim_phylogeny &lt;- get_sim_phylogeny()
sim_zones_pu_raster &lt;- get_sim_zones_pu_raster()
sim_zones_features &lt;- get_sim_zones_features()

# plot the simulated phylogeny
par(mfrow = c(1, 1))
plot(sim_phylogeny, main = "phylogeny")

# create problem with a maximum phylogenetic endemism objective,
# where each feature needs 10% of its distribution to be secured for
# it to be adequately conserved and a total budget of 1900
p1 &lt;-
  problem(sim_pu_raster, sim_features) %&gt;%
  add_max_phylo_end_objective(1900, sim_phylogeny) %&gt;%
  add_relative_targets(0.1) %&gt;%
  add_binary_decisions() %&gt;%
  add_default_solver(verbose = FALSE)

# solve problem
s1 &lt;- solve(p1)

# plot solution
plot(s1, main = "solution", axes = FALSE)

# find out which features have their targets met
r1 &lt;- eval_target_coverage_summary(p1, s1)
print(r1, width = Inf)

# plot the phylogeny and color the adequately represented features in red
plot(
  sim_phylogeny, main = "adequately represented features",
  tip.color = replace(
    rep("black", terra::nlyr(sim_features)),
    sim_phylogeny$tip.label %in% r1$feature[r1$met],
    "red"
  )
)

# rename the features in the example phylogeny for use with the
# multi-zone data
sim_phylogeny$tip.label &lt;- feature_names(sim_zones_features)

# create targets for a multi-zone problem. Here, each feature needs a total
# of 10 units of habitat to be conserved among the three zones to be
# considered adequately conserved
targets &lt;- tibble::tibble(
  feature = feature_names(sim_zones_features),
  zone = list(zone_names(sim_zones_features))[
    rep(1, number_of_features(sim_zones_features))],
  type = rep("absolute", number_of_features(sim_zones_features)),
  target = rep(10, number_of_features(sim_zones_features))
)

# create a multi-zone problem with a maximum phylogenetic endemism
# objective, where the total expenditure in all zones is 5000.
p2 &lt;-
  problem(sim_zones_pu_raster, sim_zones_features) %&gt;%
  add_max_phylo_end_objective(5000, sim_phylogeny) %&gt;%
  add_manual_targets(targets) %&gt;%
  add_binary_decisions() %&gt;%
  add_default_solver(verbose = FALSE)

# solve problem
s2 &lt;- solve(p2)

# plot solution
plot(category_layer(s2), main = "solution", axes = FALSE)

# find out which features have their targets met
r2 &lt;- eval_target_coverage_summary(p2, s2)
print(r2, width = Inf)

# plot the phylogeny and color the adequately represented features in red
plot(
  sim_phylogeny, main = "adequately represented features",
  tip.color = replace(
    rep("black", terra::nlyr(sim_features)), which(r2$met), "red"
  )
)

# create a multi-zone problem with a maximum phylogenetic endemism
# objective, where each zone has a separate budget.
p3 &lt;-
  problem(sim_zones_pu_raster, sim_zones_features) %&gt;%
  add_max_phylo_end_objective(c(2500, 500, 2000), sim_phylogeny) %&gt;%
  add_manual_targets(targets) %&gt;%
  add_binary_decisions() %&gt;%
  add_default_solver(verbose = FALSE)

# solve problem
s3 &lt;- solve(p3)

# plot solution
plot(category_layer(s3), main = "solution", axes = FALSE)

# find out which features have their targets met
r3 &lt;- eval_target_coverage_summary(p3, s3)
print(r3, width = Inf)

# plot the phylogeny and color the adequately represented features in red
plot(
  sim_phylogeny, main = "adequately represented features",
  tip.color = replace(
    rep("black", terra::nlyr(sim_features)), which(r3$met), "red"
  )
)

## End(Not run)
</code></pre>


</div>