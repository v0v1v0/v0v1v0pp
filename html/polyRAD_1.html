<div class="container">

<table style="width: 100%;"><tr>
<td>AddAlleleFreqByTaxa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Estimate Local Allele Frequencies for Each Taxon Based on Population Structure
</h2>

<h3>Description</h3>

<p>This function estimates allele frequencies per taxon, rather than for the whole
population.  The best estimated genotypes (either <code>object$depthRatio</code> or
<code>GetWeightedMeanGenotypes(object)</code>) are regressed against principal 
coordinate axes.  The regression coefficients are then in turn used to 
predict allele frequencies from PC axes.  Allele frequencies outside of a 
user-defined range are then adjusted so that they fall within that range.
</p>


<h3>Usage</h3>

<pre><code class="language-R">AddAlleleFreqByTaxa(object, ...)
## S3 method for class 'RADdata'
AddAlleleFreqByTaxa(object, minfreq = 0.0001, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>

<p>A <code>"RADdata"</code> object.  <code>AddPCA</code> should have already
been run.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minfreq</code></td>
<td>

<p>The minimum allowable allele frequency to be output.  The maximum allowable
allele frequency will be calculated as <code>1 - minfreq</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Additional arguments (none implemented).
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For every allele, all PC axes stored in <code>object$PCA</code> are used for 
generating regression coefficients and making predictions, regardless of whether
they are significantly associated with the allele.
</p>
<p><code>object$depthRatio</code> has missing data for loci with no reads; these missing
data are omitted on a per-allele basis when calculating regression coefficients.
However, allele frequencies are output for all taxa at all alleles, because
there are no missing data in the PC axes.  The output of 
<code>GetWeightedMeanGenotypes</code> has no missing data, so missing data are
not an issue when calculating regression coefficients using that method.
</p>
<p>After predicting allele frequencies from the regression coefficients, the
function loops through all loci and taxa to adjust allele frequencies if necessary.
This is needed because otherwise some allele frequencies will be below zero or
above one (typically in subpopulations where alleles are near fixation), 
which interferes with prior genotype probability estimation.  For a 
given taxon and locus, any allele frequencies below <code>minfreq</code> are adjusted
to be equal to <code>minfreq</code>, and any allele frequencies above <code>1 - minfreq</code>
are adjusted to be <code>1 - minfreq</code>.  Remaining allele frequencies are adjusted
so that all allele frequencies for the taxon and locus sum to one.
</p>


<h3>Value</h3>

<p>A <code>"RADdata"</code> object identical to the one passed to the function, but with
a matrix of allele frequencies added to the <code>$alleleFreqByTaxa</code> slot.  Taxa
are in rows and alleles in columns.
</p>


<h3>Author(s)</h3>

<p>Lindsay V. Clark
</p>


<h3>See Also</h3>

<p><code>AddGenotypePriorProb_ByTaxa</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># load data
data(exampleRAD)
# do PCA
exampleRAD &lt;- AddPCA(exampleRAD, nPcsInit = 3)

# get allele frequencies
exampleRAD &lt;- AddAlleleFreqByTaxa(exampleRAD)

exampleRAD$alleleFreqByTaxa[1:10,]
</code></pre>


</div>