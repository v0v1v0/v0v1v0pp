<div class="container">

<table style="width: 100%;"><tr>
<td>session_cookie</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Store session data in encrypted cookies.</h2>

<h3>Description</h3>

<p><code>plumber</code> uses the crypto R package <code>sodium</code>, to encrypt/decrypt
<code>req$session</code> information for each server request.
</p>


<h3>Usage</h3>

<pre><code class="language-R">session_cookie(
  key,
  name = "plumber",
  expiration = FALSE,
  http = TRUE,
  secure = FALSE,
  same_site = FALSE,
  path = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>key</code></td>
<td>
<p>The secret key to use. This must be consistent across all R sessions
where you want to save/restore encrypted cookies. It should be produced using
<code>random_cookie_key</code>. Please see the "Storing secure keys" section for more details
complex character string to bolster security.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>The name of the cookie in the user's browser.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expiration</code></td>
<td>
<p>A number representing the number of seconds into the future
before the cookie expires or a <code>POSIXt</code> date object of when the cookie expires.
Defaults to the end of the user's browser session.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>http</code></td>
<td>
<p>Boolean that adds the <code>HttpOnly</code> cookie flag that tells the browser
to save the cookie and to NOT send it to client-side scripts. This mitigates <a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">cross-site scripting</a>.
Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>secure</code></td>
<td>
<p>Boolean that adds the <code>Secure</code> cookie flag.  This should be set
when the route is eventually delivered over <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>same_site</code></td>
<td>
<p>A character specifying the SameSite policy to attach to the cookie.
If specified, one of the following values should be given: "Strict", "Lax", or "None".
If "None" is specified, then the <code>secure</code> flag MUST also be set for the modern browsers to
accept the cookie. An error will be returned if <code>same_site = "None"</code> and <code>secure = FALSE</code>.
If not specified or a non-character is given, no SameSite policy is attached to the cookie.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>The URI path that the cookie will be available in future requests.
Defaults to the request URI. Set to <code>"/"</code> to make cookie available to
all requests at the host.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The cookie's secret encryption <code>key</code> value must be consistent to maintain
<code>req$session</code> information between server restarts.
</p>


<h3>Storing secure keys</h3>

<p>While it is very quick to get started with user session cookies using
<code>plumber</code>, please exercise precaution when storing secure key information.
If a malicious person were to gain access to the secret <code>key</code>, they would
be able to eavesdrop on all <code>req$session</code> information and/or tamper with
<code>req$session</code> information being processed.
</p>
<p>Please: </p>

<ul>
<li>
<p> Do NOT store keys in source control.
</p>
</li>
<li>
<p> Do NOT store keys on disk with permissions that allow it to be accessed by everyone.
</p>
</li>
<li>
<p> Do NOT store keys in databases which can be queried by everyone.
</p>
</li>
</ul>
<p>Instead, please: </p>

<ul>
<li>
<p> Use a key management system, such as
<a href="https://github.com/r-lib/keyring">'keyring'</a> (preferred)
</p>
</li>
<li>
<p> Store the secret in a file on disk with appropriately secure permissions,
such as "user read only" (<code>Sys.chmod("myfile.txt", mode = "0600")</code>),
to prevent others from reading it.
</p>
</li>
</ul>
<p> Examples of both of these solutions are done in the Examples section.
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="https://github.com/r-lib/sodium">'sodium'</a>: R bindings to 'libsodium'
</p>
</li>
<li> <p><a href="https://doc.libsodium.org/">'libsodium'</a>: A Modern and Easy-to-Use Crypto Library
</p>
</li>
<li> <p><a href="https://github.com/r-lib/keyring">'keyring'</a>: Access the system credential store from R
</p>
</li>
<li> <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Directives">Set-Cookie flags</a>: Descriptions of different flags for <code>Set-Cookie</code>
</p>
</li>
<li> <p><a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">Cross-site scripting</a>: A security exploit which allows an attacker to inject into a website malicious client-side code
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

## Set secret key using `keyring` (preferred method)
keyring::key_set_with_value("plumber_api", plumber::random_cookie_key())


# Load a plumber API
plumb_api("plumber", "01-append") %&gt;%
  # Add cookie support via `keyring`
  pr_cookie(
    keyring::key_get("plumber_api")
  ) %&gt;%
  pr_run()


#### -------------------------------- ###


## Save key to a local file
pswd_file &lt;- "normal_file.txt"
cat(plumber::random_cookie_key(), file = pswd_file)
# Make file read-only
Sys.chmod(pswd_file, mode = "0600")


# Load a plumber API
plumb_api("plumber", "01-append") %&gt;%
  # Add cookie support and retrieve secret key from file
  pr_cookie(
    readLines(pswd_file, warn = FALSE)
  ) %&gt;%
  pr_run()

## End(Not run)
</code></pre>


</div>