<div class="container">

<table style="width: 100%;"><tr>
<td>forecasting</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Forecasting infections, hospitalizations and deaths in hospital.</h2>

<h3>Description</h3>

<p>Forecasting infections, hospitalizations and deaths in hospital. From estimated two-dimensional rates of infections and hospilizations and estimated hazards of deaths and recoveries, new infections, hospitalizations and deaths are predicted in a forecasting period.
</p>


<h3>Usage</h3>

<pre><code class="language-R">forecasting(Cval=1, period, RoInf, RoHosp, RoDeath, RoRec,
            Pz, newHz, Hz, Dz, Rz)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Cval</code></td>
<td>

<p>a numeric value with the infection indicator. Default value is <code>Cval=1</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>period</code></td>
<td>

<p>an integer value with the number of days to forecast.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RoInf</code></td>
<td>

<p>a matrix with the estimated rate of infection (<code>M-1</code> times <code>M-1</code>) estimated from <code>M</code> days, evaluating the function  <code>rate2Dmiss</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RoHosp</code></td>
<td>
<p> (optional)
a matrix with the estimated rate of hospitalization (<code>M</code> times <code>M</code>), obtained evaluating the function  <code>rate2Dmiss</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RoDeath</code></td>
<td>
<p> (optional)
a matrix with the estimated hazard of deaths  (<code>M</code> times <code>M</code>), obtained  evaluating the function  <code>hazard2Dmiss</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RoRec</code></td>
<td>
<p> (optional)
a matrix with the estimated hazard of recoveries  (<code>M</code> times <code>M</code>), obtained  evaluating the function  <code>hazard2Dmiss</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Pz</code></td>
<td>

<p>a vector with the observed (past) number of people tested positive each day (length <code>M</code>).  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newHz</code></td>
<td>

<p>a vector with the observed number of new hospitalizations each day (length <code>M</code>).  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Hz</code></td>
<td>

<p>a vector with the observed total number people in   hospitals each day (length <code>M</code>).  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dz</code></td>
<td>

<p>a vector with the observed number of deaths each day (length <code>M</code>).  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rz</code></td>
<td>

<p>a vector with the observed number of recoveries each day (length <code>M</code>).  </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To create estimated rates and hazards for the arguments evaluate the functions <code>hazard2Dmiss</code> and <code>rate2Dmiss</code>. If the argument <code>RoHosp</code> is missing then only infections are predicted. If any of the argument <code>RoDeath</code> or <code>RoRec</code> is missing  then deaths (recoveries) are not predicted.
</p>
<p>The infection indicator <code>Cval</code> is typically provided by experts. At the more recent observation (t), it indicates whether the future (t+h, h &gt; 0) will be different or equal to the immediate past. If <code>Cval=1</code> then we can forecast the immediate future based on the immediate past. There might be periods where little is happening (and the indicator might have a tendency
to increase slowly) and there might be few but very important change-points where measures (e.g. lock down) are introduced to minimize future infections (and the indicator might drop dramatically in a matter of days). See Gámiz et al. (2024a) for more details and the relationship to the well-known reproduction number.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Pz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of infections in the past. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Pz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of infections in the forecasting period. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newHz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of hospitalizations in the past. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newHz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of hospitalizations in the forecasting period. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of deaths in the past. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of deaths in the forecasting period. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rz.fitted</code></td>
<td>
<p>a vector with the fitted values for the number of recoveries in the past. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rz.pred</code></td>
<td>
<p>a vector with the predicted values for the number of recoveries in the forecasting period. </p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code>hazard2Dmiss</code>, <code>rate2Dmiss</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Forecasting October 2020 from past data
data('covid')
## We remove the first 56 rows(no data on testing until 13th May)
covid2&lt;-covid[-c(1:56),]
M2&lt;-nrow(covid2)
Hi&lt;-covid2$Hospi
Hi&lt;-Hi[-1]
Ri&lt;-covid2$Recov
Ri&lt;-diff(Ri)
Di&lt;-covid2$Death
Di&lt;-diff(Di)
Pi&lt;-covid2$Posit
M2&lt;-length(Di)
# New hospitalizations are Hi-Ri-Di
newHi&lt;-Hi[-1]-(Hi[-M2]-Ri[-M2]-Di[-M2])
newHi&lt;-as.integer(c(Hi[1],newHi))
newHi[newHi&lt;0]&lt;-0
ddates&lt;-covid2$Date

## 1. First we estimate the death and recovery hazards,
## and the infection and hospitalization rates.
## Estimation using data up to 30-Sep-2020
Ms&lt;-141   # up to 30-Sep

## 1.1. Infection rate
Ei.new&lt;-Pi[1:Ms]
delay&lt;-1;Msd&lt;-Ms-delay
Oi.z&lt;-Ei.new[-(1:delay)]
Ei.z1&lt;-Ei.new[1:Msd];
t.grid&lt;-z.grid&lt;-1:Msd
bs&lt;-t(c(5,10))
RInf&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,
     bs.grid=bs,cv=FALSE)
RoInf&lt;-RInf$hi.zt

## 1.2. Hospitalization rate
Oi.z&lt;-newHi[1:Ms]
# The exposure are the positives data
Ei.z1&lt;-Pi[1:Ms]
t.grid&lt;-z.grid&lt;-1:Ms
bs&lt;-t(c(150,150))
RHosp&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,
     bs.grid=bs,cv=FALSE)
RoHosp&lt;-matrix(as.numeric(RHosp$hi.zt),Ms,Ms)

## 1.3. Hazards of deaths and recoveries
Oi1.z&lt;-Di[1:Ms]  # deaths
Oi2.z&lt;-Ri[1:Ms]   # recoveries
Ei.z&lt;-Hi[1:Ms]    # exposure is left as cumulative
t.grid&lt;-z.grid&lt;-1:Ms
bs&lt;-t(c(150,40))
res.h&lt;-hazard2Dmiss(t.grid,z.grid,Oi1.z,Oi2.z,Ei.z,
     bs.grid=bs,cv=FALSE)
RoDeath&lt;-as.matrix(res.h$hi1.zt,Ms,Ms) ## 2D-hazard of deaths
RoRec&lt;-as.matrix(res.h$hi2.zt,Ms,Ms) ## 2D-hazard of recoveries

## 2. Forecasting with a given infection indicator
Cval&lt;-1.5
period&lt;-32  # forecasts up to 1st November, 32 days
fore&lt;-forecasting(Cval,period,RoInf,RoHosp,RoDeath,RoRec,
    Pi[1:Ms],newHi[1:Ms],Hi[1:Ms],Di[1:Ms],Ri[1:Ms])
Hz.pred&lt;-fore$newHz.pred
Pz.pred&lt;-fore$Pz.pred
Dz.pred&lt;-fore$Dz.pred

## 3. Plot forecasts and compare with observed values
## (future values are shown for predictions validation)
Pz.obs&lt;-Pi
Hz.obs&lt;-newHi
Dz.obs&lt;-Di

## Graph with the new infections up to 30-Sep and forecasts
yy&lt;-range(Pz.pred,Pz.obs,na.rm=TRUE)
plot(1:(Ms-1),Pz.obs[3:(Ms+1)],ylab='',xlab='Date of notification',
     main='Forecasts of new positives in October 2020',pch=19,
     ylim=yy,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
## forecasts start on 30-sep but we only plot from 1-October
points(Ms:(Ms+period-2),Pz.obs[(Ms+2):(Ms+period)],col=1,pch=1)
lines(Ms:(Ms+period-2),Pz.pred[-1],col=2,lty=2,lwd=3)
legend('topleft',c('Data: daily number of new positives until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of new positives in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),lwd=c(NA,3,NA),bty='n')

## Graph with the new hospitalizations up to 30-Sep and forecasts
ylim1&lt;-range(Hz.pred,Hz.obs[-(1:2)],na.rm=TRUE)
plot(1:(Ms-1),Hz.obs[3:(Ms+1)],ylab='',xlab='Date of admission',
     main='Forecasts of new hospitalizations in October 2020',
     pch=19,
     ylim=ylim1,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
points(Ms:(Ms+period-2),Hz.obs[(Ms+2):(Ms+period)])
lines(Ms:(Ms+period-2),Hz.pred[-1],col=2,lty=2,lwd=2)
legend('topleft',c('Data: daily number of new hospitalizations until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of new hospitalizations in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),lwd=c(NA,3,NA),bty='n')


## Graph with deaths up to 30-Sep and forecasts
ylim1&lt;-range(Dz.pred,Dz.obs[-(1:2)],na.rm=TRUE)
plot(1:(Ms-1),Dz.obs[3:(Ms+1)],ylab='',xlab='Date of admission',
     main='Forecasts of deaths in October 2020',
     pch=19,ylim=ylim1,xaxt='n',xlim=c(1,Ms+1+period))
oat&lt;-c(1,17,32,47,62,78,93,109,124,139,154,170)
olab&lt;-ddates[oat]
axis(1,at=oat,labels=olab)
points(Ms:(Ms+period-2),Dz.obs[(Ms+2):(Ms+period)])
lines(Ms:(Ms+period-2),Dz.pred[-1],col=2,lty=2,lwd=2)
legend('topleft',c('Data: daily number of deaths until 30-Sep',
    paste('Forecasts with Cval=',round(Cval,2)),
    'True numbers of deaths in October'),
    pch=c(19,NA,1),col=c(1,2,1),lty=c(NA,2,NA),
    lwd=c(NA,3,NA),bty='n')

</code></pre>


</div>