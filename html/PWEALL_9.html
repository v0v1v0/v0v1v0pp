<div class="container">

<table style="width: 100%;"><tr>
<td>instudyfindt</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>calculate the timeline in study when some or all subjects have entered</h2>

<h3>Description</h3>

<p>This will calculate the timeline from some timepoint in study when some/all subjects have entered accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class="language-R">instudyfindt(target=400,y=exp(rnorm(300)),z=rbinom(300,1,0.5),
                  d=rep(c(0,1,2),each=100),
                  tcut=2,blinded=1,type0=1,type1=type0,
                  rp20=0.5,rp21=0.5,tchange=c(0,1),
                  rate10=c(1,0.7),rate20=c(0.9,0.7),rate30=c(0.4,0.6),rate40=rate20,
                  rate50=rate20,ratec0=c(0.3,0.3),
                  rate11=rate10,rate21=rate20,rate31=rate30,
                  rate41=rate40,rate51=rate50,ratec1=ratec0,
                  withmorerec=1,
                  ntotal=1000,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                  ntype0=1,ntype1=1,
                  nrp20=0.5,nrp21=0.5,ntchange=c(0,1),
                  nrate10=rate10,nrate20=rate20,nrate30=rate30,nrate40=rate40,
                  nrate50=rate50,nratec0=ratec0,
                  nrate11=rate10,nrate21=rate20,nrate31=rate30,nrate41=rate40,
                  nrate51=rate50,nratec1=ratec0,
                  eps=1.0e-2,init=tcut*1.1,epsilon=0.001,maxiter=100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>target</code></td>
<td>
<p>target number of events</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>observed times</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>observed treatment indicator when <code>blinded</code>=0, z=1 denotes the treatment group and 0 the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>event indicator, 1=event, 0=censored, 2=no event or censored up to <code>tcut</code>, the data cut-point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tcut</code></td>
<td>
<p>the data cut-point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blinded</code></td>
<td>
<p>blinded=1 if the data is blinded,=0 if it is unblinded</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type0</code></td>
<td>
<p>type of the crossover for the observed data in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type1</code></td>
<td>
<p>type of the crossover for the observed data in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rp20</code></td>
<td>
<p>re-randomization prob for the observed data in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rp21</code></td>
<td>
<p>re-randomization prob for the observed data in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>ratejk</code>, j=1,2,3,4,5,c; k=0,1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate10</code></td>
<td>
<p>Hazard before crossover for the old subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate20</code></td>
<td>
<p>Hazard after crossover for the old subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate30</code></td>
<td>
<p>Hazard for time to crossover for the old subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate40</code></td>
<td>
<p>Hazard after crossover for the old subjects in the control group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate50</code></td>
<td>
<p>Hazard after crossover for the old subjects in the control group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratec0</code></td>
<td>
<p>Hazard for time to censoring for the old subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate11</code></td>
<td>
<p>Hazard before crossover for the old subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate21</code></td>
<td>
<p>Hazard after crossover for the old subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate31</code></td>
<td>
<p>Hazard for time to crossover for the old subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate41</code></td>
<td>
<p>Hazard after crossover for the old subjects in the treatment group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate51</code></td>
<td>
<p>Hazard after crossover for the old subjects in the treatment group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratec1</code></td>
<td>
<p>Hazard for time to censoring for the old subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>withmorerec</code></td>
<td>
<p>withmorerec=1 if more subjects are needed to be recruited; =0 otherwise</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntotal</code></td>
<td>
<p>total number of the potential new subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taur</code></td>
<td>
<p>recruitment time for the potential new subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>Piecewise constant recuitment rate for the potential new subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ut</code></td>
<td>
<p>Recruitment intervals for the potential new subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi1</code></td>
<td>
<p>Allocation probability to the treatment group for the potential new subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntype0</code></td>
<td>
<p>type of the crossover for the potential new subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntype1</code></td>
<td>
<p>type of the crossover for the potential new subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrp20</code></td>
<td>
<p>re-randomization prob for the potential new subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrp21</code></td>
<td>
<p>re-randomization prob for the potential new subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of ntchange must be zero. It must have the same length as <code>nratejk</code>, j=1,2,3,4,5,c; k=0,1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate10</code></td>
<td>
<p>Hazard before crossover for the potential new subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate20</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate30</code></td>
<td>
<p>Hazard for time to crossover for the potential new subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate40</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the control group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate50</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the control group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nratec0</code></td>
<td>
<p>Hazard for time to censoring for the potential new subjects in the control group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate11</code></td>
<td>
<p>Hazard before crossover for the potential new subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate21</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate31</code></td>
<td>
<p>Hazard for time to crossover for the potential new subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate41</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the treatment group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrate51</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the treatment group for complex case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nratec1</code></td>
<td>
<p>Hazard for time to censoring for the potential new subjects in the treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>initital value of the timeline estimate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>A small number representing the error tolerance when calculating the timeline.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>Maximum number of iterations when calculating the timeline</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
The hazard functions corresponding to <code>nrate11</code>,...,<code>nrate51</code>,<code>nratec1</code>, <code>nrate10</code>,...,<code>nrate50</code>,<code>nratec0</code> are all piecewise constant functions and all must have the same <code>ntchange</code>.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>t1</code></td>
<td>
<p>the calculated timeline</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dvalue</code></td>
<td>
<p>the number of events</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dvprime</code></td>
<td>
<p>the derivative of the event cummulative function at time <code>t1</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tvar</code></td>
<td>
<p>the variance of the timeline estimator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ny</code></td>
<td>
<p>total number of subjects that could be in the study</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>final tolerance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>Number of iterations performed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t1hist</code></td>
<td>
<p>the history of the iteration for timeline</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dvaluehist</code></td>
<td>
<p>the history of the iteration for the event count</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dvprimehist</code></td>
<td>
<p>the history of the iteration for the derivative of event count with respect to time</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code>pwe</code>,<code>rpwe</code>,<code>qpwe</code>,<code>pwecxpwufindt</code></p>


<h3>Examples</h3>

<pre><code class="language-R">n&lt;-1000
target&lt;-550
ntotal&lt;-1000
pi1&lt;-0.5
taur&lt;-2.8
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
tchange&lt;-c(0,1.873)
tcut&lt;-2

####generate the data
E&lt;-T&lt;-C&lt;-Z&lt;-delta&lt;-rep(0,n)
E&lt;-rpwu(nr=n,u=u,ut=ut)$r
Z&lt;-rbinom(n,1,pi1)
n1&lt;-sum(Z)
n0&lt;-sum(1-Z)
C[Z==1]&lt;-rpwe(nr=n1,rate=rc1,tchange=tchange)$r
C[Z==0]&lt;-rpwe(nr=n0,rate=rc0,tchange=tchange)$r
T[Z==1]&lt;-rpwecx(nr=n1,rate1=r11,rate2=r21,rate3=r31,
                rate4=r41,rate5=r51,tchange=tchange,type=1)$r
T[Z==0]&lt;-rpwecx(nr=n0,rate1=r10,rate2=r20,rate3=r30,
                rate4=r40,rate5=r50,tchange=tchange,type=1)$r
y&lt;-pmin(pmin(T,C),tcut-E)
y1&lt;-pmin(C,tcut-E)
delta[T&lt;=y]&lt;-1
delta[C&lt;=y]&lt;-0
delta[tcut-E&lt;=y &amp; tcut-E&gt;0]&lt;-2
delta[tcut-E&lt;=y &amp; tcut-E&lt;=0]&lt;--1

ys&lt;-y[delta&gt;-1]
Zs&lt;-Z[delta&gt;-1]
ds&lt;-delta[delta&gt;-1]

nplus&lt;-sum(delta==-1)
nd0&lt;-sum(ds==0)
nd1&lt;-sum(ds==1)
nd2&lt;-sum(ds==2)


ntaur&lt;-taur-tcut
nu&lt;-c(1/ntaur,1/ntaur)
nut&lt;-c(ntaur/2,ntaur)

###calculate the timeline at baseline
xt&lt;-pwecxpwufindt(target=target,ntotal=n,taur=taur,u=u,ut=ut,pi1=pi1,
              rate11=r11,rate21=r21,rate31=r31,ratec1=rc1,
              rate10=r10,rate20=r20,rate30=r30,ratec0=rc0,
              tchange=tchange,eps=0.001,init=taur,epsilon=0.000001,maxiter=100)
###calculate the timeline in study
yt&lt;-instudyfindt(target=target,y=ys,z=Zs,d=ds,
                       tcut=tcut,blinded=0,type1=1,type0=1,tchange=tchange,
                       rate10=r10,rate20=r20,rate30=r30,ratec0=rc0,
                       rate11=r11,rate21=r21,rate31=r31,ratec1=rc1,
                       withmorerec=1,
                       ntotal=nplus,taur=ntaur,u=nu,ut=nut,pi1=pi1,
                       ntype1=1,ntype0=1,ntchange=tchange,
                       nrate10=r10,nrate20=r20,nrate30=r30,nratec0=rc0,
                       nrate11=r11,nrate21=r21,nrate31=r31,nratec1=rc1,
                       eps=1.0e-2,init=2,epsilon=0.001,maxiter=100)
##timelines                       
c(yt$t1,xt$t1)
##standard errors of the timeline estimators 
c(sqrt(yt$tvar/yt$ny),sqrt(xt$tvar/n))
###95 percent CIs
c(yt$t1-1.96*sqrt(yt$tvar/yt$ny),yt$t1+1.96*sqrt(yt$tvar/yt$ny))
c(xt$t1-1.96*sqrt(xt$tvar/n),xt$t1+1.96*sqrt(xt$tvar/n))

</code></pre>


</div>