<div class="container">

<table style="width: 100%;"><tr>
<td>plot_sp2d</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot and mapping spatial trends.</h2>

<h3>Description</h3>

<p>Make plots and maps of the spatial trends 
in 2d of the objects fitted with <code>pspatfit</code> function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_sp2d(
  object,
  data,
  coordinates = NULL,
  npoints = 300,
  cexpoints = 0.25,
  addcontour = TRUE,
  addpoints = TRUE,
  addmain = TRUE,
  addint = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object returned from <code>pspatfit</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>either sf or dataframe with the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coordinates</code></td>
<td>
<p>coordinates matrix if <code>data</code> is not an sf object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npoints</code></td>
<td>
<p>number of points to use in the interpolation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cexpoints</code></td>
<td>
<p>size of the points. Default = 0.25</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addcontour</code></td>
<td>
<p>Logical value to add contour lines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addpoints</code></td>
<td>
<p>Logical value to add spatial points to the graphics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addmain</code></td>
<td>
<p>Add f1_main and f2_main plots in psanova case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addint</code></td>
<td>
<p>Add f12_int in psanova case.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>plots and maps of the spatial trends
</p>


<h3>Author(s)</h3>


<table>
<tr>
<td style="text-align: left;"> 
  Roman Minguez  </td>
<td style="text-align: left;"> <a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a> </td>
</tr>
<tr>
<td style="text-align: left;">
  Roberto Basile </td>
<td style="text-align: left;"> <a href="mailto:roberto.basile@univaq.it">roberto.basile@univaq.it</a> </td>
</tr>
<tr>
<td style="text-align: left;"> Maria Durban </td>
<td style="text-align: left;">
  <a href="mailto:mdurban@est-econ.uc3m.es">mdurban@est-econ.uc3m.es</a> </td>
</tr>
<tr>
<td style="text-align: left;"> Gonzalo Espana-Heredia </td>
<td style="text-align: left;">
  <a href="mailto:gehllanza@gmail.com">gehllanza@gmail.com</a> </td>
</tr>
<tr>
<td style="text-align: left;"> 
 </td>
</tr>
</table>
<h3>References</h3>

 
<ul>
<li>
<p> Lee, D. and Durban, M. (2011). P-Spline ANOVA Type Interaction 
Models for Spatio-Temporal Smoothing. <em>Statistical Modelling</em>, 
(11), 49-69. &lt;doi:10.1177/1471082X1001100104&gt;
</p>
</li>
<li>
<p> Eilers, P. and Marx, B. (2021). <em>Practical Smoothing. 
The Joys of P-Splines</em>. Cambridge University Press.
</p>
</li>
<li>
<p> Fahrmeir, L.; Kneib, T.;  Lang, S.; and Marx, B. (2021). 
<em>Regression. Models, Methods and Applications (2nd Ed.)</em>.
Springer.
</p>
</li>
<li>
<p> Wood, S.N. (2017). <em>Generalized Additive Models. 
An Introduction with <code>R</code></em> (second edition). CRC Press, Boca Raton.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">library(pspatreg)
######## EXAMPLE 2D WITH AMES DATA 
######## getting and preparing the data
library(spdep)
ames &lt;- AmesHousing::make_ames() # Raw Ames Housing Data
ames_sf &lt;- st_as_sf(ames, coords = c("Longitude", "Latitude"))
ames_sf$Longitude &lt;- ames$Longitude
ames_sf$Latitude &lt;- ames$Latitude
ames_sf$lnSale_Price &lt;- log(ames_sf$Sale_Price)
ames_sf$lnLot_Area &lt;- log(ames_sf$Lot_Area)
ames_sf$lnTotal_Bsmt_SF &lt;- log(ames_sf$Total_Bsmt_SF+1)
ames_sf$lnGr_Liv_Area &lt;- log(ames_sf$Gr_Liv_Area)
ames_sf1 &lt;- ames_sf[(duplicated(ames_sf$Longitude) == FALSE), ]

######## formula of the model in Ames
form2d &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
          pspl(lnLot_Area, nknots = 20) + 
          pspl(lnTotal_Bsmt_SF, nknots = 20) +
          pspl(lnGr_Liv_Area, nknots = 20) +
          pspt(Longitude, Latitude, 
               nknots = c(10, 10), 
               psanova = FALSE)

########### Constructing the spatial weights matrix
coord_sf1 &lt;- cbind(ames_sf1$Longitude, ames_sf1$Latitude)
k5nb &lt;- knn2nb(knearneigh(coord_sf1, k = 5, 
                          longlat = TRUE, use_kd_tree = FALSE), sym = TRUE)
lw_ames &lt;- nb2listw(k5nb, style = "W", 
                  zero.policy = FALSE)

######## fit the model
sp2dsar &lt;- pspatfit(form2d, data = ames_sf1, 
                    listw = lw_ames, 
                    method = "Chebyshev", 
                    type = "sar")
summary(sp2dsar)

####### plot spatial trend for spatial point coordinate
plot_sp2d(sp2dsar, data = ames_sf1)

###### MODEL WITH ANOVA DESCOMPOSITION
 form2d_psanova &lt;- lnSale_Price ~ Fireplaces + Garage_Cars +
                   pspl(lnLot_Area, nknots = 20) + 
                   pspl(lnTotal_Bsmt_SF, nknots = 20) +
                   pspl(lnGr_Liv_Area, nknots = 20) +
                   pspt(Longitude, Latitude, 
                        nknots = c(10, 10), 
                        psanova = TRUE)
      
sp2danovasar &lt;- pspatfit(form2d_psanova, 
                        data = ames_sf1, 
                        listw = lw_ames,
                        method = "Chebyshev", 
                        type = "sar")
summary(sp2danovasar)                         
                        
###### PLOT ANOVA DESCOMPOSITION MODEL
plot_sp2d(sp2danovasar, data = ames_sf1, 
          addmain = TRUE, addint = TRUE)
           
</code></pre>


</div>