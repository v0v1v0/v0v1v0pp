<div class="container">

<table style="width: 100%;"><tr>
<td>PheCAP-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
High-Throughput Phenotyping with EHR using a Common Automated Pipeline
</h2>

<h3>Description</h3>

<p>Implement surrogate-assisted feature extraction (SAFE) and
             common machine learning approaches to train and validate phenotyping models.
             Background and details about the methods can be found at 
             Zhang et al. (2019) &lt;doi:10.1038/s41596-019-0227-6&gt;,
             Yu et al. (2017) &lt;doi:10.1093/jamia/ocw135&gt;, and 
             Liao et al. (2015) &lt;doi:10.1136/bmj.h1885&gt;.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
<td style="text-align: left;">
Package: </td>
<td style="text-align: left;"> PheCAP</td>
</tr>
<tr>
<td style="text-align: left;">
Type: </td>
<td style="text-align: left;"> Package</td>
</tr>
<tr>
<td style="text-align: left;">
Title: </td>
<td style="text-align: left;"> High-Throughput Phenotyping with EHR using a Common Automated Pipeline</td>
</tr>
<tr>
<td style="text-align: left;">
Version: </td>
<td style="text-align: left;"> 1.2.1</td>
</tr>
<tr>
<td style="text-align: left;">
Authors@R: </td>
<td style="text-align: left;"> c(
    person("Yichi", "Zhang", role = "aut"),
    person("Chuan", "Hong", role = "aut"),
    person("Tianxi", "Cai", role = "aut"),
    person(family = "PARSE LTD", role =  c("aut", "cre"), email = "software@parse-health.org")
    )</td>
</tr>
<tr>
<td style="text-align: left;">
Description: </td>
<td style="text-align: left;"> Implement surrogate-assisted feature extraction (SAFE) and
             common machine learning approaches to train and validate phenotyping models.
             Background and details about the methods can be found at 
             Zhang et al. (2019) &lt;doi:10.1038/s41596-019-0227-6&gt;,
             Yu et al. (2017) &lt;doi:10.1093/jamia/ocw135&gt;, and 
             Liao et al. (2015) &lt;doi:10.1136/bmj.h1885&gt;.</td>
</tr>
<tr>
<td style="text-align: left;">
URL: </td>
<td style="text-align: left;"> https://celehs.github.io/PheCAP/, https://github.com/celehs/PheCAP</td>
</tr>
<tr>
<td style="text-align: left;">
BugReports: </td>
<td style="text-align: left;"> https://github.com/celehs/PheCAP/issues</td>
</tr>
<tr>
<td style="text-align: left;">
License: </td>
<td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
<td style="text-align: left;">
Encoding: </td>
<td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
<td style="text-align: left;">
ByteCompile: </td>
<td style="text-align: left;"> yes</td>
</tr>
<tr>
<td style="text-align: left;">
Imports: </td>
<td style="text-align: left;"> graphics,
methods,
stats,
utils,
glmnet,
RMySQL</td>
</tr>
<tr>
<td style="text-align: left;">
Suggests: </td>
<td style="text-align: left;"> ggplot2,
e1071,
randomForestSRC,
xgboost,
knitr,
rmarkdown</td>
</tr>
<tr>
<td style="text-align: left;">
VignetteBuilder: </td>
<td style="text-align: left;"> knitr</td>
</tr>
<tr>
<td style="text-align: left;">
Depends: </td>
<td style="text-align: left;"> R (&gt;= 3.3.0)</td>
</tr>
<tr>
<td style="text-align: left;">
RoxygenNote: </td>
<td style="text-align: left;"> 7.1.1</td>
</tr>
<tr>
<td style="text-align: left;">
LazyData: </td>
<td style="text-align: left;"> true</td>
</tr>
<tr>
<td style="text-align: left;">
Author: </td>
<td style="text-align: left;"> Yichi Zhang [aut],
  Chuan Hong [aut],
  Tianxi Cai [aut],
  PARSE LTD [aut, cre]</td>
</tr>
<tr>
<td style="text-align: left;">
Maintainer: </td>
<td style="text-align: left;"> PARSE LTD &lt;software@parse-health.org&gt;</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>Index of help topics:
</p>
<pre>
PheCAP-package          High-Throughput Phenotyping with EHR using a
                        Common Automated Pipeline
PhecapData              Define or Read Datasets for Phenotyping
PhecapSurrogate         Define a Surrogate Variable used in
                        Surrogate-Assisted Feature Extraction (SAFE)
ehr_data                A Synthetic EHR Dataset
phecap_generate_dictionary_file
                        Generate a Dictionary File for Note Parsing
phecap_perform_majority_voting
                        Perform Majority Voting on the CUIs from
                        Multiple Knowledge Sources
phecap_plot_roc_curves
                        Plot ROC and Related Curves for Phenotyping
                        Models
phecap_predict_phenotype
                        Predict Phenotype
phecap_run_feature_extraction
                        Run Surrogate-Assisted Feature Extraction
                        (SAFE)
phecap_train_phenotyping_model
                        Train Phenotyping Model using the Training
                        Labels
phecap_validate_phenotyping_model
                        Validate the Phenotyping Model using the
                        Validation Labels
</pre>
<p>PheCAP provides a straightforward interface for conducting
phenotyping on eletronic health records. One can specify the
data via <code>PhecapData</code>, define surrogate using
<code>PhecapSurrogate</code>. Next, one may run
surrogate-assisted feature extraction (SAFE) by calling
<code>phecap_run_feature_extraction</code>, and then
train and validate phenotyping models via
<code>phecap_train_phenotyping_model</code> and
<code>phecap_validate_phenotyping_model</code>.
The predictive performance can be visualized using
<code>phecap_plot_roc_curves</code>.
Predicted phenotype is provided by
<code>phecap_predict_phenotype</code>.
</p>


<h3>Author(s)</h3>

<p>NA
</p>
<p>Maintainer: NA
</p>


<h3>References</h3>

<p>Yu, S., Chakrabortty, A., Liao, K. P., Cai, T., Ananthakrishnan, A. N., Gainer, V. S., ... &amp; Cai, T. (2016). Surrogate-assisted feature extraction for high-throughput phenotyping. Journal of the American Medical Informatics Association, 24(e1), e143-e149.
</p>
<p>Liao, K. P., Cai, T., Savova, G. K., Murphy, S. N., Karlson, E. W., Ananthakrishnan, A. N., ... &amp; Churchill, S. (2015). Development of phenotype algorithms using electronic medical records and incorporating natural language processing. bmj, 350, h1885.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simulate an EHR dataset
size &lt;- 2000
latent &lt;- rgamma(size, 0.3)
latent2 &lt;- rgamma(size, 0.3)
ehr_data &lt;- data.frame(
  ICD1 = rpois(size, 7 * (rgamma(size, 0.2) + latent) / 0.5),
  ICD2 = rpois(size, 6 * (rgamma(size, 0.8) + latent) / 1.1),
  ICD3 = rpois(size, 1 * rgamma(size, 0.5 + latent2) / 0.5),
  ICD4 = rpois(size, 2 * rgamma(size, 0.5) / 0.5),
  NLP1 = rpois(size, 8 * (rgamma(size, 0.2) + latent) / 0.6),
  NLP2 = rpois(size, 2 * (rgamma(size, 1.1) + latent) / 1.5),
  NLP3 = rpois(size, 5 * (rgamma(size, 0.1) + latent) / 0.5),
  NLP4 = rpois(size, 11 * rgamma(size, 1.9 + latent) / 1.9),
  NLP5 = rpois(size, 3 * rgamma(size, 0.5 + latent2) / 0.5),
  NLP6 = rpois(size, 2 * rgamma(size, 0.5) / 0.5),
  NLP7 = rpois(size, 1 * rgamma(size, 0.5) / 0.5),
  HU = rpois(size, 30 * rgamma(size, 0.1) / 0.1),
  label = NA)
ii &lt;- sample.int(size, 400)
ehr_data[ii, "label"] &lt;- with(
  ehr_data[ii, ], rbinom(400, 1, plogis(
    -5 + 1.5 * log1p(ICD1) + log1p(NLP1) +
      0.8 * log1p(NLP3) - 0.5 * log1p(HU))))

# Define features and labels used for phenotyping.
data &lt;- PhecapData(ehr_data, "HU", "label", validation = 0.4)
data

# Specify the surrogate used for
# surrogate-assisted feature extraction (SAFE).
# The typical way is to specify a main ICD code, a main NLP CUI,
# as well as their combination.
# The default lower_cutoff is 1, and the default upper_cutoff is 10.
# In some cases one may want to define surrogate through lab test.
# Feel free to change the cutoffs based on domain knowledge.
surrogates &lt;- list(
  PhecapSurrogate(
    variable_names = "ICD1",
    lower_cutoff = 1, upper_cutoff = 10),
  PhecapSurrogate(
    variable_names = "NLP1",
    lower_cutoff = 1, upper_cutoff = 10))

# Run surrogate-assisted feature extraction (SAFE)
# and show result.
feature_selected &lt;- phecap_run_feature_extraction(
  data, surrogates, num_subsamples = 50, subsample_size = 200)
feature_selected

# Train phenotyping model and show the fitted model,
# with the AUC on the training set as well as random splits.
model &lt;- phecap_train_phenotyping_model(
  data, surrogates, feature_selected, num_splits = 100)
model

# Validate phenotyping model using validation label,
# and show the AUC and ROC.
validation &lt;- phecap_validate_phenotyping_model(data, model)
validation

phecap_plot_roc_curves(validation)

# Apply the model to all the patients to obtain predicted phenotype.
phenotype &lt;- phecap_predict_phenotype(data, model)


# A more complicated example

# Load Data.
data(ehr_data)
data &lt;- PhecapData(ehr_data, "healthcare_utilization", "label", 0.4)
data

# Specify the surrogate used for
# surrogate-assisted feature extraction (SAFE).
# The typical way is to specify a main ICD code, a main NLP CUI,
# as well as their combination.
# In some cases one may want to define surrogate through lab test.
# The default lower_cutoff is 1, and the default upper_cutoff is 10.
# Feel free to change the cutoffs based on domain knowledge.
surrogates &lt;- list(
  PhecapSurrogate(
    variable_names = "main_ICD",
    lower_cutoff = 1, upper_cutoff = 10),
  PhecapSurrogate(
    variable_names = "main_NLP",
    lower_cutoff = 1, upper_cutoff = 10),
  PhecapSurrogate(
    variable_names = c("main_ICD", "main_NLP"),
    lower_cutoff = 1, upper_cutoff = 10))

# Run surrogate-assisted feature extraction (SAFE)
# and show result.
feature_selected &lt;- phecap_run_feature_extraction(data, surrogates)
feature_selected

# Train phenotyping model and show the fitted model,
# with the AUC on the training set as well as random splits
model &lt;- phecap_train_phenotyping_model(data, surrogates, feature_selected)
model

# Validate phenotyping model using validation label,
# and show the AUC and ROC
validation &lt;- phecap_validate_phenotyping_model(data, model)
validation
phecap_plot_roc_curves(validation)

# Apply the model to all the patients to obtain predicted phenotype.
phenotype &lt;- phecap_predict_phenotype(data, model)

</code></pre>


</div>