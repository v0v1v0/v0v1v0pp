<div class="container">

<table style="width: 100%;"><tr>
<td>conditional_Spearman</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Conditional Partial Spearman's Rank Correlation</h2>

<h3>Description</h3>

<p><code>conditional_Spearman</code> computes the partial Spearman's rank correlation between variable <var>X</var> and variable <var>Y</var> adjusting for variable <var>Z</var> conditional on <var>Zc</var>.
<var>X</var> and <var>Y</var> can be any orderable variables, including continuous and discrete variables. Covariate <var>Z</var> can be multidimensional. <var>X</var>, <var>Y</var>, and <var>Z</var> are specified by the argument ‘<span class="samp">⁠formula⁠</span>’.
<var>Zc</var> is a one-dimensional covariate, specified by the argument ‘<span class="samp">⁠conditional.by⁠</span>’.
The basic approach involves fitting a specified model of <var>X</var> on <var>Z</var>, a specified model of <var>Y</var> on <var>Z</var>, obtaining the probability-scale residuals, <var>Xres</var> and <var>Yres</var>, from both models, and then modeling their Pearson's correlation conditional on <var>Zc</var>.
Different methods are provided to model the Pearson's correlation between the two sets of probability-scale residuals. See details in ‘<span class="samp">⁠conditional.method⁠</span>’.
As in ‘<span class="samp">⁠partial.Spearman⁠</span>’, by default <code>conditional_Spearman</code> uses cumulative link models for both continous and discrete ordinal variables <var>X</var> and <var>Y</var> to preserve the rank-based nature of Spearman's correlation. For some specific types of variables, options of fitting parametric models are also available. See details in ‘<span class="samp">⁠fit.x⁠</span>’ and ‘<span class="samp">⁠fit.y⁠</span>’.
</p>


<h3>Usage</h3>

<pre><code class="language-R">conditional_Spearman(
  formula,
  conditional.by,
  data,
  conditional.method = c("lm", "kernel", "stratification"),
  conditional.formula = paste("~", conditional.by, sep = ""),
  kernel.function = c("normal", "gaussian", "triweight", "quartic", "biweight",
    "epanechnikov", "uniform", "triangle"),
  kernel.bandwidth = "silverman",
  fit.x = "orm",
  fit.y = "orm",
  link.x = c("logit", "probit", "cloglog", "loglog", "cauchit", "logistic"),
  link.y = c("logit", "probit", "cloglog", "loglog", "cauchit", "logistic"),
  subset,
  na.action = getOption("na.action"),
  fisher = TRUE,
  conf.int = 0.95
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class <code>Formula</code> (or one
that can be coerced to that class): a symbolic description of the
model to be fitted.  The details of model specification are given
under ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditional.by</code></td>
<td>
<p>the name of the variable on which the partial Spearman's correlation is conditional. See ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame, list or environment (or object
coercible by <code>as.data.frame</code> to a data frame)
containing the variables in the model.  If not found in
<code>data</code>, the variables are taken from
<code>environment(formula)</code>, typically the environment from which
<code>conditional_Spearman</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditional.method</code></td>
<td>
<p>the method to be used for modeling conditional correlation between probability-scale residuals. The default option is ‘<span class="samp">⁠lm⁠</span>’, which fits linear regression models for <var>Xres</var><var>Yres</var> on <var>Zc</var>, <var>Xres^2</var> on <var>Zc</var>, and <var>Yres^2</var> on <var>Zc</var>, and then uses the fitted values to compute the Pearson's correlation between <var>Xres</var> and <var>Yres</var> conditional on <var>Zc</var>.
Other options include ‘<span class="samp">⁠kernel⁠</span>’, which computes correlation between <var>Xres</var> and <var>Yres</var> conditional on <var>Zc</var> using a kernel weighted method, and ‘<span class="samp">⁠stratification⁠</span>’, which computes the correlation between <var>Xres</var> and <var>Yres</var> seperately for each value of <var>Zc</var>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditional.formula</code></td>
<td>
<p>the formula to be used when ‘<span class="samp">⁠conditional.method⁠</span>’ is specified as ‘<span class="samp">⁠lm⁠</span>’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel.function</code></td>
<td>
<p>the kernel function to be used when ‘<span class="samp">⁠conditional.method⁠</span>’ is specified as ‘<span class="samp">⁠kernel⁠</span>’. Defaults to ‘<span class="samp">⁠normal⁠</span>’. Other options are ‘<span class="samp">⁠triweight⁠</span>’, ‘<span class="samp">⁠quartic⁠</span>’, ‘<span class="samp">⁠biweight⁠</span>’, ‘<span class="samp">⁠epanechnikov⁠</span>’, ‘<span class="samp">⁠uniform⁠</span>’, and ‘<span class="samp">⁠triangle⁠</span>’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel.bandwidth</code></td>
<td>
<p>the kernel bandwidth to be used when ‘<span class="samp">⁠conditional.method⁠</span>’ is specified as ‘<span class="samp">⁠kernel⁠</span>’. The default value is calculated using Silverman' rule. Users can also specify a positive numeric value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.x, fit.y</code></td>
<td>
<p>the fitting functions used for the model of <var>X</var> or <var>Y</var> on
<var>Z</var>.  The default function is ‘<span class="samp">⁠orm⁠</span>’, which fits cumulative link models for continuous or discrete ordinal variables. Other options include ‘<span class="samp">⁠lm⁠</span>’ (fit linear regression models and obtain the probability-scale residuals by assuming normality),
‘<span class="samp">⁠lm.emp⁠</span>’ (fit linear regression and obtain the probability-scale residuals by empirical ranking),
‘<span class="samp">⁠poisson⁠</span>’ (fit Poisson models for count variables), ‘<span class="samp">⁠nb⁠</span>’ (fit negative binomial models for count variables), and ‘<span class="samp">⁠logistic⁠</span>’ (fit logistic regression models for binary variables).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link.x, link.y</code></td>
<td>
<p>the link family to be used for the ordinal model of
<var>X</var> on <var>Z</var>.  Defaults to ‘<span class="samp">⁠logit⁠</span>’. Other options are
‘<span class="samp">⁠probit⁠</span>’, ‘<span class="samp">⁠cloglog⁠</span>’, ‘<span class="samp">⁠cauchit⁠</span>’, and ‘<span class="samp">⁠logistic⁠</span>’ (equivalent with ‘<span class="samp">⁠logit⁠</span>’). Used only when
‘<span class="samp">⁠fit.x⁠</span>’ is ‘<span class="samp">⁠orm⁠</span>’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional vector specifying a subset of
observations to be used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>action to take when <code>NA</code> present in data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fisher</code></td>
<td>
<p>logical indicating whether to apply fisher transformation to compute confidence intervals and p-values for the correlation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>
<p>numeric specifying confidence interval coverage.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To compute the partial Spearman's rank correlation between <var>X</var> and <var>Y</var> adjusting for <var>Z</var> conditional on <var>Zc</var>, ‘<span class="samp">⁠formula⁠</span>’ is specified as <code><var>X</var> | <var>Y</var> ~ <var>Z</var></code> and ‘<span class="samp">⁠conditional.by⁠</span>’ is specified as <var>Zc</var>.
This indicates that models of <code><var>X</var> ~ <var>Z</var></code> and <code><var>Y</var> ~ <var>Z</var></code> will be fit, and the correlation between the probability-scale residuals from these two models will be modeled conditional on <var>Zc</var>.
</p>


<h3>Value</h3>

<p>object of ‘<span class="samp">⁠conditional_Spearman⁠</span>’ class.
</p>


<h3>References</h3>

<p>Li C and Shepherd BE (2012)
A new residual for ordinal outcomes.
<em>Biometrika</em>. <b>99</b>: 473–480.
</p>
<p>Shepherd BE, Li C, Liu Q (2016)
Probability-scale residuals for continuous, discrete, and censored data.
<em>The Canadian Jouranl of Statistics</em>. <b>44</b>:463–476.
</p>
<p>Liu Q, Shepherd BE, Wanga V, Li C (2018)
Covariate-Adjusted Spearman's Rank Correlation with Probability-Scale Residuals.
<em>Biometrics</em>. <b>74</b>:595–605.
</p>


<h3>See Also</h3>

<p><code>print.conditional_Spearman</code>,<code>print.conditional_Spearman</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(PResidData)
library(rms)
#### fitting cumulative link models for both Y and W
result &lt;- conditional_Spearman(c|y~ x + w, conditional.by="w",
                                       conditional.method="lm", conditional.formula="~rcs(w)",
                                       fit.x="poisson",fit.y="orm",
                                       data=PResidData, fisher=TRUE)
plot(result)
</code></pre>


</div>