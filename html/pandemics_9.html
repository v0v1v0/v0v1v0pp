<div class="container">

<table style="width: 100%;"><tr>
<td>rate2Dmiss</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Local Linear Estimator of the Two-Dimensional Infection (or Hospitalization) Rate from Missing-Survival-Link Data.
</h2>

<h3>Description</h3>

<p>Local linear estimator of the infection or the hospitalization rate in the case of missing-survival-link data (Gámiz et al. 2024a). The rate is assumed to have two dimensions: a one-dimensional marker (typically the notification date) and time (duration). It is assumed the situation of observing aggregated data in the form of occurrences and exposures. The missing-survival link problem means that the duration is not directly observed. The estimator follows from an iterative algorithm where, at each step, full information including duration is estimated first and then, the local linear estimator is computed evaluating the function <code>hazard2D</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rate2Dmiss(t.grid, z.grid, Oi.z, Ei.z1, bs.grid,
    cv=TRUE, epsilon=1e-4, max.ite=50)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>t.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the time dimension.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z.grid</code></td>
<td>

<p>a vector of <code>M</code> grid points for the marker dimension.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Oi.z</code></td>
<td>

<p>a vector of length <code>M</code> with the number of people tested positive (infection rate) or with the number of hospitalizations (hospitalization rate) notified  ech day in <code>z.grid</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ei.z1</code></td>
<td>

<p>a vector of length <code>M</code> with the number of people tested positive   notified  each day in <code>z.grid</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs.grid</code></td>
<td>

<p>a matrix with a grid of 2-dimensional bandwidths (by rows).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cv</code></td>
<td>

<p>logical, if <code>cv=TRUE</code> (default) bandwidth is estimated by cross-validation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
  
<p>a numeric value with the tolerance in the iterative algorithm. Default value is <code>epsilon=1e-4</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.ite</code></td>
<td>
  
<p>an integer value with the maximum number of iterations in the iterative algorithm. Default value is <code>max.ite=50</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>Hazard is assumed having two dimensions: a one-dimensional marker (typically the notification date) and time (duration). It is assumed the situation of observing aggregated data in the form of occurrences and exposure, as  the function <code>hazard2D</code> does. The difference is that the time dimension (duration) is not directly observed. The estimator follows from an iterative algorithm where, at each step, full information, estimating the duration, is constructed first and then the local linear estimator is computed evaluating the function <code>hazard2D</code>. See more details on the local linear hazard estimator in the documentation of <code>hazard2D</code>.
</p>
<p>To estimate the infection rate we assume that each day (z), we have information on the number of people tested positive. The vector of occurrences (<code>Oi.z</code>)  is the observed number of people tested positive each day, removing the first <code>d</code> days. Here <code>d</code> is typically 1 (an infected person might infect one day after being tested positive), see the examples below. The vector of exposure (<code>Ei.z</code>) is the observed number of people tested positive each day, removing the last <code>d</code> days.
</p>
<p>To estimate the hospitalization rate we assume that each day (z), we have information on  the number of new hospitalizations (<code>Oi.z</code>), and the number of people tested positive (<code>Ei.z</code>)  each day.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>hi.zt</code></td>
<td>
<p>a (<code>M</code> times <code>M</code>) matrix with the estimated rate evaluated at the grid points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bcv</code></td>
<td>
<p>a two-dimensional vector with the bandwidth used to compute the estimator (estimated by cross-validation if <code>cv=TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>a numeric value with the achieved tolerance value in the algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>it</code></td>
<td>
<p>an integer with the number of iterations performed in the algorithm.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>M.L. Gámiz, E. Mammen, M.D. Martínez-Miranda and J.P. Nielsen.
</p>


<h3>References</h3>

<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024a). Low quality exposure and point processes with a view to the first phase of a pandemic. arXiv:2308.09918.
</p>
<p>Gámiz, M.L., Mammen, E., Martínez-Miranda, M.D. and Nielsen, J.P. (2024b). Monitoring a developing pandemic with available data. arXiv:2308.09919.
</p>


<h3>See Also</h3>

<p><code>hazard2D</code>, <code>forecasting</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Analysis of the infection and hospitalization processes
## data are (cumulative) number of hospitalizations and positive tested

data('covid')
## We remove the first 56 rows (no data on testing until 13th May)
covid2&lt;-covid[-c(1:56),]
M2&lt;-nrow(covid2)

## 1. Rate of infection
Ei.new&lt;-covid2$Posit
delay&lt;-1;M2&lt;-M2-delay
Oi.z&lt;-Ei.new[-(1:delay)]; Ei.z1&lt;-Ei.new[1:M2]
t.grid&lt;-z.grid&lt;-1:M2
bs&lt;-t(c(5,10))
RInf&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,bs.grid=bs,cv=FALSE,
       epsilon=1e-4,max.ite=50)
hi.zt&lt;-RInf$hi.zt # the estimated infection rate

## Plot the estimated infection rate at few notification days
ddates&lt;-covid2$Date
z1&lt;-c(19,49,80,141)
nz&lt;-length(z1)
zdates&lt;-ddates[z1]
t.min&lt;-min(M2-z1+1)
ti&lt;-1:t.min;n0&lt;-length(ti)

## displaced curves
alphas.I&lt;-matrix(NA,M2,M2) # upper-triangular matrix
for(j in 1:M2) alphas.I[j,j:M2]&lt;-hi.zt[j,1:(M2-j+1)]
alphas&lt;-alphas.I[z1,-(1:18)]
M2a&lt;-ncol(alphas)
yy&lt;-c(0,max(alphas,na.rm=TRUE)+0.1)

plot(1:M2a,alphas[nz,],type='l',ylab='',xlab='Date of notification',
      main= 'Dynamic rate of infection',ylim=yy,lwd=2,lty=1,xaxt='n')
axis(1,at=z1-18,labels=c(zdates))
for (i in 2:nz) lines(1:M2a,alphas[i-1,],lwd=3,col=i,lty=i)
legend('topleft',c('Starting on date:',as.character(zdates)),
     lty=c(NA,2:nz,1),lwd=c(NA,rep(3,nz-1),2),col=c(NA,2:nz,1),bty='n')

## 2. Rate of hospitalization
Hi&lt;-covid2$Hospi ; Hi&lt;-Hi[-1]
Ri&lt;-covid2$Recov ; Ri&lt;-diff(Ri)
Di&lt;-covid2$Death ; Di&lt;-diff(Di)
M2&lt;-length(Di)
## New hospitalizations are Hi-Ri-Di
newHi&lt;-Hi[-1]-(Hi[-M2]-Ri[-M2]-Di[-M2])
newHi&lt;-c(Hi[1],newHi)
newHi[newHi&lt;0]&lt;-0; # possible inconsistency in the data
Oi.z&lt;-as.integer(newHi)
Ei.z1&lt;-covid2$Posit
t.grid&lt;-z.grid&lt;-1:M2
bs&lt;-t(c(20,10))
RHosp&lt;-rate2Dmiss(t.grid,z.grid,Oi.z,Ei.z1,bs.grid=bs,cv=FALSE,
     epsilon=1e-4,max.ite=50)
hi.zt&lt;-RHosp$hi.zt # the estimated rate

## Plot the estimated rate at few notification days
z1&lt;-c(19,49,80,141)
nz&lt;-length(z1)
zdates&lt;-ddates[z1]
t.min&lt;-min(M2-z1+1)
ti&lt;-1:t.min;n0&lt;-length(ti)
## displaced curves
alphas.I&lt;-matrix(NA,M2,M2) # upper-triangular matrix
for(j in 1:M2) alphas.I[j,j:M2]&lt;-hi.zt[j,1:(M2-j+1)]
alphas&lt;-alphas.I[z1,-(1:18)]
M2a&lt;-ncol(alphas)
yy&lt;-c(0,max(alphas,na.rm=TRUE)+0.01)
plot(1:M2a,alphas[nz,],type='l',ylab='',xlab='Date of notification',
     main= 'Dynamic rate of hospitalization',ylim=yy,lwd=2,xaxt='n')
axis(1,at=z1-18,labels=c(zdates))
for (i in 2:nz) lines(1:M2a,alphas[i-1,],lwd=3,col=i,lty=i)
legend('topright',c('Starting on date:',as.character(zdates)),
    lty=c(NA,2:nz,1),lwd=c(NA,rep(3,nz-1),2),col=c(NA,2:nz,1),bty='n')
</code></pre>


</div>