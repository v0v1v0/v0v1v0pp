<div class="container">

<table style="width: 100%;"><tr>
<td>psex</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Probability of encountering a genotype more than once by chance</h2>

<h3>Description</h3>

<p>Probability of encountering a genotype more than once by chance
</p>


<h3>Usage</h3>

<pre><code class="language-R">psex(
  gid,
  pop = NULL,
  by_pop = TRUE,
  freq = NULL,
  G = NULL,
  method = c("single", "multiple"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>gid</code></td>
<td>
<p>a genind or genclone object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>either a formula to set the population factor from the 
<code>strata</code> slot or a vector specifying the population factor for 
each sample. Defaults to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_pop</code></td>
<td>
<p>When this is <code>TRUE</code> (default), the calculation will be
done by population.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>a vector or matrix of allele frequencies. This defaults to 
<code>NULL</code>, indicating that the frequencies will be determined via 
round-robin approach in <code>rraf</code>. <strong>If this matrix or 
vector is not provided, zero-value allele frequencies will automatically be
corrected.</strong> For details, please see the documentation on
correcting rare alleles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>an integer vector specifying the number of observed genets. If NULL,
this will be the number of original multilocus genotypes for 
<code>method = "single"</code> and the number of populations for 
<code>method = "multiple"</code>. <code>G</code> can also be a <strong>named</strong> integer 
vector for each population if <code>by_pop = TRUE</code>. Unnamed vectors with
a lengths greater than 1 will throw an error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>which method of calculating psex should be used? Using 
<code>method = "single"</code> (default) indicates that the calculation for psex 
should reflect the probability of encountering a second genotype. Using 
<code>method = "multiple"</code> gives the probability of encountering multiple 
samples of the same genotype (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>options from correcting rare
alleles. The default is to correct allele frequencies to 1/n</p>
</td>
</tr>
</table>
<h3>Details</h3>



<h4>single encounter:</h4>

<p>Psex is the probability of encountering a given genotype more than 
once by chance. The basic equation from Parks and Werth (1993) is
</p>
<p style="text-align: center;"><code class="reqn">p_{sex} = 1 - (1 - p_{gen})^{G})</code>
</p>

<p>where <em>G</em> is the number of multilocus genotypes and <em>pgen</em> is the
probability of a given genotype (see
<code>pgen</code> for its calculation). For a given value of alpha (e.g.
alpha = 0.05), genotypes with psex &lt; alpha can be thought of as a single
genet whereas genotypes with psex &gt; alpha do not have strong evidence that
members belong to the same genet (Parks and Werth, 1993).
</p>



<h4>multiple encounters:</h4>

<p>When <code>method = "multiple"</code>, the method from Arnaud-Haond et al. (1997)
is used where the sum of the binomial density is taken.
</p>
<p style="text-align: center;"><code class="reqn">
  p_{sex} = \sum_{i = n}^N {N \choose i} \left(p_{gen}\right)^i\left(1 - p_{gen}\right)^{N - i}
  </code>
</p>

<p>where <em>N</em> is the number of sampling units <em>i</em> is the ith - 1 
encounter of a given genotype, and <em>pgen</em> is the value of pgen for 
that genotype. This procedure is performed for all samples in the data.
For example, if you have a genotype whose pgen value was 0.0001, with 5 
observations out of 100 samples, the value of psex is computed like so:
</p>
<pre>
  dbinom(0:4, 100, 0.0001)</pre>



<h4>using by_pop = TRUE and modifying G:</h4>

<p>It is possible to modify <code>G</code> for single or multiple encounters. With
<code>method = "single"</code>, <code>G</code> takes place of the exponent, whereas 
with <code>method = "multiple"</code>, <code>G</code> replaces <code>N</code> (see above). 
If you supply a named vector for <code>G</code> with the population names and
<code>by_pop = TRUE</code>, then the value of <code>G</code> will be different for each
population. 
</p>
<p>For example, in the case of <code>method = "multiple"</code>, let's say you have
two populations that share a genotype between them. The size of population
A and B are 25 and 75, respectively, The values of pgen for that genotype
in population A and B are 0.005 and 0.0001, respectively, and the number of
samples with the genotype in popualtions A and B are 4 and 6, respectively.
In this case psex for this genotype would be calculated for each population
separately if we don't specify <code>G</code>:
</p>
<pre>
  psexA = dbinom(0:3, 25, 0.005)
  psexB = dbinom(0:5, 75, 0.0001)</pre>
<p>If we specify <code>G = 100</code>, then it changes to:
</p>
<pre>
  psexA = dbinom(0:3, 100, 0.005)
  psexB = dbinom(0:5, 100, 0.0001)</pre>
<p>We could also specify G to be the number of genotypes observed in the 
population (let's say A = 10, B = 20)
</p>
<pre>
  psexA = dbinom(0:3, 10, 0.005)
  psexB = dbinom(0:5, 20, 0.0001)</pre>

<p>Unless <code>freq</code> is supplied, the function will automatically calculate
the round-robin allele frequencies with <code>rraf</code> and <em>G</em>
with <code>nmll</code>.
</p>


<h3>Value</h3>

<p>a vector of Psex for each sample.
</p>


<h3>Note</h3>

<p>The values of Psex represent the value for each multilocus genotype. 
Additionally, when the argument <code>pop</code> is not <code>NULL</code>, 
<code>by_pop</code> is automatically <code>TRUE</code>.
</p>


<h3>Author(s)</h3>

<p>Zhian N. Kamvar, Jonah Brooks, Stacy A. Krueger-Hadfield, Erik Sotka
</p>


<h3>References</h3>

<p>Arnaud-Haond, S., Duarte, C. M., Alberto, F., &amp; Serr√£o, E. A. 2007. 
Standardizing methods to address clonality in population studies. 
<em>Molecular Ecology</em>, 16(24), 5115-5139.
</p>
<p>Parks, J. C., &amp; Werth, C. R. 1993. A study of spatial features of clones in a
population of bracken fern, <em>Pteridium aquilinum</em> (Dennstaedtiaceae). 
<em>American Journal of Botany</em>, 537-544.
</p>


<h3>See Also</h3>

<p><code>pgen</code>, <code>rraf</code>, <code>rrmlg</code>,
<code>rare_allele_correction</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(Pram)

# With multiple encounters
Pram_psex &lt;- psex(Pram, by_pop = FALSE, method = "multiple")
plot(Pram_psex, log = "y", col = ifelse(Pram_psex &gt; 0.05, "red", "blue"))
abline(h = 0.05, lty = 2)
title("Probability of multiple encounters")
## Not run: 

# For a single encounter (default)
Pram_psex &lt;- psex(Pram, by_pop = FALSE)
plot(Pram_psex, log = "y", col = ifelse(Pram_psex &gt; 0.05, "red", "blue"))
abline(h = 0.05, lty = 2)
title("Probability of second encounter")

# This can be also done assuming populations structure
Pram_psex &lt;- psex(Pram, by_pop = TRUE, method = "multiple")
plot(Pram_psex, log = "y", col = ifelse(Pram_psex &gt; 0.05, "red", "blue"))
abline(h = 0.05, lty = 2)
title("Probability of multiple encounters\nwith pop structure")

# The above, but correcting zero-value alleles by 1/(2*rrmlg) with no 
# population structure assumed
# Type ?rare_allele_correction for details.
Pram_psex2 &lt;- psex(Pram, by_pop = FALSE, d = "rrmlg", mul = 1/2, method = "multiple")
plot(Pram_psex2, log = "y", col = ifelse(Pram_psex2 &gt; 0.05, "red", "blue"))
abline(h = 0.05, lty = 2)
title("Probability of multiple encounters\nwith pop structure (1/(2*rrmlg))")

# We can also set G to the total population size
(G &lt;- nInd(Pram))
Pram_psex &lt;- psex(Pram, by_pop = TRUE, method = "multiple", G = G)
plot(Pram_psex, log = "y", col = ifelse(Pram_psex &gt; 0.05, "red", "blue"))
abline(h = 0.05, lty = 2)
title("Probability of multiple encounters\nwith pop structure G = 729")

# Or we can set G to the number of unique MLGs
(G &lt;- rowSums(mlg.table(Pram, plot = FALSE) &gt; 0))
Pram_psex &lt;- psex(Pram, by_pop = TRUE, method = "multiple", G = G)
plot(Pram_psex, log = "y", col = ifelse(Pram_psex &gt; 0.05, "red", "blue"))
abline(h = 0.05, lty = 2)
title("Probability of multiple encounters\nwith pop structure G = nmll")

## An example of supplying previously calculated frequencies and G
# From Parks and Werth, 1993, using the first three genotypes.

# The row names indicate the number of samples found with that genotype
x &lt;- "
 Hk Lap Mdh2 Pgm1 Pgm2 X6Pgd2
54 12 12 12 23 22 11
36 22 22 11 22 33 11
10 23 22 11 33 13 13"

# Since we aren't representing the whole data set here, we are defining the
# allele frequencies before the analysis.
afreq &lt;- c(Hk.1 = 0.167, Hk.2 = 0.795, Hk.3 = 0.038, 
           Lap.1 = 0.190, Lap.2 = 0.798, Lap.3 = 0.012,
           Mdh2.0 = 0.011, Mdh2.1 = 0.967, Mdh2.2 = 0.022,
           Pgm1.2 = 0.279, Pgm1.3 = 0.529, Pgm1.4 = 0.162, Pgm1.5 = 0.029,
           Pgm2.1 = 0.128, Pgm2.2 = 0.385, Pgm2.3 = 0.487,
           X6Pgd2.1 = 0.526, X6Pgd2.2 = 0.051, X6Pgd2.3 = 0.423)

xtab &lt;- read.table(text = x, header = TRUE, row.names = 1)

# Here we are expanding the number of samples to their observed values.
# Since we have already defined the allele frequencies, this step is actually
# not necessary. 
all_samples &lt;- rep(rownames(xtab), as.integer(rownames(xtab)))
xgid        &lt;- df2genind(xtab[all_samples, ], ncode = 1)

freqs &lt;- afreq[colnames(tab(xgid))] # only used alleles in the sample
pSex  &lt;- psex(xgid, by_pop = FALSE, freq = freqs, G = 45)

# Note, pgen returns log values for each locus, here we take the sum across
# all loci and take the exponent to give us the value of pgen for each sample
pGen &lt;- exp(rowSums(pgen(xgid, by_pop = FALSE, freq = freqs)))

res  &lt;- matrix(c(unique(pGen), unique(pSex)), ncol = 2)
colnames(res) &lt;- c("Pgen", "Psex")
res &lt;- cbind(xtab, nRamet = rownames(xtab), round(res, 5))
rownames(res) &lt;- 1:3
res # Compare to the first three rows of Table 2 in Parks &amp; Werth, 1993

## End(Not run)
</code></pre>


</div>