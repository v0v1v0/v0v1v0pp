<div class="container">

<table style="width: 100%;"><tr>
<td>embedded.blocks</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Embedded blocks regression</h2>

<h3>Description</h3>

<p><code>embedded.blocks</code> performs blockwise regression where the predictions of each blocks' model is used as an
risk factor for the model of the following block.
</p>


<h3>Usage</h3>

<pre><code class="language-R">embedded.blocks(
  method,
  target,
  db,
  coding = "WoE",
  blocks,
  p.value = 0.05,
  miv.threshold = 0.02,
  m.ch.p.val = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Regression method applied on each block.
Available methods: <code>"stepMIV"</code>, <code>"stepFWD"</code>, <code>"stepRPC"</code>, <code>"stepFWDr"</code>, and <code>"stepRPCr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target</code></td>
<td>
<p>Name of target variable within <code>db</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>db</code></td>
<td>
<p>Modeling data with risk factors and target variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coding</code></td>
<td>
<p>Type of risk factor coding within the model. Available options are: <code>"WoE"</code> and
<code>"dummy"</code>. If <code>"WoE"</code> is selected, then modalities of the risk factors are replaced
by WoE values, while for <code>"dummy"</code> option dummies (0/1) will be created for <code>n-1</code>
modalities where <code>n</code> is total number of modalities of analyzed risk factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocks</code></td>
<td>
<p>Data frame with defined risk factor groups. It has to contain the following columns: <code>rf</code> and
<code>block</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>Significance level of p-value for the estimated coefficient. For <code>WoE</code> coding this value is
is directly compared to p-value of the estimated coefficient, while for <code>dummy</code> coding
multiple Wald test is employed and its p-value is used for comparison with selected threshold (<code>p.value</code>).
This argument is applicable only for <code>"stepFWD"</code> and <code>"stepRPC"</code> selected methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>miv.threshold</code></td>
<td>
<p>MIV (marginal information value) entrance threshold applicable only for code"stepMIV" method.
Only the risk factors with MIV higher than the threshold are candidate for the new model.
Additional criteria is that MIV value should significantly separate
good from bad cases measured by marginal chi-square test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m.ch.p.val</code></td>
<td>
<p>Significance level of p-value for marginal chi-square test applicable only for code"stepMIV" method.
This test additionally supports MIV value of candidate risk factor for final decision.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The command <code>embedded.blocks</code> returns a list of three objects.<br>
The first object (<code>model</code>) is the list of the models of each block (an object of class inheriting from <code>"glm"</code>).<br>
The second object (<code>steps</code>), is the data frame with risk factors selected from the each block.<br>
The third object (<code>dev.db</code>), returns the list of block's model development databases.<br></p>


<h3>References</h3>

<p>Anderson, R.A. (2021). Credit Intelligence &amp; Modelling, Many Paths through the Forest of Credit Rating and Scoring,
OUP Oxford
</p>


<h3>See Also</h3>

<p><code>staged.blocks</code>, <code>ensemble.blocks</code>, <code>stepMIV</code>, <code>stepFWD</code>,
<code>stepRPC</code>, <code>stepFWDr</code> and <code>stepRPCr</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">suppressMessages(library(PDtoolkit))
data(loans)
#create risk factor priority groups
rf.all &lt;- names(loans)[-1]
set.seed(22)
blocks &lt;- data.frame(rf = rf.all, block = sample(1:3, length(rf.all), rep = TRUE))
blocks &lt;- blocks[order(blocks$block), ]
blocks
#method: stepFWDr
res &lt;- embedded.blocks(method = "stepFWDr", 
		     target = "Creditability",
		     db = loans, 
		     blocks = blocks, 
		     p.value = 0.05)
names(res)
nb &lt;- length(res[["models"]])
res$models[[nb]]

auc.model(predictions = predict(res$models[[nb]], type = "response", 
				    newdata = res$dev.db[[nb]]),
      observed = res$dev.db[[nb]]$Creditability)
</code></pre>


</div>