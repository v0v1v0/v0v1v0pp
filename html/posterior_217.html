<div class="container">

<table style="width: 100%;"><tr>
<td>pareto_smooth</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pareto smoothing</h2>

<h3>Description</h3>

<p>Smooth the tail draws of x by replacing tail draws by order
statistics of a generalized Pareto distribution fit to the
tail(s). For further details see Vehtari et al. (2024).
</p>


<h3>Usage</h3>

<pre><code class="language-R">pareto_smooth(x, ...)

## S3 method for class 'rvar'
pareto_smooth(x, return_k = FALSE, extra_diags = FALSE, ...)

## Default S3 method:
pareto_smooth(
  x,
  tail = c("both", "right", "left"),
  r_eff = NULL,
  ndraws_tail = NULL,
  return_k = FALSE,
  extra_diags = FALSE,
  verbose = TRUE,
  are_log_weights = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>(multiple options) One of:
</p>

<ul>
<li>
<p> A matrix of draws for a single variable (iterations x chains). See
<code>extract_variable_matrix()</code>.
</p>
</li>
<li>
<p> An <code>rvar</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to individual methods (if applicable).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_k</code></td>
<td>
<p>(logical) Should the Pareto khat be included in
output? If <code>TRUE</code>, output will be a list containing smoothed
draws and diagnostics, otherwise it will be a numeric of the
smoothed draws. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra_diags</code></td>
<td>
<p>(logical) Should extra Pareto khat diagnostics
be included in output? If <code>TRUE</code>, <code>min_ss</code>, <code>khat_threshold</code> and
<code>convergence_rate</code> for the estimated k value will be
returned. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tail</code></td>
<td>
<p>(string) The tail to diagnose/smooth:
</p>

<ul>
<li> <p><code>"right"</code>: diagnose/smooth only the right (upper) tail
</p>
</li>
<li> <p><code>"left"</code>: diagnose/smooth only the left (lower) tail
</p>
</li>
<li> <p><code>"both"</code>: diagnose/smooth both tails and return the maximum k-hat value
</p>
</li>
</ul>
<p>The default is <code>"both"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_eff</code></td>
<td>
<p>(numeric) relative effective sample size estimate. If
<code>r_eff</code> is NULL, it will be calculated assuming the draws are
from MCMC. Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndraws_tail</code></td>
<td>
<p>(numeric) number of draws for the tail. If
<code>ndraws_tail</code> is not specified, it will be calculated as
ceiling(3 * sqrt(length(x) / r_eff)) if length(x) &gt; 225 and
length(x) / 5 otherwise (see Appendix H in Vehtari et
al. (2024)).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>(logical) Should diagnostic messages be printed? If
<code>TRUE</code>, messages related to Pareto diagnostics will be
printed. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>are_log_weights</code></td>
<td>
<p>(logical) Are the draws log weights? Default is
<code>FALSE</code>. If <code>TRUE</code> computation will take into account that the
draws are log weights, and only right tail will be smoothed.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Either a vector <code>x</code> of smoothed values or a named list
containing the vector <code>x</code> and a named list <code>diagnostics</code>
containing numeric values:
</p>

<ul>
<li> <p><code>khat</code>: estimated Pareto k shape parameter, and optionally
</p>
</li>
<li> <p><code>min_ss</code>: minimum sample size for reliable Pareto smoothed
estimate
</p>
</li>
<li> <p><code>khat_threshold</code>: sample size specific khat threshold for
reliable Pareto smoothed estimates
</p>
</li>
<li> <p><code>convergence_rate</code>: Relative convergence rate for
Pareto smoothed estimates
</p>
</li>
</ul>
<p>If any of the draws is non-finite, that is, <code>NA</code>, <code>NaN</code>, <code>Inf</code>, or
<code>-Inf</code>, Pareto smoothing will not be performed, and the original
draws will be returned and and diagnostics will be <code>NA</code> (numeric).
</p>


<h3>References</h3>

<p>Aki Vehtari, Daniel Simpson, Andrew Gelman, Yuling Yao and
Jonah Gabry (2024). Pareto Smoothed Importance Sampling.
<em>Journal of Machine Learning Research</em>, 25(72):1-58.
<a href="https://jmlr.org/papers/v25/19-556.html">PDF</a>
</p>


<h3>See Also</h3>

<p><code>pareto_khat</code> for only calculating khat, and
<code>pareto_diags</code> for additional diagnostics.
</p>


<h3>Examples</h3>

<pre><code class="language-R">mu &lt;- extract_variable_matrix(example_draws(), "mu")
pareto_smooth(mu)

d &lt;- as_draws_rvars(example_draws("multi_normal"))
pareto_smooth(d$Sigma)
</code></pre>


</div>