<div class="container">

<table style="width: 100%;"><tr>
<td>feature_abundances</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Feature abundances</h2>

<h3>Description</h3>

<p>Calculate the total abundance of each feature found in the planning units
of a conservation planning problem.
</p>


<h3>Usage</h3>

<pre><code class="language-R">feature_abundances(x, na.rm)

## S3 method for class 'ConservationProblem'
feature_abundances(x, na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p><code>problem()</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p><code>logical</code> should planning units with <code>NA</code> cost
data be excluded from the abundance calculations? The default argument
is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Planning units can have cost data with finite values
(e.g., 0.1, 3, 100) and <code>NA</code> values. This functionality is provided so
that locations which are not available for protected area acquisition can
be included when calculating targets for conservation features
(e.g., when targets are specified using <code>add_relative_targets()</code>).
If the total amount of each feature in all the planning units is
required—including the planning units with <code>NA</code> cost data—then the
the <code>na.rm</code> argument should be set to <code>FALSE</code>. However, if
the planning units with <code>NA</code> cost data should be
excluded—for instance, to calculate the highest feasible targets for
each feature—then the <code>na.rm</code> argument should be set to
<code>TRUE</code>.
</p>


<h3>Value</h3>

<p>A <code>tibble::tibble()</code> object containing the total amount
(<code>"absolute_abundance"</code>) and proportion (<code>"relative_abundance"</code>)
of the distribution of each feature in the planning units. Here, each
row contains data that pertain to a specific feature in a specific
management zone (if multiple zones are present). This object
contains the following columns:
</p>

<dl>
<dt>feature</dt>
<dd>
<p><code>character</code> name of the feature.</p>
</dd>
<dt>zone</dt>
<dd>
<p><code>character</code> name of the zone (not included when the
argument to <code>x</code> contains only one management zone).</p>
</dd>
<dt>absolute_abundance</dt>
<dd>
<p><code>numeric</code> amount of each feature in the
planning units. If the problem contains multiple zones, then this
column shows how well each feature is represented in a each
zone.</p>
</dd>
<dt>relative_abundance</dt>
<dd>
<p><code>numeric</code> proportion of the feature's
distribution in the planning units. If the argument to <code>na.rm</code> is
<code>FALSE</code>, then this column will only contain values equal to one.
Otherwise, if the argument to <code>na.rm</code> is <code>TRUE</code> and planning
units with <code>NA</code> cost data contain non-zero amounts of each feature,
then this column will contain values between zero and one.</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>problem()</code>, <code>eval_feature_representation_summary()</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# load data
sim_pu_raster &lt;- get_sim_pu_raster()
sim_features &lt;- get_sim_features()

# create a simple conservation planning dataset so we can see exactly
# how the feature abundances are calculated
pu &lt;- data.frame(
  id = seq_len(10),
  cost = c(0.2, NA, runif(8)),
  spp1 = runif(10),
  spp2 = c(rpois(9, 4), NA)
)

# create problem
p1 &lt;- problem(pu, c("spp1", "spp2"), cost_column = "cost")

# calculate feature abundances; including planning units with NA costs
a1 &lt;- feature_abundances(p1, na.rm = FALSE) # (default)
print(a1)

# calculate feature abundances; excluding planning units with NA costs
a2 &lt;- feature_abundances(p1, na.rm = TRUE)
print(a2)

# verify correctness of feature abundance calculations
all.equal(
  a1$absolute_abundance,
  c(sum(pu$spp1), sum(pu$spp2, na.rm = TRUE))
)

all.equal(
  a1$relative_abundance,
  c(sum(pu$spp1) / sum(pu$spp1),
  sum(pu$spp2, na.rm = TRUE) / sum(pu$spp2, na.rm = TRUE))
)

all.equal(
  a2$absolute_abundance,
  c(
    sum(pu$spp1[!is.na(pu$cost)]),
    sum(pu$spp2[!is.na(pu$cost)], na.rm = TRUE)
  )
)

all.equal(
  a2$relative_abundance,
  c(
    sum(pu$spp1[!is.na(pu$cost)]) / sum(pu$spp1, na.rm = TRUE),
    sum(pu$spp2[!is.na(pu$cost)], na.rm = TRUE) /
      sum(pu$spp2, na.rm = TRUE)
  )
)

# initialize conservation problem with raster data
p3 &lt;- problem(sim_pu_raster, sim_features)

# calculate feature abundances; including planning units with NA costs
a3 &lt;- feature_abundances(p3, na.rm = FALSE) # (default)
print(a3)

# create problem using total amounts of features in all the planning units
# (including units with NA cost data)
p4 &lt;-
  p3 %&gt;%
  add_min_set_objective() %&gt;%
  add_relative_targets(a3$relative_abundance) %&gt;%
  add_binary_decisions() %&gt;%
  add_default_solver(verbose = FALSE)

# attempt to solve the problem, but we will see that this problem is
# infeasible because the targets cannot be met using only the planning units
# with finite cost data
s4 &lt;- try(solve(p4))

# calculate feature abundances; excluding planning units with NA costs
a5 &lt;- feature_abundances(p3, na.rm = TRUE)
print(a5)

# create problem using total amounts of features in the planning units with
# finite cost data
p5 &lt;-
  p3 %&gt;%
  add_min_set_objective() %&gt;%
  add_relative_targets(a5$relative_abundance) %&gt;%
  add_binary_decisions() %&gt;%
  add_default_solver(verbose = FALSE)

# solve the problem
s5 &lt;- solve(p5)

# plot the solution
# this solution contains all the planning units with finite cost data
# (i.e., cost data that do not have NA values)
plot(s5)

## End(Not run)
</code></pre>


</div>