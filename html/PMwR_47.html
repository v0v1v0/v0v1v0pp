<div class="container">

<table style="width: 100%;"><tr>
<td>position</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Aggregate Transactions to Positions
</h2>

<h3>Description</h3>

<p>Use information on single trades to compute a
position at a specific point in time.
</p>


<h3>Usage</h3>

<pre><code class="language-R">position(amount, ...)

## Default S3 method:
position(amount, timestamp, instrument, when,
                 drop.zero = FALSE, account = NULL,
                 use.names = NULL, ...)

## S3 method for class 'journal'
position(amount, when, drop.zero = FALSE,
                           use.account = FALSE, ...)

## S3 method for class 'position'
print(x, ..., sep = ":")

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>when</code></td>
<td>

<p>a timestamp or a vector of timestamps;
alternatively, several keywords are supported. See Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>amount</code></td>
<td>

<p>numeric or an object of class <code>journal</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timestamp</code></td>
<td>

<p>numeric or character: timestamps, must be sortable
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>instrument</code></td>
<td>

<p>character: symbols to identify different instruments
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>account</code></td>
<td>

<p>character: description of account. Ignored if <code>NULL</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.account</code></td>
<td>

<p>logical. If TRUE, positions are computed by
account and instrument; otherwise by instrument only.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.names</code></td>
<td>

<p>logical or <code>NULL</code>. The argument handles whether names
of <code>amount</code> are used as instruments. If <code>NULL</code>:
if <code>amount</code> is named and <code>instrument</code> is not
specified, names of <code>amount</code> are interpreted as
instruments. If <code>use.names</code> is <code>FALSE</code>, names of
<code>amount</code> are ignored. (Ignoring names was the default
behaviour prior to PMwR version 0.11.)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop.zero</code></td>
<td>

<p>If logical, drop instruments that have a zero position;
default is <code>FALSE</code>. If numeric, it is used as a
tolerance; e.g., a value of <code>1-e12</code> will drop any
position whose absolute amount is smaller than
<code>1-e12</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>An object of type position.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>arguments passed to <code>print</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>

<p>A regular expression. Split instruments accordingly.
<strong>Not implemented yet.</strong>
</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p><code>position</code> computes positions for lists of trades.
<code>position</code> is a generic function; most useful is the
method for <code>journal</code>s.
</p>
<p>The function checks if <code>timestamp</code> is sorted (see
<code>is.unsorted</code>) and sorts the journal by
<code>timestamp</code>, if required. If there are (some) <code>NA</code>
values in <code>timestamp</code>, but <code>timestamp</code> is sorted
otherwise, the function will proceed (with a warning,
though).
</p>
<p>The argument <code>when</code> can also be specified as one of
several keywords: <code>last</code> (or <code>newest</code> or
<code>latest</code>) provides the position at the latest
timestamp; <code>first</code> (or <code>oldest</code>) provides the
position at the earliest timestamp; <code>all</code> provides the
positions at all timestamps in the journal. <code>endofday</code>,
<code>endofmonth</code> and <code>endofyear</code> provide positions at
the end of all calendar days, months and years within the
timestamp range of the journal. The latter keywords can only
work if <code>timestamp</code> can be coerced to
<code>Date</code>.
</p>


<h3>Value</h3>


<p>An object of class <code>position</code>, which is a numeric
matrix with <code>instrument</code> and <code>timestamp</code>
attributes. Note that <code>position</code> will never drop the
result's <code>dim</code> attribute: it will always be a matrix of
size <code>length(when)</code> times
<code>length(unique(instrument))</code>, which may not be obvious
from the printed output.  The rows of the matrix correspond
to timestamps; the columns correspond to instruments.
</p>
<p>To extract the numeric position matrix, say
<code>as.matrix(p)</code>.
</p>


<h3>Author(s)</h3>

<p>Enrico Schumann
</p>


<h3>References</h3>

<p>Schumann, E. (2023) <em>Portfolio Management with <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span></em>.
<a href="https://enricoschumann.net/R/packages/PMwR/">https://enricoschumann.net/R/packages/PMwR/</a>;
in particular, see<br><a href="https://enricoschumann.net/R/packages/PMwR/manual/PMwR.html#computing-balances">https://enricoschumann.net/R/packages/PMwR/manual/PMwR.html#computing-balances</a>
</p>


<h3>See Also</h3>

<p><code>journal</code>; internal computations are handled by
<code>cumsum</code> and <code>findInterval</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">position(amount = c(1, 1, -1, 3, -4),
         timestamp = 1:5, when = 4.9)

## using a journal
J &lt;- journal(timestamp = 1:5, amount = c(1, 1, -1, 3, -4))
position(J, when = 4.9)


## 'declaring' a position, using named amounts
amount &lt;- c(1, 1, 1)
instrument &lt;- c("A", "A", "B")
position(amount = amount, instrument = instrument)
## .... or equivalently
amount &lt;- c(A = 2, B = 1)
position(amount)

## ignore names of amount
position(amount, use.names = FALSE)
</code></pre>


</div>