<div class="container">

<table style="width: 100%;"><tr>
<td>simFossilRecordMethods</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Methods for Editing or Converting Output from Simulated Fossil Record Objects</h2>

<h3>Description</h3>

<p>These are a set of functions available for manipulating, translating
and editing the objects of class <code>fossilRecordSimulation</code> output
from function <code>simFossilRecord</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">timeSliceFossilRecord(
  fossilRecord,
  sliceTime,
  shiftRoot4TimeSlice = FALSE,
  modern.samp.prob = 1,
  tolerance = 10^-6
)

fossilRecord2fossilTaxa(fossilRecord)

fossilTaxa2fossilRecord(fossilTaxa)

fossilRecord2fossilRanges(
  fossilRecord,
  merge.cryptic = TRUE,
  ranges.only = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fossilRecord</code></td>
<td>
<p>A list object output by <code>simFossilRecord</code>, often composed
of multiple elements, each of which is data for 'one taxon', with the first
element being a distinctive six-element vector composed of numbers, corresponding
to the six fields in tables output by the deprecated function <code>simFossilTaxa</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sliceTime</code></td>
<td>
<p>The date to slice the <code>simFossilRecord</code> output at, given
in time-units before the modern, on the same scale as the input <code>fossilRecord</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shiftRoot4TimeSlice</code></td>
<td>
<p>Should the dating of events be shifted, so that the
date given for <code>sliceTime</code> is now 0, or should the dates not be shifted,
so that they remain on the same scale as the input? This argument accepts a
logical TRUE or FALSE, but also accepts the string <code>"withExtantOnly"</code>,
which will only 'shift' the time-scale if living taxa are present, as
determined by having ranges that overlap within <code>tolerance</code> of <code>sliceTime</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modern.samp.prob</code></td>
<td>
<p>The probability that a taxon is sampled at the modern time
(or, for <code>timeSliceFossilRecord</code>, the time at which the simulation data is
slice). Must be a number between 0 and 1. If 1, all taxa that survive to the modern
day (to the <code>sliceTime</code>) are sampled, if 0, none are.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p>A small number which sets a range around the <code>sliceTime</code> within
which taxa will be considered extant for the purposes of output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fossilTaxa</code></td>
<td>
<p>A <code>fossilTaxa</code> object, composed of a table
containing information on the true first and last appearance times of taxa,
as well as their ancestor-descendant relationships.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>merge.cryptic</code></td>
<td>
<p>If <code>TRUE</code>, sampling events for cryptic taxon-units (i.e.
those in the same cryptic complex) will be merged into sampling events for a single
taxon-unit (with the name of the first taxon in that cryptic complex).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranges.only</code></td>
<td>
<p>If <code>TRUE</code> (the default), <code>fossilRecord2fossilRanges</code>
will return the dates of the first and last sampled occurrences of each taxon-unit
(i.e. the stratigraphic range of each taxon).
If <code>FALSE</code>, instead a list will be output,
with each element being a vector of dates for all sampling events of each taxon-unit.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These functions exist to manipulate <code>fossilRecordSimulation</code> objects
output from <code>simFossilRecord</code>, particularly so that they can be interfaced
with functions in library <code>paleotree</code> in the same way that output from the
deprecated 'legacy' simulation function <code>simFossilTaxa</code> was used.
</p>
<p><code>timeSliceFossilRecord</code> takes a given <code>fossilRecordSimulation</code> object
and 'slices' the data to remove any events that occur after the given
<code>sliceTime</code> and make it so any taxa still alive as of <code>sliceTime</code>
are now listed as extant.
</p>
<p><code>fossilRecord2fossilTaxa</code> converts a <code>fossilRecordSimulation</code> object
to the flat table format of taxon data as was originally output by deprecated function 
<code>simFossilTaxa</code>, and can be taken as input
by a number of <code>paleotree</code> functions such as
<code>sampleRanges</code>, <code>taxa2phylo</code> and <code>taxa2cladogram</code>. 
</p>
<p><code>fossilTaxa2fossilRecord</code> does the reverse, converting a <code>simFossilTaxa</code>
table into a <code>fossilRecordSimulation</code> list object,
but returns a <code>fossilRecordSimulation</code> object that
considers each species as <em>unsampled</em> (as sampling
information is not contained within a <code>simFossilTaxa</code> table).
</p>
<p><code>fossilRecord2fossilRanges</code> converts a <code>fossilRecordSimulation</code> object
to the flat table format of observed taxon ranges, as is typically output by processing
<code>simFossilRecord</code> simulation output with <code>paleotree</code> function
<code>sampleRanges</code>.
</p>


<h3>Value</h3>

<p>Depends on the function and the arguments given. See Details.
</p>


<h3>Author(s)</h3>

<p>David W. Bapst
</p>


<h3>See Also</h3>

<p><code>simFossilRecord</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
set.seed(44)
record &lt;- simFossilRecord(
    p = 0.1, q = 0.1, r = 0.1, 
    nruns = 1,
    nTotalTaxa = c(20,30),
    nExtant = 0, 
    plot = TRUE
    )

##################################################
# time-slicing simulations at particular dates

# let's try slicing this record at 940 time-units
slicedRecord &lt;- timeSliceFossilRecord(
    fossilRecord = record, 
    sliceTime = 940
    )
# and let's plot it
divCurveFossilRecordSim(slicedRecord)

# now with shiftRoot4TimeSlice = TRUE to shift the root age
slicedRecord &lt;- timeSliceFossilRecord(
    fossilRecord = record, 
    sliceTime = 940,
    shiftRoot4TimeSlice = TRUE
    )
# and let's plot it
divCurveFossilRecordSim(slicedRecord)

# the last two plots look a little different
    # due to how axis limits are treated...
# notice that in both, 'modern' (extant) taxa
    # are sampled with probability = 1
    
########
# let's try it again, make that probability = 0
# now with shiftRoot4TimeSlice = TRUE
    
slicedRecord &lt;- timeSliceFossilRecord(
    fossilRecord = record, 
    sliceTime = 940,
    shiftRoot4TimeSlice = TRUE, 
    modern.samp.prob = 0
    )
    
# and let's plot it
divCurveFossilRecordSim(slicedRecord)

############################

# converting to taxa objects and observed ranges

# convert to taxa data
taxa &lt;- fossilRecord2fossilTaxa(record)
# convert to ranges
ranges &lt;- fossilRecord2fossilRanges(record)

# plot diversity curves with multiDiv
multiDiv(list(taxa,ranges),
    plotMultCurves = TRUE)
# should look a lot like what we got earlier

# get the cladogram we'd obtain for these taxa with taxa2cladogram
cladogram &lt;- taxa2cladogram(taxa,
    plot = TRUE)

# now get the time-scaled phylogenies with taxa2phylo

# first, with tips extending to the true times of extinction
treeExt &lt;- taxa2phylo(taxa,
    plot = TRUE)

# now, with tips extending to the first appearance dates (FADs) of taxa
	# get the FADs from the ranges
FADs &lt;- ranges[,1]
treeFAD &lt;- taxa2phylo(taxa,
    FADs,plot = TRUE)

</code></pre>


</div>