<div class="container">

<table style="width: 100%;"><tr>
<td>obs.cor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Weighted correlation between weighted averaging optima and constrained
ordination species scores.</h2>

<h3>Description</h3>

<p>obs.cor calculates the weighted correlation between the species
weighted average optima and the axis one species scores of an ordination
constrained by the WA reconstruction.
</p>


<h3>Usage</h3>

<pre><code class="language-R">obs.cor(
  spp,
  env,
  fos,
  ord = rda,
  n = 99,
  min.occur = 1,
  autosim,
  permute = FALSE
)

## S3 method for class 'obscor'
plot(
  x,
  xlab,
  ylab,
  f = 5,
  which = 1,
  variable_names = "env",
  abun = "abun.calib",
  p_val = 0.05,
  ...
)

## S3 method for class 'obscor'
identify(x, labels, ...)

## S3 method for class 'obscor'
autoplot(
  object,
  which = 1,
  variable_names = "env",
  abun = "abun.calib",
  p_val = 0.05,
  nbins = 20,
  top = 0.7,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>spp</code></td>
<td>
<p>Data frame of modern training set species data, transformed if
required, for example with <code>sqrt</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>Vector of a single environmental variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fos</code></td>
<td>
<p>Data frame of fossil species data. Species codes and
transformations should match those in spp.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ord</code></td>
<td>
<p>Constrained ordination method to use.
<code>rda</code> is the default,
<code>cca</code> should also work.
<code>capscale</code> won't work without modifications to the code
(or a wrapper).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of random training sets. More is better.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.occur</code></td>
<td>
<p>Minimum number of occurrences of species in the species and
fossil data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autosim</code></td>
<td>
<p>Optional data frame of random values. This is useful if the
training set is spatially autocorrelated and the supplied data frame contains
autocorrelated random variables.
If <code>autosim</code> is missing, and <code>permute</code> is <code>FALSE</code>, the
transfer functions are trained on random variables drawn from a uniform
distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permute</code></td>
<td>
<p>logical value. Generate random environmental variables by
permuting existing variable.
Only possible if there is only one environmental variable and <code>autosim</code>
is missing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An obscor object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>X-axis label if the default is unsatisfactory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>Y-axis label if the default is unsatisfactory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>Scale factor for the abundances, the maximum cex of points for the
which=1 plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>Which type of plot. which = 1 gives a plot of RDA scores against
species optima. which = 2 gives a histogram showing the null distribution of
correlations between RDA scores and species optima, together with the
observed correlation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable_names</code></td>
<td>
<p>Name of environmental variable (only 1 currently) for
the label on the observed correlation with which = 2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abun</code></td>
<td>
<p>Which species weighting required for plots. See details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_val</code></td>
<td>
<p>P value to draw a line vertical line at (with which=2)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments to plot or identify</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>Labels for the points in identify. By default, the species
names from intersection of colnames(spp) and colnames(fos) are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An obscor object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbins</code></td>
<td>
<p>integer giving number of bins for the histogram</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>top</code></td>
<td>
<p>Proportion of the figure below the environmental name labels.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Obs.cor calculates the (weighted) correlation between the species
WA optima in the calibration set and their ordination axis one scores in the
fossil data. Seven different weights for the species are implemented.
</p>

<ul>
<li>
<p>"abun.fos" - weight by the mean abundance in the fossil data.
</p>
</li>
<li>
<p>"abun.calib" - weight by the mean abundance in the calibration data
</p>
</li>
<li>
<p>"abun.joint" - weight by the product of the mean abundance in the
fossil and calibration data
</p>
</li>
<li>
<p>"n2.fos" - weight by the effective number of occurrences
(Hill's N2) of each species in the fossil data
</p>
</li>
<li>
<p>"n2.calib" - weight by the effective number of occurrences
(Hill's N2) of each species in the calibration data
</p>
</li>
<li>
<p>"n2.joint" - weight by the product of n2.calib and n2.fos
</p>
</li>
<li>
<p>"unweighted" - all species receive same weight.
This is unlikely to be the best option but is included for completeness.
</p>
</li>
</ul>
<p>It is unclear which of these weights is likely to be best:
research is in progress.
A square root transformation of the species data is often useful. n = 99
is too small in practice to give a smooth histogram of the null model.
n = 999 is better.
</p>


<h3>Value</h3>

<p>obs.cor returns an obscor object, which is a list
</p>

<ul>
<li>
<p>ob Observed correlation. Data.frame with columns Optima, RDA1 and
abun containing the species optima, ordination axis 1 scores, and
abundance used to weight the species respectively and a vector containing
the weighted and unweighted correlations between species optima and
ordination scores.
</p>
</li>
<li>
<p>sim Matrix with the correlation between species weighted average
optima and ordination scores in the first column and the weighted
correlation in the second column. Each row represents a different random
environmental variable.
</p>
</li>
<li>
<p>sigs p-value for the observed correlation between species weighted
average optima and ordination scores for each of the weights.
</p>
</li>
</ul>
<h3>Functions</h3>


<ul>
<li> <p><code>plot(obscor)</code>: Plots for obscor object
</p>
</li>
<li> <p><code>identify(obscor)</code>: Identify species on obs.cor plot
</p>
</li>
<li> <p><code>autoplot(obscor)</code>: autoplot for obscor object
</p>
</li>
</ul>
<h3>Note</h3>

<p>The test of the weighted correlation between species optima and
ordination axis scores is more powerful, especially with a small number of
fossil observations, that the test of variance explained in
<code>randomTF</code> but is only applicable to WA and will have a large
type II error if there are few species.
</p>


<h3>Author(s)</h3>

<p>Richard Telford <a href="mailto:richard.telford@uib.no">richard.telford@uib.no</a>
</p>


<h3>References</h3>

<p>Telford, R. J. and Birks, H. J. B. (2011) A novel method for
assessing the statistical significance of quantitative reconstructions
inferred from biotic assemblages. <em>Quaternary Science Reviews</em>
<b>30</b>: 1272â€“1278.
<a href="https://doi.org/10.1016/j.quascirev.2011.03.002">doi:10.1016/j.quascirev.2011.03.002</a>
</p>


<h3>See Also</h3>

<p><code>randomTF</code>, <code>WA</code>,
<code>rda</code>, <code>cca</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(rioja)
data(SWAP)
data(RLGH)
rlgh.obs &lt;- obs.cor(
  spp = sqrt(SWAP$spec),
  env = SWAP$pH,
  fos = sqrt(RLGH$spec),
  n = 49 # low number for speed
)
rlgh.obs$sig
plot(rlgh.obs, which = 1)
plot(rlgh.obs, which = 2)

require(ggplot2)
autoplot(rlgh.obs, which = 1)
autoplot(rlgh.obs, which = 2, variable_names = "pH")
</code></pre>


</div>