<div class="container">

<table style="width: 100%;"><tr>
<td>mpp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Marked Point Process Object</h2>

<h3>Description</h3>

<p>Creates a marked point process model object with class <code>"mpp"</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mpp(data, gif, marks, params, gmap, mmap, TT)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a <code>data.frame</code> containing the history of the process, denoted below as <code class="reqn"> {\cal H}_t</code>. It should contain all variables that are required to evaluate the <code>gif</code> function and the mark distribution, though can contain others too. No history is represented as <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gif</code></td>
<td>
<p>ground intensity function. See topic <code>gif</code> for further details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marks</code></td>
<td>
<p>a <code>list</code> containing the mark distribution. The first component (i.e. <code>marks[[1]]</code>) is the mark density and the second (i.e. <code>marks[[2]]</code>) is the random number generator. If either of these functions are not required, the particular component can be set to <code>NULL</code>. See topic <code>marks</code> for further details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params</code></td>
<td>
<p>numeric vector of <em>all</em> model parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gmap</code></td>
<td>
<p><code>expression</code>, maps the model parameters (<code>params</code>) into the parameter sub-space of the ground intensity function; see “Details” below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mmap</code></td>
<td>
<p><code>expression</code>, maps the model parameters (<code>params</code>) into the parameter sub-space of the mark distribution; see “Details” below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TT</code></td>
<td>
<p>vector of length 2, being the time interval over which the integral of the ground intensity function is to be evaluated.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">\lambda_g(t|{\cal H}_t)</code> denote the ground intensity function and <code class="reqn">f(y|{\cal H}_t)</code> denote the joint mark densities, where <code class="reqn">y \in {\cal Y}</code>. The log-likelihood of a marked point process is given by
</p>
<p style="text-align: center;"><code class="reqn">
\log L = \sum_i \log \lambda_g(t_i|{\cal H}_{t_i}) + \sum_i \log f(y_i|{\cal H}_{t_i}) - \int \lambda_g(t|{\cal H}_t) dt,
</code>
</p>

<p>where the summation is taken over those events contained in the interval <code>(TT[1], TT[2])</code>, and the integral is also taken over that interval. However, all events in the data frame <code>data</code> before <code class="reqn">t</code>, even those before <code>TT[1]</code>, form the history of the process <code class="reqn"> {\cal H}_t</code>. This allows an initial period for the process to reach a “steady state” or “equilibrium”.
</p>
<p>The parameter spaces of the ground intensity function and mark distribution are not necessarily disjoint, and can have common parameters. Hence, when the model parameters are estimated, these relationships must be known, and are specified by the arguments <code>gmap</code> and <code>mmap</code>. The mapping expressions can also contain arithmetic expressions. The <code class="reqn">i</code>th element in the <code>params</code> argument is addressed in the expressions as <code>params[i]</code>. Here is an example of a five parameter model, where the <code>gif</code> has 4 parameters, and the mark distribution has 2, with mappings specified as:
</p>
<pre>
    gmap = expression(c(params[1:3], exp(params[4]+params[5])))

    mmap = expression(c(log(params[2]/3), params[5]))
</pre>
<p>Note the inclusion of the combine (<code>c</code>) function, because the <code>expression</code> must create a vector of parameters. Care must be taken specifying these expressions as they are embedded directly into the code of various functions.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(Tangshan)

#   increment magnitudes a fraction so none are zero
Tangshan[,"magnitude"] &lt;- Tangshan[,"magnitude"] + 0.01

dmagn_mark &lt;- function(x, data, params){
    #  Gamma distribution
    #  exponential density when params[7]=0
    #   See topic "marks" for further discussion
    lambda &lt;- etas_gif(data, x[,"time"], params=params[1:5])
    y &lt;- dgamma(x[,"magnitude"], shape=1+sqrt(lambda)*params[7],
                rate=params[6], log=TRUE)
    return(y)
}

TT &lt;- c(0, 4018)
# params &lt;- c(0.0067, 1.1025, 1.0794, 0.0169, 0.9506, 1.9159, 0.4704)
params &lt;- c(0.007, 1.1, 1.08, 0.02, 0.95, 1.92, 0.47)

x &lt;- mpp(data=Tangshan,
         gif=etas_gif,
         marks=list(dmagn_mark, NULL),
         params=params,
         gmap=expression(params[1:5]),
         mmap=expression(params[1:7]),
         TT=TT)

allmap &lt;- function(y, p){
    #    one to one mapping, all p positive
    y$params &lt;- exp(p)
    return(y)
}

#    Parameters must be positive. Transformed so that nlm
#    can use entire real line (no boundary problems, see
#    topic "neglogLik" for further explanation).
#    Argument "iterlim" has been restricted to 2 to avoid
#    excessive time in package checks, set much larger to
#    ensure convergence.
z &lt;- nlm(neglogLik, log(params), object=x, pmap=allmap,
         print.level=2, iterlim=2, typsize=abs(params))

x1 &lt;- allmap(x, z$estimate)

#    print parameter estimates
print(x1$params)

print(logLik(x))
print(logLik(x1))
plot(x1, log=TRUE)
</code></pre>


</div>