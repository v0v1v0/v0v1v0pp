<div class="container">

<table style="width: 100%;"><tr>
<td>PrInDT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>The basic undersampling loop for classification</h2>

<h3>Description</h3>

<p>The function PrInDT uses ctrees (conditional inference trees from the package "party") for optimal modeling of
the relationship between the two-class factor variable 'classname' and all other factor and numerical variables
in the data frame 'datain' by means of 'N' repetitions of undersampling. The optimization citerion is the balanced accuracy 
on the full sample. The trees generated from undersampling can be restricted by not accepting trees 
including split results specified in the character strings of the vector 'ctestv'.<br>
The undersampling percentages are 'percl' for the larger class and 'percs' for the smaller class (default = 1).<br>
The probability threshold 'thres' for the prediction of the smaller class may be specified (default = 0.5).<br>
Undersampling may be stratified in two ways by the feature 'strat'.
</p>


<h3>Usage</h3>

<pre><code class="language-R">PrInDT(datain, classname, ctestv=NA, N, percl, percs=1, conf.level=0.95, thres=0.5,
       stratvers=0, strat=NA, seedl=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>datain</code></td>
<td>
<p>Input data frame with class factor variable 'classname' and the<br>
influential variables, which need to be factors or numericals (transform logicals and character variables to factors)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classname</code></td>
<td>
<p>Name of class variable (character)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctestv</code></td>
<td>
<p>Vector of character strings of forbidden split results;<br>
Example: ctestv &lt;- rbind('variable1 == {value1, value2}','variable2 &lt;= value3'), where
character strings specified in 'value1', 'value2' are not allowed as results of a splitting operation in variable 1 in a tree.<br>
For restrictions of the type 'variable &lt;= xxx', all split results in a tree are excluded with 'variable &lt;= yyy' and yyy &lt;= xxx.<br>
Trees with split results specified in 'ctestv' are not accepted during optimization.<br>
A concrete example is: 'ctestv &lt;- rbind('ETH == {C2a, C1a}','AGE &lt;= 20')' for variables 'ETH' and 'AGE' and values 'C2a','C1a', and '20';<br>
If no restrictions exist, the default = NA is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>Number (&gt; 2) of repetitions (integer)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percl</code></td>
<td>
<p>Undersampling percentage of larger class (numerical, &gt; 0 and &lt;= 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percs</code></td>
<td>
<p>Undersampling percentage of smaller class (numerical, &gt; 0 and &lt;= 1);<br>
default = 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>(1 - significance level) in function <code>ctree</code> (numerical, &gt; 0 and &lt;= 1);<br>
default = 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thres</code></td>
<td>
<p>Probability threshold for prediction of smaller class (numerical, &gt;= 0 and &lt; 1); default = 0.5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratvers</code></td>
<td>
<p>Version of stratification;<br>
= 0: none (default),<br>
= 1: stratification according to the percentages of the values of the factor variable 'strat',<br>
&gt; 1: stratification with minimum number "stratvers" of observations per value of "strat"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strat</code></td>
<td>
<p>Name of one (!) stratification variable for undersampling (character);<br>
default = NA (no stratification)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seedl</code></td>
<td>
<p>Should the seed for random numbers be set (TRUE / FALSE)?<br>
default = TRUE</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For the optimzation of the trees, we employ a method we call Sumping (Subsampling umbrella of 
model parameters), a variant of Bumping (Bootstrap umbrella of model parameters) (Tibshirani 
&amp; Knight, 1999) which use subsampling instead of bootstrapping. The aim of the 
optimization is to identify conditional inference trees with maximum predictive power
on the full sample under interpretability restrictions.
</p>
<p><strong>References</strong> <br>
– Tibshirani, R., Knight, K. 1999. Model Search and Inference By Bootstrap "bumping".
Journal of Computational and Graphical Statistics, Vol. 8, No. 4 (Dec., 1999), pp. 671-686 <br>
– Weihs, C., Buschfeld, S. 2021a. Combining Prediction and Interpretation in  Decision Trees (PrInDT) - 
a Linguistic Example. arXiv:2103.02336
</p>
<p>Standard output can be produced by means of <code>print(name)</code> or just <code> name </code> as well as <code>plot(name)</code> where 'name' is the output data 
frame of the function.<br>
The plot function will produce a series of more than one plot. If you use R, you might want to specify <code>windows(record=TRUE)</code> before 
<code>plot(name)</code> to save the whole series of plots. In R-Studio this functionality is provided automatically.
</p>


<h3>Value</h3>


<dl>
<dt>tree1st</dt>
<dd>
<p>best tree on full sample</p>
</dd>
<dt>tree2nd</dt>
<dd>
<p>2nd-best tree on full sample</p>
</dd>
<dt>tree3rd</dt>
<dd>
<p>3rd-best tree on full sample</p>
</dd>
<dt>treet1st</dt>
<dd>
<p>best tree on test sample</p>
</dd>
<dt>treet2nd</dt>
<dd>
<p>2nd-best tree on test sample</p>
</dd>
<dt>treet3rd</dt>
<dd>
<p>3rd-best tree on test sample</p>
</dd>
<dt>ba1st</dt>
<dd>
<p>accuracies: largeClass, smallClass, balanced of 'tree1st', both for full and test sample</p>
</dd>
<dt>ba2nd</dt>
<dd>
<p>accuracies: largeClass, smallClass, balanced of 'tree2nd', both for full and test sample</p>
</dd>
<dt>ba3rd</dt>
<dd>
<p>accuracies: largeClass, smallClass, balanced of 'tree3rd', both for full and test sample</p>
</dd>
<dt>baen</dt>
<dd>
<p>accuracies: largeClass, smallClass, balanced of ensemble of all interpretable, 3 best acceptable, and all acceptable trees on full sample</p>
</dd>
<dt>bafull</dt>
<dd>
<p>vector of balanced accuracies of all trees from undersampling</p>
</dd>
<dt>batest</dt>
<dd>
<p>vector of test accuracies of all trees from undersampling</p>
</dd>
<dt>dataout</dt>
<dd>
<p>transformed data set 'datain' for further analyses</p>
</dd>
<dt>treeAll</dt>
<dd>
<p>tree based on all observations</p>
</dd>
<dt>baAll</dt>
<dd>
<p>balanced accuracy of 'treeAll'</p>
</dd>
<dt>interpAll</dt>
<dd>
<p>criterion of interpretability of 'treeall' (TRUE / FALSE)</p>
</dd>
<dt>confAll</dt>
<dd>
<p>confusion matrix of 'treeAll'</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R">datastrat &lt;- PrInDT::data_zero
data &lt;- na.omit(datastrat) # cleaned full data: no NAs
# interpretation restrictions (split exclusions)
ctestv &lt;- rbind('ETH == {C2a, C1a}','MLU == {1, 3}') # split exclusions
N &lt;- 41  # no. of repetitions
conf.level &lt;- 0.99 # 1 - significance level (mincriterion) in ctree
percl &lt;- 0.08  # undersampling percentage of the larger class
percs &lt;- 0.95 # undersampling percentage of the smaller class
# calls of PrInDT
out &lt;- PrInDT(data,"real",ctestv,N,percl,percs,conf.level) # unstratified
out # print best model and ensembles as well as all observations
plot(out)
out &lt;- PrInDT(data,"real",ctestv,N,percl,percs,conf.level,stratvers=1,
              strat="SEX") # percentage stratification
out &lt;- PrInDT(data,"real",ctestv,N,percl,percs,conf.level,stratvers=50,
              strat="SEX") # stratification with minimum no. of tokens
out &lt;- PrInDT(data,"real",ctestv,N,percl,percs,conf.level,thres=0.4) # threshold = 0.4

</code></pre>


</div>