<div class="container">

<table style="width: 100%;"><tr>
<td>as.pml</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Likelihood of a tree.</h2>

<h3>Description</h3>

<p><code>pml</code> computes the likelihood of a phylogenetic tree given a sequence
alignment and a model. <code>optim.pml</code> optimizes the different model
parameters. For a more user-friendly interface see <code>pml_bb</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">as.pml(x, ...)

pml(tree, data, bf = NULL, Q = NULL, inv = 0, k = 1, shape = 1,
  rate = 1, model = NULL, site.rate = "gamma", ASC = FALSE, ...)

optim.pml(object, optNni = FALSE, optBf = FALSE, optQ = FALSE,
  optInv = FALSE, optGamma = FALSE, optEdge = TRUE, optRate = FALSE,
  optRooted = FALSE, control = pml.control(), model = NULL,
  rearrangement = ifelse(optNni, "NNI", "none"), subs = NULL,
  ratchet.par = ratchet.control(), ...)

## S3 method for class 'pml'
logLik(object, ...)

## S3 method for class 'pml'
anova(object, ...)

## S3 method for class 'pml'
vcov(object, ...)

## S3 method for class 'pml'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>So far only an object of class <code>modelTest</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to or from other methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p>A phylogenetic <code>tree</code>, object of class <code>phylo</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An alignment, object of class <code>phyDat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bf</code></td>
<td>
<p>Base frequencies (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>A vector containing the lower triangular part of the rate matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inv</code></td>
<td>
<p>Proportion of invariable sites.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Number of intervals of the discrete gamma distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>Shape parameter of the gamma distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate</code></td>
<td>
<p>Rate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>allows to choose an amino acid models or nucleotide model, see
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site.rate</code></td>
<td>
<p>Indicates what type of gamma distribution to use. Options
are "gamma" approach of Yang 1994 (default), ""gamma_quadrature"" after the
Laguerre quadrature approach of Felsenstein 2001 or "freerate".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ASC</code></td>
<td>
<p>ascertainment bias correction (ASC), allows to estimate models
like Lewis' Mkv.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class <code>pml</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optNni</code></td>
<td>
<p>Logical value indicating whether topology gets optimized (NNI).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optBf</code></td>
<td>
<p>Logical value indicating whether base frequencies gets
optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optQ</code></td>
<td>
<p>Logical value indicating whether rate matrix gets optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optInv</code></td>
<td>
<p>Logical value indicating whether proportion of variable size
gets optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optGamma</code></td>
<td>
<p>Logical value indicating whether gamma rate parameter gets
optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optEdge</code></td>
<td>
<p>Logical value indicating the edge lengths gets optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optRate</code></td>
<td>
<p>Logical value indicating the overall rate gets optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optRooted</code></td>
<td>
<p>Logical value indicating if the edge lengths of a rooted
tree get optimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A list of parameters for controlling the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rearrangement</code></td>
<td>
<p>type of tree tree rearrangements to perform, one of
"none", "NNI", "stochastic" or "ratchet"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subs</code></td>
<td>
<p>A (integer) vector same length as Q to specify the optimization
of Q</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratchet.par</code></td>
<td>
<p>search parameter for stochastic search</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Base frequencies in <code>pml</code> can be supplied in different ways.
For amino acid they are usually defined through specifying a model, so the
argument bf does not need to be specified. Otherwise if <code>bf=NULL</code>,
each state is given equal probability. It can be a numeric vector given the
frequencies. Last but not least <code>bf</code> can be string "equal", "empirical"
and for codon models additionally "F3x4".
</p>
<p>The topology search uses a nearest neighbor interchange (NNI) and the
implementation is similar to phyML.  The option model in pml is only used
for amino acid models.  The option model defines the nucleotide model which
is getting optimized, all models which are included in modeltest can be
chosen. Setting this option (e.g. "K81" or "GTR") overrules options optBf
and optQ.  Here is a overview how to estimate different phylogenetic models
with <code>pml</code>: </p>

<table>
<tr>
<td style="text-align: left;"> model </td>
<td style="text-align: left;"> optBf </td>
<td style="text-align: left;"> optQ </td>
</tr>
<tr>
<td style="text-align: left;"> Jukes-Cantor
</td>
<td style="text-align: left;"> FALSE </td>
<td style="text-align: left;"> FALSE </td>
</tr>
<tr>
<td style="text-align: left;"> F81 </td>
<td style="text-align: left;"> TRUE </td>
<td style="text-align: left;"> FALSE </td>
</tr>
<tr>
<td style="text-align: left;"> symmetric </td>
<td style="text-align: left;"> FALSE
</td>
<td style="text-align: left;"> TRUE </td>
</tr>
<tr>
<td style="text-align: left;"> GTR </td>
<td style="text-align: left;"> TRUE </td>
<td style="text-align: left;"> TRUE </td>
</tr>
</table>
<p> Via model in optim.pml the following
nucleotide models can be specified: JC, F81, K80, HKY, TrNe, TrN, TPM1, K81,
TPM1u, TPM2, TPM2u, TPM3, TPM3u, TIM1e, TIM1, TIM2e, TIM2, TIM3e, TIM3,
TVMe, TVM, SYM and GTR.  These models are specified as in Posada (2008).
</p>
<p>So far 17 amino acid models are supported ("WAG", "JTT", "LG", "Dayhoff",
"cpREV", "mtmam", "mtArt", "MtZoa", "mtREV24", "VT","RtREV", "HIVw", "HIVb",
"FLU", "Blosum62", "Dayhoff_DCMut" and "JTT_DCMut") and additionally rate
matrices and amino acid frequencies can be supplied.
</p>
<p>It is also possible to estimate codon models (e.g. YN98), for details see
also the chapter in vignette("phangorn-specials").
</p>
<p>If the option 'optRooted' is set to TRUE than the edge lengths of rooted
tree are optimized. The tree has to be rooted and by now ultrametric!
Optimising rooted trees is generally much slower.
</p>
<p>If <code>rearrangement</code> is set to <code>stochastic</code> a stochastic search
algorithm similar to Nguyen et al. (2015). and for <code>ratchet</code> the
likelihood ratchet as in Vos (2003).  This should helps often to find better
tree topologies, especially for larger trees.
</p>


<h3>Value</h3>

<p><code>pml</code> or <code>optim.pml</code> return a list of class <code>pml</code>,
some are useful for further computations like </p>
<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p>the phylogenetic
tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the alignment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>Log-likelihood of the
tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>siteLik</code></td>
<td>
<p>Site log-likelihoods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>Weight of the
site patterns.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Klaus Schliep <a href="mailto:klaus.schliep@gmail.com">klaus.schliep@gmail.com</a>
</p>


<h3>References</h3>

<p>Felsenstein, J. (1981) Evolutionary trees from DNA sequences: a
maximum likelihood approach. <em>Journal of Molecular Evolution</em>,
<b>17</b>, 368–376.
</p>
<p>Felsenstein, J. (2004). <em>Inferring Phylogenies</em>. Sinauer Associates,
Sunderland.
</p>
<p>Yang, Z. (2006). <em>Computational Molecular evolution</em>. Oxford University
Press, Oxford.
</p>
<p>Adachi, J., P. J. Waddell, W. Martin, and M. Hasegawa (2000) Plastid genome
phylogeny and a model of amino acid substitution for proteins encoded by
chloroplast DNA.  <em>Journal of Molecular Evolution</em>, <b>50</b>, 348–358
</p>
<p>Rota-Stabelli, O., Z. Yang, and M. Telford. (2009) MtZoa: a general
mitochondrial amino acid substitutions model for animal evolutionary
studies. <em>Mol. Phyl. Evol</em>, <b>52(1)</b>, 268–72
</p>
<p>Whelan, S. and Goldman, N. (2001) A general empirical model of protein
evolution derived from multiple protein families using a maximum-likelihood
approach. <em>Molecular Biology and Evolution</em>, <b>18</b>, 691–699
</p>
<p>Le, S.Q. and Gascuel, O. (2008) LG: An Improved, General Amino-Acid
Replacement Matrix <em>Molecular Biology and Evolution</em>, <b>25(7)</b>,
1307–1320
</p>
<p>Yang, Z., R. Nielsen, and M. Hasegawa (1998) Models of amino acid
substitution and applications to Mitochondrial protein evolution.
<em>Molecular Biology and Evolution</em>, <b>15</b>, 1600–1611
</p>
<p>Abascal, F., D. Posada, and R. Zardoya (2007) MtArt: A new Model of amino
acid replacement for Arthropoda. <em>Molecular Biology and Evolution</em>,
<b>24</b>, 1–5
</p>
<p>Kosiol, C, and Goldman, N (2005) Different versions of the Dayhoff rate
matrix - <em>Molecular Biology and Evolution</em>, <b>22</b>, 193–199
</p>
<p>L.-T. Nguyen, H.A. Schmidt, A. von Haeseler, and B.Q. Minh (2015) IQ-TREE: A
fast and effective stochastic algorithm for estimating maximum likelihood
phylogenies. <em>Molecular Biology and Evolution</em>, <b>32</b>, 268–274.
</p>
<p>Vos, R. A. (2003) Accelerated Likelihood Surface Exploration: The Likelihood
Ratchet. <em>Systematic Biology</em>, <b>52(3)</b>, 368–373
</p>
<p>Yang, Z., and R. Nielsen (1998) Synonymous and nonsynonymous rate variation
in nuclear genes of mammals. <em>Journal of Molecular Evolution</em>,
<b>46</b>, 409-418.
</p>
<p>Lewis, P.O. (2001) A likelihood approach to estimating phylogeny from
discrete morphological character data. <em>Systematic Biology</em> <b>50</b>,
913–925.
</p>


<h3>See Also</h3>

<p><code>pml_bb</code>, <code>bootstrap.pml</code>,
<code>modelTest</code>, <code>pmlPart</code>, <code>pmlMix</code>,
<code>plot.phylo</code>, <code>SH.test</code>,
<code>ancestral.pml</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  example(NJ)
# Jukes-Cantor (starting tree from NJ)
  fitJC &lt;- pml(tree, Laurasiatherian)
# optimize edge length parameter
  fitJC &lt;- optim.pml(fitJC)
  fitJC

## Not run: 
# search for a better tree using NNI rearrangements
  fitJC &lt;- optim.pml(fitJC, optNni=TRUE)
  fitJC
  plot(fitJC$tree)

# JC + Gamma + I - model
  fitJC_GI &lt;- update(fitJC, k=4, inv=.2)
# optimize shape parameter + proportion of invariant sites
  fitJC_GI &lt;- optim.pml(fitJC_GI, optGamma=TRUE, optInv=TRUE)
# GTR + Gamma + I - model
  fitGTR &lt;- optim.pml(fitJC_GI, rearrangement = "stochastic",
      optGamma=TRUE, optInv=TRUE, model="GTR")

## End(Not run)


# 2-state data (RY-coded)
  dat &lt;- acgt2ry(Laurasiatherian)
  fit2ST &lt;- pml(tree, dat)
  fit2ST &lt;- optim.pml(fit2ST,optNni=TRUE)
  fit2ST
# show some of the methods available for class pml
  methods(class="pml")

</code></pre>


</div>