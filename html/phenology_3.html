<div class="container">

<table style="width: 100%;"><tr>
<td>add_phenology</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a new dataset or add a timeserie to a previous dataset.</h2>

<h3>Description</h3>

<p>To create a new dataset, the syntaxe is :<br>
data &lt;- add_phenology(add=newdata, name="Site", reference=as.Date('2001-12-31'),
format='\
To add a dataset to a previous one, the syntax is :<br>
data &lt;- add_phenology(previous=previousdata, add=newdata, name='Site', <br>
reference=as.Date('2001-01-01'), format="\
The dataset to be added must include 2 or 3 columns.<br>
The colname.Date included the dates in the format specified by
the parameter format. If the number of nests is known
for an exact date, then only one date must be indicated.<br>
If the number of nests is known for a range of date, the
first and last dates must be separated by a sep.dates character.<br>
For example: 1/2/2000-10/2/2000<br>
Note that date in the colname.Date column can be already formated and in this case
the parameter format is ignored.<br><br>
The colname.Number includes the number of nests observed for
this date or this range of dates.<br>
The colname.Rookery is optional and includes the name of the rookeries.<br><br>
If only two columns are indicated, the name can be indicated as
a parameter of the function with the parameter name. If no name is indicated,
the default name Site will be used, but take care, only one
rookery of this name can be used.<br><br>
Several rookeries can be included in the same file but in this case
the rookery name is obligatory at the colname.Rookery column.<br><br>
The model cannot be fitted if a timeseries has no observation because the trivial
solution is of course with max=0. The solution is to include a fake false observation at the closest
position of the peak, and then the estimated number of nests/tracks will be the estimated number - 1.<br>
If include0 is TRUE, then the series with no observation are included and one observation is added
at the monitored date the closest of datepeakfor0.<br>
The normal way to manage such a situation is as followed:<br>
1- Format data with include0 being FALSE<br>
2- Fit parameters using fdf &lt;- fit_phenology()<br>
3- Format data with include0 being TRUE and datepeakfor0=fdf$par["Peak"]<br>
4- Fix previsouly fitted parameters using pfixed &lt;- fdf$par<br>
5- Generate new set of parameters with par_init(data, fixed.parameters=pfixed)<br>
6- Run again fit_phenology()<br><br>
Some problems that can occur:<br>
If a name is defined as a third column of a data.frame and a name is
defined also with name parameter, the third column has priority.<br>
Two different timeseries MUST have different name and characters _ and
space are forbiden in timeseries names. They are automatically changed if they are present.
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_phenology(
  add = stop("New data must be given."),
  name = "Site",
  reference = NULL,
  month_ref = NULL,
  sep.dates = "-",
  end.season.date = NULL,
  colname.Date = 1,
  colname.Number = 2,
  colname.Rookery = "Site",
  colname.CountTypes = NULL,
  CountTypes.default = "exact",
  colname.A = NULL,
  A.default = NA,
  colname.S = NULL,
  S.default = NA,
  colname.ZeroCounts = NULL,
  ZeroCounts.default = TRUE,
  format = "%d/%m/%Y",
  previous = NULL,
  include0 = FALSE,
  datepeakfor0 = NULL,
  expandRange0Observation = TRUE,
  check.overlapping.dates = TRUE,
  silent = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p>The data to be added. It can be a set of several entities that uses the same reference and date format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>The name of the monitored site.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference</code></td>
<td>
<p>as.Date('2001-12-31') The date used as day 0 in the ordinal date model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>month_ref</code></td>
<td>
<p>If no reference date is given, use this month as a reference.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep.dates</code></td>
<td>
<p>Separator used to separate dates when incertitude is included.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end.season.date</code></td>
<td>
<p>The date corresponding to the end of nesting season.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.Date</code></td>
<td>
<p>Name or number of column with dates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.Number</code></td>
<td>
<p>Name or number of column with numbers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.Rookery</code></td>
<td>
<p>Name or number of column with rookery names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.CountTypes</code></td>
<td>
<p>Model of count type. It can be "exact" (default), "minimum" or a number to indicate the maximum possible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CountTypes.default</code></td>
<td>
<p>The default of CountTypes if colname.CountTypes is not provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.A</code></td>
<td>
<p>The A parameter of the detection model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A.default</code></td>
<td>
<p>Default A value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.S</code></td>
<td>
<p>The S parameter of the detection model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S.default</code></td>
<td>
<p>Default S value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colname.ZeroCounts</code></td>
<td>
<p>The name of the column to indicate whether zero counts are included (TRUE is default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ZeroCounts.default</code></td>
<td>
<p>The default for ZeroCounts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format</code></td>
<td>
<p>The format of the dates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>previous</code></td>
<td>
<p>Previous data formated with add_phenology or NULL [default] if no previous data exist.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include0</code></td>
<td>
<p>Does timeseries with only 0 should be included?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datepeakfor0</code></td>
<td>
<p>If series with no observation are included, where add a 1 value in ordinal date (see description)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expandRange0Observation</code></td>
<td>
<p>If TRUE, the range of date with 0 observations are expanded into individual dates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check.overlapping.dates</code></td>
<td>
<p>If TRUE, will check for date overlapping</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Does information about added timeseries is shown</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>add_phenology creates a new dataset.
</p>


<h3>Value</h3>

<p>Return a list of formated data that can be used ith fit_phenology()
</p>


<h3>Author(s)</h3>

<p>Marc Girondot <a href="mailto:marc.girondot@gmail.com">marc.girondot@gmail.com</a>
</p>


<h3>See Also</h3>

<p>Other Phenology model: 
<code>AutoFitPhenology()</code>,
<code>BE_to_LBLE()</code>,
<code>Gratiot</code>,
<code>LBLE_to_BE()</code>,
<code>LBLE_to_L()</code>,
<code>L_to_LBLE()</code>,
<code>MarineTurtles_2002</code>,
<code>MinBMinE_to_Min()</code>,
<code>adapt_parameters()</code>,
<code>add_SE()</code>,
<code>extract_result()</code>,
<code>fit_phenology()</code>,
<code>likelihood_phenology()</code>,
<code>logLik.phenology()</code>,
<code>map_Gratiot</code>,
<code>map_phenology()</code>,
<code>par_init()</code>,
<code>phenology()</code>,
<code>phenology2fitRMU()</code>,
<code>phenology_MHmcmc()</code>,
<code>phenology_MHmcmc_p()</code>,
<code>plot.phenology()</code>,
<code>plot.phenologymap()</code>,
<code>plot_delta()</code>,
<code>plot_phi()</code>,
<code>print.phenology()</code>,
<code>print.phenologymap()</code>,
<code>print.phenologyout()</code>,
<code>remove_site()</code>,
<code>result_Gratiot</code>,
<code>result_Gratiot1</code>,
<code>result_Gratiot2</code>,
<code>result_Gratiot_Flat</code>,
<code>result_Gratiot_mcmc</code>,
<code>summary.phenology()</code>,
<code>summary.phenologymap()</code>,
<code>summary.phenologyout()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(phenology)
# Read a file with data
data(Gratiot)
# Generate a formatted list nammed data_Gratiot 
refdate &lt;- as.Date("2001-01-01")
data_Gratiot &lt;- add_phenology(Gratiot, name="Complete", 
	reference=refdate, format="%d/%m/%Y")
	
# Generate initial points for the optimisation
parg &lt;- par_init(data_Gratiot, fixed.parameters=NULL)
# Run the optimisation
result_Gratiot &lt;- fit_phenology(data=data_Gratiot, fitted.parameters=parg, 
	fixed.parameters=NULL)
data(result_Gratiot)
# Plot the phenology and get some stats
output &lt;- plot(result_Gratiot)

#############################################
# Example of use of include0 and datepeakfor0
#############################################
# Let create a times series with only 0
data0 &lt;- data.frame(Date=c("11/3/2015", "12/3/2015", "13/3/2015-18/3/2015", "25/3/2015"), 
                    Number=c(0, 0, 0, 0), 
                    Beach=rep("Site", 4), stringsAsFactors=FALSE)
# Here I don't include beach with no observation: error message
try1 &lt;- add_phenology(data0, format="%d/%m/%Y", month_ref=1, include0=FALSE)
# Here I include timeseries with no observation
try1 &lt;- add_phenology(data0, format="%d/%m/%Y", month_ref=1, include0=TRUE, datepeakfor0=100)
try1 &lt;- add_phenology(data0, format="%d/%m/%Y", month_ref=1, include0=TRUE, datepeakfor0=73)
try1 &lt;- add_phenology(data0, format="%d/%m/%Y", month_ref=1, include0=TRUE, datepeakfor0=70)
# It can be done in two steps
try1 &lt;- add_phenology(data0, format="%d/%m/%Y", month_ref=1, include0=TRUE)
try2 &lt;- add_phenology(previous=try1, include0=TRUE, datepeakfor0=100)
# Here I include the series without observation
try1 &lt;- add_phenology(add=data0, format="%d/%m/%Y", month_ref=1, 
                      include0=TRUE, expandRange0Observation=TRUE)
                      
##############################################################################
# Example of A and S parameters to say that only half of a beach was monitored
##############################################################################

refdate &lt;- as.Date("2001-01-01")
data_Gratiot &lt;- add_phenology(Gratiot, name="Complete1", 
                             	reference=refdate, format="%d/%m/%Y")
	      S.default = 10
	      # Let Complete1 be of length 2 and Complete0.5 be of length 1
	      length.Complete1 &lt;- 2
	      length.Complete0.5 &lt;- 1
	      A.default = log(1/(length.Complete0.5/length.Complete1)-1)/(-S.default*4)
	      # For day 0, the detection probability is
	      1/(1+exp(-(4*S.default)*(A.default-0)))
	data_Gratiot &lt;- add_phenology(previous=data_Gratiot, 
	      add=Gratiot, 
	      name="Complete0.5", 
	      A.default = A.default,
	      S.default = S.default, 
	      reference=refdate, 
	      format="%d/%m/%Y")
	parg &lt;- c(par_init(data_Gratiot, fixed.parameters=c(Min=0, Flat=0)), PMin=0.1)
	result_Gratiot &lt;- fit_phenology(data=data_Gratiot, fitted.parameters=parg, 
	                                fixed.parameters=c(Flat=0))
	result_Gratiot$par
	# it shows that Max_Complete1 is half of Max_Complete0.5; all is ok
	summary(result_Gratiot)$synthesis
	

## End(Not run)
</code></pre>


</div>