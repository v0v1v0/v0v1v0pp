<div class="container">

<table style="width: 100%;"><tr>
<td>communityEcology</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Miscellaneous Functions for Community Ecology</h2>

<h3>Description</h3>

<p>This is just a small collection of miscellaneous functions
that may be useful, primarily for community ecology analyses,
particularly for paleoecological data. They are here mainly for
pedagogical reasons (i.e. for students) as they don't appear
to be available in other ecology-focused packages.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pairwiseSpearmanRho(
  x,
  dropAbsent = "bothAbsent",
  asDistance = FALSE,
  diag = NULL,
  upper = NULL,
  na.rm = FALSE
)

HurlbertPIE(x, nAnalyze = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The community abundance matrix. Taxonomic units are assumed to be
the columns and sites (samples) are assumed to be the rows, for both
functions. The abundances can be absolute counts of specimens for particular
taxa in each sample, or it can be proportional (relative) abundances, where
all taxon abundances at a site are divided by the total number of specimens
collected at that site. For function <code>pairwiseSpearmanRho</code>, the input
<code>x</code> should be a matrix with two dimensions. For <code>HurlbertPIE</code>, a
vector (an object with only one dimension) will be treated as if it was
matrix with a single row and number of columns equal to its length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dropAbsent</code></td>
<td>
<p>Should absent taxa be dropped? Must be one of either: 
<code>dropAbsent = 'bothAbsent'</code> (drop taxa absent in both sites for a given pairwise comparison), 
<code>dropAbsent = 'eitherAbsent'</code> (drop taxa absent in either site), or 
<code>dropAbsent = 'noDrop'</code> (drop none of the taxa absent in either site). 
The default <code>dropAbsent = 'bothAbsent'</code> is recommended; see examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asDistance</code></td>
<td>
<p>Should the rho coefficients be rescaled on a scale similar to
dissimilarity metrics, i.e. bounded 0 to 1, with 1 representing maximum dissimilarity (i.e.
a Spearman rho correlation of -1)? (Note that dissimilarity = (1 - rho) / 2 )</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diag</code></td>
<td>
<p>Should the diagonal of the output distance matrix be included?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper</code></td>
<td>
<p>Should the upper triangle of the output distance matrix be included?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Should taxa listed with <code>NA</code> values be dropped from a pair-wise site comparison?
If <code>na.rm = FALSE</code>, the returned value for that site pair will be NA if NAs are present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nAnalyze</code></td>
<td>
<p>Allows users to select that PIE be calculated only on the <code>nAnalyze</code> 
most-abundant taxa in a site sample. <code>nAnalyze</code> must be a vector of <code>length = 1</code>, 
consisting of a whole-number value greater than 1. By default, <code>nAnalyze = Inf</code> so all taxa are
accepted. Note that if there are less taxa in a sample than <code>nAnalyze</code>, the number present will
be used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>pairwiseSpearmanRho</code> returns Spearman rho correlation coefficients
based on the rank abundances of taxa (columns) within sites (rows) from
the input matrix, by internally wrapping the function <code>cor.test</code>.
It allows for various options that automatically allow
for dropping taxa not shared between two sites (the default), as well as
several other options. This allows the rho coefficient to behave like the
Bray-Curtis distance, in that it is not affected by the number of taxa absent
in both sites.
</p>
<p><code>pairwiseSpearmanRho</code> can also rescale the rho coefficients with (1-rho)/2
to provide a measure similar to a dissimilarity metric, bounded between 0 and 1.
This function was written so several arguments would be in a similar format to
the <code>vegan</code> library function <code>vegdist</code>. If used to obtain rho
rescaled as a dissimilarity, the default output will be the lower triangle of
a distance matrix object, just as is returned by default by <code>vegdist</code>.
This behavior can be modified via the arguments for including the diagonal 
and upper triangle of the matrix. Otherwise, a full matrix is returned (by default)
if the <code>asDistance</code> argument is not enabled. 
</p>
<p><code>HurlbertPIE</code> provides the 'Probability of Interspecific Encounter' metric for
relative community abundance data, a commonly used metric for evenness of community
abundance data based on derivations in Hurlbert (1971). An optional argument allows
users to apply Hurlbert's PIE to only a subselection of the most abundant taxa.
</p>


<h3>Value</h3>

<p><code>pairwiseSpearmanRho</code> will return either a full matrix (the default) or (if
<code>asDistance</code> is true, a distance matrix, with only the lower triangle
shown (by default). See details.
</p>
<p><code>HurlbertPIE</code> returns a named vector of PIE values for the input data.
</p>


<h3>Author(s)</h3>

<p>David W. Bapst
</p>


<h3>References</h3>

<p>Hurlbert, S. H. 1971. The <em>nonconcept</em> of species diversity:
a critique and alternative parameters. <em>Ecology</em> 52(4):577-586.
</p>


<h3>See Also</h3>

<p><code>twoWayEcologyCluster</code>; example dataset: <code>kanto</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# let's load some example data:
# a classic dataset collected by Satoshi &amp; Okido from the Kanto region

data(kanto)

rhoBothAbsent &lt;- pairwiseSpearmanRho(kanto,dropAbsent = "bothAbsent")

#other dropping options
rhoEitherAbsent &lt;- pairwiseSpearmanRho(kanto,dropAbsent = "eitherAbsent")
rhoNoDrop &lt;- pairwiseSpearmanRho(kanto,dropAbsent = "noDrop")

#compare
layout(1:3)
lim &lt;- c(-1,1)
plot(rhoBothAbsent, rhoEitherAbsent, xlim = lim, ylim = lim)
	abline(0,1)
plot(rhoBothAbsent, rhoNoDrop, xlim = lim, ylim = lim)
	abline(0,1)
plot(rhoEitherAbsent, rhoNoDrop, xlim = lim, ylim = lim)
	abline(0,1)
layout(1)

#using dropAbsent = "eitherAbsent" reduces the number of taxa so much that
	# the number of taxa present drops too low to be useful
#dropping none of the taxa restricts the rho measures to high coefficients
	# due to the many shared 0s for absent taxa

#############

# Try the rho coefficients as a rescaled dissimilarity
rhoDist &lt;- pairwiseSpearmanRho(kanto,asDistance = TRUE,dropAbsent = "bothAbsent")

# What happens if we use these in typical distance matrix based analyses?

# Cluster analysis
clustRes &lt;- hclust(rhoDist)
plot(clustRes)

# Principle Coordinates Analysis
pcoRes &lt;- pcoa(rhoDist,correction = "lingoes")
scores &lt;- pcoRes$vectors
#plot the PCO
plot(scores,type = "n")
text(labels = rownames(kanto),scores[,1],scores[,2],cex = 0.5)

##################################

# measuring evenness with Hurlbert's PIE

kantoPIE &lt;- HurlbertPIE(kanto)

#histogram
hist(kantoPIE)
#evenness of the kanto data is fairly high

#barplot
parX &lt;- par(mar = c(7,5,3,3))
barplot(kantoPIE,las = 3,cex.names = 0.7,
	ylab = "Hurlbert's PIE",ylim = c(0.5,1),xpd = FALSE)
par(parX)

#and we can see that the Tower has extremely low unevenness
	#...overly high abundance of ghosts?

# NOTE it doesn't matter whether we use absolute abundances
# or proportional (relative) abundances
kantoProp&lt;-t(apply(kanto,1,function(x) x/sum(x)))
kantoPropPIE &lt;- HurlbertPIE(kantoProp)
identical(kantoPIE,kantoPropPIE)

#let's look at evenness of 5 most abundant taxa
kantoPIE_5 &lt;- HurlbertPIE(kanto,nAnalyze = 5)

#barplot
parX &lt;- par(mar = c(7,5,3,3))
barplot(kantoPIE_5,las = 3,cex.names = 0.7,
	ylab = "Hurlbert's PIE for 5 most abundant taxa",ylim = c(0.5,1),xpd = FALSE)
par(parX)
</code></pre>


</div>