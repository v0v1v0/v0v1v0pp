<div class="container">

<table style="width: 100%;"><tr>
<td>projection.matrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct projection matrix models using transition frequency tables</h2>

<h3>Description</h3>

<p>Construct an age or stage-structure projection model from a transition table
listing stage in time <em>t</em>, fate in time <em>t+1</em>, and one or more
individual fertility columns.
</p>


<h3>Usage</h3>

<pre><code class="language-R">projection.matrix(
  transitions,
  stage = NULL,
  fate = NULL,
  fertility = NULL,
  sort = NULL,
  add = NULL,
  TF = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>transitions</code></td>
<td>
<p>a stage-fate data frame with stage or age class in the
current census,  fate in the subsequent census, and one or more fertility columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage</code></td>
<td>
<p>a column name or position of the stage column in the stage-fate
data frame.  Defaults to "stage".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fate</code></td>
<td>
<p>name of the fate column in the stage-fate data frame. Defaults to "fate"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fertility</code></td>
<td>
<p>one or more names of fertility columns in the stage-fate
data frame.  By default, any column names matching stage class names are
assumed to contain individual fertilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort</code></td>
<td>
<p>a vector listing stage classes that correspond to the rows and
columns of the desired projection matrix.  Currently, names in this vector
must match a level in the stage column.  Also, this option should only be
used if stages are not <code>ordered</code>, since the default is to sort by
<code>levels</code> in the stage column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p>a vector listing row, column and value, used to add
<em>estimated</em>  transtions to the transition matrix (e.g., a transition
from seed bank to  seedling).  May be repeated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TF</code></td>
<td>
<p>output separate transition (T) and fertility (F) matrices.  Default
is FALSE and outputs a single projection matrix A</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The state transition rates are estimated using transition frequency tables
(see section 6.1.1, Caswell 2001), so this technique will most likely apply
to demographic studies of plants or other sessile organisms where individuals
are tagged and then consistently relocated in annual censuses.  The fertility
rates are calculated by averaging individuals fertilities by stage class;
therefore, some care should be taken to correctly estimate individual
fertilities based on the timing of the census.
</p>


<h3>Value</h3>

<p>The default output is a single projection matrix A. If the TF flag is
true, then a list with 2 items where A=T+F
</p>


<h3>Note</h3>

<p>Individual fertilities should be the total number of offspring at the
end of the census interval.  Therefore, fertilites should include offspring
survival in a prebreeding censuses (and more than one offspring class may be
present).  In a postbreeding census, new offspring were born just before the
census, so the fertility rate is just the number of offspring in this case.
</p>


<h3>Author(s)</h3>

<p>Chris Stubben
</p>


<h3>Examples</h3>

<pre><code class="language-R">trans01 &lt;- subset(merge(test.census, test.census, by = "plant", sort =FALSE),
                    year.x==2001 &amp; year.y==2002 )
## Add individual fertilities using "anonymous reproduction"  based on the
## proportional reproductive outputs of flowering plants and the total number
## of seedlings at the end of the projection interval
trans01$seedferts &lt;- trans01$fruits.x/sum(trans01$fruits.x) * 5
trans01
stages &lt;- c("seedling", "vegetative", "reproductive")
## three ways to specify columns
projection.matrix(trans01, stage.x, stage.y, seedferts, stages)
projection.matrix(trans01, 3, 6, 8, c(3,4,2))
projection.matrix(trans01, "stage.x", "stage.y", "seedferts", stages)
## BEST to use column default (fertility column (seedling) now matches stage class name)
names(trans01)[c(3, 6, 8)] &lt;- c("stage", "fate", "seedling")
# AND order stages in dataframe
trans01$stage &lt;- ordered(trans01$stage, stages)
projection.matrix(trans01)
projection.matrix(trans01, TF=TRUE)
## Example using Aquilegia data
sf &lt;- subset(aq.trans, year==1998 &amp; plot==909, c(year, plant, stage, fruits, fate))
## rows and columns of final matrix
levels(sf$stage)
## seedlings next year
seedlings &lt;- nrow(subset(aq.trans, plot==909 &amp; year==1999 &amp; stage=="recruit"))
## ADD individual fertility estimates for recruits and seeds assuming seed bank and
## new seeds contribute to a common germinant pool with equal chance of recruitment
seed.survival &lt;- .4
seed.bank.size &lt;- 1000
seeds.per.fruit &lt;- 50
seeds.from.plants &lt;- sum(sf$fruits)*seeds.per.fruit
recruitment.rate &lt;- seedlings/(seed.bank.size + seeds.from.plants)
## add two fertility columns
sf$recruit &lt;- sf$fruits/sum(sf$fruits) * seeds.from.plants * recruitment.rate
sf$seed &lt;- sf$fruits * seeds.per.fruit * seed.survival
## add seed bank survival and seed bank recruitment rate to transition matrix
A &lt;- projection.matrix(sf, add=c(1,1, seed.survival, 2,1, recruitment.rate ))
A
max(Re(eigen(A)$values))

</code></pre>


</div>