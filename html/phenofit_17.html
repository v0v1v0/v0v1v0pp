<div class="container">

<table style="width: 100%;"><tr>
<td>curvefits</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fine Curve fitting</h2>

<h3>Description</h3>

<p>Fine Curve fitting for INPUT time-series.
</p>


<h3>Usage</h3>

<pre><code class="language-R">curvefits(INPUT, brks, options = list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>INPUT</code></td>
<td>
<p>A list object with the elements of 't', 'y', 'w', 'Tn' (optional)
and 'ylu', returned by <code>check_input</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brks</code></td>
<td>
<p>A list object with the elements of 'fit' and 'dt', returned by
<code>season</code> or <code>season_mov</code>, which contains the growing season division information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>see section: options for fitting for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other parameters to <code>curvefit()</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>List of phenofit fitting object.
</p>


<h3>options for fitting</h3>


<ul>
<li> <p><code>methods</code> (default <code style="white-space: pre;">⁠c('AG', 'Beck', 'Elmore', 'Zhang')``): Fine curve fitting methods, can be one or more of ⁠</code>c('AG', 'Beck', 'Elmore', 'Zhang',
'Gu', 'Klos')‘. Note that ’Gu' and 'Klos' are very slow.
</p>
</li>
<li> <p><code>iters</code> (default 2): max iterations of fine fitting.
</p>
</li>
<li> <p><code>wFUN</code> (default <code>wTSM</code>): Character or function, weights updating function
of fine fitting function.
</p>
</li>
<li> <p><code>wmin</code> (default 0.1): min weights in the weights updating procedure.
</p>
</li>
<li> <p><code>use.rough</code> (default FALSE): Whether to use rough fitting smoothed
time-series as input? If <code>false</code>, smoothed VI by rough fitting will be used
for Phenological metrics extraction; If <code>true</code>, original input <code>y</code> will be
used (rough fitting is used to divide growing seasons and update weights.
</p>
</li>
<li> <p><code>use.y0</code> (default TRUE): boolean. whether to use original <code>y0</code> as the input
of <code>plot_input</code>, note that not for curve fitting. <code>y0</code> is the original
value before the process of <code>check_input</code>.
</p>
</li>
<li> <p><code>nextend</code> (default 2): Extend curve fitting window, until <code>nextend</code> good or
marginal points are found in the previous and subsequent growing season.
</p>
</li>
<li> <p><code>maxExtendMonth</code> (default 1): Search good or marginal good values in
previous and subsequent <code>maxExtendMonth</code> period.
</p>
</li>
<li> <p><code>minExtendMonth</code> (default 0.5): Extend period defined by <code>nextend</code> and
<code>maxExtendMonth</code>, should be no shorter than <code>minExtendMonth</code>. When all
points of the input time-series are good value, then the extending period
will be too short. In that situation, we can't make sure the connection
between different growing seasons is smoothing.
</p>
</li>
<li> <p><code>minPercValid</code>: (default 0, not use). If the percentage of good- and
marginal- quality points is less than <code>minPercValid</code>, curve fiting result is
set to <code>NA</code>.
</p>
</li>
<li> <p><code>minT</code>: (not use). If <code>Tn</code> not provided in <code>INPUT</code>, <code>minT</code> will
not be used. <code>minT</code> use night temperature Tn to define backgroud value
(days with <code>Tn &lt; minT</code> treated as ungrowing season).
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>FitDL()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("CA_NS6")
d = CA_NS6

nptperyear &lt;- 23
INPUT &lt;- check_input(d$t, d$y, d$w, QC_flag = d$QC_flag,
     nptperyear = nptperyear, south = FALSE,
     maxgap = nptperyear/4, alpha = 0.02, wmin = 0.2)
# plot_input(INPUT)

# Rough fitting and growing season dividing
wFUN &lt;- "wTSM"
brks2 &lt;- season_mov(INPUT,
    options = list(
        rFUN = "smooth_wWHIT", wFUN = wFUN,
        r_min = 0.05, ypeak_min = 0.05,
        lambda = 10,
        verbose = FALSE
    ))
# plot_season(INPUT, brks2, d)
# Fine fitting
fits &lt;- curvefits(
    INPUT, brks2,
    options = list(
        methods = c("AG", "Beck", "Elmore", "Zhang"), #,"klos", "Gu"
        wFUN = wFUN,
        nextend = 2, maxExtendMonth = 2, minExtendMonth = 1, minPercValid = 0.2
    )
)

r_param = get_param(fits)
r_pheno = get_pheno(fits)
r_gof = get_GOF(fits)
d_fit = get_fitting(fits)

g &lt;- plot_curvefits(d_fit, brks2)
grid::grid.newpage(); grid::grid.draw(g)
</code></pre>


</div>