<div class="container">

<table style="width: 100%;"><tr>
<td>policy_data</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create Policy Data Object</h2>

<h3>Description</h3>

<p><code>policy_data()</code> creates a policy data object which
is used as input to <code>policy_eval()</code> and <code>policy_learn()</code> for policy
evaluation and data adaptive policy learning.
</p>


<h3>Usage</h3>

<pre><code class="language-R">policy_data(
  data,
  baseline_data,
  type = "wide",
  action,
  covariates,
  utility,
  baseline = NULL,
  deterministic_rewards = NULL,
  id = NULL,
  stage = NULL,
  event = NULL,
  action_set = NULL,
  verbose = FALSE
)

## S3 method for class 'policy_data'
print(x, digits = 2, ...)

## S3 method for class 'policy_data'
summary(object, probs = seq(0, 1, 0.25), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.frame or data.table::data.table; see Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baseline_data</code></td>
<td>
<p>data.frame or data.table::data.table; see Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Character string. If "wide", <code>data</code> is considered to be on wide format.
If "long", <code>data</code> is considered to be on long format; see Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>action</code></td>
<td>
<p>Action variable name(s). Character vector or character string.
</p>

<ul>
<li>
<p> A vector is valid for wide data. The length of the vector determines the number of stages (K).
</p>
</li>
<li>
<p> A string is valid for single stage wide data or long data.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>Stage specific covariate name(s). Character vector or named list of character vectors.
</p>

<ul>
<li>
<p> A vector is valid for single stage wide data or long data.
</p>
</li>
<li>
<p> A named list is valid for multiple stages wide data. Each element
must be a character vector with length K. Each vector can contain NA
elements, if a covariate is not available for the given stage(s).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>utility</code></td>
<td>
<p>Utility/Reward variable name(s). Character string or vector.
</p>

<ul>
<li>
<p> A string is valid for long data and wide data with a single final utility.
</p>
</li>
<li>
<p> A vector is valid for wide data with incremental rewards. Must have length K+1; see Examples.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baseline</code></td>
<td>
<p>Baseline covariate name(s). Character vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deterministic_rewards</code></td>
<td>
<p>Deterministic reward variable name(s). Named list of character vectors of length K.
The name of each element must be on the form "U_Aa" where "a" corresponds to an action in the action set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>ID variable name. Character string.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage</code></td>
<td>
<p>Stage number variable name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>Event indicator name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>action_set</code></td>
<td>
<p>Character string. Action set across all stages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. If TRUE, formatting comments are printed to the console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Object to be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Minimum number of digits to be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to print.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Object of class policy_data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>numeric vector (probabilities)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Each observation has the sequential form
</p>
<p style="text-align: center;"><code class="reqn">O= {B, U_1, X_1, A_1, ..., U_K, X_K, A_K, U_{K+1}},</code>
</p>

<p>for a possibly stochastic number of stages K.
</p>

<ul>
<li> <p><code class="reqn">B</code> is a vector of baseline covariates.
</p>
</li>
<li> <p><code class="reqn">U_k</code> is the reward at stage k (not influenced by the action <code class="reqn">A_k</code>).
</p>
</li>
<li> <p><code class="reqn">X_k</code> is a vector of state covariates summarizing the state at stage k.
</p>
</li>
<li> <p><code class="reqn">A_k</code> is the categorical action at stage k.
</p>
</li>
</ul>
<p>The utility is given by the sum of the rewards, i.e.,
<code class="reqn">U = \sum_{k = 1}^{K+1} U_k</code>.
</p>


<h3>Value</h3>

<p><code>policy_data()</code> returns an object of class "policy_data".
The object is a list containing the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>stage_data</code></td>
<td>
<p>data.table::data.table containing the id, stage number, event
indicator, action (<code class="reqn">A_k</code>), state covariates
(<code class="reqn">X_k</code>), reward (<code class="reqn">U_k</code>), and the
deterministic rewards.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baseline_data</code></td>
<td>
<p>data.table::data.table containing the id and baseline
covariates (<code class="reqn">B</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colnames</code></td>
<td>
<p>List containing the state covariate names, baseline
covariate names, and the deterministic reward variable
names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>action_set</code></td>
<td>
<p>Sorted character vector describing the action set, i.e.,
the possible actions at all stages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage_action_sets</code></td>
<td>
<p>List of sorted character vectors describing
the observed actions at each stage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dim</code></td>
<td>
<p>List containing the number of observations (n) and the
number of stages (K).</p>
</td>
</tr>
</table>
<h3>S3 generics</h3>

<p>The following S3 generic functions are available for an object of
class <code>policy_data</code>:
</p>

<dl>
<dt><code>partial()</code></dt>
<dd>
<p> Trim the maximum number
of stages in a <code>policy_data</code> object.</p>
</dd>
<dt><code>subset_id()</code></dt>
<dd>
<p> Subset a a <code>policy_data</code> object on ID.</p>
</dd>
<dt><code>get_history()</code></dt>
<dd>
<p> Summarize the history and action at
a given stage.</p>
</dd>
<dt><code>get_history_names()</code></dt>
<dd>
<p> Get history variable names.</p>
</dd>
<dt><code>get_actions()</code></dt>
<dd>
<p> Get the action at every stage.</p>
</dd>
<dt><code>get_utility()</code></dt>
<dd>
<p>Get the utility.</p>
</dd>
<dt><code>plot()</code></dt>
<dd>
<p>Plot method.</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>policy_eval()</code>, <code>policy_learn()</code>, <code>copy_policy_data()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library("polle")
### Single stage: Wide data
d1 &lt;- sim_single_stage(n = 5e2, seed=1)
head(d1, 5)
# constructing policy_data object:
pd1 &lt;- policy_data(d1,
                   action="A",
                   covariates=c("Z", "B", "L"),
                   utility="U")
pd1
# associated S3 methods:
methods(class = "policy_data")
head(get_actions(pd1), 5)
head(get_utility(pd1), 5)
head(get_history(pd1)$H, 5)

### Two stage: Wide data
d2 &lt;- sim_two_stage(5e2, seed=1)
head(d2, 5)
# constructing policy_data object:
pd2 &lt;- policy_data(d2,
                  action = c("A_1", "A_2"),
                  baseline = c("B"),
                  covariates = list(L = c("L_1", "L_2"),
                                    C = c("C_1", "C_2")),
                  utility = c("U_1", "U_2", "U_3"))
pd2
head(get_history(pd2, stage = 2)$H, 5) # state/Markov type history and action, (H_k,A_k).
head(get_history(pd2, stage = 2, full_history = TRUE)$H, 5) # Full history and action, (H_k,A_k).

### Multiple stages: Long data
d3 &lt;- sim_multi_stage(5e2, seed = 1)
head(d3$stage_data, 10)
# constructing policy_data object:
pd3 &lt;- policy_data(data = d3$stage_data,
                   baseline_data = d3$baseline_data,
                   type = "long",
                   id = "id",
                   stage = "stage",
                   event = "event",
                   action = "A",
                   utility = "U")
pd3
head(get_history(pd3, stage = 3)$H, 5) # state/Markov type history and action, (H_k,A_k).
head(get_history(pd3, stage = 2, full_history = TRUE)$H, 5) # Full history and action, (H_k,A_k).
</code></pre>


</div>