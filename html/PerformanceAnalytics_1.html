<div class="container">

<table style="width: 100%;"><tr>
<td>PerformanceAnalytics-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Econometric tools for performance and risk analysis.
</h2>

<h3>Description</h3>

<p><kbd>PerformanceAnalytics</kbd> provides an <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package of econometric functions for performance and risk analysis of financial instruments or portfolios. This package aims to aid practitioners and researchers in using the latest research for analysis of both normally and non-normally distributed return streams.
</p>
<p>We created this package to include functionality that has been appearing in the academic literature on performance analysis and risk over the past several years, but had no functional equivalent in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>.  In doing so, we also found it valuable to have wrappers for some functionality with good defaults and naming consistent with common usage in the finance literature.  
</p>
<p>In general, this package requires return (rather than price) data. Almost all of the functions will work with any periodicity, from annual, monthly, daily, to even minutes and seconds, either regular or irregular.
</p>
<p>The following sections cover Time Series Data, Performance Analysis, Risk Analysis (with a separate treatment of VaR), Summary Tables of related statistics, Charts and Graphs, a variety of Wrappers and Utility functions, and some thoughts on work yet to be done.
</p>
<p>In this summary, we attempt to provide an overview of the capabilities provided by <kbd>PerformanceAnalytics</kbd> and pointers to other literature and resources in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> useful for performance and risk analysis.  We hope that this summary and the accompanying package and documentation partially fill a hole in the tools available to a financial engineer or analyst.
</p>


<h3>Time Series Data</h3>

<p>Not all, but many of the measures in this package require time series data.  <kbd>PerformanceAnalytics</kbd> uses the <code>xts</code> package for managing time series data for several reasons.  Besides being fast and efficient, <code>xts</code> includes functions that test the data for periodicity and draw attractive and readable time-based axes on charts.  Another benefit is that <code>xts</code> provides compatability with Rmetrics' <code>timeSeries</code>, <code>zoo</code> and other time series classes, such that <kbd>PerformanceAnalytics</kbd> functions that return a time series will return the results in the same format as the object that was passed in.  Jeff Ryan and Josh Ulrich, the authors of <code>xts</code>, have been extraordinarily helpful to the development of <kbd>PerformanceAnalytics</kbd> and we are very greatful for their contributions to the community.  The <code>xts</code> package extends the excellent <code>zoo</code> package written by Achim Zeileis and Gabor Grothendieck. <code>zoo</code> provides more general time series support, whereas <code>xts</code> provides functionality that is specifically aimed at users in finance.
</p>
<p>Users can easily load returns data as time series for analysis with <kbd>PerformanceAnalytics</kbd> by using the <code>Return.read</code> function.  The <code>Return.read</code> function loads csv files of returns data where the data is organized as dates in the first column and the returns for the period in subsequent columns.  See <code>read.zoo</code> and <code>as.xts</code> if more flexibility is needed.  
</p>
<p>The functions described below assume that input data is organized with asset returns in columns and dates represented in rows.  All of the metrics in <kbd>PerformanceAnalytics</kbd> are calculated by column and return values for each column in the results.  This is the default arrangement of time series data in <code>xts</code>.
</p>
<p>Some sample data is available in the <code>managers</code> dataset. It is an xts object that contains columns of monthly returns for six hypothetical asset managers (HAM1 through HAM6), the EDHEC Long-Short Equity hedge fund index, the S&amp;P 500 total returns, and total return series for the US Treasury 10-year bond and 3-month bill. Monthly returns for all series end in December 2006 and begin at different periods starting from January 1996. That data set is used extensively in our examples and should serve as a model for formatting your data.
</p>
<p>For retrieving market data from online sources, see <code>quantmod</code>'s <code>getSymbols</code> function for downloading prices and <code>chartSeries</code> for graphing price data.  Also see the <code>tseries</code> package for the function <code>get.hist.quote</code>. Look at <code>xts</code>'s <code>to.period</code> function to rationally coerce irregular price data into regular data of a specified periodicity.  The <code>aggregate</code> function has methods for <code>tseries</code> and <code>zoo</code> timeseries data classes to rationally coerce irregular data into regular data of the correct periodicity.  
</p>
<p>Finally, see the function <code>Return.calculate</code> for calculating returns from prices.
</p>


<h3>Performance Analysis</h3>

<p>The literature around the subject of performance analysis seems to have exploded with the popularity of alternative assets such as hedge funds, managed futures, commodities, and structured products. Simpler tools that may have seemed appropriate in a relative investment world seem inappropriate for an absolute return world.  Risk measurement, which is nearly inseparable from performance assessment, has become multi-dimensional and multi-moment while trying to answer a simple question: “How much could I lose?”  Portfolio construction and risk budgeting are two sides of the same coin: “How do I maximize my expected gain and avoid going broke?”  But before we can approach those questions we first have to ask: “Is this something I might want in my portfolio?”
</p>
<p>With the the increasing availability of complicated alternative investment strategies to both retail and institutional investors, and the broad availability of financial data, an engaging debate about performance analysis and evaluation is as important as ever.  There won't be one <em>right</em> answer delivered in these metrics and charts.  What there will be is an accretion of evidence, organized to <em>assist</em> a decision maker in answering a specific question that is pertinent to the decision at hand.  Using such tools to uncover information and ask better questions will, in turn, create a more informed investor.
</p>
<p>Performance measurement starts with returns.  Traders may object, complaining that “You can't eat returns,” and will prefer to look for numbers with currency signs.  To some extent, they have a point - the normalization inherent in calculating returns can be deceiving.  Most of the recent work in performance analysis, however, is focused on returns rather than prices and sometimes called "returns-based analysis" or RBA.  This “price per unit of investment” standardization is important for two reasons - first, it helps the decision maker to compare opportunities, and second, it has some useful statistical qualities.  As a result, the <kbd>PerformanceAnalytics</kbd> package focuses on returns.  See <code>Return.calculate</code> for converting net asset values or prices into returns, either discrete or continuous.  Many papers and theories refer to “excess returns”: we implement a simple function for aligning time series and calculating excess returns in <code>Return.excess</code>.
</p>
<p><code>Return.portfolio</code> can be used to calculate weighted returns for a portfolio of assets.  The function was recently changed to support several use-cases: a single weighting vector, an equal weighted portfolio, periodic rebalancing, or irregular rebalancing.  That replaces functionality that had been split between that function and <code>Return.rebalancing</code>.  The function will subset the return series to only include returns for assets for which <code>weights</code> are provided.
</p>
<p>Returns and risk may be annualized as a way to simplify comparison over longer time periods.  Although it requires a bit of estimating, such aggregation is popular because it offers a reference point for easy comparison.  Examples are in <code>Return.annualized</code>, <code>sd.annualized</code>, and <code>SharpeRatio.annualized</code>.
</p>
<p>Basic measures of performance tend to treat returns as independent observations.  In this case, the entirety of R's base is applicable to such analysis.  Some basic statistics we have collected in <code>table.Stats</code> include:
<br></p>

<table>
<tr>
<td style="text-align: left;">
<code>mean</code>  </td>
<td style="text-align: left;">  arithmetic mean </td>
</tr>
<tr>
<td style="text-align: left;">
<code>mean.geometric</code> </td>
<td style="text-align: left;"> geometric mean </td>
</tr>
<tr>
<td style="text-align: left;">
<code>mean.stderr</code> </td>
<td style="text-align: left;"> standard error of the mean (S.E. mean) </td>
</tr>
<tr>
<td style="text-align: left;">
<code>mean.LCL</code> </td>
<td style="text-align: left;"> lower confidence level (LCL) of the mean </td>
</tr>
<tr>
<td style="text-align: left;">
<code>mean.UCL</code> </td>
<td style="text-align: left;"> upper confidence level (UCL) of the mean </td>
</tr>
<tr>
<td style="text-align: left;">
<code>quantile</code>  </td>
<td style="text-align: left;"> for calculating various quantiles of the distribution </td>
</tr>
<tr>
<td style="text-align: left;">
<code>min</code>  </td>
<td style="text-align: left;"> minimum return </td>
</tr>
<tr>
<td style="text-align: left;">
<code>max</code>  </td>
<td style="text-align: left;"> maximum return </td>
</tr>
<tr>
<td style="text-align: left;">
<code>range</code> </td>
<td style="text-align: left;"> range of returns </td>
</tr>
<tr>
<td style="text-align: left;">
<code>length(R)</code>  </td>
<td style="text-align: left;"> number of observations </td>
</tr>
<tr>
<td style="text-align: left;">
<code>sum(is.na(R))</code> </td>
<td style="text-align: left;"> number of NA's </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>It is often valuable when evaluating an investment to know whether the instrument that you are examining follows a normal distribution.  One of the first methods to determine how close the asset is to a normal or log-normal distribution is to visually look at your data.  Both <code>chart.QQPlot</code> and <code>chart.Histogram</code> will quickly give you a feel for whether or not you are looking at a normally distributed return history.  Differences between <code>var</code> and <code>SemiVariance</code> will help you identify <code>skewness</code> in the returns.  Skewness measures the degree of asymmetry in the return distribution.  Positive skewness indicates that more of the returns are positive, negative skewness indicates that more of the returns are negative.  An investor should in most cases prefer a positively skewed asset to a similar (style, industry, region) asset that has a negative skewness. 
</p>
<p>Kurtosis measures the concentration of the returns in any given part of the distribution (as you should see visually in a histogram).  The <code>kurtosis</code> function will by default return what is referred to as “excess kurtosis”, where 0 is a normal distribution, other methods of calculating kurtosis than <code>method="excess"</code> will set the normal distribution at a value of 3.  In general a rational investor should prefer an asset with a low to negative excess kurtosis, as this will indicate more predictable returns (the major exception is generally a combination of high positive skewness and high excess kurtosis).  If you find yourself needing to analyze the distribution of complex or non-smooth asset distributions, the <code>nortest</code> package has several advanced statistical tests for analyzing the normality of a distribution.
</p>
<p><em>Modern Portfolio Theory (MPT)</em> is the collection of tools and techniques by which a risk-averse investor may construct an “optimal” portfolio.  It was pioneered by Markowitz's ground-breaking 1952 paper <cite>Portfolio Selection</cite>.  It also encompasses CAPM, below, the efficient market hypothesis, and all forms of quantitative portfolio construction and optimization.
</p>
<p><em>The Capital Asset Pricing Model (CAPM)</em>, initially developed by William Sharpe in 1964, provides a justification for passive or index investing by positing that assets that are not on the efficient frontier will either rise or fall in price until they are. The <code>CAPM.RiskPremium</code> is the measure of how much the asset's performance differs from the risk free rate.  Negative Risk Premium generally indicates that the investment is a bad investment, and the money should be allocated to the risk free asset or to a different asset with a higher risk premium.  <code>CAPM.alpha</code> is the degree to which the assets returns are not due to the return that could be captured from the market. Conversely, <code>CAPM.beta</code> describes the portions of the returns of the asset that could be directly attributed to the returns of a passive investment in the benchmark asset. 
</p>
<p>The Capital Market Line <code>CAPM.CML</code> relates the excess expected return on an efficient market portfolio to its risk (represented in CAPM by <code>sd</code>).  The slope of the CML, <code>CAPM.CML.slope</code>, is the Sharpe Ratio for the market portfolio. The Security Market Line is constructed by calculating the line of <code>CAPM.RiskPremium</code> over <code>CAPM.beta</code>.  For the benchmark asset this will be 1 over the risk premium of the benchmark asset. The slope of the SML, primarily for plotting purposes, is given by <code>CAPM.SML.slope</code>. CAPM is a market equilibrium model or a general equilibrium theory of the relation of prices to risk, but it is usually applied to partial equilibrium portfolios, which can create (sometimes serious) problems in valuation.
</p>
<p>One extension to the CAPM contemplates evaluating an active manager's ability to time the market.  Two other functions apply the same notion of best fit to positive and negative market returns, separately.  The <code>CAPM.beta.bull</code> is a regression for only positive market returns, which can be used to understand the behavior of the asset or portfolio in positive or 'bull' markets.  Alternatively, <code>CAPM.beta.bear</code> provides the calculation on negative market returns. The <code>TimingRatio</code> uses the ratio of those to help assess whether the manager has shown evidence that of timing skill.
</p>
<p>The performance premium provided by an investment over a passive strategy (the benchmark) is provided by <code>ActivePremium</code>, which is the investment's annualized return minus the benchmark's annualized return. A closely related measure is the <code>TrackingError</code>, which  measures the unexplained portion of the investment's performance relative to a benchmark. The <code>InformationRatio</code> of an investment in a MPT or CAPM framework is the Active Premium divided by the Tracking Error.  Information Ratio may be used to rank investments in a relative fashion.
</p>
<p>We have also included a function to compute the <code>KellyRatio</code>.  The Kelly criterion applied to position sizing will maximize log-utility of returns and avoid risk of ruin.  For our purposes, it can also be used as a stack-ranking method like <code>InformationRatio</code> to describe the “edge” an investment would have over a random strategy or distribution.
</p>
<p>These metrics and others such as <code>SharpeRatio</code>, <code>SortinoRatio</code>, <code>UpsidePotentialRatio</code>, Spearman rank correlation (see <code>rcorr</code>), etc., are all methods of rank-ordering relative performance. <cite>Alexander and Dimitriu (2004) in “The Art of Investing in Hedge Funds”</cite> show that relative rankings across multiple pricing methodologies may be positively correlated with each other and with expected returns.  This is quite an important finding because it shows that multiple methods of predicting returns and risk which have underlying measures and factors that are not directly correlated to another measure or factor will still produce widely similar quantile rankings, so that the “buckets” of target instruments will have significant overlap.  This observation specifically supports the point made early in this document regarding “accretion of the evidence” for a positive or negative investment decision.
</p>


<h3>Style Analysis</h3>

<p>Style analysis is one way to help determine a fund's exposures to the changes in returns of major asset classes or other factors.  <kbd>PerformanceAnalytics</kbd> previously had a few functions that calculate style weights using an asset class style model as described in detail in Sharpe (1992).
</p>
<p>These functions have been moved to <kbd>R-Forge</kbd> in package <kbd>FactorAnalytics</kbd> as part of a collaboration with Eric Zivot at the University of Washington. The functions combine to calculate effective style weights and display the results in a bar chart.  <code>chart.Style</code> calculates and displays style weights calculated over a single period. <code>chart.RollingStyle</code> calculates and displays those weights in rolling windows through time.  <code>style.fit</code> manages the calculation of the weights by method, and <code>style.QPfit</code> calculates the specific constraint case that requires quadratic programming.  [note: these functions do not currently appear in the development codebase, but should reappear as a supported method at some point]
</p>
<p>There is a significant amount of academic literature on identifying and attributing sources of risk or returns.  Much of it falls into the field of “factor analysis” where “risk factors” are used to retrospectively explain sources of risk, and through regression and other analytical methods <em>predict</em> future period returns and risk based on factor drivers.  These are well covered in chapters on factor analysis in <cite>Zivot and Wang(2006)</cite> and also in the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> functions <code>factanal</code> for basic factor analysis and <code>princomp</code> for Principal Component Analysis.  The authors feel that financial engineers and analysts would benefit from some wrapping of this functionality focused on finance, but the capabilities already available from the base functions are quite powerful.  We are hopeful that our new collaboration with Prof. Zivot will provide additional functionality in the near future.
</p>


<h3>Risk Analysis</h3>

<p>Many methods have been proposed to measure, monitor, and control the risks of a diversified portfolio. Perhaps a few definitions are in order on how different risks are generally classified. <em>Market Risk</em> is the risk to the portfolio from a decline in the market price of instruments in the portfolio.  <em>Liquidity Risk</em> is the risk that the holder of an instrument will find that a position is illiquid, and will incur extra costs in unwinding the position resulting in a less favorable price for the instrument. In  extreme cases of liquidity risk, the seller may be unable to find a buyer for the instrument at all, making the value unknowable or zero.  <em>Credit Risk</em> encompasses <em>Default Risk</em>, or the risk that promised payments on a loan or bond will not be made, or that a convertible instrument will not be converted in a timely manner or at all.  There are also <em>Counterparty Risks</em> in over the counter markets, such as those for complex derivatives.  Tools have evolved to measure all these different components of risk.  Processes must be put into place inside a firm to monitor the changing risks in a portfolio, and to control the magnitude of risks.  For an extensive treatment of these topics, see Litterman, Gumerlock, et. al.(1998).  For our purposes, <kbd>PerformanceAnalytics</kbd> tends to focus on market and liquidity risk.
</p>
<p>The simplest risk measure in common use is volatility, usually modeled quantitatively with a univariate standard deviation on a portfolio.  See <code>sd</code>.  Volatility or Standard Deviation is an appropriate risk measure when the distribution of returns is normal or resembles a random walk, and may be annualized using <code>sd.annualized</code>, or the equivalent function <code>sd.multiperiod</code> for scaling to an arbitrary number of periods.  Many assets, including hedge funds, commodities, options, and even most common stocks over a sufficiently long period, do not follow a normal distribution.  For such common but non-normally distributed assets, a more sophisticated approach than standard deviation/volatility is required to adequately model the risk.
</p>
<p>Markowitz, in his Nobel acceptance speech and in several papers, proposed that <code>SemiVariance</code> would be a better measure of risk than variance.  See <cite>Zin, Markowitz, Zhao (2006)</cite>.  This measure is also called <code>SemiDeviation</code>.  The more general case is <code>DownsideDeviation</code>, as proposed by <cite>Sortino and Price(1994)</cite>, where the minimum acceptable return (MAR) is a parameter to the function.  It is interesting to note that variance and mean return can produce a smoothly elliptical efficient frontier for portfolio optimization using <code>solve.QP</code> or <code>portfolio.optim</code> or <kbd>fPortfolio</kbd>. Use of semivariance or many other risk measures will not necessarily create a smooth ellipse, causing significant additional difficulties for the portfolio manager trying to build an optimal portfolio.  We'll leave a more complete treatment and implementation of portfolio optimization techniques for another time.
</p>
<p>Another very widely used downside risk measures is analysis of drawdowns, or loss from peak value achieved. The simplest method is to check the <code>maxDrawdown</code>, as this will tell you the worst cumulative loss ever sustained by the asset.  If you want to look at all the drawdowns, you can <code>findDrawdowns</code> and <code>sortDrawdowns</code> in order from worst/major to smallest/minor. The <code>UpDownRatios</code> function will give you some insight into the impacts of the skewness and kurtosis of the returns, and letting you know how length and magnitude of up or down moves compare to each other.  You can also plot drawdowns with <code>chart.Drawdown</code>.
</p>
<p>One of the most commonly used and cited measures of the risk/reward tradeoff of an investment or portfolio is the <code>SharpeRatio</code>, which measures return over standard deviation.  If you are comparing multiple assets using Sharpe, you should use <code>SharpeRatio.annualized</code>. It is important to note that William Sharpe now recommends <code>InformationRatio</code> preferentially to the original Sharpe Ratio. The <code>SortinoRatio</code> uses mean return over <code>DownsideDeviation</code> below the MAR as the risk measure to produce a similar ratio that is more sensitive to downside risk. Sortino later enhanced his ideas to use upside returns for the numerator and <code>DownsideDeviation</code> as the denominator in <code>UpsidePotentialRatio</code>. <cite>Favre and Galeano(2002)</cite> propose using the ratio of expected excess return over the Cornish-Fisher <code>VaR</code> to produce <code>SharpeRatio.modified</code>. <code>TreynorRatio</code> is also similar to the Sharpe Ratio, except it uses <code>CAPM.beta</code> in place of the volatility measure to produce the ratio of the investment's excess return over the beta.
</p>
<p>One of the newer statistical methods developed for analyzing the risk of financial instruments is <code>Omega</code>.  Omega analytically constructs a cumulative distribution function, in a manner similar to <code>chart.QQPlot</code>, but then extracts additional information from the location and slope of the derived function at the point indicated by the risk quantile that the researcher is interested in.  Omega seeks to combine a large amount of data about the shape, magnitude, and slope of the distribution into one method.  The academic literature is still exploring the best manner to use Omega in a risk measurement and control process, or in portfolio construction.
</p>
<p>Any risk measure should be viewed with suspicion if there are not a large number of historical observations of returns for the asset in question available.  Depending on the measure, the number of observations required will vary greatly from a statistical standpoint.  As a heuristic rule, ideally you will have data available on how the instrument performed through several economic cycles and shocks.  When such a long history is not available, the investor or researcher has several options.  A full discussion of the various approaches is beyond the scope of this introduction, so we will merely touch on several areas that an interested party may wish to explore in additional detail. Examining the returns of assets with a similar style, industry, or asset class to which the asset in question is highly correlated and shares other characteristics can be quite informative.  Factor analysis may be used to uncover specific risk factors where transparency is not available. Various resampling (see <code>tsbootstrap</code>) and simulation methods are available in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> to construct an artificially long distribution for testing.  If you use a method such as Monte Carlo simulation or the bootstrap, it is often valuable to use <code>chart.Boxplot</code> to visualize the different estimates of the risk measure produced by the simulation, to see how small (or wide) a range the estimates cover, and thus gain a level of confidence with the results.  Proceed with extreme caution when your historical data is lacking.  Problems with lack of historical data are a major reason why many institutional investors will not invest in an alternative asset without several years of historical return data available.
</p>


<h3>Value at Risk - VaR</h3>

<p><em>Traditional mean-VaR</em>:
In the early 90's, academic literature started referring to “value at risk”, typically written as VaR. Take care to capitalize VaR in the commonly accepted manner, to avoid confusion with var (variance) and VAR (vector auto-regression).  With a sufficiently large data set, you may choose to use a non-parametric VaR estimation method using the historical distribution and the probability quantile of the distribution calculated using <code>qnorm</code>. The negative return at the correct quantile (usually 95% or 99%), is the non-parametric VaR estimate.  J.P. Morgan's RiskMetrics parametric mean-VaR was published in 1994 and this methodology for estimating parametric mean-VaR has become what people are generally referring to as “VaR” and what we have implemented as <code>VaR</code> with <code>method="historical"</code>.  See <cite>Return to RiskMetrics: Evolution of a Standard</cite> at <a href="https://www.msci.com/documents/10199/dbb975aa-5dc2-4441-aa2d-ae34ab5f0945">https://www.msci.com/documents/10199/dbb975aa-5dc2-4441-aa2d-ae34ab5f0945</a>. Parametric traditional VaR does a better job of accounting for the tails of the distribution by more precisely estimating the tails below the risk quantile.  It is still insufficient if the assets have a distribution that varies widely from normality.  That is available in <code>VaR</code> with <code>method="gaussian"</code>.
</p>
<p>The <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package VaR, now orphaned, contains methods for simulating and estimating lognormal <kbd>VaR.norm</kbd> and generalized Pareto <kbd>VaR.gpd</kbd> distributions to overcome some of the problems with nonparametric or parametric mean-VaR calculations on a limited sample size.  There is also a <kbd>VaR.backtest</kbd> function to apply simulation methods to create a more robust estimate of the potential distribution of losses.  The VaR package also provides plots for its functions.  We will attempt to incoporate this orphaned functionality in PerformanceAnalytics in an upcoming release.
</p>
<p><em>Modified Cornish-Fisher VaR</em>:
The limitations of traditional mean-VaR are all related to the use of a symmetrical distribution function.  Use of simulations, resampling, or Pareto distributions all help in making a more accurate prediction, but they are still flawed for assets with significantly non-normal (skewed and/or kurtotic) distributions. <cite>Huisman (1999)</cite> and <cite>Favre and Galleano (2002)</cite> propose to overcome this extensively documented failing of traditional VaR by directly incorporating the higher moments of the return distribution into the VaR calculation.  
</p>
<p>This new VaR measure incorporates skewness and kurtosis via an analytical estimation using a Cornish-Fisher (special case of a Taylor) expansion. The resulting measure is referred to variously as “Cornish-Fisher VaR” or “Modified VaR”.  We provide this measure in function <code>VaR</code> with <code>method="modified"</code>.  Modified VaR produces the same results as traditional mean-VaR when the return distribution is normal, so it may be used as a direct replacement.  Many papers in the finance literature have reached the conclusion that Modified VaR is a superior measure, and may be substituted in any case where mean-VaR would previously have been used.  
</p>
<p><em>Conditional VaR and Expected Shortfall</em>:
We have implemented Conditional Value at Risk, also called Expected Shortfall (not to be confused with shortfall probability, which is much less useful), in function <code>ES</code>.  Expected Shortfall attempts to measure the magnitude of the average loss exceeding the traditional mean-VaR. Expected Shortfall has proven to be a reasonable risk predictor for many asset classes.  We have provided traditional historical, Gaussian and modified Cornish-Fisher measures of Expected Shortfall by using <code>method="historical"</code>, <code>method="gaussian"</code> or <code>method="modified"</code>. See <cite>Uryasev(2000)</cite> and <cite>Sherer and Martin(2005)</cite> for more information on Conditional Value at Risk and Expected Shortfall.  Please note that your milage will vary; expect that values obtained from the normal distribution may differ radically from the real situation, depending on the assets under analysis.
</p>
<p><em>Multivariate extensions to risk measures</em>:
We have extened all moments calculations to work in a multivariate portfolio context.  In a portfolio context the multivariate moments are generally to be preferred to their univariate counterparts, so that all information is available to subsequent calculations.  Both the <code>VaR</code> and <code>ES</code> functions allow calculation of metrics in a portfolio context when <code>weights</code> and a <code>portfolio_method</code> are passed into the function call.
</p>
<p><em>Marginal, Incremental, and Component VaR</em>:
Marginal VaR is the difference between the VaR of the portfolio without the asset in question and the entire portfolio.  The <code>VaR</code> function calculates Marginal VaR for all instruments in the portfolio if you set <code>method="marginal"</code>. Marginal VaR as provided here may use traditional mean-VaR or Modified VaR for the calculation. Per <cite>Artzner,et.al.(1997)</cite> properties of a coherent risk measure include subadditivity (risks of the portfolio should not exceed the sum of the risks of individual components) as a significantly desirable trait.  VaR measures, including Marginal VaR, on individual components of a portfolio are <em>not</em> subadditive. 
</p>
<p>Clearly, a general subadditive risk measure for downside risk is required.  In Incremental or Component VaR, the Component VaR value for each element of the portfolio will sum to the total VaR of the portfolio.  Several EDHEC papers suggest using Modified VaR instead of mean-VaR in the Incremental and Component VaR calculation.  We have succeeded in implementing Component VaR and ES calculations that use Modified Cornish-Fisher VaR, historical decomposition, and kernel estimators.  You may access these with <code>VaR</code> or <code>ES</code> by setting the appropriate <code>portfolio_method</code> and <code>method</code> arguments.
</p>
<p>The <code>chart.VaRSensitivity</code> function creates a chart of Value-at-Risk or Expected Shortfall estimates by confidence interval for multiple methods. Useful for comparing a calculated VaR or ES method to the historical VaR or ES, it may also be used to visually examine whether the VaR method “breaks down” or gives nonsense results at a certain threshold.
</p>
<p>Which VaR measure to use will depend greatly on the portfolio and instruments being analyzed.  If there is any generalization to be made on VaR measures, we agree with <cite>Bali and Gokcan(2004)</cite> who conclude that “the VaR estimations based on the generalized Pareto distribution and the Cornish-Fisher approximation perform best”.
</p>


<h3>Moments and Co-moments</h3>

<p>Analysis of financial time series often involves evaluating their mathematical moments.  While <code>var</code> and <code>cov</code> for variance has always been available, as well as  <code>skewness</code> and <code>kurtosis</code> (which we have extended to make multivariate and multi-column aware), a larger suite of multivariate moments calculations was not available in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>.  We have now implemented multivariate moments and co-moments and their beta or systematic co-moments in <kbd>PerformanceAnalytics</kbd>.
</p>
<p><cite>Ranaldo and Favre (2005)</cite> define coskewness and cokurtosis as the skewness and kurtosis of a given asset analysed with the skewness and kurtosis of the reference asset or portfolio.  The co-moments are useful for measuring the marginal contribution of each asset to the portfolio's resulting risk.  As such, co-moments of an asset return distribution should be useful as inputs for portfolio optimization in addition to the covariance matrix.  Functions include <code>CoVariance</code>, <code>CoSkewness</code>, <code>CoKurtosis</code>.
</p>
<p>Measuring the co-moments should be useful for evaluating whether or not an asset is likely to provide diversification potential to a portfolio.  But the co-moments do not allow the marginal impact of an asset on a portfolio to be directly measured.  Instead, <cite>Martellini and Zieman (2007)</cite> develop a framework that assesses the potential diversification of an asset relative to a portfolio. They use higher moment betas to estimate how much portfolio risk will be impacted by adding an asset.  
</p>
<p>Higher moment betas are defined as proportional to the derivative of the covariance, coskewness and cokurtosis of the second, third and fourth portfolio moment with respect to the portfolio weights.  A beta that is less than 1 indicates that adding the new asset should reduce the resulting portfolio's volatility and kurtosis, and to an increase in skewness. More specifically, the lower the beta the higher the diversification effect, not only in terms of normal risk (i.e. volatility) but also the risk of assymetry (skewness) and extreme events (kurtosis).  See the functions for <code>BetaCoVariance</code>, <code>BetaCoSkewness</code>, and <code>BetaCoKurtosis</code>.
</p>


<h3>Robust Data Cleaning</h3>

<p>The functions <code>Return.clean</code> and <code>clean.boudt</code> implement statistically robust data cleaning methods tuned to portfolio construction and risk analysis and prediction in financial time series while trying to avoid some of the pitfalls of standard robust statistical methods.
</p>
<p>The primary value of data cleaning lies in creating a more
robust and stable estimation of the distribution generating the
large majority of the return data. The increased robustness and
stability of the estimated moments using cleaned data should be
used for portfolio construction. If an investor wishes to
have a more conservative risk estimate, cleaning may not be
indicated for risk monitoring. 
</p>
<p>In actual practice, it is probably best to back-test the out-of-sample results of
both cleaned and uncleaned series to see what works best when forecasting risk with the
particular combination of assets under consideration.
</p>


<h3>Summary Tabular Data</h3>

<p>Summary statistics are then the necessary aggregation and reduction of (potentially thousands) of periodic return numbers. Usually these statistics are most palatable when organized into a table of related statistics, assembled for a particular purpose.  A common offering of past returns organized by month and cumulated by calendar year is usually presented as a table, such as in <code>table.CalendarReturns</code>.  Adding benchmarks or peers alongside the annualized data is helpful for comparing returns in calendar years.
</p>
<p>When we started this project, we debated whether such tables would be broadly useful or not.  No reader is likely to think that we captured the precise statistics to help their decision. We merely offer these as a starting point for creating your own.  Add, subtract, do whatever seems useful to you.  If you think that your work may be useful to others, please consider sharing it so that we may include it in a future version of this package.
</p>
<p>Other tables for comparison of related groupings of statistics discussed elsewhere:
</p>

<table>
<tr>
<td style="text-align: right;">

    <code>table.Stats</code> </td>
<td style="text-align: left;"> Basic statistics and stylized facts </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.TrailingPeriods</code> </td>
<td style="text-align: left;"> Statistics and stylized facts compared over different trailing periods </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.AnnualizedReturns</code> </td>
<td style="text-align: left;"> Annualized return, standard deviation, and Sharpe ratio </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.CalendarReturns</code> </td>
<td style="text-align: left;"> Monthly and calendar year return table </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.CAPM</code> </td>
<td style="text-align: left;"> CAPM-related measures </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.Correlation</code> </td>
<td style="text-align: left;"> Comparison of correlalations and significance statistics </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.DownsideRisk</code> </td>
<td style="text-align: left;"> Downside risk metrics and statistics </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.Drawdowns</code> </td>
<td style="text-align: left;"> Ordered list of drawdowns and when they occurred </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.Autocorrelation</code> </td>
<td style="text-align: left;"> The first six autocorrelation coefficients and significance </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.HigherMoments</code> </td>
<td style="text-align: left;"> Higher co-moments and beta co-moments </td>
</tr>
<tr>
<td style="text-align: right;">
    <code>table.Arbitrary</code> </td>
<td style="text-align: left;"> Combines a function list into a table </td>
</tr>
<tr>
<td style="text-align: right;">
  </td>
</tr>
</table>
<h3>Charts and Graphs</h3>

<p>Graphs and charts can also help to organize the information visually. Our goal in creating these charts was to simplify the process of creating well-formatted charts that are used often in performance analysis, and to create high-quality graphics that may be used in documents for consumption by non-analysts or researchers. <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>'s graphics capabilities are substantial, but the simplicity of the output of <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> default graphics functions such as <code>plot</code> does not always compare well against graphics delivered with commercial asset or performance analysis from places such as MorningStar or PerTrac.
</p>
<p>The cumulative returns or wealth index is usually the first thing displayed, even though neither conveys much information.  See <code>chart.CumReturns</code>.  Individual period returns may be helpful for identifying problematic periods, such as in <code>chart.Bar</code>.  Risk measures can be helpful when overlaid on the period returns, to display the bounds at which losses may be expected.  See <code>chart.BarVaR</code> and the prior section on Risk Analysis.  More information can be conveyed when such charts are displayed together, as in <code>charts.PerformanceSummary</code>, which combines the performance data with detail on downside risk (see <code>chart.Drawdown</code>).
</p>
<p><code>chart.RelativePerformance</code> can plot the relative performance through time of two assets.  This plot displays the ratio of the cumulative performance at each point in time and makes periods of under- or out-performance easy to see.  The value of the chart is less important than the slope of the line.  If the slope is positive, the first asset is outperforming the second, and vice verse.  Affectionately known as the Canto chart, it was used effectively in Canto (2006).
</p>
<p>Two-dimensional charts can also be useful while remaining easy to understand.  <code>chart.Scatter</code> is a utility scatter chart with some additional attributes that are used in <code>chart.RiskReturnScatter</code>.  Overlaying Sharpe ratio lines or boxplots helps to add information about relative performance along those dimensions. 
</p>
<p>For distributional analysis, a few graphics may be useful.  <code>chart.Boxplot</code> is an example of a graphic that is difficult to create in Excel and is under-utilized as a result.  A boxplot of returns is, however, a very useful way to instantly observe the shape of large collections of asset returns in a manner that makes them easy to compare to one another.  <code>chart.Histogram</code> and <code>chart.QQPlot</code> are two charts originally found elsewhere and now substantially expanded in <kbd>PerformanceAnalytics</kbd>.
</p>
<p>Rolling performance is typically used as a way to assess stability of a return stream.  Although perhaps it doesn't get much credence in the financial literature as it derives from work in digital signal processing, many practitioners find it a useful way to examine and segment performance and risk periods.  See <code>chart.RollingPerformance</code>, which is a way to display different metrics over rolling time periods.  <code>chart.RollingMean</code> is a specific example of a rolling mean and standard error bands.  A group of related metrics is offered in <code>charts.RollingPerformance</code>.  These charts use utility functions such as <code>rollapply</code>.
</p>
<p><code>chart.SnailTrail</code> is a scatter chart that shows how rolling calculations of annualized return and annualized standard deviation have proceeded through time where the color of lines and dots on the chart diminishes with respect to time. <code>chart.RollingCorrelation</code> shows how correlations change over rolling periods.  <code>chart.RollingRegression</code> displays the coefficients of a linear model fitted over rolling periods.  A group of charts in <code>charts.RollingRegression</code> displays alpha, beta, and R-squared estimates in three aligned charts in a single device.
</p>
<p><code>chart.StackedBar</code> creates a stacked column chart with time on the horizontal axis and values in categories.  This kind of chart is commonly used for showing portfolio 'weights' through time, although the function will plot any values by category. 
</p>
<p>We have been greatly inspired by other peoples' work, some of which is on display at addictedtor.free.fr.  Particular inspiration came from Dirk Eddelbuettel and John Bollinger for their work at http://addictedtor.free.fr/graphiques/RGraphGallery.php?graph=65. Those interested in price charting in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> should also look at the <code>quantmod</code> package.
</p>


<h3>Wrapper and Utility Functions</h3>

<p><span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> is a very powerful environment for manipulating data.  It can also be quite confusing to a user more accustomed to Excel or even MatLAB.  As such, we have written some wrapper functions that may aid you in coercing data into the correct forms or finding data that you need to use regularly.  To simplify the management of multiple-source data stored in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> in multiple data formats, we have provided <code>checkData</code>.  This function will attempt to coerce data in and out of <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>'s multitude of mostly fungible data classes into the class required for a particular analysis.  The data-coercion function has been hidden inside the functions here, but it may also save you time and trouble in your own code and functions as well.
</p>
<p><span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>'s built-in <code>apply</code> function in enormously powerful, but is can be tricky to use with timeseries data, so we have provided wrapper functions to <code>apply.fromstart</code> and <code>apply.rolling</code> to make handling of “from inception” and “rolling window” calculations easier.
</p>


<h3>Further Work</h3>

<p>We have attempted to standardize function parameters and variable names, but more work exists to be done here.
</p>
<p>Any comments, suggestions, or code patches are invited.
</p>
<p>If you've implemented anything that you think would be generally useful to include, please consider donating it for inclusion in a later version of this package.
</p>


<h3>Acknowledgments</h3>

<p>Data series <code>edhec</code> used in <kbd>PerformanceAnalytics</kbd> and related publications with the kind permission of the EDHEC Risk and Asset Management Research Center. <br><a href="http://www.edhec-risk.com/indexes/pure_style">http://www.edhec-risk.com/indexes/pure_style</a>
</p>
<p>Kris Boudt was instrumental in our research on component risk for portfolios with non-normal distributions, and is responsible for much of the code for multivariate moments and co-moments.
</p>
<p>Jeff Ryan and Josh Ulrich are active participants in the R finance community and created <code>xts</code>, upon which much of PerformanceAnalytics depends.
</p>
<p>Prototypes of the drawdowns functionality were provided by Sankalp Upadhyay, and modified with permission. Stephan Albrecht provided detailed feedback on the Getmansky/Lo Smoothing Index.  Diethelm Wuertz provided prototypes of modified VaR and skewness and kurtosis functions (and is of course the maintainer of the RMetrics suite of pricing and optimization functions).  He also contributed prototypes for many other functions from Bacon's book that were incorporated into PerformanceAnalytics by Matthieu Lestel.  Any errors are, of course, our own.
</p>
<p>Thanks to Joe Wayne Byers and Dirk Eddelbuettel for comments on early versions of these functions, and to Khanh Nguyen, Tobias Verbeke, H. Felix Wittmann, and Ryan Sheftel for careful testing and detailed problem reports.
</p>
<p>Thanks also to our Google Summer of Code students through the years for their contributions.  Significant contributions from GSOC students to this package have come from Matthieu Lestel and Andrii Babii so far.  We expect to eventually incorporate contributions from Pulkit Mehrotra and Shubhankit Mohan, who worked with us during the summer of 2013.
</p>
<p>Thanks to the R-SIG-Finance community without whom this package would not be possible.  We are indebted to the R-SIG-Finance community for many helpful suggestions, bugfixes, and requests.
</p>


<h3>Author(s)</h3>

<p>Brian G. Peterson <br>
Peter Carl <br></p>
<p>Maintainer: Brian G. Peterson <a href="mailto:brian@braverock.com">brian@braverock.com</a>
</p>


<h3>References</h3>

<p>Amenc, N. and Le Sourd, V. <em>Portfolio Theory and Performance Analysis</em>. Wiley. 2003. <br></p>
<p>Bacon, C. <em>Practical Portfolio Performance Measurement and Attribution</em>. Wiley. 2004. <br></p>
<p>Canto, V. <em>Understanding Asset Allocation</em>. FT Prentice Hall. 2006. <br></p>
<p>Lhabitant, F. <em>Hedge Funds: Quantitative Insights</em>. Wiley. 2004. <br></p>
<p>Litterman, R., Gumerlock R., et. al. <em>The Practice of Risk Management: Implementing Processes for Managing Firm-Wide Market Risk</em>. Euromoney. 1998. <br></p>
<p>Martellini, Lionel, and Volker Ziemann. <em>Improved Forecasts of Higher-Order Comoments and Implications for Portfolio Selection.</em> EDHEC Risk and Asset Management Research Centre working paper. 2007. <br></p>
<p>Ranaldo, Angelo, and Laurent Favre Sr. <em>How to Price Hedge Funds: From Two- to Four-Moment CAPM.</em> SSRN eLibrary. 2005.
</p>
<p>Murrel, P. <em>R Graphics</em>. Chapman and Hall. 2006.  <br></p>
<p>Ruppert, D. <em>Statistics and Finance, an Introduction</em>. Springer. 2004. <br></p>
<p>Scherer, B. and Martin, D. <em>Modern Portfolio Optimization</em>. Springer. 2005. <br></p>
<p>Shumway, R. and Stoffer, D. <em>Time Series Analysis and it's Applications, with R examples</em>, Springer, 2006. <br></p>
<p>Tsay, R. <em>Analysis of Financial Time Series</em>. Wiley. 2001. <br></p>
<p>Zin, Markowitz, Zhao A Note on Semivariance. Mathematical Finance, Vol. 16, No. 1, pp. 53-61, January 2006 
</p>
<p>Zivot, E. and Wang, Z. <em>Modeling Financial Time Series with S-Plus: second edition</em>. Springer. 2006. <br></p>


<h3>See Also</h3>

<p>CRAN task view on Empirical Finance <br><a href="https://CRAN.R-project.org/view=Econometrics">https://CRAN.R-project.org/view=Econometrics</a>
</p>
<p>Grant Farnsworth's Econometrics in R <br><a href="https://cran.r-project.org/doc/contrib/Farnsworth-EconometricsInR.pdf">https://cran.r-project.org/doc/contrib/Farnsworth-EconometricsInR.pdf</a>
</p>
<p>Collection of R charts and graphs <br> http://addictedtor.free.fr/graphiques/
</p>


</div>