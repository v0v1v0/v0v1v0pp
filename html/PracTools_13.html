<div class="container">

<table style="width: 100%;"><tr>
<td>deff</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Design effects of various types
</h2>

<h3>Description</h3>

<p>Compute the Kish, Henry, Spencer, or Chen-Rust design effects.
</p>


<h3>Usage</h3>

<pre><code class="language-R">deff(w, x=NULL, y=NULL, p=NULL, strvar=NULL, clvar=NULL, Wh=NULL, nest=FALSE, type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>vector of weights for a sample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>matrix of covariates used to construct a GREG estimator of the total of <code class="reqn">y</code>.  This matrix does not include the intercept. Used only for Henry <em>deff</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>vector of the sample values of an analysis variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>vector of 1-draw selection probabilities, i.e., the probability that each unit would be selected in a sample of size 1. Used only for Spencer <em>deff</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strvar</code></td>
<td>
<p>vector of stratum identifiers; equal in length to that of <code>w</code>. Used only for Chen-Rust <em>deff</em>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clvar</code></td>
<td>
<p>vector of cluster identifiers; equal in length to that of <code>w</code>. Used only for Chen-Rust <em>deff</em>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Wh</code></td>
<td>
<p>vector of the proportions of elements that are in each stratum; length is number of strata. Used only for Chen-Rust <em>deff</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nest</code></td>
<td>
<p>Are cluster IDs numbered within strata (<code>TRUE</code> or <code>FALSE</code>)? If <code>TRUE</code>, cluster IDs can be restarted within strata, e.g., 1,2,3,1,2,3,...</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of allocation; must be one of <code>"kish"</code>, <code>"henry"</code>, <code>"spencer"</code>, <code>"cr"</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>deff</code> calls one of <code>deffK</code>, <code>deffH</code>, <code>deffS</code>, or <code>deffCR</code> depending on the value of the <code>type</code> parameter. The Kish design effect is the ratio of the variance of an estimated mean in stratified simple random sampling without replacement (<em>stsrswor</em>) to the variance of the estimated mean in <em>srswor</em>, assuming that all stratum unit variances are equal. In that case, proportional allocation with equal weighting is optimal. deffK equals 1 + relvar(w) where relvar is relvariance of the vector of survey weights. This measure is not appropriate in samples where unequal weighting is more efficient than equal weighting.
</p>
<p>The Henry design effect is the ratio of the variance of the general regression (GREG) estimator of a total of <code class="reqn">y</code> to the variance of the estimated total in <em>srswr</em>. Calculations for the Henry <em>deff</em> are done as if the sample is selected in a single-stage and with replacement.  Varying selection probabilities can be used. The model for the GREG is assumed to be <code class="reqn">y = \alpha + \beta x + \epsilon</code>, i.e., the model has an intercept.
</p>
<p>The Spencer design effect is the ratio of the variance of the <em>pwr</em>-estimator of the total of <em>y</em>, assuming that a single-stage sample is selected with replacement, to the variance of the total estimated in <em>srswr</em>. Varying selection probabilities can be used.
</p>
<p>The Chen-Rust <em>deff</em> accounts for stratification, clustering, and unequal weights, but does not account for the use of any auxiliary data in the estimator of a mean. The Chen-Rust <em>deff</em> returned here is appropriate for stratified, two-stage sampling.</p>


<h3>Value</h3>

<p>Numeric design effect for types <code>kish</code>, <code>henry</code>, <code>spencer</code>. For type <code>cr</code> a list with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>strata components</code></td>
<td>
<p>Matrix with <em>deff</em>'s due to weighting, clustering, and stratification for each stratum</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall deff</code></td>
<td>
<p>Design effect for full sample accounting for weighting, clustering, and stratification</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Richard Valliant, Jill A. Dever, Frauke Kreuter
</p>


<h3>References</h3>

<p>Chen, S. and Rust, K. (2017). An Extension of Kish's Formula for Design Effects to Two- and Three-Stage Designs with Stratification. <em>Journal of Survey Statistics and Methodology</em>, 5(2), 111-130.
</p>
<p>Henry, K.A., and Valliant, R. (2015). A Design Effect Measure for Calibration Weighting in Single-stage Samples. <em>Survey Methodology</em>, 41, 315-331.
</p>
<p>Kish, L. (1965). <em>Survey Sampling</em>. New York: John Wiley &amp; Sons.
</p>
<p>Kish, L. (1992). Weighting for unequal Pi. <em>Journal of Official Statistics</em>, 8, 183-200.
</p>
<p>Park, I., and Lee, H. (2004). Design Effects for the Weighted Mean and Total Estimators under Complex Survey Sampling. <em>Survey Methodology</em>, 30, 183-193.
</p>
<p>Spencer, B. D. (2000). An Approximate Design Effect for Unequal Weighting When Measurements May Correlate With Selection Probabilities. Survey Methodology, 26, 137-138.
</p>
<p>Valliant, R., Dever, J., Kreuter, F. (2018, chap. 14). <em>Practical Tools for Designing and Weighting Survey Samples, 2nd edition</em>. New York: Springer.
</p>


<h3>See Also</h3>

<p><code>deffK</code>, <code>deffH</code>, <code>deffS</code>, <code>deffCR</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(reshape)      # has function that allows renaming variables
require(sampling)

set.seed(-500398777)
    # generate population using HMT function
pop.dat &lt;- as.data.frame(HMT())
mos &lt;- pop.dat$x
pop.dat$prbs.1d &lt;- mos / sum(mos)
    # select pps sample
n &lt;- 80
pk &lt;- pop.dat$prbs.1d
sam &lt;- UPrandomsystematic(pk)
sam &lt;- sam==1

sam.dat &lt;- pop.dat[sam, ]
dsgn.wts &lt;- 1/pk[sam]
deff(w=dsgn.wts, type="kish")
deff(w=dsgn.wts, y=sam.dat$y, p=sam.dat$prbs.1d, type="spencer")
deff(w=dsgn.wts, x=sam.dat$x, y=sam.dat$y, type="henry")


data(MDarea.popA)
Ni &lt;- table(MDarea.popA$TRACT)
m &lt;- 10
probi &lt;- m*Ni / sum(Ni)
    # select sample of clusters
set.seed(-780087528)
sam &lt;- cluster(data=MDarea.popA, clustername="TRACT", size=m, method="systematic",
                pik=probi, description=TRUE)
    # extract data for the sample clusters
samclus &lt;- getdata(MDarea.popA, sam)
samclus &lt;- rename(samclus, c("Prob" = "pi1"))
    # treat sample clusters as strata and select srswor from each
nbar &lt;- 4
s &lt;- strata(data = as.data.frame(samclus), stratanames = "TRACT",
            size = rep(nbar,m), method="srswor")
    # extracts the observed data
samdat &lt;- getdata(samclus,s)
samdat &lt;- rename(samdat, c("Prob" = "pi2"))
    # add a fake stratum ID
H &lt;- 2
nh &lt;- m * nbar / H
stratum &lt;- NULL
for (h in 1:H){
    stratum &lt;- c(stratum, rep(h,nh))
}
wt &lt;- 1/(samdat$pi1*samdat$pi2) * runif(m*nbar)
samdat &lt;- cbind(subset(samdat, select = -c(Stratum)), stratum, wt)
deff(w = samdat$wt, y=samdat$y2, strvar = samdat$stratum, clvar = samdat$TRACT, Wh=NULL, type="cr")
</code></pre>


</div>