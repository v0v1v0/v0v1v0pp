<div class="container">

<table style="width: 100%;"><tr>
<td>fit_trend</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit a Bayesian model to estimate population size trend</h2>

<h3>Description</h3>

<p>This function applies a Bayesian model to count series in order to infer
the population trend over time. This function only works on the output of
<code>format_data()</code> or <code>filter_series()</code>.
</p>
<p><strong>Important:</strong> This function uses <code>R2jags::jags()</code> and the
freeware <strong>JAGS</strong> (<a href="https://mcmc-jags.sourceforge.io/">https://mcmc-jags.sourceforge.io/</a>) must be
installed.
</p>
<p>There are two types of options: model options (argument <code>model_opts</code>) and
MCMC options (argument <code>mcmc_opts</code>).
</p>
<p><strong>A. Model options</strong>
</p>

<ul>
<li>
<p> a smoothing factor: the precision (the inverse of variance) of a normal
distribution centered on the current relative rate of increase r from which
the next candidate relative rate of increase (see below) is drawn.
The highest this number, the tighter the link between successive relative
rates of increase. The default <code>100</code> corresponds to a moderate link.
</p>
</li>
<li>
<p> a logical indicating whether the population growth must remain limited by
the species demographic potential (provided by the argument <code>rmax</code> in
<code>format_data()</code>).
</p>
</li>
</ul>
<p>The relative rate of increase is the change in log population size between
two dates. The quantity actually being modeled is the relative rate of
increase per unit of time (usually one date). This quantity reflects more
directly the prevailing conditions than the population size itself, which is
the reason why it has been chosen.
</p>
<p>When the second model option is set to <code>TRUE</code>, the candidate rate of
increase is compared to the maximum relative rate of increase
(obtained when using <code>format_data()</code>) and replaced by <code>rmax</code> if greater.
</p>
<p><strong>B. MCMC options</strong>
</p>
<p>Classical Markov chain Monte Carlo (MCMC) settings (see argument <code>mcmc_opts</code>
below).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit_trend(
  data,
  model_opts = list(100, TRUE),
  mcmc_opts = list(ni = 50000, nt = 3, nb = 10000, nc = 2),
  path = "."
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a named <code>list</code>. The output of <code>format_data()</code> or
<code>filter_series()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_opts</code></td>
<td>
<p>a <code>list</code> of two vectors. The model smoothing factor
(<code>numeric</code>) and a <code>logical</code> indicating if the parameter <strong>r</strong> must be
limited by <code>rmax</code> (<code>TRUE</code>) or not (<code>FALSE</code>). If this second parameter is
<code>TRUE</code>, the argument <code>rmax</code> cannot be <code>NULL</code> unless species are listed in
<code>popbayes</code> (in <code>species_info</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc_opts</code></td>
<td>
<p>a <code>list</code> containing the number of iterations (<code>ni</code>), the
thinning factor (<code>nt</code>), the length of burn in (<code>nb</code>), i.e. the number of
iterations to discard at the beginning, and the number of chains (<code>nc</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>a <code>character</code> string. The directory to save BUGS outputs (the
same as in <code>format_data()</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An n-element <code>list</code> (where <code>n</code> is the number of count series). Each
element of the list is a BUGS output as provided by JAGS (also written
in the folder <code>path</code>).
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Load Garamba raw dataset ----
file_path &lt;- system.file("extdata", "garamba_survey.csv", 
                         package = "popbayes")
                         
garamba &lt;- read.csv(file = file_path)

## Create temporary folder ----
temp_path &lt;- tempdir()

## Format dataset ----
garamba_formatted &lt;- popbayes::format_data(
  data              = garamba, 
  path              = temp_path,
  field_method      = "field_method",
  pref_field_method = "pref_field_method",
  conversion_A2G    = "conversion_A2G",
  rmax              = "rmax")

## Get data for Alcelaphus buselaphus at Garamba only ----
a_buselaphus &lt;- popbayes::filter_series(garamba_formatted, 
                                        location = "Garamba",
                                        species  = "Alcelaphus buselaphus")
                                        

## Fit population trend (requires JAGS) ----
a_buselaphus_mod &lt;- popbayes::fit_trend(a_buselaphus, path = temp_path)

## Check for convergence ----
popbayes::diagnostic(a_buselaphus_mod, threshold = 1.1)

## Plot estimated population trend ----
popbayes::plot_trend(series = "garamba__alcelaphus_buselaphus", 
                     path   = temp_path)

## Plot MCMC traceplot ----
R2jags::traceplot(a_buselaphus_mod[[1]], ask = TRUE)

</code></pre>


</div>