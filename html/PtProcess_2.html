<div class="container">

<table style="width: 100%;"><tr>
<td>Change Log</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Changes Made to the Package</h2>

<h3>Description</h3>

<p>This page contains a listing of recent changes made to functions, and known general problems.
</p>


<h3>Recent Changes</h3>


<ol>
<li>
<p> Version 3 contains major changes, and code that worked in Version 2 will no longer work in Version 3. The models included in Version 2 are also contained in Version 3, but the framework has been extended so that the original models can now contain a variety of mark distributions. This has been achieved by giving a more general structure and utilising the object orientated aspects of the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> language. <em>Examples are given below that show how models were defined in Version 2 and how the corresponding models are now defined in Version 3.</em> (28 Apr 2008)
</p>
</li>
<li>
<p> Naming changes to the <code>*.cif</code> functions. In Version 2, these were referred to as “conditional intensity functions”, which is really a slightly more general class. In keeping with Daley &amp; Vere-Jones (2003) we now call them ground intensity functions, with a suffix of “gif”. Further, the dot has been replaced by an underscore, e.g. <code>etas.cif</code> to <code>etas_gif</code>. This is to lessen the possibility of future conflicts with object orientated naming conventions in the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> language. (28 Apr 2008)
</p>
</li>
<li>
<p> Arguments <code>eval.pts</code> and <code>t.plus</code> in the ground intensity functions have been renamed to <code>evalpts</code> and <code>tplus</code>, respectively. This is to lessen the possibility of future conflicts with object orientated naming conventions in the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> language. (28 Apr 2008)
</p>
</li>
<li> <p><code>logLik</code>: the log-likelihood calculated in package Versions before Version 3 did not have the sum over the mark density term (see topic <code>logLik</code>, under “Details”). This term can also be excluded in this Version of the package by placing <code>NULL</code> for the mark density in the <code>mpp</code> object, see example below. (28 Apr 2008)
</p>
</li>
<li>
<p> Version 2 had a framework to assign prior densities to the estimated parameters. This has not been retained in Version 3. However, some of the features like holding a parameter at a fixed value, and restricting it to an open or closed interval can be achieved in Version 3; see <code>neglogLik</code> for further details. (28 Apr 2008)
</p>
</li>
<li> <p><code>neglogLik</code>: the format of this function has been changed to be consistent with that in package <span class="pkg">HiddenMarkov</span>. Argument <code>updatep</code> renamed as <code>pmap</code>. (07 Aug 2008)
</p>
</li>
<li> <p><code>simulate</code>: manual page revised to include more information about controlling the length of the simulated series. (18 Nov 2008)
</p>
</li>
<li> <p><code>mpp</code>: example modified due to warning messages caused by negative <code class="reqn">\lambda_g(t|{\cal H}_t)</code>. (18 Nov 2008)
</p>
</li>
<li> <p><code>marks</code>: manual page revised to include more information. (18 Nov 2008)
</p>
</li>
<li> <p><code>mpp</code>: fuller description to argument <code>marks</code> on manual page. (19 Nov 2008)
</p>
</li>
<li> <p><code>Phuket</code>: new dataset added. (4 Dec 2008)
</p>
</li>
<li> <p><code>linksrm_gif</code>, <code>marks</code>: remove some LaTeX specific formatting to be compatible with <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> 2.9.0. (26 Jan 2009)
</p>
</li>
<li> <p><code>Phuket</code>: clarify magnitude scale used in the dataset. (11 Jul 2009)
</p>
</li>
<li>
<p> Attribute <code>type</code> is no longer required on the <code>gif</code> functions, removed. (7 Oct 2009)
</p>
</li>
<li> <p><code>logLik</code>, <code>neglogLik</code>: Parallel processing support, using package <span class="pkg">snow</span>, has been added. (8 Oct 2009)
</p>
</li>
<li> <p><code>plot</code>: Correct hyperlink to generic plot function. (10 Oct 2009)
</p>
</li>
<li> <p><code>etas_normal0</code>: New function. Test version of a spatial ETAS conditional intensity function. (12 Oct 2009)
</p>
</li>
<li> <p><code>logLik</code>: Fixed bug when using parallel processing on only two nodes. (22 Oct 2009)
</p>
</li>
<li>
<p> Tidied HTML representation of equations in manual pages. Removal of “synopsis” on manual pages of functions with multiple forms of usage. (26 Jan 2010)
</p>
</li>
<li> <p><code>logLik.mpp</code>, <code>summary.mpp</code>: Changed to <code>inherits</code> to determine class. (27 Jan 2010)
</p>
</li>
<li> <p><code>Phuket</code>: Additional data, until the beginning of 2009, have been added. The magnitude is now the maximum of the body wave and surface wave magnitudes, <code class="reqn">m_b</code> and <code class="reqn">M_s</code>, respectively. Earlier it was simply <code class="reqn">m_b</code>. (01 Feb 2010)
</p>
</li>
<li> <p><code>simulate.linksrm</code>, <code>simulate.mpp</code>, <code>logLik.mpp</code>: Inconsistency in nomenclature between “mark” and “marks”, will standardise on the plural. (07 May 2010)
</p>
</li>
<li> <p><code>simulate.mpp</code>: Two bugs: <br><code>use &lt;- (data[, "time"] &lt; TT[1])</code> changed to <code>use &lt;- (data[, "time"] &lt;= TT[1])</code>, <br>
and <code>else data &lt;- data[use, c("time", "magnitude")]</code> changed to <br><code>else data &lt;- data[use, ]</code>. (18 Jun 2010)
</p>
</li>
<li> <p><code>etas_normal0</code>: Errors in some terms involving <code>beta</code>. (18 Jun 2010)
</p>
</li>
<li>
<p> Minor citation and reference inclusion changes to manual pages. (19 Jul 2010)
</p>
</li>
<li> <p><code>simulate.mpp</code>: Bug fix on 18 June 2010 induced another bug;<br><code>data &lt;- rbind(data, newevent)</code> changed to<br><code>data &lt;- rbind(data[, names(newevent)], newevent)</code>. (11 Dec 2010)
</p>
</li>
<li>
<p> Implement very basic NAMESPACE. (5 Nov 2011)
</p>
</li>
<li>
<p> List functions explicitly in NAMESPACE; “<code>LazyData: no</code>” and “<code>ZipData: no</code>” in DESCRIPTION file. (9 Dec 2011)
</p>
</li>
<li> <p><code>logLik.mpp</code>: Enable one to specify the relative CPU speeds of the nodes when parallel processing. (9 Dec 2011)
</p>
</li>
<li> <p><code>mpp</code> and <code>etas_normal0</code>: Restrict the number of iterations in examples on manual pages to minimise time during package checks. (13 Dec 2011)
</p>
</li>
<li> <p><code>residuals</code> and <code>linksrm</code>: Include example using cusum of residuals on manual page. (15 Dec 2011)
</p>
</li>
<li> <p><code>dpareto</code>, <code>dtappareto</code>, <code>ltappareto</code> (etc): Include parameter consistency checks. (6 Jan 2014)
</p>
</li>
<li> <p><code>etas_gif</code>: Documentation example error: <code>marks=list(rmagn_mark, rmagn_mark)</code> should be <code>marks=list(dmagn_mark, NULL)</code>. (23 Jan 2014)
</p>
</li>
<li> <p><code>linksrm1_gif</code>: Function deleted, alternative discussed on manual page of <code>linksrm_gif</code>. (19 Mar 2014)
</p>
</li>
<li>
<p> Correct html problem in ‘<span class="file">inst/doc/index.html</span>’. (14 Aug 2014)
</p>
</li>
<li> <p><code>logLik.mpp</code>: Call to <code>clusterApply</code> changed to <code>snow::clusterApply</code>. (20 Aug 2014)
</p>
</li>
<li> <p><code>logLik.mpp</code>: The package <span class="pkg">snow</span> has been superseded by <span class="pkg">parallel</span>. Change <code>snow</code> to <code>parallel</code>, also in file ‘<span class="file">DESCRIPTION</span>’. (15 Oct 2014)
</p>
</li>
<li> <p><code>makeSOCKcluster</code>: This function is in <span class="pkg">snow</span> but not in <span class="pkg">parallel</span>. This function points to the closest eqivalent in <span class="pkg">parallel</span>, <code>makePSOCKcluster</code>. <code>makeSOCKcluster</code> will eventually become deprecated. Was added to the export list in file ‘<span class="file">NAMESPACE</span>’ too. (15 Oct 2014)
</p>
</li>
<li> <p><code>logLik.mpp</code>, <code>neglogLik</code>: Update consistent with changes from <span class="pkg">snow</span> to <span class="pkg">parallel</span>. (17 Oct 2014)
</p>
</li>
<li> <p><code>logLik.mpp</code>: Change <code>require(parallel)</code> to <code>requireNamespace("parallel")</code>. (21 Jan 2015)
</p>
</li>
<li>
<p> Added to NAMESPACE: <br><code>importFrom(graphics, plot)</code> <br><code>importFrom(stats, dexp, integrate, logLik, pnorm,</code> <br><code>           qexp, rexp, runif, simulate, ts)</code> <br>
(03 Jul 2015)
</p>
</li>
<li> <p><code>PtProcess</code>: Add DOI to some references, rename topic to appear first in table of contents. (16 Oct 2015)
</p>
</li>
<li> <p><code>plot.mpp</code>: Activate argument <code>ylim</code>. (17 Aug 2016)
</p>
</li>
<li> <p><code>etas_normal0</code>: This has been removed. Adding a spatial dimension requires more generality in other package functions like <code>logLik.mpp</code>. For a reasonable amount of generality, it requires the addition of new model class, currently under development. (01 Sep 2016)
</p>
</li>
<li> <p><code>simulate.mpp</code>: Did not allow argument <code>marks = list(NULL, NULL)</code> in <code>mpp</code> object. <br><code>simulate.mpp</code> now tests to see if <code>NULL</code> marks. (17 Nov 2017)
</p>
</li>
<li> <p><code>fourier_gif</code>: Example added on manual page with <code>NULL</code> marks. (17 Nov 2017)
</p>
</li>
<li> <p><code>Phuket</code>: Hyperlink to data source updated, others updated to https where possible. (24 Apr 2021)
</p>
</li>
</ol>
<h3>Future Development</h3>


<ol>
<li>
<p> Currently spatial versions of the ETAS model are being written and tested.
</p>
</li>
<li>
<p> In the model object, allow one to alternatively specify the <code>name</code> of the gif function.
</p>
</li>
<li>
<p> Function <code>linksrm_gif</code>: Use of <code>St1</code> and <code>St2</code>. Is there a tidier way? Also utilise this feature in <code>srm_gif</code>.
</p>
</li>
<li>
<p> Want a generic function, possibly called <code>forecast</code>, to produce probability forecasts. This would be based on simulating empirical probability distributions.
</p>
</li>
<li>
<p> Want a function like <code>linksrm_convert</code> to map between the two main parametrisations of the ETAS model.
</p>
</li>
<li>
<p> Add general forms of the truncated exponential and gamma distributions as marks for the magnitude of the event.
</p>
</li>
<li>
<p> A tidy way to pass the values of the <code>gif</code> function into the mark distributions, if required.
</p>
</li>
</ol>
<h3>References</h3>

<p>Cited references are listed on the PtProcess manual page.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#    SRM: magnitude is iid exponential with bvalue=1
#    simulate and calculate the log-likelihood

TT &lt;- c(0, 1000)
bvalue &lt;- 1
params &lt;- c(-1.5, 0.01, 0.8, bvalue*log(10))

#   --- Old Method ---
# x &lt;- pp.sim(NULL, params[1:3], srm.cif, TT, seed=5, magn.sim=1)
# print(pp.LL(x, srm.cif, params[1:3], TT))
# [1] -601.3941

#   --- New Method, no mark density ---
x1 &lt;- mpp(data=NULL,
          gif=srm_gif,
          marks=list(NULL, rexp_mark),
          params=params,
          gmap=expression(params[1:3]),
          mmap=expression(params[4]),
          TT=TT)
x1 &lt;- simulate(x1, seed=5)
print(logLik(x1))

#  An advantage of the object orientated format is that it
#  simplifies further analysis, e.g. plot intensity function:
plot(x1)
#  plot the residual process:
plot(residuals(x1))

#---------------------------------------------------
#    SRM: magnitude is iid exponential with bvalue=1
#    simulate then estimate parameters from data

#   --- Old Method ---
# TT &lt;- c(0, 1000)
# bvalue &lt;- 1
# params &lt;- c(-2.5, 0.01, 0.8)
#
# x &lt;- pp.sim(NULL, params, srm.cif, TT, seed=5, magn.sim=1)
#
# posterior &lt;- make.posterior(x, srm.cif, TT)
#
# neg.posterior &lt;- function(params){
#     x &lt;- -posterior(params)
#     if (is.infinite(x) | is.na(x)) return(1e15)
#     else return(x)
# }
#
# z &lt;- nlm(neg.posterior, params, typsize=abs(params),
#          iterlim=1000, print.level=2)
#
# print(z$estimate)
# [1] -2.83900091  0.01242595  0.78880647

#   --- New Method, no mark density ---
#   maximise only SRM parameters (like old method)

TT &lt;- c(0, 1000)
bvalue &lt;- 1
params &lt;- c(-2.5, 0.01, 0.8, bvalue*log(10))

x1 &lt;- mpp(data=NULL,
          gif=srm_gif,
          marks=list(dexp_mark, rexp_mark),
          params=params,
          gmap=expression(params[1:3]),
          mmap=expression(params[4]),
          TT=TT)
#  note that dexp_mark above is not used below
#  and could alternatively be replaced by NULL

x1 &lt;- simulate(x1, seed=5)

#  maximise only SRM parameters
onlysrm &lt;- function(y, p){
    #  maps srm parameters into model object
    #  the exp rate for magnitudes is unchanged
    y$params[1:3] &lt;- p
    return(y)
}

params &lt;- c(-2.5, 0.01, 0.8)

z1 &lt;- nlm(neglogLik, params, object=x1, pmap=onlysrm,
          print.level=2, iterlim=500, typsize=abs(params))
print(z1$estimate)
</code></pre>


</div>