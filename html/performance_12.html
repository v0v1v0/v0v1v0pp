<div class="container">

<table style="width: 100%;"><tr>
<td>check_dag</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Check correct model adjustment for identifying causal effects</h2>

<h3>Description</h3>

<p>The purpose of <code>check_dag()</code> is to build, check and visualize
your model based on directed acyclic graphs (DAG). The function checks if a
model is correctly adjusted for identifying specific relationships of
variables, especially directed (maybe also "causal") effects for given
exposures on an outcome. In case of incorrect adjustments, the function
suggests the minimal required variables that should be adjusted for (sometimes
also called "controlled for"), i.e. variables that <em>at least</em> need to be
included in the model. Depending on the goal of the analysis, it is still
possible to add more variables to the model than just the minimally required
adjustment sets.
</p>
<p><code>check_dag()</code> is a convenient wrapper around <code>ggdag::dagify()</code>,
<code>dagitty::adjustmentSets()</code> and <code>dagitty::adjustedNodes()</code> to check correct
adjustment sets. It returns a <strong>dagitty</strong> object that can be visualized with
<code>plot()</code>. <code>as.dag()</code> is a small convenient function to return the
dagitty-string, which can be used for the online-tool from the
dagitty-website.
</p>


<h3>Usage</h3>

<pre><code class="language-R">check_dag(
  ...,
  outcome = NULL,
  exposure = NULL,
  adjusted = NULL,
  latent = NULL,
  effect = c("all", "total", "direct"),
  coords = NULL
)

as.dag(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>One or more formulas, which are converted into <strong>dagitty</strong> syntax.
First element may also be model object. If a model objects is provided, its
formula is used as first formula, and all independent variables will be used
for the <code>adjusted</code> argument. See 'Details' and 'Examples'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>Name of the dependent variable (outcome), as character string.
Must be a valid name from the formulas. If not set, the first dependent
variable from the formulas is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposure</code></td>
<td>
<p>Name of the exposure variable (as character string), for
which the direct and total causal effect on the <code>outcome</code> should be checked.
Must be a valid name from the formulas. If not set, the first independent
variable from the formulas is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjusted</code></td>
<td>
<p>A character vector with names of variables that are adjusted
for in the model. If a model object is provided in <code>...</code>, any values in
<code>adjusted</code> will be overwritten by the model's independent variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>latent</code></td>
<td>
<p>A character vector with names of latent variables in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effect</code></td>
<td>
<p>Character string, indicating which effect to check. Can be
<code>"all"</code> (default), <code>"total"</code>, or <code>"direct"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>A list with two elements, <code>x</code> and <code>y</code>, which both are named
vectors of numerics. The names correspond to the variable names in the DAG,
and the values for <code>x</code> and <code>y</code> indicate the x/y coordinates in the plot.
See 'Examples'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>check_dag</code>, as returned by <code>check_dag()</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>check_dag</code>, which can be visualized with <code>plot()</code>.
The returned object also inherits from class <code>dagitty</code> and thus can be used
with all functions from the <strong>ggdag</strong> and <strong>dagitty</strong> packages.
</p>


<h3>Specifying the DAG formulas</h3>

<p>The formulas have following syntax:
</p>

<ul>
<li>
<p> One-directed paths: On the <em>left-hand-side</em> is the name of the variables
where causal effects point to (direction of the arrows, in dagitty-language).
On the <em>right-hand-side</em> are all variables where causal effects are assumed
to come from. For example, the formula <code>Y ~ X1 + X2</code>, paths directed from
both <code>X1</code> and <code>X2</code> to <code>Y</code> are assumed.
</p>
</li>
<li>
<p> Bi-directed paths: Use <code style="white-space: pre;">⁠~~⁠</code> to indicate bi-directed paths. For example,
<code>Y ~~ X</code> indicates that the path between <code>Y</code> and <code>X</code> is bi-directed, and
the arrow points in both directions. Bi-directed paths often indicate
unmeasured cause, or unmeasured confounding, of the two involved variables.
</p>
</li>
</ul>
<h3>Minimally required adjustments</h3>

<p>The function checks if the model is correctly adjusted for identifying the
direct and total effects of the exposure on the outcome. If the model is
correctly specified, no adjustment is needed to estimate the direct effect.
If the model is not correctly specified, the function suggests the minimally
required variables that should be adjusted for. The function distinguishes
between direct and total effects, and checks if the model is correctly
adjusted for both. If the model is cyclic, the function stops and suggests
to remove cycles from the model.
</p>


<h3>Direct and total effects</h3>

<p>The direct effect of an exposure on an outcome is the effect that is not
mediated by any other variable in the model. The total effect is the sum of
the direct and indirect effects. The function checks if the model is correctly
adjusted for identifying the direct and total effects of the exposure on the
outcome.
</p>


<h3>Why are DAGs important - the Table 2 fallacy</h3>

<p>Correctly thinking about and identifying the relationships between variables
is important when it comes to reporting coefficients from regression models
that mutually adjust for "confounders" or include covariates. Different
coefficients might have different interpretations, depending on their
relationship to other variables in the model. Sometimes, a regression
coefficient represents the direct effect of an exposure on an outcome, but
sometimes it must be interpreted as total effect, due to the involvement
of mediating effects. This problem is also called "Table 2 fallacy"
(<em>Westreich and Greenland 2013</em>). DAG helps visualizing and thereby focusing
the relationships of variables in a regression model to detect missing
adjustments or over-adjustment.
</p>


<h3>References</h3>


<ul>
<li>
<p> Rohrer, J. M. (2018). Thinking clearly about correlations and causation:
Graphical causal models for observational data. Advances in Methods and
Practices in Psychological Science, 1(1), 27–42. <a href="https://doi.org/10.1177/2515245917745629">doi:10.1177/2515245917745629</a>
</p>
</li>
<li>
<p> Westreich, D., &amp; Greenland, S. (2013). The Table 2 Fallacy: Presenting and
Interpreting Confounder and Modifier Coefficients. American Journal of
Epidemiology, 177(4), 292–298. <a href="https://doi.org/10.1093/aje/kws412">doi:10.1093/aje/kws412</a>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
# no adjustment needed
check_dag(
  y ~ x + b,
  outcome = "y",
  exposure = "x"
)

# incorrect adjustment
dag &lt;- check_dag(
  y ~ x + b + c,
  x ~ b,
  outcome = "y",
  exposure = "x"
)
dag
plot(dag)

# After adjusting for `b`, the model is correctly specified
dag &lt;- check_dag(
  y ~ x + b + c,
  x ~ b,
  outcome = "y",
  exposure = "x",
  adjusted = "b"
)
dag

# use specific layout for the DAG
dag &lt;- check_dag(
  score ~ exp + b + c,
  exp ~ b,
  outcome = "score",
  exposure = "exp",
  coords = list(
    # x-coordinates for all nodes
    x = c(score = 5, exp = 4, b = 3, c = 3),
    # y-coordinates for all nodes
    y = c(score = 3, exp = 3, b = 2, c = 4)
  )
)
plot(dag)

# Objects returned by `check_dag()` can be used with "ggdag" or "dagitty"
ggdag::ggdag_status(dag)

# Using a model object to extract information about outcome,
# exposure and adjusted variables
data(mtcars)
m &lt;- lm(mpg ~ wt + gear + disp + cyl, data = mtcars)
dag &lt;- check_dag(
  m,
  wt ~ disp + cyl,
  wt ~ am
)
dag
plot(dag)

</code></pre>


</div>