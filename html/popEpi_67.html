<div class="container">

<table style="width: 100%;"><tr>
<td>sirspline</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate splines for SIR or SMR</h2>

<h3>Description</h3>

<p>Splines for standardised incidence or mortality ratio. A useful 
tool to e.g. check whether a constant SIR can be assumed for all calendar periods,
age groups or follow-up intervals. Splines can be fitted for these time dimensions
separately or in the same model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sirspline(
  coh.data,
  coh.obs,
  coh.pyrs,
  ref.data = NULL,
  ref.obs = NULL,
  ref.pyrs = NULL,
  ref.rate = NULL,
  subset = NULL,
  print = NULL,
  adjust = NULL,
  mstate = NULL,
  spline,
  knots = NULL,
  reference.points = NULL,
  dependent.splines = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coh.data</code></td>
<td>
<p>cohort data with observations and at risk time variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coh.obs</code></td>
<td>
<p>variable name for observed cases</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coh.pyrs</code></td>
<td>
<p>variable name for person-years in cohort data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.data</code></td>
<td>
<p>aggregated population data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.obs</code></td>
<td>
<p>variable name for observed cases</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.pyrs</code></td>
<td>
<p>variable name for person-years in population data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.rate</code></td>
<td>
<p>population rate observed/expected. This overwrites the parameters
<code>ref.pyrs</code> and <code>ref.obs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>logical condition to subset <code>coh.data</code> before any computations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print</code></td>
<td>
<p>variable names for which to estimate SIRs/SMRs and 
associated splines separately</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>variable names for adjusting the expected cases</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mstate</code></td>
<td>
<p>set column names for cause specific observations. Relevant only
when coh.obs length is two or more. See help for <code>sir</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spline</code></td>
<td>
<p>variable name(s) for the splines</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>number knots (vector),  pre-defined knots (list of vectors) or for optimal number of knots left NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference.points</code></td>
<td>
<p>fixed reference values for rate ratios. If left <code>NULL</code>
the smallest value is the reference point (where SIR = 1). 
Ignored if <code>dependent.splines = FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dependent.splines</code></td>
<td>
<p>logical; if TRUE, all splines are fitted in same model.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <code>sir</code> for help on SIR/SMR estimation in general; usage of splines
is discussed below.
</p>
<p><strong>The spline variables</strong>
</p>
<p>The model can include one, two or three splines variables.
Variables can be included in the same model selecting <code>dependent.splines = TRUE</code>
and SIR ratios are calculated (first one is the SIR, others SIR ratios). 
Reference points vector can be set via <code>reference.points</code>
where first element of the vector is the reference point for first ratio.
</p>
<p>Variable(s) to fit splines are given as a vector in argument <code>spline</code>.
Order will affect the results.
</p>
<p><strong>dependent.splines</strong> 
</p>
<p>By default dependent.splines is FALSE and all splines are fitted in separate models. 
If TRUE, the first variable in <code>spline</code> is a function of a SIR and other(s) are ratios.
</p>
<p><strong>knots</strong>
</p>
<p>There are three options to set knots to splines:
</p>
<p>Set the number of knots for each spline variable with a <strong>vector</strong>. 
The knots are automatically placed to the quantiles of observed cases in cohort data. 
The first and last knots are always the maximum and minimum values, so knot
value needs to be at least two.
</p>
<p>Predefined knot places can be set with a <strong>list</strong> of vectors.
The vector for each spline in the list specifies the knot places. The lowest 
and the largest values are the boundary knots and these should be checked beforehand.
</p>
<p>If <code>knots</code> is left <strong>NULL</strong>, the model searches the optimal number 
of knots by model AIC by fitting models iteratively from 2 to 15 knots and 
the one with smallest AIC is selected.
If <code>dependent.splines = TRUE</code>, the number of knots is searched by fitting each spline
variable separately.
</p>
<p><strong>print</strong>
</p>
<p>Splines can be stratified by the levels of variable given in <code>print</code>. If 
<code>print</code> is a vector, only the first variable is accounted for. The knots 
are placed globally for all levels of <code>print</code>. This also ensures that the likelihood 
ratio test is valid.
Splines are also fitted independently for each level of <code>print</code>.
This allows for searching interactions, e.g. by fitting spline for period 
(<code>splines='period'</code>) for each age group (<code>print = 'agegroup'</code>).
</p>
<p><strong>p-values</strong>
</p>
<p>The output p-value is a test of whether the splines are equal (homogenous)
at different levels of <code>print</code>. 
The test is based on the likelihood ratio test, where the full model 
includes <code>print</code> and is 
compared to a null model without it.
When <code>(dependent.splines = TRUE)</code> the p-value returned is a global p-value.
Otherwise the p-value is spline-specific.
</p>


<h3>Value</h3>

<p>A list of data.frames and vectors.
Three spline estimates are named as <code>spline.est.A/B/C</code> and the corresponding values
in <code>spline.seq.A/B/C</code> for manual plotting
</p>


<h3>Author(s)</h3>

<p>Matti Rantanen, Joonas Miettinen
</p>


<h3>See Also</h3>

<p><code>splitMulti</code> 
<a href="../doc/sir.html">A SIR calculation vignette</a>
</p>
<p>Other sir functions: 
<code>lines.sirspline()</code>,
<code>plot.sirspline()</code>,
<code>sir()</code>,
<code>sir_exp()</code>,
<code>sir_ratio()</code>
</p>
<p>Other main functions: 
<code>Surv()</code>,
<code>rate()</code>,
<code>relpois()</code>,
<code>relpois_ag()</code>,
<code>sir()</code>,
<code>survmean()</code>,
<code>survtab()</code>,
<code>survtab_ag()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## for examples see: vignette('sir')

</code></pre>


</div>