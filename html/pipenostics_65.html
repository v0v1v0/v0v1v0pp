<div class="container">

<table style="width: 100%;"><tr>
<td>traceline</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Trace thermal-hydraulic regime for linear segment of district
heating network</h2>

<h3>Description</h3>

<p>Trace values of thermal-hydraulic regime (temperature, pressure,
flow_rate, and other) along the adjacent linear segments of pipeline using
user-provided values of <em>specific heat loss power</em>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">traceline(
  temperature = 130,
  pressure = mpa_kgf(6),
  flow_rate = 250,
  g = 0,
  d = 700,
  len = c(600, 530, 300, 350),
  loss = c(348, 347.1389, 346.3483, 345.861),
  roughness = 0.006,
  inlet = 0,
  outlet = 0,
  elev_tol = 0.1,
  method = "romeo",
  forward = TRUE,
  absg = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>temperature</code></td>
<td>
<p><em>Traced thermal hydraulic regime</em>. Sensor-measured temperature of heat
carrier (water)
inside the pipe sensor-measured at the inlet
(forward tracing) or at the outlet (backward tracing) of path, [<em>째C</em>].
Type: <code>assert_number</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pressure</code></td>
<td>
<p><em>Traced thermal hydraulic regime</em>. Sensor-measured
<a href="https://en.wikipedia.org/wiki/Pressure_measurement#Absolute">absolute
pressure</a> of heat carrier (water) sensor-measured at the inlet
(forward tracing) or at the outlet (backward tracing) of path, [<em>MPa</em>].
Type: <code>assert_number</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flow_rate</code></td>
<td>
<p><em>Traced thermal hydraulic regime</em>. Amount of heat carrier (water)
sensor-measured at the inlet (forward tracing) or at the outlet (backward
tracing) of path, [<em>ton/hour</em>]. Type: <code>assert_number</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g</code></td>
<td>
<p>amount of heat carrier discharge to network for each pipe segment in the
tracing path enumerated along the direction of flow. If flag <code>absg</code>
is <code>TRUE</code> then they treat argument <code>g</code> as absolute value in
[<em>ton/hour</em>], otherwise they do as percentage of flow_rate in the
pipe segment.
Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>internal diameters of subsequent pipes in tracing path that are enumerated
along the direction of flow, [<em>mm</em>].
Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>len</code></td>
<td>
<p>length of subsequent pipes in tracing path that are enumerated
along the direction of flow, [<em>m</em>].
Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loss</code></td>
<td>
<p>user-provided value of <em>specific heat loss</em> power for each pipe in tracing
path enumerated along the direction of flow, [<em>kcal/m/h</em>]. Values of the
argument can be obtained experimentally, or taken from regulatory documents.
Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roughness</code></td>
<td>
<p>roughness of internal wall for each pipe in tracing path enumerated along
the direction of flow, [<em>m</em>]. Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inlet</code></td>
<td>
<p>elevation of pipe inlet for each pipe in tracing path enumerated along
the direction of flow, [<em>m</em>]. Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outlet</code></td>
<td>
<p>elevation of pipe outlet for each pipe in tracing path enumerated along
the direction of flow, [<em>m</em>]. Type: <code>assert_double</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elev_tol</code></td>
<td>
<p>maximum allowed discrepancy between adjacent outlet and inlet elevations of
two subsequent pipes in the traced path, [<em>m</em>].
Type: <code>assert_number</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>method of determining <em>Darcy friction factor</em>
</p>

<ul>
<li> <p><code>romeo</code>
</p>
</li>
<li> <p><code>vatankhan</code>
</p>
</li>
<li> <p><code>buzelli</code>
</p>
</li>
</ul>
<p>Type: <code>assert_choice</code>. For more details see <code>dropp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forward</code></td>
<td>
<p>tracing direction flag: is it a forward direction of tracing?
If <code>FALSE</code> the backward tracing is performed.
Type: <code>assert_flag</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>absg</code></td>
<td>
<p>Whether argument <code>g</code> (amount of heat carrier discharge to network) is an
absolute value in [<em>ton/hour</em>] (<code>TRUE</code>) or is it a percentage of
flow rate in the pipe segment (<code>FALSE</code>)?
Type: <code>assert_flag</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>They consider only simple tracing paths which do not contain rings and any
kind of parallelization. At the same time bidirectional (forward and
backward) tracing is possible in accordance with sensor position. They also
may consider discharges to network at the inlet of each pipeline segment
as an approximation of actual forks of flows. Relevant illustration of
adopted assumptions for 4-segment tracing path is depicted on the next
figure.
</p>
<p><img src="../help/figures/regtrace.png" alt="regtrace.png"></p>
<p>They make additional check for consistency of <code>inlet</code> and <code>outlet</code>
values for subsequent pipe segments. Discrepancy of appropriate elevations
cannot be more than <code>elev_tol</code>.
</p>
<p>Since inner diameter of the pipe is used as input, the the thickness of the
pipe wall additionally considered in heat flux calculations. Pipe wall thickness
is derived from pipe diameter using
<a href="https://docs.cntd.ru/document/1200174717">GOST 30732</a> specifications.
</p>


<h3>Value</h3>

<p><code>list</code> containing results (detailed log) of tracing for each pipe
in tracing path enumerated along the direction of flow:
</p>

<dl>
<dt><code>temperature</code></dt>
<dd>
<p><em>Traced thermal hydraulic regime</em>. Traced temperature of heat
carrier (water), [<em>째C</em>]. Type: <code>assert_double</code>.
</p>
</dd>
<dt><code>pressure</code></dt>
<dd>
<p><em>Traced thermal hydraulic regime</em>. Traced pressure of heat
carrier (water) for each pipe in tracing path enumerated along the
direction of flow, [<em>MPa</em>]. Type: <code>assert_double</code>.
</p>
</dd>
<dt><code>flow_rate</code></dt>
<dd>
<p><em>Traced thermal hydraulic regime</em>. Traced flow rate of heat
carrier (water) for each pipe in tracing path enumerated along the
direction of flow, [<em>ton/hour</em>]. Type: <code>assert_double</code>.
</p>
</dd>
<dt><code>loss</code></dt>
<dd>
<p>User-provided specific heat
loss power for each pipe in tracing path enumerated along the direction
of flow, [<em>kcal/m/h</em>], - copy of input. Type: <code>assert_double</code>.
</p>
</dd>
<dt><code>flux</code></dt>
<dd>
<p>Heat flux for each pipe
in tracing path enumerated along the direction of flow, [<em>W/m^2</em>].
Type: <code>assert_double</code>.
</p>
</dd>
<dt><code>Q</code></dt>
<dd>
<p>Heat loss for each
pipe in tracing path enumerated along the direction of flow per day,
[<em>kcal</em>]. Type: <code>assert_double</code>.
</p>
</dd>
</dl>
<p>Type: <code>assert_list</code>.
</p>


<h3>See Also</h3>

<p>Other Regime tracing: 
<code>m325tracebw()</code>,
<code>m325tracefw()</code>,
<code>m325traceline()</code>,
<code>tracebw()</code>,
<code>tracefw()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> library(pipenostics)

# Consider 4-segment tracing path.
# First, let sensor readings for forward tracing:
t_fw &lt;- 130  # [째C]
p_fw &lt;- mpa_kgf(6)*all.equal(.588399, mpa_kgf(6))  # [MPa]
g_fw &lt;- 250  # [ton/hour]

# Let discharges to network for each pipeline segment are somehow determined as
discharges &lt;- seq(0, 30, 10)  # [ton/hour]

# Experimentally obtained values of specific heat loss power are
actual_loss &lt;- c(348.0000, 347.1389, 346.3483, 345.8610)

# Then the calculated regime (red squares) for forward tracing is
regime_fw &lt;- traceline(t_fw, p_fw, g_fw, discharges, loss = actual_loss, forward = TRUE)
print(regime_fw)

# $temperature
# [1] 129.1799 128.4269 127.9628 127.3367
#
# $pressure
# [1] 0.5878607 0.5874226 0.5872143 0.5870330
#
# $flow_rate
# [1] 250 240 220 190
#
# $loss
# [1] 348.0000 347.1389 346.3483 345.8610
#
# $flux
# [1] 181.9600 181.5097 181.0963 180.8415
#
# $Q
# [1] 5011200 4415607 2493707 2905232


# Next consider values of traced regime as sensor readings for backward tracing:
t_bw &lt;- 127.3367  # [째C]
p_bw &lt;- .5870330  # [MPa]
g_bw &lt;- 190  # [ton/hour]

# Then the calculated regime (red squares) for backward tracing is
regime_bw &lt;- traceline(t_bw, p_bw, g_bw, discharges, loss = actual_loss, forward = FALSE)
print(regime_bw)

# $temperature
# [1] 130.000893685 129.180497939 128.427226907 127.963046346
#
# $pressure
# [1] 0.588399833660 0.587861095778 0.587422779315 0.587214377798
#
# $flow_rate
# [1] 250 250 240 220
#
# $loss
# [1] 348.0000 347.1389 346.3483 345.8610
#
# $flux
# [1] 181.959958158 181.509711836 181.096328092 180.841531863
#
# $Q
# [1] 5011200.000 4415606.808 2493707.760 2905232.400

# Let compare sensor readings with backward tracing results:
tracing &lt;- with(regime_bw, {
  lambda &lt;- function(val, constraint)
    c(val, constraint, constraint - val,
      abs(constraint - val)*100/constraint)
  first &lt;- 1
  structure(
    rbind(
      lambda(temperature[first], t_fw),
      lambda(pressure[first],    p_fw),
      lambda(flow_rate[first], g_fw)
    ),
    dimnames = list(
      c("temperature", "pressure", "flow_rate"),
      c("sensor.value", "traced.value", "abs.discr", "rel.discr")
    )
  )
})
print(tracing)

# sensor.value   traced.value          abs.discr         rel.discr
# temperature 130.00089368526 130.0000000000 -8.93685255676e-04 0.000687450196674
# pressure      0.58839983366   0.5883990075 -8.26160099998e-07 0.000140408139624
# flow_rate   250.00000000000 250.0000000000  0.00000000000e+00 0.000000000000000

</code></pre>


</div>