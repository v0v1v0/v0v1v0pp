<div class="container">

<table style="width: 100%;"><tr>
<td>BBmm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Beta-binomial mixed-effects model
</h2>

<h3>Description</h3>

<p><code>BBmm</code> function performs beta-binomial mixed-effects models, i.e., it allows the inclusion of gaussian random effects in the linear predictor of a logistic beta-binomial regression model.
</p>
<p>The structure of the random part of the model can be expecified by two different ways: (i) determining the <code>random.formula</code> argument, or (ii) especifying the model matrix of the random effects, <code>Z</code>, and determining the number of random effects in each random component, <code>nRandComp</code>.
</p>
<p>For the estimation of the parameters the joint log-likelihood can be optimized by means of two different approaches: (i) BB-Delta, specific Delta algorithm developed for beta-binomial mixed-effect regression models, and (ii) usual Newton-Raphson method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">BBmm(fixed.formula,X,y,random.formula,Z=NULL,nRandComp=NULL,m,data,
      method="BB-Delta",maxiter=50,show=FALSE,nDim=1,tolerance=10^(-6))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fixed.formula</code></td>
<td>
<p> an object of class <code>"formula"</code> (or one that can be coerced to that class): a symbolic description of the fixed part of the model to be fitted. It must be specified in cases where the model matrix of the fixed effects <code>X</code> and the outcome variable <code>y</code> are not specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p> a matrix class object containing the covariate structure of the fixed part of the model to be fitted. If the <code>fixed.formula</code> argument is specified this argument should not be defined, as we will be specifying twice the fixed structure of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p> a vector containing the outcome variable(s). If joint analysis is expected, the outcome variables must be listed one after another in a vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.formula</code></td>
<td>
<p> an object of class <code>"formula"</code> (or one that can be coerced to that class): a symbolic description of the random part of the model to be fitted. It must be specified in cases where the model matrix of the random effects <code>Z</code> is not determined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p> the design matrix of the random effects. If the <code>random.formula</code> argument is specified this argument should not be specified, as we will be specifying twice the random structure of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nRandComp</code></td>
<td>
<p> the number of random effects in each random component of the model. It must be especified as a vector, where the 'i'th value must correspond with the number of random effects of the 'i'th random component. It must be only determined when we specify the random structure of the model by the model matrix of the random effects, <code>Z</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p> maximum score number in each beta-binomial observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from environment(formula).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p> the methodology for performing the estimation of the parameters. Options "BB-Delta" or "NR". Default "BB-Delta".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p> the maximum number of iterations in the parameters estimation algorithm. Default 50.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show</code></td>
<td>
<p> logical parameter. If <code>TRUE</code>, the step by step optimization process will be shown in the screen. <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nDim</code></td>
<td>
<p> number of response outcome variables involved in the multidimensional analysis. <code>nDim=1</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p> tolerance of the estimated linear predictor in the estimation process. <code>tolerance=10^(-6)</code> by default.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>BBmm</code> function performs beta-binomial mixed-effects regression models. It extends the beta-binomial regression model including gaussian random effects in the linear predictor. The model is defined as, conditional on some gaussian random effects <code class="reqn">u</code>, the response variable <code class="reqn">y</code> follows a beta-binomial distribution with parameters <code class="reqn">m</code>, <code class="reqn">p</code> and <code class="reqn">\phi</code>,
</p>
<p style="text-align: center;"><code class="reqn">y|u \sim BB(m,p,\phi), \text{and } u \sim N(0,D)</code>
</p>

<p>where the regression model is defined as,
</p>
<p style="text-align: center;"><code class="reqn">\log(p/(1-p))=X*\beta+Z*u</code>
</p>

<p>and <code class="reqn">D</code> is determined by some dispersion parameters icluded in the parameter vector <code class="reqn">\theta</code>.
</p>
<p>The estimation of the regression parameters <code class="reqn">\beta</code> and the prediction of the random effects <code class="reqn">u</code> is done via the extended likelihood, where the marginal likelihood is approximated to the h-likelihood by a first order Laplace approximation,
</p>
<p style="text-align: center;"><code class="reqn">h=f(y|\beta,u,\theta)+f(u|\theta).</code>
</p>

<p>The previous formula do not have a closed form and numerical methods are needed for the estimation precedure. Two approches are available in the function in order to perform the fixed and random effects estimation: (i) A special case of the Delta algorithm developed for beta-binomial mixed-effects model estimations, and (ii) the general Newton-Raphson algorithm available in R-package <code>rootSolve</code>.
</p>
<p>On the other hand, the estimation of dispersion parameters by the h-likelihood can be bias due to the previous estimation of the regression parameters. Consequenlty, a penalization of the h-likelihood must be performed to get unbiased estimations of the dispersion parameters. Lee and Nelder (1996) proposed the adjusted profile h-likelihood, where the following penalization is applied,
</p>
<p style="text-align: center;"><code class="reqn">h(\theta)=h+(1/2)*\log[det(2\pi H^{-1})],</code>
</p>

<p>being <code class="reqn">H</code> the Hessian matrix of the model, replacing the terms <code class="reqn">\beta</code> and <code class="reqn">u</code> involved in the previous formula with their estimates.
</p>
<p>The method iterates between both estimation processes until convergence is reached based on the pre-established tolerance of the linear predictor.
</p>


<h3>Value</h3>

<p><code>BBmm</code> returns an object of class "<code>BBmm</code>".
</p>
<p>The function <code>summary</code> (i.e., <code>summary.BBmm</code>) can be used to obtain or print a summary of the results..
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fixed.coef</code></td>
<td>
<p> estimated value of the fixed coefficients of the regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.vcov</code></td>
<td>
<p> variance and covariance matrix of the estimated fixed coefficients of the regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.coef</code></td>
<td>
<p> predicted random effects of the regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma.coef</code></td>
<td>
<p> estimated value of the random effects variance parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma.var</code></td>
<td>
<p> variance of the estimated value of the random effects variance parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi.coef</code></td>
<td>
<p> estimated value of the dispersion parameter of the conditional beta-binomial distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi.coef</code></td>
<td>
<p> estimated value of the logrithm of the dispersion parameter of the conditional beta-binomial distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi.var</code></td>
<td>
<p> variance of the estimation of the logarithm of the conditional beta-binomial distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.values</code></td>
<td>
<p> the fitted mean values of the probability parameter of the conditional beta-binomial distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv</code></td>
<td>
<p> convergence of the methodology. If the method has converged it returns "yes", otherwise "no".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviance</code></td>
<td>
<p> deviance of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p> degrees of freedom of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.deviance</code></td>
<td>
<p> null-deviance, deviance of the null model. The null model will only include an intercept as the estimation of the probability parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.df</code></td>
<td>
<p> degrees of freedom of the null model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nRand</code></td>
<td>
<p> number of random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nComp</code></td>
<td>
<p> number of random components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nRandComp</code></td>
<td>
<p> number of random effects in each random component of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>namesRand</code></td>
<td>
<p> names of the random components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p> number of iterations in the estimation method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nObs</code></td>
<td>
<p> number of observations in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p> dependent response variable in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p> model matrix of the fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p> model matrix of the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p> variance and covariance matrix of the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balanced</code></td>
<td>
<p> if the response dependent variable is balanced it returns "yes", otherwise "no".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p> maximum score number in each beta-binomial observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p> the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p> the formula supplied.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>J. Najera-Zuloaga
</p>
<p>D.-J. Lee
</p>
<p>I. Arostegui
</p>


<h3>References</h3>

<p>Najera-Zuloaga, J.; Lee, D.-J.; Esteban, C. &amp; Arostegui, I. (2023): Multidimensional beta-binomial regression model: a joint
analysis of patient-reported outcomes. <em>Statistical Modelling</em>, 0(0).
</p>
<p>Najera-Zuloaga J., Lee D.-J. &amp; Arostegui, I. (2019): A beta-binomial mixed effects model approach for analysing longitudinal discrete and bounded outcomes. <em>Biometrical Journal</em>, 61(3), 600-615.
</p>
<p>Najera-Zuloaga J., Lee D.-J. &amp; Arostegui I. (2018): Comparison of beta-binomial regression model approaches to analyze health related quality of life data. <em>Statistical Methods in Medical Research</em>, 27(10), 2989-3009.
</p>
<p>Lee Y. &amp; Nelder J. A. (1996): Hierarchical generalized linear models, <em>Journal of the Royal Statistical
Society. Series B</em>, <b>58</b>, 619-678
</p>


<h3>See Also</h3>

<p>The <code>multiroot</code> and <code>uniroot</code> functions of the R-package <code>rootSolve</code> for the general Newton-Raphson algorithm.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(7)

# Defining the parameters
k &lt;- 100
m &lt;- 10
phi &lt;- 0.5
beta &lt;- c(1.5,-1.1)
sigma &lt;- 0.5

# Simulating the covariate and random effects
x &lt;- runif(k,0,10)
X &lt;- model.matrix(~x)
z &lt;- as.factor(rBI(k,4,0.5,2))
Z &lt;- model.matrix(~z-1)
u &lt;- rnorm(5,0,sigma)


# The linear predictor and simulated response variable
eta &lt;- beta[1]+beta[2]*x+crossprod(t(Z),u)
p &lt;- 1/(1+exp(-eta))
y &lt;- rBB(k,m,p,phi)
dat &lt;- data.frame(cbind(y,x,z))
dat$z &lt;- as.factor(dat$z)

# Apply the model
model &lt;- BBmm(fixed.formula = y~x,random.formula = ~z,m=m,data=dat)
model

#---------#

# Multidimensional regression with 2 dimensions

set.seed(5)
nId &lt;- 25

# Simulation

m &lt;- 10
beta1 &lt;- c(1,-0.5)
beta2 &lt;- c(-1,0.5)
beta &lt;- cbind(beta1,beta2)

x1 &lt;- rnorm(nId, 1,2)
X1 &lt;- model.matrix(~x1)
x2 &lt;- rnorm(nId, -1,1)
X2 &lt;- model.matrix(~x2)

sigma &lt;- 0.6
u &lt;- rnorm(nId,0,sigma)

eta1 &lt;- beta1[1]+x1*beta1[2]+u
p1 &lt;- 1/(1+exp(-eta1))
eta2 &lt;- beta2[1]+x2*beta2[2]+u
p2 &lt;- 1/(1+exp(-eta2))

phi1 &lt;- 0.3
phi2 &lt;- 1
phi &lt;- c(phi1,phi2)

y1 &lt;- rBB(nId,m,p1,phi1)
y2 &lt;- rBB(nId,m,p2,phi2)
y &lt;- c(y1,y2)

# Define matrices

X &lt;- Matrix::bdiag(X1,X2)
X &lt;- as.matrix(X)
Z. &lt;- diag(nId)
Z &lt;- kronecker(rbind(1,1),Z.)

# Fit the model

Model.multi &lt;- BBmm(X=X,y=y,Z=Z,nRandComp = nId,m=m,nDim=2)
Model.multi

</code></pre>


</div>