<div class="container">

<table style="width: 100%;"><tr>
<td>NesPrInDT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nested <code>PrInDT</code> with additional undersampling of a factor with two unbalanced levels</h2>

<h3>Description</h3>

<p>Function for additional undersampling of the factor 'nesvar' with two unbalanced levels to avoid dominance of the level with higher frequency.
The factor 'nesvar' is allowed not be part of the input data frame 'datain'. The data of this factor is given in the vector 'nesunder'. 
The observations in 'nesunder' have to represent the same cases as in 'datain' in the same ordering.<br><code>PrInDT</code> is called 'repin' times with subsamples of the original data so that the level with the larger frequency in the vector 'nesunder' has 
approximately the same number of values as the level with the smaller frequency.<br>
Only the arguments 'nesvar', 'nesunder', and 'repin' relate to the additional undersampling, all the other arguments relate to the standard 
<code>PrInDT</code> procedure. <br> As in <code>PrInDT</code>, the aim is to optimally model the relationship between the two-class factor variable 'classname' and all other factor and  
numerical variables in the data frame 'datain' by means of 'N' repetitions of undersampling. The trees generated by <code>PrInDT</code> can be
restricted by excluding unacceptable trees which include split results specified in the character strings of the vector 'ctestv'.<br>
The probability threshold 'thres' for the prediction of the smaller class may be specified (default = 0.5).<br>
Undersampling may be stratified in two ways by the feature 'strat'.<br>
The results are evaluated on the full sample and on the subsamples of 'nesunder'.
</p>
<p><strong>Reference</strong> <br> Weihs, C., Buschfeld, S. 2021b. NesPrInDT: Nested undersampling in PrInDT. 
arXiv:2103.14931
</p>


<h3>Usage</h3>

<pre><code class="language-R">NesPrInDT(datain, classname, ctestv=NA, N, plarge, psmall=1.0, conf.level=0.95,
       thres=0.5, stratvers=0, strat=NA, seedl=TRUE, nesvar, nesunder, repin)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>datain</code></td>
<td>
<p>Input data frame with class factor variable 'classname' and the<br>
influential variables, which need to be factors or numericals (transform logicals and character variables to factors)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classname</code></td>
<td>
<p>Name of class variable (character)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctestv</code></td>
<td>
<p>Vector of character strings of forbidden split results;<br>
see function <code>PrInDT</code> for details.<br>
If no restrictions exist, the default = NA is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>Number of repetitions (integer &gt; 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plarge</code></td>
<td>
<p>Undersampling percentage of larger class (numerical, &gt; 0 and &lt;= 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psmall</code></td>
<td>
<p>Undersampling percentage of smaller class (numerical, &gt; 0 and &lt;= 1);<br>
default = 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>(1 - significance level) in function <code>ctree</code> (numerical, &gt; 0 and &lt;= 1);<br>
default = 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thres</code></td>
<td>
<p>Probability threshold for prediction of smaller class; default = 0.5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratvers</code></td>
<td>
<p>Version of stratification;<br>
= 0: none (default),<br>
= 1: stratification according to the percentages of the values of the factor variable 'strat',<br>
&gt; 1: stratification with minimum number 'stratvers' of observations per value of 'strat'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strat</code></td>
<td>
<p>Name of one (!) stratification variable for undersampling (character);<br>
default = NA (no stratification)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seedl</code></td>
<td>
<p>Should the seed for random numbers be set (TRUE / FALSE)?<br>
default = TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nesvar</code></td>
<td>
<p>Name of factor to be undersampled (character)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nesunder</code></td>
<td>
<p>Data of factor to be undersampled (integer)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>repin</code></td>
<td>
<p>Number of repetitions (integer) for undersampling of 'nesvar'</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Standard output can be produced by means of <code>print(name)</code> or just <code> name </code> as well as <code>plot(name)</code>  where 'name' is the output data 
frame of the function.<br>
The plot function will produce a series of more than one plot. If you use R, you might want to specify <code>windows(record=TRUE)</code> before 
<code>plot(name)</code> to save the whole series of plots. In R-Studio this functionality is provided automatically.
</p>


<h3>Value</h3>

  
<dl>
<dt>undba</dt>
<dd>
<p>balanced accuracies on undersamples</p>
</dd>
<dt>imax</dt>
<dd>
<p>indices of best trees on undersamples</p>
</dd>
<dt>undba3en</dt>
<dd>
<p>balanced accuracies of ensembles of 3 best trees on undersamples</p>
</dd>
<dt>accF</dt>
<dd>
<p>balanced accuracies on full sample</p>
</dd>
<dt>accE</dt>
<dd>
<p>balanced accuracy on full sample of best ensemble of 3 trees from undersampling</p>
</dd>
<dt>maxt</dt>
<dd>
<p>indices of best trees on full sample</p>
</dd>
<dt>treesb</dt>
<dd>
<p>3 best trees of all undersamples of 'nesunder'; refer to an individual tree as <code>treesb[[k]]</code>, k = 1, ..., 3*repin</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R"># data input and preparation --&gt; data frame with 
#   class variable, factors, and numericals (no character variables)!!
data &lt;- PrInDT::data_speaker
data &lt;- na.omit(data)
nesvar &lt;- "SPEAKER"
N &lt;- 49  # no. of repetitions in inner loop
plarge &lt;- 0.06 # sampling percentage for larger class in nesunder-subsample
psmall &lt;- 1 # sampling percentage for smaller class in nesunder-subsample
nesunder &lt;- data$SPEAKER
data[,nesvar] &lt;- list(NULL)
outNes &lt;- NesPrInDT(data,"class",ctestv=NA,N,plarge,psmall,conf.level=0.95,nesvar=nesvar,
  nesunder=nesunder,repin=5)
outNes
plot(outNes)
hist(outNes$undba,main=" ",xlab = "balanced accuracies of 3 best trees of all undersamples")

</code></pre>


</div>