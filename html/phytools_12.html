<div class="container">

<table style="width: 100%;"><tr>
<td>anc.ML</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Ancestral character estimation using likelihood</h2>

<h3>Description</h3>

<p>This function estimates the evolutionary parameters and ancestral states for Brownian evolution using likelihood. It is also possible (for <code>model="BM"</code>) to allow for missing data for some tip taxa.
</p>


<h3>Usage</h3>

<pre><code class="language-R">anc.ML(tree, x, maxit=2000, model=c("BM","OU","EB"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p>an object of class <code>"phylo"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a vector of tip values for species; <code>names(x)</code> should be the species names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>an optional integer value indicating the maximum number of iterations for optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>model of continuous character evolution on the tree. It's possible that only <code>model="BM"</code> &amp; <code>model="EB"</code> work in the present version as <code>model="OU"</code> has not be thoroughly tested &amp; some bugs were reported for an earlier version.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Because this function relies on a high dimensional numerical optimization of the likelihood function, <code>fastAnc</code> should probably be preferred for most purposes. If using <code>anc.ML</code>, users should be cautious to ensure convergence. 
</p>
<p>This issue has been ameliorated in <span class="pkg">phytools</span> &gt;= 0.2-48 by seeding the ML optimization with the result from <code>fastAnc</code>.
</p>
<p>For <code>model="EB"</code> this should also not be a problem as the numerical optimization is performed for only <code>sig2</code> and <code>r</code>, while the ML values of the ancestral states are obtained during every iteration of the optimization algorithmically using the re-rooting method.
</p>


<h3>Value</h3>

<p>An object of class <code>"anc.ML"</code> with at least the following four elements (if not more, depending on <code>model</code>):
</p>
<table>
<tr style="vertical-align: top;">
<td><code>sig2</code></td>
<td>
<p>the variance of the BM process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ace</code></td>
<td>
<p>a vector with the ancestral states.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>the log-likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>the value of <code>convergence</code> returned by <code>optim</code> (0 is good).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Liam Revell <a href="mailto:liam.revell@umb.edu">liam.revell@umb.edu</a></p>


<h3>References</h3>

<p>Revell, L. J. (2024) phytools 2.0: an updated R ecosystem for phylogenetic comparative methods (and other things). <em>PeerJ</em>, <b>12</b>, e16505.
</p>
<p>Schluter, D., Price, T., Mooers, A. O., and Ludwig, D. (1997) Likelihood of ancestor states in adaptive radiation. <em>Evolution</em> <b>51</b>, 1699-1711.
</p>


<h3>See Also</h3>

<p><code>ace</code>, <code>anc.Bayes</code>, <code>fastAnc</code>, <code>optim</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## load data from Garland et al. (1992)
data(mammal.tree)
data(mammal.data)
## extract character of interest
ln.bodyMass&lt;-log(setNames(mammal.data$bodyMass,
    rownames(mammal.data)))
## estimate ancestral state under BM model
fit.BM&lt;-anc.ML(mammal.tree,ln.bodyMass)
print(fit.BM)
</code></pre>


</div>