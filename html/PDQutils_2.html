<div class="container">

<table style="width: 100%;"><tr>
<td>AS269</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Higher order Cornish Fisher approximation.</h2>

<h3>Description</h3>

<p>Lee and Lin's Algorithm AS269 for higher order Cornish Fisher quantile approximation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">AS269(z,cumul,order.max=NULL,all.ords=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>the quantiles of the normal distribution. an atomic vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cumul</code></td>
<td>
<p>the standardized cumulants of order 3, 4, ..., k. an atomic
vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order.max</code></td>
<td>
<p>the maximum order approximation, must be greater than
<code>length(cumul)+2</code>.
We assume the cumulants have been adjusted to reflect that the random
variable has unit variance ('standardized cumulants')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all.ords</code></td>
<td>
<p>a logical value. If <code>TRUE</code>, then results are returned
as a matrix, with a column for each order of the approximation. Otherwise
the results are a matrix with a single column of the highest order
approximation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The Cornish Fisher approximation is the Legendre
inversion of the Edgeworth expansion of a distribution, but ordered
in a way that is convenient when used on the mean of a number of
independent draws of a random variable. 
</p>
<p>Suppose <code class="reqn">x_1, x_2, \ldots, x_n</code> are <code class="reqn">n</code> independent 
draws from some probability distribution. 
Letting 
</p>
<p style="text-align: center;"><code class="reqn">X = \frac{1}{\sqrt{n}} \sum_{1 \le i \le n} x_i,</code>
</p>

<p>the Central Limit Theorem assures us that, assuming finite variance, 
</p>
<p style="text-align: center;"><code class="reqn">X \rightarrow \mathcal{N}(\sqrt{n}\mu, \sigma),</code>
</p>

<p>with convergence in <code class="reqn">n</code>.
</p>
<p>The Cornish Fisher approximation gives a more detailed picture of the
quantiles of <code class="reqn">X</code>, one that is arranged in decreasing powers of
<code class="reqn">\sqrt{n}</code>. The quantile function is the function <code class="reqn">q(p)</code> 
such that <code class="reqn">P\left(X \le q(p)\right) = q(p)</code>. The
Cornish Fisher expansion is 
</p>
<p style="text-align: center;"><code class="reqn">q(p) = \sqrt{n}\mu + \sigma \left(z + \sum_{3 \le j} c_j f_j(z)\right),</code>
</p>

<p>where <code class="reqn">z = \Phi^{-1}(p)</code>, and <code class="reqn">c_j</code> involves
standardized cumulants of the distribution of <code class="reqn">x_i</code> of order
up to <code class="reqn">j</code>. Moreover, the <code class="reqn">c_j</code> include decreasing
powers of <code class="reqn">\sqrt{n}</code>, giving some justification for truncation.
When <code class="reqn">n=1</code>, however, the ordering is somewhat arbitrary.
</p>


<h3>Value</h3>

<p>A matrix, which is, depending on <code>all.ords</code>, either with one column per 
order of the approximation, or a single column giving the maximum order
approximation. There is one row per value in <code>z</code>.
</p>
<p>Invalid arguments will result in return value <code>NaN</code> with a warning.
</p>


<h3>Note</h3>

<p>A warning will be thrown if any of the z are greater than 
3.719017274 in absolute value; the traditional AS269 errors out in this
case.
</p>


<h3>Author(s)</h3>

<p>Steven E. Pav <a href="mailto:shabbychef@gmail.com">shabbychef@gmail.com</a>
</p>


<h3>References</h3>

<p>Lee, Y-S., and Lin, T-K. "Algorithm AS269: High Order Cornish Fisher
Expansion." Appl. Stat. 41, no. 1 (1992): 233-240. 
<a href="http://www.jstor.org/stable/2347649">http://www.jstor.org/stable/2347649</a>
</p>
<p>Lee, Y-S., and Lin, T-K. "Correction to Algorithm AS269: High Order 
Cornish Fisher Expansion." Appl. Stat. 42, no. 1 (1993): 268-269. 
<a href="http://www.jstor.org/stable/2347433">http://www.jstor.org/stable/2347433</a>
</p>
<p>AS 269. <a href="http://lib.stat.cmu.edu/apstat/269">http://lib.stat.cmu.edu/apstat/269</a>
</p>
<p>Jaschke, Stefan R. "The Cornish-Fisher-expansion in the context of 
Delta-Gamma-normal approximations." No. 2001, 54. Discussion Papers, 
Interdisciplinary Research Project 373: Quantification and Simulation of 
Economic Processes, 2001. 
<a href="http://www.jaschke-net.de/papers/CoFi.pdf">http://www.jaschke-net.de/papers/CoFi.pdf</a>
</p>


<h3>See Also</h3>

<p><code>qapx_cf</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">foo &lt;- AS269(seq(-2,2,0.01),c(0,2,0,4))
# test with the normal distribution:
s.cumul &lt;- c(0,0,0,0,0,0,0,0,0)
pv &lt;- seq(0.001,0.999,0.001)
zv &lt;- qnorm(pv)
apq &lt;- AS269(zv,s.cumul,all.ords=FALSE)
err &lt;- zv - apq

# test with the exponential distribution
rate &lt;- 0.7
n &lt;- 18
# these are 'raw' cumulants'
cumul &lt;- (rate ^ -(1:n)) * factorial(0:(n-1))
# standardize and chop
s.cumul &lt;- cumul[3:length(cumul)] / (cumul[2]^((3:length(cumul))/2))
pv &lt;- seq(0.001,0.999,0.001)
zv &lt;- qnorm(pv)
apq &lt;- cumul[1] + sqrt(cumul[2]) * AS269(zv,s.cumul,all.ords=TRUE)
truq &lt;- qexp(pv, rate=rate)
err &lt;- truq - apq
colSums(abs(err))

# an example from Wikipedia page on CF, 
# \url{https://en.wikipedia.org/wiki/Cornish%E2%80%93Fisher_expansion}
s.cumul &lt;- c(5,2)
apq &lt;- 10 + sqrt(25) * AS269(qnorm(0.95),s.cumul,all.ords=TRUE)

</code></pre>


</div>